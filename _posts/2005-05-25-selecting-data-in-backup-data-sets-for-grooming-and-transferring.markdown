---

title: Selecting data in backup data sets for grooming and transferring
abstract: A method for grooming a backup data set is disclosed. The method comprises receiving data associated with one or more restore points associated with the backup data set. The method further comprises automatically selecting one or more of said one or more restore points for retention, removal, or transfer.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08335768&OS=08335768&RS=08335768
owner: EMC Corporation
number: 08335768
owner_city: Hopkinton
owner_country: US
publication_date: 20050525
---
Data backup for a computer system s stored data involves storing at different times copies of the data in a secondary storage location e.g. on a secondary storage media or device or in a secondary location on a primary storage media or device. The copies are often compressed and managed by a backup software system. Managing the copies of the computer system s stored data includes understanding the data s relevance with respect to time some data is relevant for long periods of time i.e. medical records or financial records and some data is relevant for short periods of time i.e. email server or cached data from web browsers . Managing the copies of the computer system s stored data also includes understanding the requirements for availability of the copies some data may be required to be available with a few hours notice some data may be required to be available with a week s notice and some data may be required to be available despite the destruction of the source computer system. Current approaches are inefficient because they do not take into account the varied time relevance and availability requirements different data have. Keeping all data for the longest retention period applicable to any portion thereof results in unneeded data being retained increasing storage and management costs. Likewise keeping all data at the highest level of availability applicable to any portion thereof results in data that could not be sent offsite e.g. being kept close at hand again increasing storage and administrative costs. Segregating data having different retention and or availability requirements may not always be practicable and has higher costs associated with it as well. There is a need therefore for backup management capabilities that take into account the varied requirements of data in backup data sets.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer readable medium such as a computer readable storage medium or a computer network wherein program instructions are sent over optical or electronic communication links. In this specification these implementations or any other form that the invention may take may be referred to as techniques. A component such as a processor or a memory described as being configured to perform a task includes both a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. In general the order of the steps of disclosed processes may be altered within the scope of the invention.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

Automatically selecting data in backup data sets for grooming and or transfer is disclosed. In some embodiments data is selectively transferred from removed from and or retained in a backup dataset based at least in part on an at least partly automated selection process that takes into account the varied time relevance and availability requirements different data have. In some embodiments selected data comprising a backup data set is selected to be retained in a grooming or included in a transfer operation based at least in part on the desired time relevance of the data e.g. a retention period applicable to the data by virtue of a regulatory requirement organizational or user policy etc. and or a heuristic or other time based criteria that ensures that more relevant data e.g. more recently stored or revised data is included or included with higher frequency or granularity than older or unchanged data. In some embodiments selected data comprising a backup data set is selected to be retained in a grooming or included in a transfer operation based at least in part on availability requirements in that data is selectively stored in multiple redundant locations according to the desired availability of the data e.g. so that certain data is available immediately from a local backup storage device or media whereas older or other data less likely to be needed quickly is stored offsite. In some embodiments backup data is selected to be transferred retained and or removed by indicating one or more restore points to be retained and or removed. As used herein a restore point refers to all files directories as they existed at a particular instance in time e.g. as of the time of an associated backup operation. In some embodiments a restore point may comprise a synthetic full backup. In some embodiments specific files e.g. as stored on backup media as part of a backup data set may be designated for transfer retention and or removal. In some embodiments a restore point provides the ability to restore files and directories as they existed at a particular instance in time using incremental backups.

In the following selecting data in a backup data set is discussed in the context of grooming a backup data set which includes selectively retaining and or removing data in the backup data set. In some embodiments selecting is used for selecting data in a backup data set for transferring to a transfer data set. In some embodiments the selected data comprises a subset of data comprising a backup data set which subset is transferred to a second backup storage device or media e.g. to enable the selected subset of data to be stored in a second physical device or location.

Selecting data in a backup data set for grooming and transferring is disclosed. In some embodiments grooming a backup data set includes selectively removing and or retaining data included in the backup data set e.g. based on some criterion or set of criteria and transferring a backup data set includes selectively transferring data included in the backup data set. In some embodiments data is selected to be retained in and or removed from or transferred from the backup data set based at least in part on a time based criterion or heuristic such as an amount of time that has passed since particular data was added to the backup data set and or a particular time or event such as a particular backup operation with which the data is associated. In some embodiments data is selected to be retained in and or removed from or transferred from the backup data set based at least in part on restore points. In various embodiments grooming or transfer occurs automatically when needed i.e. when the secondary storage device is full at media request e.g. when the user decreases the number of backup sessions allowed on the backup media on a scheduled basis or when manually triggered e.g. when the user decreases the amount of disc space available for the backup data sets or when triggered by a trigger external to the backup system e.g. a storage system might be used for storing backup data sets and emails if the email system needs more space on the storage system it might invoke grooming on the backup data sets in order to free up space on the storage system . In some embodiments a trigger external to the backup system may include using an Application Programming Interface API .

In some embodiments a backup data set contains backup information in addition to backup data. Backup information may be stored in one or more records comprising a backup data set. In various embodiments backup information may include a catalog of the contents of the backup set or data to recreate a catalog of the contents of the backup data set. In some embodiments the catalog includes one or more indexes of the source data set at particular backup times and the corresponding locations at which each element of source data is stored on backup media also called a restore point index. In some embodiments the backup information includes for each backup session i.e. operation or event session data identifying the data actually copied to backup media during the session. In some embodiments if a file in the index of a data set at a particular backup time already exists in the backup data set because it had not changed from a previous backup then the file is not stored again during the current backup session and in some such embodiments the session data is associated with source data that has changed or is new since the last backup session. In some embodiments a restore point index points to data in one or more sets of session data to indicate for each element of source data e.g. each file and directory the session s during which the element of source data as it existed at the time of the backup with which the restore point index is associated was stored. In some embodiments the combination of the restore point index and the session data makes it possible to determine for each element of data associated with a restore point index the location on backup media of the corresponding backup data which in turn makes it possible to use the backup data set to reconstruct the source data set in the form it existed at the time associated with the restore point index e.g. at the time of a backup operation with which the restore point index is associated. The backup information stored with a backup data set may include other and or different information about the backup data set the source data set from which it originated and or the backup sessions through which the backup data set was generated.

In some embodiments one or more restore points may be selected for retention by an automated process. In some embodiments restore points are selected automatically for retention based at least in part on a rule or algorithm for selecting restore points for retention that results in a higher frequency of restore points being retained for more recent restore points and a lower frequency of restore points being retained for less recent restore points. For example in some embodiments a restore point for every day in the last week is selected for retention but only one restore point for each of the remaining weeks in the last month is included. Or for example restore points are retained for every week in the last month but only one restore point is to be retained for the remaining months in the last year.

In some embodiments a rule for selecting restore points to be retained includes having different frequencies of restore points selected to be retained based one or more of the following a computer system or host with which the source data is associated an application with which the source data is associated or a process with which the source data is associated. For example the mail server computer system may require more frequent retention of restore points in the recent past but for several years ago few restore points are required. Another example a software development computer system may require frequent restore points all the time since it is important to be able to recover specific past instances of a developing software program.

In some embodiments a rule for selecting restore points to be retained includes selecting the restore points based on criteria for backups. For example criteria for backups may be to have at least five backups on site where four backups are from within the last week and one backup is at least one week old but not older than one month old. Or for example criteria for backups may be to have at least three backups at another company location that are not older than one month and at least one backup at a third party site i.e. a document warehouse that is no older than six months. The backup system software having been informed as to where the secondary storage device is located or where the secondary storage device media is to be located would determine the restore points to be retained. In some embodiments criteria for backups may indicate that a backup data set no older than one week is required to be available at two office locations.

In some embodiments a rule for selecting restore points to be retained includes selecting the restore points based on criteria for restore points. For example only the most recent restore point for each source is selected to be retained for grooming. This example is specifically useful for transfer where a rule that automatically selects most recent restore points for each source corresponding to previous transfer selections saves the user from selecting from among a number of restore points each time for a similar transfer.

In some embodiments a rule for selecting specific files or data to be retained uses a time based criteria. In various embodiments the time based criteria may be based on a relative time an absolute time or a restore point. For example any files or data may be retained if they have been altered more recently than last week from the current date. Or for example every third restore point may be retained for the last year. Or for example all accounting files may be retained for the week following the end of a fiscal quarter. In some embodiments a rule for selecting specific files or data to be retained includes retaining all files associated with a specific program or database. For example all files or data associated with the accounting system are specified to be retained. In some embodiments a rule for selecting specific files or data not to be retaining includes removing all files with specific filename extensions. For example all files with extensions .mp3 audio files and .mov movie files are specified to be removed.

In some embodiments a restore point may be locked or designated automatically for retention e.g. for regulatory or policy compliance purposes and associated backup data and backup information marked for retention automatically even if no other indication e.g. user selection that the restore point should be retained is received. This prevents the restore point from being designated for removal. In some embodiments specific files and or file types e.g. certain financial or personnel files may similarly be included automatically in a retention operation even if not otherwise designated e.g. based on a regulatory requirement organizational policy etc.

In some embodiments a restore point may be blocked from retention e.g. for retention policy or security purposes and associated backup data and backup information blocked for retention even if other indication e.g. user selection that the restore point should be retained is received. In some embodiments specific files and or file types e.g. certain confidential or temporary files may similarly be blocked in a retention operation even if otherwise designated e.g. based on a regulatory requirement organizational policy etc. In some embodiments blocking is based at in part on the user initiating the retention operation.

In some embodiments a restore point index or other backup information associated with a restore point that is not to be retained in a backup data set is removed from the backup data set along with backup data not associated with a restore point to be retained.

In a list of file addresses on the backup media is created from the session address indexes. In a list of physical file size on the backup media is created from the session address indexes. In the files that are to be retained are marked in the list of file addresses. In some embodiments the files to be retained are marked by marking the files that are to be removed. In various embodiments the files to be retained are marked in the list of file addresses by negating the address or by negating the physical file size in the list of physical file size on the backup media.

In some embodiments in an iteration of performed after an instruction to delete an entire segment has been written in any records associated with the segment for which the deletion instruction was written are not considered. In some embodiments if an instruction to delete an entire segment is written in a next record that is NOT to be removed is identified and an instruction is written to delete any intervening segments which under those circumstances would only be associated with records that are to be removed and control only then returns to in which during the ensuing iteration of any records associated with a segment for which a deletion instruction was written are not considered. If not all records in the segment are to be removed then in instructions are written in the instruction list to read the segment and write an updated segment that includes only those records in the segment that are to be retained after which control is returned to . In some embodiments writing an updated segment includes reading the segment removing the records that are to be removed and writing an updated segment that does not contain the records that were to be removed.

In some embodiments the instruction list that is executed in is designed to help safeguard against the potential failure of the computer system at any time. The instruction list along with tracking information is used in such a way that it can be ascertained how many of the instructions in the instruction list have been executed. Thus the state of the backup data set is known in the event that the grooming operation is interrupted. From this knowledge the grooming process can be resumed and completed without regard to any interruptions or failures in between the start of the grooming and the time corresponding to the interruption. In some embodiments the tracking information is designed to overcome a failure during a write operation including a failure during a writing operation that is writing tracking information.

Using the techniques described herein data is selected for retention removal or transfer based at least in part on requirements for retention and availability in some embodiments freeing up backup storage space to be used to store other data for example additional backup data that is desired to be retained.

Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.

