---

title: Node-to node messaging transceiver network with dynamic routing and configuring
abstract: The invention is a system operating on a reference frequency. The system comprises a plurality of at least three nodes. Each node hands off a message received from another node to a subsequent node. Each of the nodes comprises a transceiver receiving a message on the reference frequency from another node and transmitting the received message on the reference frequency to a subsequent node, and a controller controlling operation of the transceiver to receive the message transmitted by another node and to transmit the received message to a subsequent node.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07653394&OS=07653394&RS=07653394
owner: AFX Technology Group International, Inc.
number: 07653394
owner_city: Dallas
owner_country: US
publication_date: 20050603
---
The invention generally relates to multilevel networks and in particular to a wireless network of intelligent transceiver nodes which employ local processing and node to node data messaging to hand off messages from an origination point to a destination point.

Wireless networks such as the cellular phone system are well known in the prior art. Such networks are complex and are based on the apparent need for real time connectivity. Consumer applications of networks such as cellular phones have promoted a perception that robust real time connections are a requirement of wireless communications. Real time connections are very expensive in terms of equipment and air time. Many wireless data applications have been designed around real time communications because it has been available but many more potential applications have been unable to be cost justified using this technology.

For many applications the requirement for a real time connection is an artificial constraint and has limited the development of short range messaging between devices. There is a need for an inexpensive flexible expandable network to replace traditional network concepts which require the installation of an expensive fixed infrastructure prior to the operation of the network. Cellular phones for example require that every subscriber phone communicates only with the cellular base station. Even though there may be thousands of actual phones in the area they are not capable of direct communication with each other.

It is an object of this invention to provide a low cost multi node system which hands off messages from node to node a system of nodes which hands off messages and provides implicit and or explicit acknowledgment of the hand off a flexible adaptable multi node system which is applicable in a plurality of environments and for a plurality of uses a multi node system having stationary nodes and mobile nodes known as Minion devices the position of which can be determined by the stationary nodes a multi node system which permits nodes to communicate with a wide area network or a global positioning system via a selected number of nodes a multi node system which operates multiple applications at each node and a multi node system which interfaces with a plurality of gateways e.g. wide area network WAN connections to other communications networks whether wired or not such as telephone or CATV or wireless or satellite or terrestrial.

compensates for processor clock variations using periodic updates of entries in a table driven Manchester coding algorithm and adaptively compensating for differences in processor clock speed between a sender and a receiver using table updates computed on a message by message basis 

reduces wireless traffic by randomly increasing delays between individual message transmissions as the network traffic load increases by automatically reducing the output power of the transmission to a level just sufficient to ensure a high probability of reception by the receiver by eliminating extraneous traffic by deriving routing information by snooping on network data messages to reduce the number or routing table update messages by implementing a method of limiting the number of hops a message will take over the network that is specified by the message originator and or by implementing a flexible method of causing the message to time out if it is not delivered by a time set by the originator 

shares network resources among low cost intelligent data radios wherein the resources may include time synchronization virtual geolocation services sensor or actuator interfaces shared memory and wide area network access and

In one form the invention is a system operating on a reference frequency. The system comprises a plurality of at least three nodes. Each node hands off a message received from another node to a subsequent node. Each of the nodes comprises a transceiver receiving a message on the reference frequency from another node and transmitting the received message on the reference frequency to a subsequent node and a controller controlling operation of the transceiver to receive the message transmitted by another node and to transmit the received message to a subsequent node.

In another form the invention is a system operating on a reference frequency comprising a plurality of nodes each node comprising a transceiver and a corresponding controller for controlling the operation of the transceiver. Each controller operates its corresponding transceiver as one or more of the following types of nodes. An originating type of node provides a message in a mode in which the transceiver transmits on the reference frequency a message to another node of the system. An intermediate type of node hands off a message in a mode in which the transceiver receives on the reference frequency the message transmitted by another node and transmits on the reference frequency the received message to a subsequent node other than the node from which the message was received. A destination type of node receives the message in a mode in which the transceiver receives on the reference frequency the message transmitted by another node.

In another form the invention is a message having a protocol which permits the message to be successively transmitted by a wireless network of transceiver nodes employing node to node messaging. A message including data is sent from a first node originating via one or more intermediate nodes to a last node designated by the first node as the destination of the message. The message comprises data bits corresponding to the data originating bits identifying the first node from which the message originates destination bits identifying the last node to which the message is destined transmitting bits identifying the current node transmitting the message and receiving bits identifying the next node intended to receive the message currently being transmitted.

In yet another form the invention is a system operating on a reference frequency comprising an originating node a plurality of intermediate nodes and a destination node. The originating node provides data to the intermediate node. The originating node comprises a first transceiver transmitting on the reference frequency a message including the data and receiving on the reference frequency an implicit and or explicit acknowledgment that the message has been received by one of the intermediate nodes and a first controller controlling operation of the first transceiver to transmit the message to the intermediate node and to receive the implicit and or explicit acknowledgment that the message has been received by one of the intermediate nodes. Each of the intermediate nodes hands off the message from one node of the system to another node of the system. Each of the intermediate nodes comprises a second transceiver receiving the message transmitted on the reference frequency by the one node and transmitting on the reference frequency an implicit and or explicit acknowledgment to the one node that the message has been received by the intermediate node. The second transceiver also transmits on the reference frequency the received message and receives on the reference frequency an implicit and or explicit acknowledgment that the message has been received by the another node. A second controller controls operation of the second transceiver to receive the message transmitted by the one node and to transmit an implicit and or explicit acknowledgment that the message has been received by the intermediate node and to thereafter transmit the received message and receive the implicit and or explicit acknowledgment that the message has been received by the another node. A destination node receives the message from one of the intermediate nodes. The destination node comprises a third transceiver receiving on the reference frequency the message transmitted by the one intermediate node and transmitting on the reference frequency an implicit and or explicit acknowledgment to the one intermediate node that the message has been received by the destination node and a third controller controlling the operation of the third transceiver to receive the message transmitted by the one intermediate node and to transmit an implicit and or explicit acknowledgment that the message has been received by the destination node.

The MinionNet Network as illustrated in is a wireless data network characterized by short range device to device messaging. Minion MinionNet Minion muMinion microMinion gatewayMinion geoMinion and cap are trademarks of the assignee. As used hereinafter Minion device means Minion MinionNet Minion muMinion microMinion gatewayMinion and or geoMinion unless otherwise specified. The trademark designation will not be used hereafter for convenience. Messages are automatically routed through multiple device to device hops to provide robust area coverage redundancy noise immunity and dynamic routing and reconfiguration. These device to device messages do not have a time critical requirement such as would be found in a real time voice connection such as a cellular telephone net.

The devices used by the MinionNet network are generally referred to as Minion devices and are actually extremely inexpensive two way data radios such as a transceiver as will be described below. In particular the Minion devices may be a Minion microMinion device a gatewayMinion device or a geoMinion device each of which is a trademark of the assignee and will be described below. One key feature of these Minion devices is that they are able to exchange short data messages with each other as indicated by the arrows in . Each Minion device becomes a part of a community and can share the burden of conveying messages throughout an area. Any Minion device can directly communicate with any other Minion device within range. This facilitates message hand off and acknowledgment as will be described below.

The network according to the invention communicates in a manner that can be illustrated by a discussion at a cocktail party. Individuals form small groups and communicate among themselves. These groups are not static. From time to time new members join in or old members wander off to join another group. Some of the people just listen in without saying anything important. The members of the group are aware of the other members and may solicit information from anyone nearby. Occasionally a person Jack will decide that he needs to locate another individual Jane . If he looks around and discovers they are in the same group there is no problem. Otherwise he is likely to ask the people nearby Have you seen Jane lately He will probably receive a variety of responses. Most people will ignore him either because they didn t hear him or because they have no relevant information. One might say I saw Jane an hour ago. Another might say Jane was over near the punch bowl a few minutes ago. This gives Jack the hint that he needs to move through the crowd. He may need to ask again but eventually he will locate Jane.

A similar situation arises if there is a phone call for Jane at the group. A messenger may take the call then ask the people nearby for Jane. Eventually the message will be conveyed and Jane will be able to take the call. Sometimes the search process will take too long and the caller will hang up. This is not a problem since Jane will eventually get the message and be able to return the call. If Jane had left the group there is a high probability that the helpful messenger will be able to discover this and convey the additional information to the caller.

In keeping with the loosely structured nature of the group there is no central governing authority no broadcast announcements or global paging system. Individuals move around freely arrive and depart independently and converse with one another as they see fit. As will be pointed out below Minion devices function in a similar manner.

More particularly the network according to the invention communicates in a manner that is in contrast to the controlled environment of a moderated conference. Here there is a rigidly structured environment in which only one person at a time speaks. There is only one public address system and it is controlled by a moderator. The moderator will make a series of general announcements which establish the topics that will be allowed in this conference. This general information is assumed to be required by all of the participants. During the question and answer period participants make requests to be recognized. They will ask a question which may need to be repeated by the moderator for the benefit of the other participants. The moderator will answer the question or solicit responses from the participants. Each response will be handled in the same way participant requests recognition moderator recognizes him participant makes a statement moderator repeats statement etc. There is no direct discussion between participants. In contrast the MinionNet network as will be described below in detail does not constitute such a rigidly constructed network.

The MinionNet network operates along the same lines as the group. Each of the individuals communicates only with their neighbors that are in close proximity including those that move in. A large amount of information can be exchanged in a short period of time because the small groups all operate in parallel. Roving messengers can pass important data from one group to another while suppressing less important items. Shared resources such as telephones are efficiently used and inexpensive. There is a high level of cooperation among individuals of the group or in the case of the nodes MinionNet network. Herein a node refers to a Minion device and visa versa since a Minion device may be a node.

Traditional prior art wireless applications such as cellular phones pagers and wireless local area networks more closely resemble the moderated conference. There is invariably a controlling entity such as a satellite or base station that corresponds to the moderator. All participants are required to communicate only with this moderator and to use resources allocated by this moderator. All information eventually winds up as part of a broadcast which can be received by all participants. This is extremely slow and inefficient. There is essentially no contact between participants each cooperates and communicates only with the moderator.

A number of major market areas have been identified most notably utility monitoring and control intelligent transportation systems ITS mobile finance management building automation and control factory automation and control home automation and control security and access control and asset management. There are also a number of military and other governmental applications in addition to the above. Some of these will be described below as illustrative not limiting.

Many possible applications and implementations of the MinionNet network are contemplated only some of which are disclosed herein. For example the MinionNet network may be used as a geolocation network as described below. In this environment this is accomplished by making a small percentage of the Minion devices in the field act as geoMinion devices illustrated in block diagram form in . These geoMinion devices interface with the global positions systems GPS already in place to act as anchor points for locating other Minion devices.

Preferably all Minion devices share a common structure in the form of a radio transceiver with antenna microprocessor for controlling the transceiver memory associated with the microprocessor and a power source. The transceivers transmit and receive on the same frequency which reduces hardware requirements and allows a single filter to be used on the antenna for both transmission and reception. This also avoids the need for tuning or frequency selection equipment.

As shown in a geoMinion device comprises a Minion device configured to interface with a GPS receiver . The GPS receiver would be in contact either directly or through an optional GPS augmentation receiver to a GPS which would provide a two or three dimensional indication of the location of the GPS receiver . By locating another Minion device between several geoMinion devices the approximate position of the Minion device can be determined. The power supply options and power control of the geoMinion device will be described below with regard to .

Alternatively the MinionNet network can be used to associate anchored physical locations with virtual ones as illustrated in . For example points in the MinionNet network should be connected to a wider area network so that message travel times and network loading are minimized. This is accomplished by making a small percentage of the Minion devices in the field act as gateway Minion devices illustrated in block diagram form in . These gateway Minion devices act as concentrators for messages bound to and emanating from the centralized supervisory components of the nationwide MinionNet network. The actual wide area connectivity of a gateway Minion device may be provided by a terrestrial wide area wireless data network such as the Bell South Wireless Data Mobitex network a cellular based network using CDPD or a satellite based data network such as Orbcomm.

As shown in a gateway Minion device comprises a Minion device configured to interface with a wide area network WAN interface . The WAN interface would be in contact either directly or wireless communication with other stations which would provide data to the Minion devices or receive data from the Minion devices. The power supply options and power control of the gateway Minion device will be described below with regard to .

The dynamic configuration and automatic routing aspects of the MinionNet network Protocol cause messages to be routed by the most efficient method from their origin to their ultimate destination. Since many Minion devices will be installed in fixed locations to provide increased coverage geolocation services and application specific functions it will be possible to provide gateway services via wired and wireless local area networks and other existing data networks. All Minion devices use the same communications protocol data format and data rate to reduce software and hardware requirements as well as maintain simplicity within the network itself.

Providing Gateway Services to the individual Minion devices means that all Minion devices effectively become part of the Internet as shown in . Status enquiries and data messages can originate at any Internet workstation in the world and can be directed to any Minion device. The central MinionNet network Servers and application specific features of individual Minion devices provide any required level of security. Security features would typically include robust public key cryptography to provide end to end protection for specific data while still allowing for full participation in the shared aspects of the MinionNet network.

The virtual geolocation mechanism and routine communication between Minion devices also allows for distribution of accurate time and date information. Minion devices automatically synchronize their internal clocks to within one millisecond. MinionNet network signals can be used to coordinate events throughout the network. Routinely transmitted data messages that provide local time conversion information allow application specific devices to keep track of time zones daylight time changes and leap seconds. Minion devices can provide this important value added feature to many consumer products.

As shown in one preferred embodiment of a Minion device comprises a radio transceiver a micro controller and data memory contained on a double sided circuit board about the size of a postage stamp. Preferably the micro controller is any microprocessor or controller which can be programmed to meet the functional needs of the Minion device. For example one preferred micro controller is Model 16F876 manufactured by Microchip Technologies. Some advantages of such controllers include a built in analog to digital converter allowing power supply management an adequate number of inputs for control signals a built in clock generator so that a simple crystal need only be added to the controller a fairly low operating voltage such as 2.6 volts so that it is acceptable for battery power and programmable storage. In particular the programmable storage would preferably be an on chip flash memory which is field programmable on the fly so that the operating software of the controller could actually be changed through the MinionNet network system. In this way Minion devices could be reprogrammed through the MinionNet network without the need for physically connecting to or handling the particular Minion device being reprogrammed.

Preferably the transceiver comprises an amplifier sequenced hybrid ASH transceiver such as disclosed in U.S. Pat. No. 5 787 117 the entire disclosure of which is incorporated herein by reference. Although the radio transceiver would preferably operate in the unlicensed ISM band e.g. presently 902 928 MHZ as is approved by the FCC in the United States and by the corresponding regulatory agencies in a number of other countries particularly in North and South America with an effective output power of less than 1 milliwatt. Other embodiments using other reference frequencies and power output levels are also contemplated. A second frequency selection should cover most of the European Market. All Minion devices transmit and receive on a single frequency so that most components of the transceiver are utilized in both receiving and transmitting messages and in receiving and transmitting acknowledgments that the messages have been handed off to the next node. This eliminates the added cost and complexity inherent in spread spectrum or frequency agile approaches. The receiver is a stable inexpensive direct conversion implementation. Minion devices do not have frequency synthesizers local oscillators IF filters IF amplifiers or antenna duplexes.

Receipt of messages can be confirmed by either an implicit acknowledgment or an explicit acknowledgment. Implicit acknowledgment occurs when an originating Minion device sends a message via an intermediate Minion device to a destination Minion device and the originating Minion device receives a copy of the message when it is being transmitted by the intermediate Minion device. For example suppose Minion devices A and B communicate with each other Minion devices B and C communicate with each other and Minion devices B and D communicate with each other. Suppose Minion device A sends a message to Minion device B to be passed along to a Minion device F as shown in . Minion device A transmits the message to Minion device B which receives it. Minion device B determines that Minion device D should get the message next and transmits the message to Minion device D. Since Minion devices A and B are in communication when Minion device B transmits to Minion device D Minion device A also receives the transmission and recognizes it as the same message Minion device A previously send to Minion device B. This is an implicit acknowledgment that Minion device B received the message since Minion device B could not be handing off the message to Minion device D unless it received the message from Minion device A in the first place.

Explicit acknowledgment occurs in the following manner. Each Minion device is programmed to listen for an implicit acknowledgment of a transmitted message within a window of time e.g. one second after it transmits the message. If the originating Minion device does not receive an implicit acknowledgment from the intermediate Minion device within the window the originating Minion device retransmits the message to the intermediate Minion device. If the intermediate Minion device receives the message for a second time then it sends an explicit acknowledgment that it received the message. In other words each Minion device is programmed to transmit an explicit acknowledgment when it determines that another Minion device which sent it a message does not know that the message has been received. For example suppose Minion devices A and B communicate with each other Minion devices B and C communicate with each other and Minion devices B and D communicate with each other. Suppose Minion device A sends a message to Minion device B to be passed along to a Minion device F. Minion device A transmits the message to Minion device B which receives it. Minion device B determines that Minion device D should get the message next and transmits the message to Minion device D. Since Minion devices A and B are in communication when Minion device B transmits to Minion device D Minion device A should also receive the transmission and recognize it as the same message Minion device A previously sent to Minion device B. However if this does not happen Minion device A will retransmit the message to Minion device B. Upon receipt by Minion device B of the same message from Minion device A Minion device B will send a specific acknowledgment message to Minion device A indicating that it has received the previous message sent by Minion device A to Minion device B. This specific acknowledgment message is an explicit acknowledgment that Minion device B received the message.

All message transmissions and explicit acknowledgments are transmitted on the same reference frequency. Optionally each Minion device maintains a table of contacts with probabilities so that it knows the more or less likely Minion devices with which it can communicate.

Preferably the modulation is continuous wave CW also referred to as on off keying and the bit coding uses a self clocking Manchester code. This minimizes the power required for transmitting since the transmitter is on for exactly half the time during a message transmission and is completely off at all other times. Manchester coding requires the receiver to be able to accurately detect signal edges on off or off on transitions. These edges must occur within certain timing windows to be valid. This provides an opportunity for increased noise immunity and rejection of spurious transitions. The self clocking nature of the bit coding means that there is no requirement for long term clock stability start stop bits or zero bit insertion such as would be found in asynchronous or synchronous schemes.

Since modulation using Manchester coded data is balanced the signal rides on top of the background noise level and is very easy to detect. A simple automatic gain control provides rejection of background noise and detection of data signals over a wide dynamic range. Other modulation schemes and coding formats will be apparent to those skilled in the art.

The micro controller keeps time by a real time clock which is periodically adjusted by a timed broadcasted signal to be in synchronization with the other time clocks of the network. The micro controller stores data to be transmitted in the data memory and stores its operating software in a flash program memory . Optional expansion memory for increasing the size of the data memory may be provided. The power supply options and power control of the Minion device will be described below with regard to .

The micro controller controls the transceiver via an a d converter and a peripheral interface . The interface may be any communications interface such as a GPS receiver GPS differential augmentation wide area wireless network local area wireless network cellular modem land line modem satellite data modem personal computer interface PDA interface or any other hardware or software system interface. A schematic of the Minion device is shown in and operates according to the flow chart illustrated in .

The micro controller in implementing the flow chart of employs a modified Manchester code receiving scheme. In general the Manchester code takes every data bit and breaks it into two signaling or transmission bits. For example a 01 zero followed by one corresponds to a 0 and a 10 one followed by zero corresponds to a 1. In this way the number of transmitted bits is 50 ones and 50 zeros so that a 50 duty cycle results. As noted below this allows receivers to more easily discriminate messages from noise. It also means that pattern sensitivity to the data is not needed.

In particular the transmission of data via the MinionNet network according to the invention is accomplished at the lowest level using a modified Manchester encoding and data recovery method. In order to maximize reliability of data transfer in a single frequency environment it is necessary to ensure that there is a constant amount of energy in each bit of data in a message regardless of whether that bit is a one or zero. This modified approach ensures that there will be no data dependent conditions in which one message will be more susceptible to disruption by noise than another. This also ensures that claims related to bit error rate at the heart of a proposed distance measuring method are not impacted by data dependencies.

Furthermore the Manchester coding is self clocking. There is one signal transition for every data bit so the transmitters and the receivers that comprise the transceivers do not have to have synchronized clocks and clock drifting is not a problem. Therefore an accurate oscillator such as a crystal oscillator need not be used and other less accurate less expensive oscillators such as an RC oscillator may be used. This self clocking aspect guarantees at least one state transition on to off or off to on per bit. In particular self clocking eliminates the need for clock synchronization between the transmitting transceiver and the receiving transceiver. Allowing wide variations in the system clocks used for generation and sampling of the data stream means that low cost Minion devices are possible even including those that have no crystal oscillator for timebase generation. Also Minion devices will still function over wide ranges of temperature and supply voltage. These factors traditionally mitigate against systems without stabilized oscillators.

Simply stated Manchester codes replace each data bit with a pair of transmitted levels a zero data bit replaced by a zero one pair and a one data bit replaced by a one zero pair. The consequence exacted by this technique is that the minimum pulse width in the transmission medium is one half of the bit time for an actual data bit. This tends to lead to pulse distortion as the data rate reaches the maximum bandwidth of the channel for this modulation scheme.

Traditional demodulators try to oversample the levels from the receiver and recover the data based on the level pairs. An example technique tries to synchronize with a data bit interval and determine the direction of the transition that will occur in the center of the bit interval rising for a zero falling for a one. This does not work in the presence of pulse width distortion level noise or phase shifts that cause rising and falling edges to be displaced with respect to one another.

In one preferred embodiment of the invention the Manchester code would be detected by falling edge discrimination. Generally Manchester code is determined by measuring signal levels to determine the zero level and the one level. However the invention contemplates that signal levels need not be determined. For example by observing the behavior of the receiver and particularly the trailing edge of the bits the message can be decoded. In particular in order to decode the Manchester code it is possible to measure the interval between falling edges to determine what the code is. Depending on whether the period between falling edge half bit intervals is two half bits three half bits or four half bits this period determines whether the data results in a zero a one or a zero followed by a one. This approach provides much more tolerance than an approach which measures the level of the bits and allows the receiver to maintain synchronization.

The encoding technique of the invention relies only on the time interval between falling edges of the received signal. Pulse distortion phase shifts and level noise do not significantly affect the performance of this system. In addition the characteristics of the preferred ASH receiver are such that the rising edge of the received signal pulse tends to be subject to significantly more jitter than the falling edge especially with minimum receive signal strength. Therefore falling edge detection means less jitter.

The Training Pattern has longer than normal pulses which result in falling edges that are 5 half bit periods apart. This is detected and causes the receiving firmware to reset to its initial state. The purpose of these training bits is to condition the receiver to the signal levels that will be encountered in the message. The first training bits will usually not be detected. The system of the invention sends three training bits so that the receiving transceiver is properly conditioned at the end of the third. Specifically the receiver must be able to reliably detect the falling transition labeled Critical Edge in the timing diagram of . This marks the beginning of the data stream. Since we must have a falling edge here the first bit in the data stream must be a zero. The transmitter artificially inserts this zero. The actual data message follows and may begin with either a zero or one. Thus the interval following the critical edge may be either two or three half bit times. The MinionNet network receiver uses this interval to build the data stream into the receiver buffer. The standard MinionNet network Message is 256 bits long. Preliminary error detection occurs in the Receive Message firmware itself since bit intervals must allow correct detection of these data patterns and the number of bits must exactly conform to the message standard.

One preferred implementation uses interrupt driven firmware which is triggered for each falling edge. This means that there is at most one interrupt per data bit.

Otherwise the micro controller proceeds to step to determine if the period between the falling edges is equal to two half bit intervals. If it is this indicates that it corresponds to a zero data bit and a 0 is input into the buffer by step . The micro controller then proceeds to step to wait for the next falling edge from the received signal. If the period between falling edges is not equal to two the microprocessor proceeds to step to determine if the period is equal to three half bit intervals. If it is this indicates two data bits a zero followed by a one in which case the micro controller inputs a 0 in the buffer at step followed by a 1 input at step . Thereafter the micro controller proceeds to step to wait for the next falling edge from the received signal. If the period between falling edges is not equal to three half bit intervals as determined by step the microprocessor exits as step on the basis that no message has been received.

At step the micro controller is again waiting for the next falling edge from the received signal. If the period between falling edges is equal to two half bit intervals as determined by step the micro controller inputs a 1 in the buffer by step and returns to step to wait for the next falling edge. If the period does not equal two half bit intervals the micro controller proceeds to step to determine whether the period equals four half bit intervals. If it does a zero is stored in the buffer by step followed by a one stored in the buffer by step . Otherwise the micro controller proceeds to step to determine if the period equals three. If it does a zero is stored in the buffer by step . Otherwise the micro controller exits the program by step .

In general step waits for the falling edge of the signal after a zero bit so it is the next step after steps and . On the other hand step waits for the falling edge after a one bit so it is the next step after steps and .

Although not shown in it is possible to include a counter after each bit is entered into the buffer to ensure that no more than 256 bits which equals one message are stored in the buffer. Alternatively each time a bit is stored in the buffer the micro controller can check for overflow at that point. In other words step can include the function of determining that the number of bits for the particular message is correct. In addition step performs a CRC cyclic redundancy check calculation to confirm that there is a high probability that the message is accurate.

The messages handled by the MinionNet network can be thought of as being 32 bytes long and transferred at 9600 baud although other data rates are feasible. Each Minion device has a unique 32 bit serial number assigned during manufacture. This gives over four billion numbers although number reuse is not as big an issue in this environment as it is in some others. Each message will contain space for four of these serial numbers 1 the message originator 2 the message final destination 3 the device actually transmitting for this hop and 4 the intended receiver for this hop. Messages also contain a set of standard fields for message type codes device status bits message priority and handling bits. A payload area will contain application specific data such as geolocation information time date etc. as determined by the message type codes. In addition the protocol specifies a cyclic redundancy check e.g. CRC 16 used to detect errors encountered during transmission. The message length and data rate combine to give a maximum of approximately 20 messages per second to or from a single node. The normal operation of the network will tend to keep the actual average rate down around one message every few seconds. The actual radio modulation scheme provides easily detected balanced modulation with self clocking data bits. This allows wide variations in microprocessor clock performance with temperature and eliminates the need for a crystal oscillator.

The basic protocol is completely connectionless and each message is treated as an independent datagram. Protection mechanisms are built in to ensure robustness but delivery of any individual message is not guaranteed. The database server may initiate enquiries into the distributed network and ask for retransmission of suspected missing messages.

The purpose of certain applications is to detect missing items and generate an exception report or alarm. Much useful information may be derived from interrogating the message routing tables of nearby nodes to establish a Minion s last known location.

The Minion device transceivers are half duplex devices meaning they cannot transmit and receive at the same time. Several methods are used to avoid collisions two nodes transmitting at the same time and garbling the message for the recipient . First not all collisions will result in message corruption. If the receiver is not in range of both transmitters it is unlikely that the message will be corrupted. Second the level of traffic may be kept low and interval randomization techniques may be used to reduce the likelihood of simultaneous transmissions. Third all messages are implicitly acknowledged when they are forwarded on the next hop and explicitly acknowledged when received at their ultimate destination. Automatic retransmission and elimination of duplicate messages are features of the protocol.

Since the basic operation of the MinionNet network provides for precision time synchronization between devices it is possible to implement additional features that will enable significant power savings for applications that need it. Battery powered devices which operate in TDMA modes with dynamically adjustable windows may be capable of extraordinarily low average current drain. These Minion devices would not directly participate in the normal message routing in the network but would send and receive their own application specific data via other Minion devices in the vicinity that did not have such extreme power constraints.

Certain applications will require the ability to transfer larger amounts of data than can be contained in a single packet. These applications will use a set of extensions to the basic MinionNet network Protocol. Minion devices will pair up for point to point burst data communications. A section of memory in each Minion device to be set aside as a buffer. Once these buffers are initialized the routine operation of the network will cause the data in one buffer to be duplicated in the buffer of the other Minion device. The mechanism for the transfer is referred to as semi streaming because data is sent in packetized form at a high rate without explicit acknowledgment of each packet. Any missing packets are transmitted again correctly received packets are never sent again even if they were received in the wrong order. The maximum length of these extended data messages will be governed by the amount of memory available in each Minion device. Each Minion device may have multiple buffers and may be engaged in sending or receiving multiple messages concurrently. Each message may have an explicit primary function and other implicit functions e.g. the content of a message and the fact that a message has been sent are two useful pieces of information which can be derived from a single message.

Once a message buffer is completely received and acknowledged the Minion device will examine the message and act on its contents. If the message has reached its final destination there may be any application specific action necessary. If the message has reached an intermediate Minion device the message will be forwarded on the next hop using the same burst protocol. The hop to hop routing is the same as for basic Minion device operation. Note that the burst data protocol causes an entire message to hop intact from one Minion device to the next. Messages will never be split or follow more than one route to their destination. This allows the burst data to be sent as a series of point to point messages that do not require the overhead of full routing information in each packet. The message originator final destination and other header data are part of the full message not each individual packet. Burst data thus has a lower overhead per byte than normal network traffic. Burst data is intended to be sent over reasonably robust stable network segments.

Protocol extensions include the ability to explicitly acknowledge standard messages from multiple originators in a single message. The identification of the recipients is implied because recipients will scan their tables of recently sent messages see below to see if they had sent a message with the particular originator sequence number pair for the standard message. For example a multiple message acknowledgment may include the following fields type code indication that this is a multi message acknowledgment the serial number of the Minion device transmitting the message and a list of the originator s identification and sequence numbers that uniquely identify each message that is being acknowledged.

Data transmission is accomplished by keying the transceiver in a transmit mode ON and OFF which makes the data easier to separate from background noise at the receiver and which reduces the power requirements over FM transmission schemes by 50 . As mentioned above all packets are encoded using a modified Manchester code to provide a DC balanced data stream 50 duty cycle on the transmitter .

Transmissions begin with a training sequence of balanced pulses having a unique duration indicating that the pulses are training pulses and not data or some other information. The end of the training sequence will be signaled by a valid data bit with a value of zero. The message data will follow immediately after the end of the training sequence. Balanced coding ensures that each data bit will have equal periods of carrier OFF and carrier ON operation. A zero data bit is represented by an OFF ON or zero one transition and a one data bit is represent by an ON OFF or one zero transition.

The balanced coding enables accurate separation and detection by the transceiver of the data bits from the background noise in the receiver. In addition balanced coding makes each bit self clocking so that a precision time reference and synchronization for data transmission and reception is not required. Preferably the microprocessor need only be able to distinguish three different pulse lengths received by the transceiver half bit 1 two half bits and 1 three half bits times the data bit rate. In one preferred embodiment decoding is based on measuring the interval between the falling edges of the FR carrier signal. This is preferred over level detection since the transceiver can run at a lower sample rate.

Minion devices preferably include a hybrid transceiver that includes an ASH receiver as described above. Falling edge detection and timing is accomplished with hardware in the micro controller and is superior to leading edge detection since the leading edge in the ASH receiver transmission suffer from significant time jitter. Trailing edges tend to have less jitter.

Although any standard of error detection and correction may be used it is preferred that each data message include a CRC 16 for error detection. Error correction bits may be included in the message to correct transmission errors.

In one preferred embodiment it is contemplated that the transceiver output power be less than one 1 milliwatt although other minimums may be implemented. For 1 mW the effective transmission range would be about 100 meters. The power output relates to the range and the two parameters must be selected and adjusted based on the particular network implementation. For 1 mW at 100 m range needless interference between adjacent Minion devices is prevented particularly when the Minion devices are geographically dense. The micro controller may control the actual power output steps to reduce interference even further in very dense areas.

Since to some extent each Minion device is an independent transmitter it is possible that two Minion devices may transmit simultaneously causing a collision of messages. Those skilled in the art will recognize many ways of preventing or minimizing such collisions. In one preferred embodiment the protocol of the invention increases the interval between transmissions from a particular Minion device if the Minion device determines that a high density of data traffic is occurring. For example before beginning the transmission of training bits at the start of a message the transceiver in the receive mode will be used to listen for balanced data transitions that would indicate another message being transmitted in the vicinity. If such balanced data transitions are detected transmission of a message will be delayed by a randomly selected amount of time before attempting transmission again. For example this type of delayed transmission interval is referred to as a modified ALOHA procedure similar to the protocols used by Ethernet and Mobitex. Delaying the message helps prevent the collision of two messages which could cause garbling of both messages or corruption of either or both messages. One result of this approach is that it inherently increases the interval between transmissions from any particular Minion device in a crowded area. The benefit of this increased interval is that it limits the total RF signal strength radiated by all Minion devices in a particular area thereby reducing the possibility of collisions. This will also reduce the power consumption by individual Minion devices in crowded areas and will maintain a near constant probability of successful message transmission.

It is contemplated that connectivity on the local MinionNet network may be provided by external communications interfaces well known in the art. For example m Minion devices with external two way communication capability may be employed as gatewayMinion devices. Such external communication between a gatewayMinion device and the system database allows messages to reach the central database so that the messages can be made available to users or customers via the Internet or other networks which interface with the system database.

In addition Minion devices located in close proximity to each other may share the resources connected to their close Minion devices via their wireless MinionNet network connection. For example Minion devices without a global positioning system receiver can learn their approximate position by communicating with a nearby Minion device with a GPS receiver as described above in the section on virtual geolocation. Also Minion devices without Internet connectivity can contact the Internet via a gatewayMinion device which is connected with the Internet.

All Minion devices maintain internal clocks which are synchronized with coordinated universal time UTC via a geoMinion device and the global positioning system GPS . The precision time is maintained to approximately 1 millisecond in order to allow coordinated transmission and reception of the protocol messages. GeoMinion devices connected to the GPS are programmed to frequently broadcast high precision time messages to re synchronize other Minion devices within the network. In addition if a Minion device loses power or loses contact with the MinionNet network is programmed to recognize that its clock accuracy may be degraded and to defer to other Minion devices with more accurate clocks when synchronizing throughout the network. It is also contemplated that Minion devices may maintain local time zone offsets based on their geographical location. Internally Minion devices maintain GPS time which is a monotonically increasing count of seconds. The conversion to UTC is handled on an as needed basis.

It is also contemplated that Minion devices maintain an epoch correction and a magnitude correction for changes in time information to be implemented. For example leap seconds may be inserted or deleted at scheduled times throughout the year as broadcast by the GPS satellites. The time at which a second will be inserted or deleted will be scheduled throughout the MinionNet network. In addition local time changes caused by daylight saving time will be scheduled in advance and broadcast throughout the network.

Each Minion device is assigned a unique serial number which is installed during manufacture that identifies that particular Minion device so that each Minion device is unique. This allows Minion devices to distinguish themselves from each other and one Minion device from another. Minion devices may be programmed to receive messages from all other Minion devices in the vicinity on a continuous basis. In the vicinity may mean Minion devices within range or Minion devices within range at a particular time. Alternatively it is also contemplated that Minion device transceivers may be selectively activated and turned on for short periods of time and off at other periods to conserve power. It is further contemplated that if a Minion device receives only during certain intervals the interval during which it is receiving may be derived from the Minion devices unique serial number so that other Minion devices can determine when to transmit to a particular Minion device which is normally off. Messages directed to a Minion device that does not receive continuously will be transmitted during the appropriate interval as defined by the serial number. Those skilled in the art will recognize other ways of conserving power and permitting intermittent operation of the Minion devices.

Messages which are transmitted between Minion devices will each contain a header area and a data area. The header area will contain the following bit fields 

d. the serial number of the Minion device intended as the final destination of this message destination 

h. a timeout indicating the time at which this message will expire if it has not reached its final destination 

i. a set of flags that control the disposition of this message and indicate the status of the sender or originator 

Type codes include but are not limited to the following position time history request response command application specific data velocity prefix Init stream weather and firmware. It is contemplated that the data area in the MinionNet network message may be encrypted or transmitted as plain binary text. Preferably if encrypted encrypted data would use a public key crypto system that allows only the Minion device at the final destination of the message to decrypt the data. Plain text data may be examined by any Minion device that receives the message. Some plain text data may be encoded in an application specific manner accessible only by other Minion devices with firmware tailored to the application. The meaning of this data may not be publicly available to all Minion devices.

Messages including both the header and the data areas are forwarded from one Minion device to the other toward their intended destination. In this way the range of each Minion device is extended to the range of the local MinionNet network and well beyond the range of any single transceiver. Messages may also be collected by a mobile Minion device which acts as a messenger delivering messages at a later time to Minion devices too far away to be reached directly.

As noted above implicit acknowledgement of message receipt takes place as follows a message originated by Minion device A is sent to Minion device B with an ultimate destination of Minion device C. When Minion device B transmit the message to Minion device C Minion device A can also hear the transmission and is then certain that Minion device B received it correctly. Under some circumstances implicit acknowledgement will not occur. Messages that are not acknowledged explicitly are sent again after a suitable delay. Upon receipt of multiple instances of the same message the recipient will generate an explicit acknowledgement by transmitting the message with a null recipient. This acts as an acknowledgement without the possibility of a recipient trying to forward the message and wasting power and bandwidth.

The message Flags may include indicators with the following meanings. These Flags may not be explicitly present in the Header or other part of the message. They may actually be represented by combinations of values in other fields. The presence of the information indicated by the following descriptions allows many of the features and application of the MinionNet network to operate 

The Data portion of a MinionNet network Standard Message with a Type Code meaning APosition will contain the following bit fields Quality estimate of the accuracy of the position value Latitude Longitude Height above a standard reference datum such as WGS84 derived from GPS readings and Time in seconds at which the position was derived.

MinionNet network Standard Message with a Type Code meaning APosition are used to provide the virtual geolocation services to all Minion devices. Each Minion device will periodically transmit a message declaring its current best estimate of its own position. Minion devices equipped with GPS receivers that are currently receiving good quality data from the GPS constellation will provide the highest accuracy position messages. Fixed Minion devices permanently installed in stable structures will be able to provide high accuracy position messages without the cost of GPS equipment and in locations in which GPS will not work e.g. underground . Minion devices may derive increased accuracy in their estimated positions by receiving APosition messages from multiple high accuracy sources. Possible methods of calculating an improved position include 

The Data portion of a MinionNet network Standard Message with a Type Code meaning ATime will contain the following bit fields 

ChangeEpoch time at which UTC or zone offset will change and NewValue value for new time zone offset or change to UTC.

MinionNet network Standard Message with a Type Code meaning ATime are used to perform the synchronization of Minion device clocks throughout the network.

The Data portion of a MinionNet network Standard Message with a Type Code meaning AHistory will contain multiple copies of a Quality Time Latitude Longitude position history record. This is used to convey a travel history for the originating Minion device in a compact message format.

The Data portion of a MinionNet network Standard Message with a Type Code meaning Avelocity will contain multiple copies of a Quality Time Velocity Direction history record. This is used to convey a velocity history for the originating Minion device in a compact message format.

The Data portion of a MinionNet network Standard Message with a Type Code meaning AApplication Specific Data will contain data values that are interpreted by the devices attached to the final destination Minion device. This data is usually encrypted. The data is not interpreted or modified in any way by the intermediary Minion devices. It may be collected and stored for later retrieval in the MinionNet network database associated with the specific destination.

The Data portion of a MinionNet network Standard Message with a Type Code meaning ACommand will contain information originating with the MinionNet network Control Center that causes certain operations to be performed by the Minion device and results to be sent back to the Control Center. This can be used to set operating modes or data throughout the MinionNet network.

The Data portion of a MinionNet network Standard Message with a Type Code meaning ARequest Response will contain a compressed representation of formulas used to compute certain results based on the values of memory locations and counters maintained by application specific operations performed within the Minion device itself. These application specific data and computations are performed and formatted into messages that are shared locally in the MinionNet network. Final results in a compact form may be sent via gateways to a central server or the Internet. Examples of the calculations that may be performed locally include Total Counts Counts per Time Interval Averages Sums Differences Ratios Maxima Minima etc. The data on which these formulae operate may include any data field from any message sent or received data fields contained within the internal routing tables and data fields contained within records received from attached hardware devices. The results of these computations may be used for further computations or for direct inclusion in an application specific data message to be transmitted to other Minion devices or to a central Database or the Internet.

The Data portion of a MinionNet network Standard Message with a Type Code meaning APrefix will contain the high order bits of several fields from the Standard Message Header and Position records. In particular the current Latitude Longitude Time and the Serial Number of the Transmitting Minion device all represent long binary fields whose leading bits are generally common to all Minion devices in an area or are redundant in that they provide no significant additional information. Transmitting them with every message would be wasteful so they have been moved to the infrequently transmitted APrefix message.

The Data portion of a MinionNet network Standard Message with a Type Code meaning AInit Stream will contain the data necessary to initiate a Semi Streaming transfer of a large block of data directly from one Minion device to another. The message will contain fields which indicate the total size of the block of data to be transferred a timeout value after which the transfer will be aborted and an interval between acknowledgments to be sent by the recipient.

The antennas for the radios are built into the case and are intended to provide omni directional coverage. As illustrated in the antenna A is printed on a dual sided circuit board B itself and wrapped around the periphery of the board. This allows the antenna to be printed as part of the printed circuit board layout. In general the antenna would function as a monopole with a ground plane GP which may be embedded in the board B although it is also contemplated that the antenna may be a dipole or j pole or other antenna implementation. The other side of the board would have mounted thereon the micro controller memory and connectors and for connecting to the battery power supply shown in phantom . Alternatively as shown in it is contemplated that the antenna may be a whip antenna A in the form of a single piece of wire extending from the board B and having an imbedded ground plane GP. For example a Minion device M mounted on a traffic sign post P may be provided with a one foot long quarter wave whip coil WC within its housing H see or hanging from the housing. The housing may be a PVC pipe with endcaps for enclosing a battery as illustrated in . Minions can be mounted in a number of ways. One preferred method is to use standard mounting brackets SMB used for mounting cameras sensors and other traffic monitoring equipment on traffic signal standards. Alternatively the PVC pipe may be covered by an exterior sleeve of amorphous silicon SAS functioning as part of a solar cell to recharge the batteries. In cases where directionality is desired or required a beam antenna with gain such as a three element yagi or an antenna with a reflector may be used. For example in a situation where a Minion device may need to know which side of the road other Minion devices are located would use a directional antenna. Also a Minion device on a police car may have a directional antenna to focus on and interrogate a Minion device directly in front of it located on another vehicle. Omnidirectional antennas will never actually be realized and environmental limitations are an expected part of the operation of the network. The operating range of any transceiver will not be a fixed distance but should rather be viewed as a probability function. Thus the likelihood of successfully exchanging messages between radios is a function of their position in space. Viewed in this way all sources of transmission error can be incorporated into a single function. This is similar to taking the bit error rate allowed for a fixed length message and determining the probability of successful reception. Unlike the wired network the wireless network has a spatially distributed error rate.

That being said think of the effective range of a Minion device as varying from 100 to 300 feet. Additional control of the area of coverage will be possible with the use of application specific antenna and packaging designs. Optional application specific interfaces include interfaces to vehicles door locks utility meters appliances building controls user displays and user keyboards. Application specific interfaces may also be links to external sensors such as sensors for magnetic flux temperature meteorology acceleration altitude and pressure.

The antenna used for most Minion devices are intended to provide omnidirectional coverage so that any omnidirectional antenna known in the art may be employed.

In some applications a Minion device may require a directional antenna to provide directionality so that Minion devices will only communicate in a specific region or with certain other Minion devices. This can be accomplished by a directional antenna well known in the prior art or by electronically tuning the above noted antennas to have limited sectors of reception with other sectors having nulls. Also the directionality of an antenna may be controlled by placing the antenna in a shield or reflector such as employing the antenna in combination with the parabolic reflector so that only other antennas facing the parabolic reflector can communicate with the antenna in the reflector. In general antennas would have a range of about 100 meters in order to avoid too much cross talk between too many Minion devices. The use of antennas designed to provide gain in a particular direction may be used to increase the effective range to significantly greater than 10 meters in a particular direction. In order to maintain the most compact size for each Minion device particularly Minion devices and because high performances is not necessarily required for Minion devices the antenna is preferably built and mounted on the printed circuit board containing the other components of the Minion device. Some applications may require an external antenna. For example an external antenna may be used when it is necessary to house the m Minion device circuitry in a shielded enclosure because of RF interference caused by other devices near the Minion device. In such cases a suitable interconnect cable may be used between the Minion device and the external antenna.

As shown in self contained Minion devices may be powered by one or more of the following power sources 

Minion devices connected to another device may receive power from that device. For example Minion devices may receive external power from 

MinionNet network Protocol Extensions include the ability to send a burst of data in the form of multiple messages directly from one Minion device to another. This semi streaming data has compact headers and reduced overhead compared to sending the data via Standard messages. Normal MinionNet network message formatting and transfer methods apply including the transmission of training bits message encoding the addition of CRC 16 and error correction bits. Semi streaming data messages are the same length as Standard Messages and can be received using the same buffers and error detection and correction algorithms. Data streams may be concurrently received from multiple Minion devices. The ability of a Minion device to participate in Semi streaming data transfers is dependent on the amount of memory available and the power situation of the Minion device. Semi streaming data transfers assume a fairly stable communication environment they will not be initiated until a high probability of message reception has been established.

Semi streaming data messages are acknowledged by a specialized form of multiple block transfer request. A message containing the block numbers of data that have not been received is returned to the sender. The sender uses this as a prompt to retransmit or continue transmitting data. There is no explicit acknowledgment for blocks successfully received. The Transfer Request message has the following fields 

The actual data sent via Semi streaming data transfer may be arbitrarily large limited primarily by the memory available for buffering. The actual data will contain header information including the size of the total data transfer the ultimate recipient if the data is to be forwarded error detection information and instructions for handling the data such as transfer priority etc. This control information is in addition to the data sent in the AInit Stream message used to start the semi streaming data transfer.

The Data portion of a MinionNet network Standard Message with a Type Code meaning AWeather will contain data fields related to the operational environment of the Originating Minion device. Fixed solar powered Minion devices provide an opportunity to record cloud cover and relative insolation through measurements of the performance of the solar power source. Vehicle mounted solar Minion devices provide the opportunity to determine intervals outside vs. garaged. Temperature sensors allow recording operating environment information useful for meteorology as well as improvement of the Minion device products themselves. Other sensors may be attached to Minion devices to provide additional fields of information including Barometric Pressure Relative Humidity or Dew Point Precipitation wind velocity and direction. Minion devices may be attached to such locations as highway Amile markers on or near bridge and overpass surfaces to provide useful data to drivers police and emergency vehicles and traffic managers.

The Data portion of a MinionNet network Standard Message with a Type Code meaning AFirmware will contain memory address and instruction codes used to update the firmware contained within the Final Destination Minion device. Usually multiple AFirmware Messages will be required to send the amount of data required to perform an upgrade of Minion device functionality. The various messages need not be received in a particular order each encode their own place in the overall update message. Validity checks including CRC 16 will be performed on the complete set of AFirmware messages before the new instruction code is allowed to execute within the Minion device. Allowing field updating of the Minion device control program allows low cost flexible growth as new applications are developed for the MinionNet network. Multiple Minion devices may be targeted for updates simultaneously. The number of messages sent through the network will automatically be minimized by selecting groups of Minion devices for concurrent updating. Each version of MinionNet network operating firmware will have an associated version number. Updates to the firmware may be sent as incremental changes thus allowing the transmission of small pieces of code that change from one version to the next and not the large body that remains constant. These Patches will be specifically applied to change one version to the next Minion devices that do not contain the correct original version will automatically ignore any patched not intended for their version.

Each message transmitted by a Minion device has an Originating Minion device ID and a Final Destination ID which will result in passing through one or more gateways in the process. Usually the ID is the serial number of a Minion device. Some ID s are of special significance. The Null Minion device ID zero is used as a destination for messages that are broadcast and actually intended for all recipients in an area. Application specific Minion devices send data to a Final Destination ID that represents the database that corresponds to the application. The MinionNet network routes the message to a gatewayMinion device that forwards the message to the correct server.

The routing table is maintained by snooping all received messages not just those for a particular recipient. Thus all message traffic helps to maintain correct routing tables in all Minion devices without generating additional traffic geared solely for routing table updates.

Each Minion device maintains a table containing all messages recently received. Each incoming message is compared against the list. Duplicate messages may cause an explicit acknowledgment to be scheduled for transmission. Message flags may cause the list of scheduled messages to be altered either to forward this message or to consolidate messages from a single originator or directed toward a single destination. The number of entries in each of the tables will be constrained by the available memory and the speed of the micro controller. The oldest entries will be lost as new messages are received.

Each Minion device maintains a table containing all messages recently transmitted. A flag will indicate if an acknowledgment has been received. Unacknowledged messages may be scheduled for retransmission.

Messages may be received or created that cannot be forwarded immediately. This Minion device may be acting as a messenger and not have a current path to the destination. The next intermediate Minion device may be in a power save mode and not have a window available. There may be too much traffic in the local area so transmission will be delayed. The Minion device will always be able to determine the next message to be transmitted and when transmission will be attempted.

The discussion that follows describes a normal operation situation such as might be encountered in support of the cap Certified Collateral Protection System for the Mobile Equipment Finance market which is also used for the geolocation example above. All operating parameters such as the interval between transmissions the power consumption of each device the number of devices and the level of network traffic are dynamically adjusted to fit the application and environment. The numbers given below is intended to provide a representative view of a possible implementation.

Consider the sample situation depicted in . The local network consists of 18 Minion devices each able to communicate with at least one other as indicated by the connecting lines.

These lines are not intended to indicate adjacent nodes and in some cases connections may be established over unusually long distances. This represents the possibility of favorable geometry and low radio background noise that may be encountered. In contrast some physically nearby Minion devices may be unable to establish direct connections because of adverse environmental conditions such as indicated by the metaphorical brick wall.

Again the network has no a priori knowledge of the location or connection paths available. The messages sent by the Minion devices themselves and the operating protocol allow this information to be dynamically derived.

Each node in the diagram represents a Minion device with a short range radio transceiver a microprocessor and a small amount of memory. The labeled nodes have additional hardware that results in added functionality throughout the network. Even the least capable Minion devices will be able to make use of the features of the more capable devices nearby.

The nodes labeled A B and C represent geoMinion devices and act as anchor points for the virtual geolocation system as shown in . Each is equipped with a GPS receiver or has been installed at a fixed point with known coordinates to act as a static beacon. The nodes labeled D and E are gatewayMinion devices. They provide connections to a wide area network using Mobitex7 radios for example. The Gateways allow direct connections to the MinionNet network Server and database facilities.

On a periodic basis each gatewayMinion device will send out a broadcast message identifying itself and indicating that it is capable of sending and receiving messages to the central database server. This occurs on a random basis a few times per hour. Each Minion device that receives the message remembers the number of the gatewayMinion device and adds it to a list of candidates to handle traffic destined for the database server. After an interval the message is transmitted on a second hop with an incremented counter. The message now means AI am a Minion device that is one hop away from a gatewayMinion device and I can handle your messages. The recipients of this message make note of it and send one that says AI am two hops away . . . Nodes that have already heard about this Gateway will have smaller hop counts stored in their table and will ignore these later messages since they are only proclaiming longer paths than the node already knows about. A message parameter controls the maximum number of hops allowed so that the proliferation of messages from distant sources will be controlled.

In this manner each Minion device will have built a list of all of the nearby gatewayMinion devices. The number of hops required and the identity of the Minion device to use as an intermediary will also be known. Thus sending a message to the database server is accomplished by looking up the identity of the Gateway with the smallest hop count and sending out the message to the appropriate intermediary.

Once a Minion device has discovered a valid way to contact a Gateway it will do just that. At random intervals think several times per day each Minion device will send a message to its nearest gatewayMinion device. This message is basically just a status report and is buffered with others in the Gateway. After some interval and dependent on the desired traffic level on the Gateway network these status messages will be forwarded to the database server via the wide area network. The purpose of these status messages is two fold 1 the database server gets a heartbeat from each Minion device and knows how to address Gateway traffic destined for any particular Minion device and 2 each Minion device involved in handling intermediary hops of status messages has seen routing information to allow a reply to be delivered.

In this context a reply to a status message could be any message from a Gateway to another Minion device. Remember that this is really a connectionless protocol and that all messages are really datagrams. It would be possible for the database server to originate a message for a particular Minion device at any time but the chances of its successful delivery are greatest just after a status message has been sent by that Minion device. This assumption allows us to maintain very short history tables in each Minion device. Perhaps only a few dozen entries would be needed to provide thoroughly effective delivery if only the most recent information is kept.

The same philosophy of communicating in multiple hops and retaining records in each Minion device can be extended to the Virtual Geolocation application.

Each of the geoMinion device nodes A B and C in periodically sends out a broadcast message with its current GPS position and time. As this message is forwarded from node to node the position and number of hops is recorded by each Minion device. After data has been collected from several geoMinion devices it is possible for each Minion device to compute a weighted average position based on the relative distances from each known location implied by the hop counts.

This is an example of the benefits of using short range radios in the MinionNet network. Short range coverage means better resolution for position estimates. Wide area networks require sophisticated and expensive time delay or time of arrival measurement equipment to achieve similar results. This equipment is so bulky and expensive that it can only be installed at fixed base stations. In addition position information using time of arrival data can only be derived if the target unit is in the coverage area of multiple base stations.

Referring to one preferred application of the MinionNet network is to establish a virtual geolocation infrastructure for use as a certified collateral protection system such as the cap System of the assignee. This is just one example of how geolocation can be applied. An expanded description of several cap application is included in the market applications section on Additional Alternative Network Applications. The cap System provides mobile equipment finance companies with exception and audit reports concerning unusual movement patterns of financed vehicles and other types of nonstationary movable or mobile equipment.

Many applications such as this can actually be best addressed by a system that provides a general view of the location and movement of items without the expense of traditional precision location technologies such as GPS.

A Virtual Geolocation system provides 2 dimensional or 3 dimensional relative position information that is only loosely associated with absolute latitude and longitude and altitude . Some applications will be adequately served by virtual addresses alone while others will need tighter correlation with actual physical positions. The MinionNet network anchors a small percentage of points in the network with known locations. These anchor points may be Minion devices with GPS receivers that report accurate positions but which move with time or they may be Minion devices installed in fixed locations such as on light poles street intersections or on different levels of a high rise structure.

Nearby devices need only receive messages from these fixed points to have an approximate idea of their own location. With each hop from device to device the area of possible position increases and the position accuracy degrades. The MinionNet network is designed to automatically keep track of the count of hops involved. The presence of multiple anchor points and the use of the hop count to approximate relative distances allows the MinionNet network to approximate the actual position with the least possible expense in hardware. The use of short range transceivers actually improves the resolution of this approach as well as keeping the power requirements for each device to a minimum. This not only reduces costs but eases certification and reduces environmental concerns.

One application is to use the MinionNet network technology and services to provide a wireless dynamic traffic monitoring system DTMS for municipal regional state and federal government agencies as illustrated in B A and B. Organizations such as city traffic departments regional and state mass transit agencies like any COG Counsel of Governments and any DOT Department of Transportation such as the US DOT or TX DOT can use this cost effective system to monitor traffic movement. Dynamic Traffic Monitoring System ADTMS can be initiated on a limited basis and incrementally expanded as more fixed and mobile gateway Minion devices are diffused into the system. The entire MinionNet network functions as a collective and even the lowest level Minion device becomes part of the data collection infrastructure. With this technology there is no need for high dollar roadside reading devices nor is it necessary to install hard wired infrastructure.

The Dynamic Traffic Monitoring System ADTMS gives the City the ability to monitor obstructions travel time traffic flow and traffic pattern deviation along highways thruways and side streets. This information is important to all governmental traffic control agencies and represents an opportunity to better serve their community.

The MinionNet network uses a virtual network control program that controls the operations of Minion devices. There are three classes of Minion devices associated with ADTMS . First there are gatewayMinion devices. These are fixed or mobile ADTMS devices that provide a wireless interface to a terrestrial or satellite network. Data is collected from the ADTMS network and is then placed into a local ADTMS database. Second there are geoMinion devices. These devices are fixed or mobile and give the entire network at the device level a virtual latitude and longitude address. Third there are Minion devices. These are minimal cost digital RF radios that are fixed or mobile and transmit status information from the field locations to the database using the MinionNet network wireless network backbone.

By establishing a network of fixed and mobile GatewayMinion devices and then an appropriate combination of low cost single and multi radio Minion devices a superior wireless ADTMS data collection network is created. Traffic flow data can now be collected and processed both locally and remotely. The traffic flow data is transmitted to a database through wireless links and is made available to the city engineers from a secure Internet Service Center.

The MinionNet network is a wireless data collection network characterized by two way short range device to device messaging that can operate with both fixed and mobile devices. Thus it is ideal for traffic management applications. Messages are automatically routed through multiple device to device hops to provide robust area coverage redundancy and noise immunity. Additionally MinionNet networks are virtual networks with virtual addresses dynamic routing and reconfiguration. This is an example of how the inexpensive two way data radios Minion devices described above are used by the MinionNet network. The key feature of Minion devices is the ability to share short data messages with each other. Each Minion device becomes a part of a community and can share the burden of conveying messages throughout the area dynamically seeking a gateway to a specific destination database.

This concept is in contrast to all traditional network concepts which require the installation of an expensive fixed base station infrastructure prior to the operation of the network. Typical cellular phones for example require that each subscriber phone communicate only with the cellular base station. Even though there may be thousands of actual phones in the area they are not capable of communication with each other directly. The ability to use short range messaging between devices such as this has been historically ignored due to the perception that consumers require robust real time connections. In actuality these connections may be real time but are not necessarily robust. Since the MinionNet network is a data network designed for device to device messaging without a time critical component it is able to leverage these capabilities into applications such as Dynamic Traffic Management Systems DTMS . The typical MinionNet network system periodically transfers data back to a central database for analysis making the collection of traffic Atravel time practical.

In addition exceptions can be identified and communicated on a near term basis as required. For example a traffic accident will immediately register on the network. With this early warning emergency vehicles can be dispatched sooner resulting in faster clearance and quicker return to normal traffic patterns. The Aexception process operational nature of the network gives the user the exception earlier than if done on a poling basis. Lack of movement along a highway could be the exception. Thus when there is an obstruction detected Minion devices will start reporting immediately and continue to report the condition until the network returns to a normal operating state.

Once the initial fixed and mobile gatewayMinion devices are installed applications other than strict traffic monitoring can easily be added. Other governmental and commercial vehicles like utility trucks delivery vehicles school buses and garbage trucks can add important traffic flow information while providing additional safety security and traffic management capabilities simply by placing a low cost Minion device on the vehicle. More gatewayMinion devices can then be placed in neighboring cities leveraging already installed Minion devices and giving additional information about traffic as it approaches the city also providing the service to the new city for very little added expense.

In the DTMS application virtual geolocation system capability as described above in the section on the Mobile Finance Market provides 2 dimensional relative position information that is only loosely associated with absolute latitude and longitude. Some applications will be adequately served by virtual addresses alone while others will need tighter correlation with actual physical positions. The MinionNet network anchors a small number of fixed points in the network with GPS derived positions or known locations such as street intersections or floors of a building.

Nearby Minion devices need only receive messages from these fixed or mobile points to have an approximate idea of their own location. With each hop device to device the area of possible position increases and the position accuracy degrades. However as mobile gatewayMinion devices approach an area or the concentration of Minion devices increases the accuracy of the original geolocation is validated and even improved. The MinionNet network is designed to automatically keep track by counting the hops involved. The presence of multiple anchor points and the use of the hop counter to approximate relative distances allows the MinionNet network system network to approximate actual position using low cost hardware. The use of short range transceivers actually improves the resolution of this approach as well as keeping the power requirements for each device to a minimum. This not only reduces costs but eases certification and environmental concerns.

Just as certain points in a geolocation network need to be anchored to associate physical locations with virtual ones other points in the network should be connected to a wider area network so that message travel times and network loading are minimized. This is accomplished by adding gateway transceivers such as the BellSouth Mobitex7 digital radio network to a small percentage of the ADTMS Minion devices in the field. These gatewayMinion devices act as concentrators for messages bound to and from the centralized supervisory components of the MinionNet network.

The dynamic configuration and automatic routing aspects of the MinionNet network Protocol cause these messages to be routed by the most efficient method from their origin to their ultimate destination.

The protocol is completely connectionless and each message is treated as an independent datagram. Protection mechanisms are built in to ensure robustness but delivery of any individual message is not necessary nor is it guaranteed. The database server may initiate enquiries into the distributed network and ask for retransmission of suspected missing messages.

The purpose of certain intelligent applications is to detect missing items and abnormal states and status then provide a report or alarm to the user. Much useful information may be derived from interrogating the message routing tables of nearby nodes to establish the last known location. In this way the network will begin to report immediately when there is a lack of motion or a dramatic change in the rate of motion on a given highway or thruway. Average and expected travel times can be monitored and reports will be generated when the normal expected parameters are not being seen by the ADTMS . This differentiates the ADTMS from all other known traffic monitoring products as it will focus on troubled spots and report only those on an automatic basis. This automatically reduces the amount of system air time required thus providing a more efficient and less expensive solution than otherwise possible. Special purpose monitoring can be accomplished by changing parameters or inquiring specifically within a given area or zone. Moreover gatewayMinion devices can report their location outside of their logical domain. An example of this is the use of a gatewayMinion device on a school bus. The bus will collect traffic data as it travels its route both to and from school and then it will functions as a tracking device on trips outside of the district. Even if this device passes a Minion device outside of its normal Alocal domain it will still ask and receive data from any Minion device it may encounter. So a bus on a school trip to another district can track its trip as well as function as a data collection device out of its local domain.

Consider a sample situation. The local seed network may consist of 50 Roadside gatewayMinion devices along thruways 10 Mobile gatewayMinion devices placed on police cars and 20 additional gatewayMinion devices placed on city road repair equipment emergency vehicles and school buses. Each of these units is able to communicate with other Minion devices. Then place 300 Minion devices with select companies that have work sites within the city limits. An example might install 150 Minion devices in vehicles at Company A and an additional 150 Minion devices in vehicles at Company B. Employee selection in a test would be done so vehicles will enter and exit the city in diverse directions and along different travel paths. As vehicle travels the roads in the city it will be registered and logged as to location and travel time as the vehicle enters the city and proceed to its final destination. Vehicle will be moving into and out of the city on shifts at different times allowing the city to record valuable data about normal thruway traffic patterns abnormal thruway traffic patterns average travel time traffic flow and traffic obstructions. These data can be shared with the companies and help employees find the most efficient route to and from work. The entire collection process can be enhanced by adding more Minion devices and extending the gatewayMinion devices into neighboring cities and along major highways.

In Summary contrasted to a traditional read only Roadside Reader approach the MinionNet network can be installed with wireless networking technology. Additionally all Minion devices in the network serve a useful data collection function. The more Minion devices in an area the better the network functions. Minion devices can be installed on vehicles for short tests in several minutes and will be battery and or solar powered.

The MinionNet network is dynamic and functions on an exception basis by screening out data that is not necessary to process and present to the user. This in a cost effective network both in terms of initial and ongoing operational costs.

Another application for the buddy system is a system which allows car owners to monitor the location of their car. Each car owner and their car would have a Minion device which communicate with each other. When the car Minion device and the owner Minion device are outside of range of each other the Minion devices would communicate with each other through the MinionNet network system network. If the car begins to move without the car Minion device being in communication with the owner Minion device the car Minion device sends an alert via the MinionNet network. This alert could be provided to secure your law enforcement personnel. This system would also allow the location of stolen property through the use of a wide area network. For example it would serve as an electronic enhancement to current theft reduction and prevention programs which allow a vehicle owner to attach a sticker to alert police that a vehicle should not be on the road during certain hours. Using MinionNet network technology offers an electronic version of this capability. This would provide a less expensive electronic theft prevention and reduction system than products currently available. It can also be structured as to provide a possible flow of revenues for local police departments managing the system.

Other possible uses of the buddy system include a house arrest anti stalking system in which a detainee must remain near certain Minion devices to prevent alert messages or conversely exclusion zones can be created to generate alerts when a specific Minion device is able to communicate with another Minion device indicating that the specific Minion device is too close to the other Minion device.

As noted herein the invention may also be implemented as a device and process for the automated collection of toll road fees virtual toll roads or for locating children in amusement parks day care centers and schools. A number of applications are outlined later.

This section describes a system and method according to the invention for determining which one of a possible set of allowed paths was traversed by a vehicle. In particular a system and method for approximately determining the distance from the vehicle to a fixed location is described and a system and method for integrating a set of such measurements over time to arrive at a solution unique to one of the several allowed paths which typically represent parallel travel lanes is described as shown in B A and B. The system and method are applicable over distances on the order of 300 feet from the fixed location can resolve five or more lanes in each direction as shown in the figures requires only low cost equipment and yields repeatable results over a wide range of vehicle speeds.

This technique completely eliminates the requirement for analog measurements of signal strength. The bit error rate has been translated to a pass fail test of individual data messages. This allows for an adaptable system in which varying transmit power levels can be used as appropriate for the installation and without any knowledge of the particular location by the target vehicle systems. The only analog portion of the system is involved in the generation of stepped power levels at the fixed transmitter.

Each message sent by the Survey Minion device has normal MinionNet network structure and formatting including error detection bits. When a receiver is out of range of a transmission at a given power level the message will not be received correctly. Only messages that are received intact and complete will be eligible for further consideration by the receiver. Correctly received messages will cause the values of one or more of a set of software counters to be incremented.

After passage through the area of the Roadside Survey Minion device the vehicle will come to the area of one of the bracketing Roadside Minion devices. Two bracketing Minion devices are used to allow collection of data from vehicles traveling in either direction on the roadway. The bracketing Roadside Minion device will interrogate the Vehicle Minion device for the value of the counters associated with the passage by the Roadside Survey Minion device. The vehicle Minion device will send a response message containing the counter values to the bracketing roadside Minion device.

The bracketing roadside Minion device will use the two values to compute an estimate of the path that the vehicle took through the area of the Roadside Survey Minion device. One possible method will be to compute an Aaverage bias by dividing the Atotal bias counter by the Atotal messages received during the transit. This yields a value that is independent of the speed of the vehicle through the survey area. The resulting average is dependent only on the vehicle path and the transmit signal strength bias constant values used by the Roadside Survey Minion device. The operating parameters of the Roadside Survey Minion device are set up when the device is installed. The relationship between a particular range of Aaverage bias values calculated by the bracketing roadside Minion device and a specific travel lane used by a vehicle Minion device is also determined at installation and is stored in the bracketing Minion device. Thus the bracketing Minion device can estimate the travel lane used by a vehicle through the survey area. In addition the Atotal messages is inversely proportional to the average speed of the vehicle through the survey area. The method of choosing optimal bias values and power settings for particular installations is under study.

Excellent correlation with actual travel lane may be achieved by looking only at the ratio of the counts in the smallest non zero bin with the counts in the largest non zero bin. This works best if the change in radius from one transmit power level to the next differs by three lane widths or less. In the example using 6 different power levels results in 4 bins whose data is not directly used for calculating a given path but this is not known ahead of time .

Using all of the available counter data allows for the elimination of illegal or erroneous paths which could not be detected with the previously discussed methods. In particular using the values of all six counters and knowing the transmission pattern of the Survey Minion device allows a least squares solution to the problem of closest approach to the Survey Minion device and thus uniquely identifies the chord which corresponds to the travel lane. The assumption that the travel lane will be a straight segment over the 600 foot survey area is probably warranted especially in light of the overriding assumption that the vehicles will move with near constant speed through the area.

The current implementation uses roadside Minion devices that transmit messages 10 times per second at 6 different power levels. Low power transmissions occur more frequently than high power so that a vehicle passing through the smaller region of low power reception will be given a higher probability of receiving a message. Power levels are chosen such that the maximum range is divided into 6 equally spaced radii. Vehicles passing the area in the lane nearest the Survey Minion device most nearly a diameter of the Survey Area at 60 mph would receive up to 60 messages if all were sent at full power. Proportionately fewer will be received due to the power reduction algorithm.

This demonstrates operation during a possible worst case scenario with a vehicle traveling at high speed through the area. Slower speeds would yield proportionately larger numbers of messages. The large number of messages received by each passing vehicle Minion device results in a robust tolerance for lost messages. Messages are subject to sporadic interference or noise and may be lost as a result. The present method tolerates a high loss rate for individual messages and still yields a good approximation of the desired data. The method automatically compensates for the speed with which the vehicle transits the area.

A primary advantage of the proposed method is that the individual Vehicle Minion devices do not need any analytical capability or a priori knowledge of the survey area or geometry. Vehicle Minion devices need only be able to add a bias constant from a message received from the Survey Minion device to a total which will be sent on demand to a bracketing Minion device. The value of the bias constants and the output power levels and transmission rate and pattern are contained solely within the Roadside Survey Minion device and are selected at the time the Minion device is installed. Additional calculation capabilities data collection and consolidation and possibly gateway services will be required in the bracketing Minion devices. The calculations required at these Minion devices need only include integer multiplication and division and the ability to compare a resulting value with installation parameters to establish specific lane numbers in a particular installation.

Note that after the lane specific resolution is complete the information may be coupled with other application specific data such as cumulative vehicle counts toll collection data etc. The resulting information may be forwarded to a central collection center using MinionNet network gateway connectivity or it may be returned to the Vehicle Minion device for storage or display. A simple example would include an in vehicle display of expected travel time in each different lane using data relayed from one end of a section of roadway to another by gatewayMinion devices located at each end and then forwarded on to the in vehicle Minion devices.

The distance from the roadside Minion device to the vehicle Minion device is the quantity that should be the dominant factor regarding success or failure of reception of an individual message. This will allow the system to derive the actual path followed by the vehicle as it passes the vicinity of the roadside Minion device. The system is arranged to receive a large number of messages with different transmit power levels as the vehicle transits the survey area.

The sensitivity of the individual Vehicle Minion devices will affect the resulting estimated path of travel through the Survey Area. A standardized installation in the vehicles could be used to make the sensitivity from one vehicle to another uniform. This would probably be impractical due to the variation of vehicles found in the real world. A better solution would be to strive for antenna pattern uniformity in the vehicle installations make the reception as close to omnidirectional as feasible and install Roadside Survey Minion devices in pairs as described below. This pairing would allow dual solutions to the travel path equation that could be used to eliminate the receiver sensitivity variable and result in a single unique path solution.

Optimal results will be obtained if the vehicle Minion device receiver has an omni directional sensitivity pattern. This may require care in placement of the antenna for the vehicle Minion device.

The effect of environmental factors on the performance of the system can be minimized by careful selection of location for the installation of roadside Minion devices. Choosing straight flat unobstructed roadways with minimal signage will achieve the best results. The quick convenient flexible installation options for roadside Minion devices will simplify this selection. The ease of repositioning roadside Minion devices will allow adjustment for optimal data collection.

In this implementation the roadside Minion devices will be time synchronized such that their data message transmissions occur at alternate intervals. This cooperation will prevent messages from being sent at the same time from each side of the road a situation that would garble the data for virtually all recipients.

In addition a solid state magnetic flux sensor may be embedded along with the Minion device. The flux sensor is used to detect changes in ambient magnetic field caused by the nearby presence of the metal of a vehicle. The intended applications would involve the installation of RPM Minion devices near the center of marked parking spaces. The Minion devices would thus provide vehicle presence information on a per slot basis to the network.

The MinionNet network architecture allows a small number of gatewayMinion devices to relay information from the large number of RPM Minion devices to a centralized database or dispatch center.

The ability of the MinionNet network to collect transaction data with associated time stamps would allow prorated or time based billing. Multiple slots could be assigned as a pool to a particular company s employees and the employees could choose to park in any of their assigned spots on a first come first served basis. The MinionNet network would collect information regarding the number of spots actually used at any given time and verify the legitimacy of the vehicles using those spots.

Due to the omnidirectional characteristics and variable range of the MinionNet network radios it is possible that certain ambiguities could arise in closely packed parking applications. Consider the case of two vehicles parking at adjacent meters simultaneously. If one was valid Minion device Equipped and the other was not it would be difficult to automatically determine which was the offending vehicle. The number of occupied slots and the number of payments would be out of balance so an enforcement exception could be generated but it would be necessary for a human being to examine the situation to identify the violator. This implies that the vehicle mounted Minion device should be visible for enforcement purposes or that it should contain vehicle identification information in electronic form that can be interrogated for enforcement purposes. Enforcement personnel could use a hand held device to interrogate the Minion devices in an area to determine the vehicle that was not properly equipped.

The present application describes the use of MinionNet network technology and specialized Minion devices to form a distributed Black Box data recorder for vehicles including military railroads commercial and private aircraft commercial and private cars and trucks etc. e.g a device for distributed collection and recording of vehicle performance data. In this implementation Minion devices would be installed in various locations distributed throughout the vehicle. Gateway black boxes would be located in and around secure facilities at railroad crossings and along highways for example.

Each Minion device would include an interface to a sensor related to a measurable phenomenon located in close proximity to the Minion device itself. In general these phenomena would include an electrical potential such as the current that powers a light or actuator and would thus be capable of providing operating power to the Minion device itself. Some instances might involve a non electrical quantity such as a shaft position or hydraulic pressure or the presence of noxious gases. In this latter case it would be necessary to make additional provision for power to the Minion device.

In a military application the distributed Minion devices would initialize and synchronize when the vehicle is initially powered up for a mission. After confirming normal operation of the individual Sensor Minion devices an instruction would be sent throughout the network to eliminate further transmissions for the duration of the mission thus eliminating the possibility of interference or unwanted radiation in a hostile zone. After the mission a message with an encrypted authentication sequence would reenable the normal MinionNet network operation and allow downloading the collected data for debriefing or performance analysis.

The current implementation of the MinionNet network uses Minion devices that incorporate single frequency ASH transceivers. The primary reasons for this choice are as follows 

Key features that enable MinionNet network operation are the fact that all transmission and reception is on the same frequency. This means that Minion devices do not have to seek an active frequency or hopping pattern. All Minion devices in an area automatically snoop all message traffic and build a table of Minion device IDs automatically it is not necessary to explicitly transmit routing tables over the network. The low transmit power and 300 foot range means that this single frequency is able to handle many parallel geographically diverse micro nets which are interconnected either through gatewayMinion devices or Minion devices with overlapping ranges.

It is possible to expand the MinionNet network concept to include implementations using other transceiver technologies. In particular a spread spectrum implementation with higher power transmitters greater range and higher data rates would be possible. In any multi frequency implementation the applications would have to justify the added cost of synthesized transceivers and the necessary power supplies. In addition provision for operation on multiple Avirtual channels at the same time would probably be required. These channels could be implemented with different hopping patterns or code division schemes. The purpose would be to provide a single type of channel for traffic identification and routing purposes and to use other channels for the bulk of the data messages. Simultaneous use of the channels would allow the equivalent of the snooping feature of the traditional MinionNet network and yet increase the effective overall bandwidth and data rate for longer rang or more data intensive applications such as the Internet real time voice or video. Since the longer range communications would cover a geometrically increasing number of Minion devices the bandwidth required by the spread spectrum implementation would also increase geometrically. Careful power modulation in each transmitter would be required to keep such an implementation practical. Power modulation is a feature of the single frequency implementation but the ramifications of using excessive power in the wider area implementation are much more drastic.

The main reason for implementing a spread spectrum approach is 1 to allow higher bandwidth transfers to each Minion device and 2 to make near real time delivery of data possible over a larger area. Specifically any two single frequency Minion devices can expect to communicate but this may require a large number of hops and may have to involve gateways. Expanding the range of each Minion device through spread spectrum or multi frequency implementations with higher transmit power levels would allow direct communication over larger areas. There will be a trade off between the conflicts generated by these large coverage areas and the delays caused by multiple hops. It is anticipated that a balance will exist based on the type of application that needs to be supported.

For example MinionNet network based telephony might be practical with effective maximum transmission ranges on the order of 6000 feet. This is 20 times the range anticipated for the single frequency MinionNet network and would probably require a power output level of 3 watts or so for digitized voice. It is anticipated that short voice exchanges could be accomplished using this technology even if a small number of hops were included. Thus the effective coverage of such a network would encompass many square miles and require no fixed infrastructure such as cellular phone towers.

In addition it is anticipated that the correct organization of such a network would include a hierarchy of Minion devices with different service radii. An automatic negotiation would take place among Minion devices in a locally communicating network that would appoint a particular Minion device as the gateway to a larger service radius. Typically this Minion device would communicate with the gateways that were similarly selected for adjacent areas. This establishes a multi tiered gateway architecture that is dynamically configured and could extend to four or five levels as opposed to the basic MinionNet network implementation that uses a flat single level gateway architecture. This yields a totally wireless network that is conceptually organized more along the lines of the traditional wired telephone system with its hierarchy of different level i.e. local regional national and international switching offices. The key features of the MinionNet network architecture multiple identical nodes automatic reconfiguration and dynamic routing are preserved and expanded in this approach.

Hot Sync Data Minion devices could be installed in Palm Pilots to perform the data transfer currently done with hard wire modem or infra red links.

Universal Control Panel Replacement Minion device based Pilots would replace the user interface on a variety of devices.

Route Sales Terminal Minion device based Pilots could be used as route sales order entry terminals. The wireless link could connect to a portable printer and a gateway in the truck.

Restaurant Order Entry Minion device based Pilots could be used to link waiters with the kitchen ticket printers and credit verification terminals.

The major drawback to establishing real time voice connections is that the nodes involved in the connection need to remain nearly static for the duration of the connection. This becomes more problematic if the call is lengthy. If connections could be limited to a simple exchange of short messages possibly including limitation to half duplex the practicality of this approach would be increased. In addition the peak bandwidth allocation could be reduced proportionately.

Simple examples of the difference between a MinionNet network based voice messaging system and traditional telephony could be as clear as the differences between the Star Trek communicators and a teenager s telephone.

The Star Trek scenario allows virtually instantaneous transmission of a short message from one communicator to any other by name without any central processing or switching AKirk to Spock . A short verbal reply follows ASpock here. Kirk concludes the exchange with AOne to beam up. This is entirely one at a time half duplex communication with certain delays that are completely obscured by the short asynchronous nature of the communication. In particular the hypothetical voice actuated routing system cannot possibly know the intended destination of the message until Kirk finishes saying the word ASpock . Therefore the system has to have recorded the entire origination message analyzed it established the message routing activated Spock s communicator and then played back the AKirk to Spock message. This delay is not obvious from the way the communication is seen on TV but the effectiveness and utility of these short transmissions is amply demonstrated in the TV series. This type of voice communication would be feasible with MinionNet network technology.

In contrast current public expectations of a telephone system more closely match the teenagers. Connections can last for hours. There can be long periods of silence or background only transmissions. During conversation there will be frequent interruptions by the other party. A side tone and continuous receipt of Acomfort noise from the other party are expected. It would be difficult for a Minion based system to provide this type of service in a cost effective manner.

The lowest level Minion device will be capable of participating in the network routing traffic providing time and location services and acting as a proof of existence token. Many applications may find that this is all the service that is actually required. However added functionality will always be requested as customers find additional potential markets for the technology.

Minion device modules provide a component level capability that can be incorporated into existing designs with very little engineering effort. This will provide the shortest time to market for the technology.

In addition we envision a set of OEM modules designed for direct incorporation into consumer appliances as a replacement or supplement to the receivers for infrared remote controls modules that plug directly into the Standard Automotive Bus the Universal Serial Bus for personal computers and standard analog phone lines.

By replacing or supplementing the infrared receiver in home appliances the manufacturer would be able to offer distinctive new features for new and existing product lines. Controlling appliances such as televisions stereos cable and satellite receiver boxes thermostats and fire alarms would be possible from a personal computer personal digital assistant or from other rooms via a Minion equipped remote control. This would require minimal design changes to the appliances. Ultimately it would be possible to eliminate the expensive displays and switches that form the user interface to virtually all appliances.

For automotive applications a Minion device that plugs directly into the Standard Automotive Bus would allow such features as wireless diagnostics. This extremely easy installation of Minion devices in vehicles would not require any additional design work.

Many of the applications require a Minion device that can connect to a personal computer. It would be possible to connect a Minion device via the serial or parallel ports of any existing PC. Most new computers have an implementation of the Universal Serial Bus interface. This interface is ideal since it provides a self configuring Plug and Play connection scheme. Power is available on the bus and it is designed to support multiple devices without conflicts.

Minion devices could be designed for direct connection to existing analog telephone lines without interfering with the normal operation of the phones. This provides a convenient source of power for the Minion device as well as offering the opportunity for clever value added services such as wireless Caller ID ring detection recording of phone usage automatic muting of televisions during calls. The MinionNet network services would help to unify the telephones computers and appliances throughout a home or business.

Even though these application specific Minion devices add new features to each application and are cost justifiable on that basis alone the real benefit comes from the universal nature of the Minion devices themselves. Each Minion device incorporates the basic MinionNet network features of unique identity message routing time synchronization virtual geolocation and gateway access. This combination of features coupled with large numbers of Minion devices deployed in the field allow for services far beyond what any single application could provide.

The basic m Minion devices may be used as stand alone devices which perform the prescribed network functions or they may be connected to or embedded in external equipment or devices. For example 

Although these are network applications may not be part of the authorized MinionNet network because the applications are unlicensed these Minion devices would be available to transfer data to and from licensed Minion devices. Furthermore any Minion device would have the option to join the licensed network in the future by becoming a part of one of the MinionNet networks.

The following applications are generally grouped by the type of market. However it should be recognized that many applications can be applied to multiple markets and or may be combined.

This document describes the features and implementation of the kernel functions of the base Minion. The hardware listed is common to all Minions and does not cover any application specific ports interfaces or software. The software listed includes standard API calls that would be used by application specific drivers for external hardware.

The Minion is a low cost intelligent two way data radio. It participates as a member of a self organizing network of functionally identical nodes. Each Minion can originate and receive data messages and can act as an intermediary in forwarding messages on behalf of other Minions.

Each Minion may optionally be connected to external devices such as sensors memory or wide area network connections. Each Minion makes these resources available to the other Minions in the vicinity. Minions with wide area connectivity are referred to as gatewayMinions.

The base Minion uses a Microchip PIC16LF876 microcontroller and an AFX proprietary hybrid RF transceiver. The transceiver operates in the unlicensed 900 MHZ ISM Industrial Scientific and Medical band.

The physical implementation of a Minion consists of a radio transceiver microcontroller and memory contained on a double sided circuit board about the size of a postage stamp.

The radio transceiver operates in the unlicensed ISM band above 900 MHZ. The effective output power is less than 1 milli watt. All Minions transmit and receive on a single frequency. This eliminates the added cost and complexity inherent in spread spectrum or frequency agile approaches. The receiver is a stable inexpensive direct conversion implementation. Minions do not have frequency synthesizers local oscillators IF filters IF amplifiers or antenna duplexers.

The modulation is CW also referred to as on off keying and the bit coding uses a self clocking Manchester code. This minimizes the power required for transmitting since the transmitter is on for exactly half the time during a message transmission and is completely off at all other times. Manchester coding requires the receiver to be able to accurately detect signal edges on off or off on transitions. These edges must occur within certain timing windows to be valid. This provides an opportunity for increased noise immunity and rejection of spurious transitions. The self clocking nature of the bit coding means that there is no requirement for long term clock stability start stop bits or zero bit insertion such as would be found in asynchronous or synchronous schemes.

Since modulation using Manchester coded data is balanced the signal rides on top of the background noise level and is very easy to detect. A simple automatic gain control provides rejection of background noise and detection of data signals over a wide dynamic range.

The messages handled by the Minion Network can be thought of as being 32 bytes long and transferred at 9600 baud. Each Minion has a unique 32 bit serial number assigned during manufacture. This gives over four billion numbers although number reuse is not as big an issue in this environment as it is in some others. Each message will contain space for four of these serial numbers 1 the message originator 2 the message final destination 3 the device actually transmitting for this hop and 4 the intended receiver for this hop. Messages also contain a set of standard fields for message type codes device status bits message priority and handling bits. A payload area will contain application specific data such as geolocation information time date etc. as determined by the message type codes. In addition the protocol specifies a cyclic redundancy check CRC 16 used to detect errors encountered during transmission. The message length and data rate combine to give a maximum of 20 messages per second to or from a single node. The normal operation of the network will tend to keep the actual average rate down around one message every few seconds. The actual radio modulation scheme provides easily detected balanced modulation with self clocking data bits. This allows wide variations in microprocessor clock performance with temperature and eliminates the need for a crystal oscillator.

The basic protocol is completely connectionless and each message is treated as an independent datagram. Protection mechanisms are built in to ensure robustness but delivery of any individual message is not guaranteed. The database server may initiate enquiries into the distributed network and ask for retransmission of suspected missing messages.

The purpose of certain applications is to detect missing items and generate an exception report or alarm. Much useful information may be derived from interrogating the message routing tables of nearby nodes to establish a Minion s last known location.

The Minion transceivers are half duplex devices meaning they cannot transmit and receive at the same time. Several methods are used to avoid collisions two nodes transmitting at the same time and garbling the message for the recipient . First not all collisions will result in message corruption. If the receiver is not in range of both transmitters it is unlikely that the message will be corrupted. Second the level of traffic will be kept low and interval randomization techniques will be used to reduce the likelihood of simultaneous transmissions. Third all messages are implicitly acknowledged when they are forwarded on the next hop and explicitly acknowledged when received at their ultimate destination. Automatic retransmission and elimination of duplicate messages are features of the protocol.

The antennas for the radios are built into the case and are intended to provide omni directional coverage. This will never actually be the case and environmental limitations are an expected part of the operation of the network. The operating range of any transceiver will not be a fixed distance but should rather be viewed as a probability function. Thus the likelihood of successfully exchanging messages between radios is a function of their position in space. Viewed in this way all sources of transmission error can be incorporated into a single function. This is similar to taking the bit error rate allowed for a fixed length message and determining the probability of successful reception. Unlike the wired network the wireless network has a spatially distributed error rate.

That being said think of the effective range of a Minion as varying from 100 to 300 feet. Additional control of the area of coverage will be possible with the use of application specific antenna and packaging designs.

The following table shows the I O pin usage for the base Minion and the intended usage of the unused pins as implemented in various current board designs.

Memory and special function registers share a 512 byte address space divided into four pages. Some locations are duplicated in each page. There is a total of 368 available bytes of memory for programmatic usage. Sixteen of these bytes are duplicated across all pages we reserve these for interrupts service and language dependent uses.

The RC option provides a low cost implementation that assumes that any precision timing requirements are met by the real time clock. This allows the processor to spend most of its time in sleep mode without having an expensive oscillator powered off.

The XT option is intended to use a 4.0 MHZ crystal to provide a 1.0 MHZ instruction rate for general Minion operation.

The power up timer is normally only enabled on Minions that are expected to have low power operational requirements such as solar power. The power up timer provides a fixed 72 mSec delay before releasing the processor reset after power is applied.

The oscillator start up timer provides a fixed delay of 1024 oscillator cycles when a crystal oscillator is used. There is no delay if the processor clock is provided from a RC oscillator. The start up delay is invoked on power up and when waking from sleep mode since the clock is stopped in both cases.

An analysis is currently underway to explain certain operational problems in certain environments that change their characteristics when the WDT is enabled. This appears to be related to ESD but further study is required.

Brownout reset is not usable since the Minion is a 3.3 Volt not 5.0 Volt device. The brownout set point is a nominal 4.0 volts.

The actual transmitted signal level is either off or on but we use the Amplitude Shift Keying mode to allow the Minion to vary the transmitted signal level. In ASK mode the output power is governed by the current into the TXmod pin of the transceiver. We use a resistive divider to set the actual modulation level each time a bit is sent by the Minion.

The processor contains 256 bytes of non volatile EEPROM data memory. This is used to store the unique device serial number as well as program version information.

The processor contains 8192 words 14 bits each of program memory divided into four pages. This flash memory contains the MinionNet operating system and any application specific drivers. It is field programmable and program updates maybe received from the network and installed in a device without user intervention.

Timer is an 8 bit counter with edge select for the external clock source. It has an 8 bit programmable prescaler.

Timer is not used. Application specific drivers may use the Timer module for counting pulses on the T0CKI pin.

Future implementations of the timing calibration algorithm for the processor clock oscillator may use the Timer module in conjunction with an external time base. This could allow precision measurement of the processor clock using attached GPS remote geoMinions or the 32 KHz clock while the receiver and interrupts remained enabled. It would probably be best if the pre scaler could be assigned to Timer during this type of operation. Care should be exercised since the pre scaler is currently used by the Watchdog Timer for diagnostics.

Timer is used as the real time clock with the 32 768 Hz crystal oscillator. It uses the pre scaler in divide by 1 mode and generates an interrupt once per second. The interrupt service is responsible for updating a software count of elapsed seconds that is the basis of the real time clock available to applications.

Network synchronization messages establish the real time value of the clock and adjust the value of the Timer registers so as to maintain overall synchronization. The highest possible resolution is maintained as messages propagate through the network since Timer counts in units of 31 micro seconds. Every effort is taken to ensure that precision is maintained.

Timer is an 8 bit timer with an associated 8 bit period register and comparator. It counts instruction cycles. It can pre scale by 1 4 or 16 and can post scale by 1 through 16.

Timer is used to measure the interval between falling edges of received Manchester data from the radio receiver and to provide the required interval timing for transmitting Manchester data via the radio transmitter. The prescaler is used in 1 1 mode for interval counting and the postscaler is used in 1 1 mode to generate the interrupt that terminates reception of a faulty message.

In receive mode the timer is cleared by software after the falling edge interrupt in the receive data ISR. Subsequent interrupts read the current timer value prior to clearing the counter. The interval thus measured is used to determine the values of incoming Manchester data bits. The longest possible valid data interval is pre loaded into the compare register. If this long interval expires the module generates an interrupt which resets the receive mode clearing any message reception that was in progress.

In transmit mode the timer is used to measure the intervals between rising and falling edges of the encoded data to be sent via the radio transmitter. The FastSend implementation for 4.0 MHZ processor 1.0 MHZ instruction rate implementations runs with the interrupts disabled. The timer module is programmed to generate interrupts at intervals of one half bit time but the interrupt flag is polled and transitions are generated based on the outgoing bit stream. This generates extremely precise edge timing with no interrupt latency jitter. The data rate is high enough that not much processing time is left over with a 4.0 MHZ clock. It is anticipated that for a 20.0 MHZ 5.0 MHZ instruction rate implementation a fully interrupt driven variant would be used. The only significant issue would be additional latency generated by the possibility of other interrupts specifically the real time clock s one second interrupt and the serial communications port s I O interrupts.

For Minion implementations that do not use a stable processor clock oscillator we periodically measure the relationship of instruction rate to the real time clock and adjust the timing of our I O accordingly. This is handled by placing updated operating parameter values in the table driven implementation of the Manchester Encoder Decoder. Since the main sources of processor clock error are related to temperature and supply voltage and these will normally be slowly varying quantities we implement an algorithm that randomly varies the re calibration interval based on the anticipated operating environment of the Minion. The interval between re calibration cycles uses a control parameter based on the same algorithm that handles message expiration. An exponent which acts as a scale factor is chosen based on the anticipated environment and a random mantissa value is used. When the indicated time arrives re calibration occurs and anew control parameter is chosen to cause the next re calibration. Care is taken to ensure that the new time is actually in the future since a purely random mantissa has a one in sixteen chance of matching the current time.

This will result in an interval of up to 2 seconds during which transmission and reception will be inhibited. The one second sample interval is chosen to obtain a representative measurement and to minimize the effects of jitter in both the processor and real time oscillators.

The microcontroller has two Capture Compare PWM modules. The CCP2 module is not used since its input shares a pin with the 32 KHz oscillator.

The CCP1 module is used to detect the falling edge of the received serial data from the radio receiver. The falling edge generates an interrupt which is timed by the ISR using Timer . The captured value from Timer 1 is not used in the current implementation since Timer is the free running Real Time Clock 32 768 Hz divided by 8 .

It should be possible to implement a delta time function in the current ISR that would use the more precise edge latched time values but the source for Timer would have to be the processor clock. This would mean losing the 32 KHz real time clock.

The way it works now is that the falling edge triggers an interrupt the ISR reads and clears Timer evaluates the interval for the Manchester Decoder. If timer reaches the value in the period register PR2 it causes an interrupt which is used to restart message reception.

In the current implementation the receiver runs with all of the interrupt sources enabled. This means that there is an inherent jitter in the received time values based on the ISR service time for any combination of other interrupts. In reality the major source of error will probably be the real time clock s one second interrupts which may increase the probability of corrupting an incoming message that spans a one second boundary. The simplest solution would be to disable all other interrupts after the preamble of a message is received and to re enable them after message completion or when the receiver detects an error. This would add a worst case latency of one message time 30 mSec to these interrupts which corresponds to the delay that is already imposed due to the FastSend transmission methodology which disables interrupts completely during transmission.

The Synchronous Serial Port is used in IC mode to interface to optional on board serial EEPROM memory. Current boards allow up to four memory devices although the addressing scheme would support eight. Each memory device may be a Microchip 24AA256 with 32 K bytes of capacity giving a maximum external memory address space of 256 K bytes.

The USART is used in gateway implementations for communication with a host PC MOBITEX modem or GPS receiver.

The A D converter is used to measure the level of the primary power source although other channels are available for application specific usage.

Each interrupt has its own flag bit and enable bit. All peripheral interrupts also require the global peripheral enable PEE bit to be set before any actual interrupt will occur. The interrupt sources may be used in a polled manner by simply ensuring that the corresponding enable bit remains clear. Most interrupts require that the flag bit be explicitly cleared in the service routine as indicated in the table.

In order to allow application developers to use the Microchip In Circuit Debugging tool designed for the 16F876 we reserve 5 memory locations at 0 01EB through 0 01EF and the location 0 0070 which appears in all four banks. In addition the pins associated with RB6 RB7 and RB3 and the MCLR pin are able to be connected to the debugger hardware without interference. When the debugger is loaded into the PIC it occupies the highest 0 0100 words of the 8K flash address space.

Initial programming of a Minion takes place using a workstation running the Microchip MPLab software an ICD module and a 28 pin clip attached to the processor chip. Power is applied through the ICD not through the Minion.

The hybrid transceiver module uses SAW technology to provide direct conversion receive and transmit functions using shared filters. The transmit power level is a function of the current into the TXmod pin of the device. The minion circuitry provides a resistive divider to allow selection of the transmit power level. Certification requirements for the ISM band require that output power be less than 1 mW.

This section describes briefly the major aspects of the Minion operating system kernel. These features are present in all Minions and provide the base level networking functionality and the ability to add application specific support.

Message transmission begins by calling MakeMessage with the message type code. This creates a blank message with some header fields filled in. The destination field and payload are then filled in as needed by the application. Changes may also be made to the Hop and expiration fields.

A call to SendMessage waits for current receive operations to complete imposes a short random delay to help prevent message collisions computes the correct message RC 16 and then a makes call to FastSend. FastSend is a brute force Manchester encoder that runs with the interrupts disabled to ensure high quality edge timing in the transmitted message. Edge jitter will be less than 3 instruction cycles normally 3 microseconds .

Message reception consists of an interrupt driven edge detector attached to the receive data line from the radio transceiver. The edge detector establishes the interval between falling edges. These intervals drive a state machine that translates into the series of data bits that are placed into the receive buffer. When a complete buffer has been received without blatant timing errors the CRC 16 is computed and checked for correctness. If the message is correct a flag is set indicating that a valid message has arrived and further reception is disabled by setting the state machine to an idle state.

Received messages are processed as part of the operation of the main program i.e. not at the interrupt level. Upon completing the processing of a received message the main program will set the receiver state machine to reenable reception.

Handling of a received message may consist of adding it to a list of messages to be forwarded the transmit message queue. This is generally the case when the message You field is our ID but the message Destination field is not ours.

When we speak of messages and message acknowledgment in this section we are discussing a single hop from one Minion to the next and the acknowledgment that occurs. This is not an end to end confirmation of delivery.

Messages from F to G are acknowledged in one of two ways implicit or explicit. Explicit acknowledgment occurs when an acknowledgment message is generated and sent specifically back from G to F . Implicit acknowledgment occurs when the message is forwarded on to its next hop and the previous sender is able to hear the message being forwarded F deduces that G received the message successfully when F hears G send the message on to H .

If the received message is intended specifically for us our ID is Destination we generate an explicit acknowledgment. This covers the case where we are the end of the line so to speak. An explicit acknowledgment is also sent if a Minion G has received a message from F forwarded it to H received satisfactory acknowledgment and then hears F sending the same message again. The same means at a minimum a matching Source and Serial Number it is not necessary for a Minion to retain the entire message although this will probably be the most common case. Minions with large amounts of memory may retain the entire message and allow for the case where the message Serial Number has wrapped around 256 messages from the same Source . Full comparison would prevent the accidental suppression of non duplicate messages.

Upon receipt of an acknowledgment message the minion removes the message from its queue of pending transmit messages. A portion of the message or the whole thing may be retained in a list of sent messages memory permitting to allow the detection of duplicate transmissions and their elimination.

An explicit acknowledgment from G has F in the You field. The Hop limit will be adjusted to prevent accidental propagation in case F had lost the record of having sent the message originally.

Each Minion maintains a queue of messages to be transmitted. These include ones originated by the Minion itself and ones received for forwarding. The Minion firmware idle process will scan the queue transmitting each message in turn. In general messages will remain in the transmit queue until they are acknowledged or until they expire.

When a message expires a supervisory message is queued to be sent to the message s Sender to notify of the loss of connectivity and to update the intermediate routing tables.

As part of the process of preparing a message for transmission Minion G will look up the X in the routing table. If X is found the correct next hop H is filled in as You the hop count is adjusted and the message is transmitted.

A check is also made to ensure that the number of hops allowed by the message will allow routing via the entry we found in the table.

If the Destination X is not found in the table the message is replaced in the transmit queue by a supervisory message directed at F indicating that I no longer have a path to the destination . Note that this eliminates the possibility of acknowledgment of the message so when F gets around to re transmitting the message he will have the opportunity to discover and use an alternate route to the Destination.

The situation may occur where a Minion F receives a supervisory message as above has no alternate path and has a pending data message awaiting acknowledgment for the now unreachable destination. F will modify and send the supervisory message all the way to the Sender of the pending data message. This notifies the sender and all intermediate Minions that there has been a path disruption. F then discards the undeliverable pending data message.

The Sender may use this notification as a hint that messages have been dropped and so re transmit recent messages or perform other session level tasks as necessary to confirm or re establish the link.

The total amount of memory number of entries allocated to the Routing Table is dependent on the available memory in the Minion and its intended application. Short routing tables can be allocated in processor RAM but longer tables are stored in non volatile EEPROM either on the processor chip or in external memory.

The Hop Count field stores the expected number of hops required to reach Destination ID when sending via Via ID .

The LRU Count is used to conceptually order entries in the table so that the oldest will be overwritten by new entries.

As a goal the MinionNet network maintains unified network time with an accuracy in the 1 milli second range. This time standard is fundamentally derived from GPS time. We implement a monotonically increasing count of GPS seconds and coordinate the time base with GPS receivers attached to geoMinions which achieve an accuracy on the order of several micro seconds.

geoMinion synchronization messages are broadcast using precision edge timing that is correlated to the time reference contained in the message. This allows the receiving Minion to adjust its timer to synchronize with the rest of the network.

The kernel clock functions maintain a figure of merit associated with the real time clock. This is essentially a tolerance value that is used to determine the degree of faith that should be placed on the time value. Upon power up or after periods running autonomously without network contact the figure of merit will be low. geoMinions receiving good satellite data will have high figures of merit. Any Minions receiving synchronization messages from multiple geoMinions with tight correlation between the messages will have the highest figure of merit.

Minions use their internally maintained figure of merit as a sanity check for network synchronization messages. If a message claims a higher figure of merit than the Minion s own and the time value in the message is within the tolerance band of the Minion the Minion will reset its clock to the new value and boost its figure of merit. If a message claims a lower figure of merit than the Minion s own the message will be ignored.

If a message claims a time that is out of tolerance with the Minion s internal clock the Minion will cease originating or forwarding synchronization messages. As time passes the Minions internal figure of merit will degrade. Once synchronization messages from at least two sources show an acceptable correlation the Minion will accept the new time and resume participation in the network synchronization process.

The Minion Firmware kernel provides interrupt services for the following devices RF Receiver Real Time Clock USART transmit and receive and the external interrupt pin. All of these are normally handled internally with data being moved into and out of queues. The application program normally never needs access to the actual interrupt service routing.

Application programs should be structured in the form of state machines which are run as a cooperative part of the MinionNet operating system. Each state should perform a specific well defined task and then return to the operating system. The sequence of states can be controlled by data from the network the passage of time or information derived from application specific sensors.

Specific hardware Application Programming Interfaces APIs are provided as part of the code protection design of the Minion firmware. In general the programmer writing code for a particular application will not be allowed to access hardware ports directly he must use API calls provided by AFX.

The Minion Firmware supports a mechanism that allows data to be stored anywhere in the program or data memory. This is used to load application specific firmware during the manufacturing process. In addition a download mode can be initiated in the field that allows an individual Minion to receive a complete firmware upgrade from another Minion. This is usually provided as a gateway service since gateways typically have more memory and can store complete code updates for a variety of application specific devices.

MinionNet messages consist of 32 data bytes followed by a 2 byte CRC 16 for error detection. The 32 byte message is divided into a 20 byte header and 12 byte payload. The header is used to provide network routing and message handling information while the payload contains any application specific data fields.

Type is an 8 bit value used to identify different message formats for handling by the MinionNet network itself. Unique types are used for virtual geolocation routing table updates precision time synchronization self announcement broadcast messages and application specific data. The coding of these types is to be determined. Selected Type codes are in developmental use as defined in the table below.

Four fields You Me Source and Destination are 32 bit Minion ID fields. In general they represent the unique identifier assigned to each Minion during manufacture. Certain IDs taken from this pool of 4 294 836 225 are reserved for certain routing functions and identifying application specific databases .

 You is the specific Minion intended to receive this particular transmission. It may also be 0 to indicate a broadcast message intended for any recipient.

 Source is the ID of the originator of the message. The message may be carried by multiple intermediaries before reaching its ultimate destination.

 N is the 8 bit serial number of the message as counted by the Source minion. It consecutively numbers messages from 0 to 255 then starts over.

Any Minion that originates messages that require forwarding establishes a valid Hop Max value based on the expected routing of the message.

The Hop Max field is the number of hops that the message will be allowed to make before reaching its destination. It is set by the Source Minion and remains unchanged as the message proceeds from one intermediary Minion to the next. The Source Minion uses its current routing table information to determine the expected length of the path to the Destination Minion.

The Hop To Go field is the number of hops remaining for this message. Each intermediary Minion decrements the Hop To Go field before forwarding the message.

The mechanism that selects the routing for the next hop will determine if the expected path to the Destination is still short enough to be reached with the remaining hops. If the path is too long the message will be discarded and a new supervisory message will be created and sent to the Source Minion. The supervisory message indicates routing failure and helps in establishing new routing for future messages.

In a static environment all Minions update their routing tables based on the header information contained in all messages that are received. Snooping on messages especially those that are not directed toward the snooping Minion is the primary method that Minions use to keep their routing tables updated. Information concerning the path length to each of the four Minion IDs contained in the message header can be derived. The Hop To Go value plus one is the number of hops that a snooper would expect to be able to use to reach the Destination Minion. The difference between Hop Max and Hop To Go plus one is the number of hops that a snooper would expect to be able to use to reach the Source Minion. The Me Minion could be reached in one hop. The You Minion could be reached in two hops.

 X is the 8 bit Expiration field. Messages may move from one Minion to another as they propagate toward their Destination. These individual hops may be delayed by factors such as network traffic broken communication links and the use of messengers that physically move and establish new dynamic routes. The originator of each message Source Minion is aware of the period of time over which a particular message will me meaningful. This information is stored in the message header in the form of an expiration time for the message.

Any Minion that originates messages that require forwarding establishes a valid Expiration Field value based on the longevity of the data in the message.

The expiration of a message occurs when the current time maintained by the Minion matches the value indicated by the Expiration Field. The use of an Exponent Mantissa format allows the dynamic range of expiration times to range from a few seconds to several weeks.

All Minions maintain a synchronized 32 bit seconds counter for network message handling functions. The bit fields described here are based on a counter where bit 0 increments every second. The message expiration algorithm assumes time synchronization among all participating Minions.

The Source Minion begins with an expected lifetime value for the message. The exponent is chosen such that it is the smallest with a range that covers the expected lifetime. The Minion then computes an expected timeout time for a message by adding the expected lifetime to the current time value. The chosen mantissa is the four bit field within the timeout time value selected by the exponent. Using this methodology we achieve a timeout resolution on the order of 3 over the range indicated by the exponent.

It is possible for a Minion to have lost time synchronization with the network. For certain applications it is possible for such a Minion to use the statistical properties of the timeout algorithm to advantage. Specifically an AVERAGE message timeout may be chosen by simply setting the exponent value and leaving the mantissa zero. This does not require a time value at all in the Source Minion but will result in messages timing out randomly during the range implied by the exponent.

All Minions capable of acting as Messengers must implement the expiration algorithm. They are expected to maintain a clock synchronized to network time. The operating system idle process periodically examines each message in the store and forward queue. If the bits in the current time match the bits specified in the message s expiration field the message is discarded.

Each application may have payload formats that are specific to the needs of that application. In general the network will neither know nor care about the contents of the message payload. In particular the message payload may be encrypted with an end to end encryption algorithm that makes it impossible for any intermediary or outside observer to determine the message contents. The recipient of a MinionNet message is able to use the information in the Type Source and Destination fields to uniquely identify the message format and can then decode the meanings of the individual bits in the Payload area. In addition the Source Sequence Number N can be used to reassemble a lengthy data block from multiple MinionNet messages.

The wide variety of messages are too complex to be described here in detail but the general flavor of coding can be demonstrated with a few examples.

This beacon announcement message is sent at a fixed rate for system evaluation purposes. A typical rate is once per second but other rates may be used to cover different circumstances. The transmission uses ProtocolDelay to prevent normal transmission collisions.

For the current diagnostic purposes the You Me and Source fields are the ID of the particular Minion. This prevents any message routing and allows handling and performance evaluation using Minions explicitly programmed for this application. This eliminates the possibility of interference with other applications being developed at the same time in the lab.

Payload Field M is the value of iReceiveMode the message reception mode value prior to the last reset.

This message is sent periodically to act as a self announcement message as well as to convey data to diagnostic gateways.

For the current diagnostic purposes the You Source and Destination fields are null. This prevents any message routing and allows handling and performance evaluation using Minions explicitly programmed for this application. This eliminates the possibility of interference with other applications being developed at the same time in the lab.

This message is sent as an interrogation message from a reading device to a specific Minion given by TargetID.

This message is sent as a command message from a reading device to a specific Minion given by TargetID. It is used to command disconnect and reclosure Minions.

The target Minion will send a response not documented here upon receipt of the Poll Command message. The command response includes the current status of the switch.

This message is sent in response to an interrogation message from a reading device. The You and Destination fields are filled in with the MinionID of the Minion that interrogated the unit. Thus the response is sent back directly to the interrogating Minion.

Programming of the Minion is done exclusively in an enhanced high level version of Microchip Assembler. The enhancements provide a carefully controlled structured environment for developing an very large project in an otherwise intractable language. The Enhanced assembler provides the following high level features 

The software is expected to be implemented as a state machine which cooperates with the operating system to allow handling of MinionNet network traffic in parallel with the application specific activities of the Minion. The state machine implementation has the added advantage of minimizing the stack requirements for hardware that is severely limited in that respect.

When creating an application specific MinionNet program it is necessary to provide two assembly language components. These are an Initialize routine and a Loop routine. The Initialize routine sets up memory and hardware as required by the application. It is called any time the Minion is reset. The Loop routine is called repeatedly during normal Minion operation. It is expected that the application will be implemented as a state machine with each entry to the Loop processing a single state or transition. It is not necessary or allowed for the user application to retain control for long periods of time as network message processing is interspersed with calls to Loop. Due to interrupts and network related processing there are no guarantees concerning the timing of Application Specific operations.

The application specific routines are written using the AFX Enhanced Assembler and have approximately one page of program memory available for application code. Most functions are expected to be implemented by a series of calls to AFX supplied functions. In particular access to I O ports must be done through approved interfaces to avoid interference with the Minion functions.

For power starved applications the operating system can be configured to enter sleep mode at periodic intervals and to re awaken on a timer or external interrupt basis. To implement the lowest possible sleep mode power consumption the application specific peripherals must be able to be shut down and restarted. If sleep mode is to be used by a particular Minion the application must provide two additional procedures Nap and Wake which will be called before and after the operating system invokes sleep mode.

