---

title: Systems and methods for gathering debug information
abstract: System and methods are disclosed for gathering debug information of a storage system of a computer system without requiring additional external hardware directly connected to the controller of the storage system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07818627&OS=07818627&RS=07818627
owner: LSI Corporation
number: 07818627
owner_city: Milpitas
owner_country: US
publication_date: 20050923
---
The present invention relates generally to the field of embedded systems and more particularly to systems and methods for gathering debug information from embedded systems.

In the development of embedded systems such as data storage systems debugging operations are typically performed using external hardware. The external hardware is used to monitor and control the system. depicts an exemplary system of hardware used to debugging a storage system.

While developing firmware it is very important to have a serial port or some other type of hardware connected to controller to debug it while the code. This way a developer has extensive information which can help find and analyze problems. A developer can also step through the code while it is executing. This functionality also allows the developer to change execution order of the code. Essentially the developer can have full control over the software that is being developed. Although having hardware for external connections is beneficial for the development and testing of a system the hardware is not generally included in the final product.

To reduce the final costs of the system the hardware used to create the connection to the external hardware e.g. debugging system is typically removed. For example a UART universal asynchronous receiver transmitter not shown used to facilitated communications with external debugger may be removed from controller to help reduced the production costs of system . Although computer system is typically very stable upon release to customers computer system may still experience some problems while being operated by a customer. Because these problems generally occur while computer system is at a customer location and without any external hardware attached to system it is very difficult to debug the problems that occur. The developer of the computer system may attempt to reproduce a customer s problem but this can take considerable amounts of time. Furthermore some problems experienced by a customer may not be able to be reproduced by the developer.

Accordingly what is needed are systems and methods for gathering internal information of an embedded system without having additional external hardware connected.

In general exemplary embodiments of the invention are concerned with systems and methods for gathering and displaying debug information. In an embodiment a computer system is capable of gathering debug information of its storage system without requiring additional external hardware directly connected to the controller of the storage system. The computer system comprises a host processor and a storage system which comprises a controller communicatively coupled to the host processor and an array of storage devices communicatively coupled to the controller. Resident on the computer system is an application for issuing debug commands to the controller of the storage system and for receiving and displaying data from the storage system. In an embodiment the application may comprise an issuing module operated by the computer system for issuing debug commands to the controller of the storage system and a receiving module also operated by the computer system for receiving and displaying data from the storage system.

In an embodiment a method for issuing debug commands to the storage system involves receiving a debug command. The command may be entered by a user or may be automatically generated based upon information regarding computer system . In an embodiment the debug commands may allow varying levels of access to the storage system and may also be password protected. In an embodiment the debug command may also be checked against existing commands to determine if it is a valid command. In an embodiment if the command is not valid the process may return to request input of a different command. Because different vendors of controllers and storage devices may employ different or proprietary commands an embodiment of the present invention may include the use of standard commands at a user level regardless of the controller or storage devices being accessed. If necessary the standard command may be mapped to a corresponding proprietary command. In an embodiment an IOCTL command or commands may be prepared. The debug command is sent to the device driver and if necessary forwarded to the storage system. In an embodiment these methods may be performed by an issuing module.

An embodiment of the present invention includes methods for processing a debug command. In an embodiment the controller receives a debug command via the device driver. The controller may be configured to determine if the received command is supported. If the command is not supported by the controller the controller may indicated that the received command is not supported and return that data for display to a user. If the command is supported the command is processed and the data returned for display to a user.

In an embodiment the data received from the storage system may be formatted and displayed for a user. In one embodiment the method of receiving and displaying the data may be performed by a receiving module.

Although the features and advantages of the invention are generally described in this summary section and the following detailed description section in the context of embodiments it shall be understood that the scope of the invention should not be limited to these particular embodiments. Many additional features and advantages will be apparent to one of ordinary skill in the art in view of the drawings specification and claims hereof.

In the following description for purposes of explanation specific details are set forth in order to provide an understanding of the invention. It will be apparent however to one skilled in the art that the invention can be practiced without these details. Furthermore one skilled in the art will recognize that embodiments of the present invention described below may be performed in a variety of ways and using a variety of means including software hardware firmware or a combination thereof. Accordingly the embodiments described below are illustrative of specific embodiments of the invention and are meant to avoid obscuring the invention.

Reference in the specification to one embodiment a preferred embodiment or an embodiment means that a particular feature structure characteristic or function described in connection with the embodiment is included in at least one embodiment of the invention. The appearances of the phrase in one embodiment in an embodiment or the like in various places in the specification are not necessarily all referring to the same embodiment.

Various systems in accordance with the present invention may be constructed. is a block diagram illustrating an exemplary system in which embodiments of the present invention may operate. It shall be noted that the present invention may operate and be embodied in other systems as well.

Computer may be any type of apparatus having a host processor coupled to a memory not shown for retrieving data and for executing instructions stored in the memory. Such instructions may include instructions used to perform I O Input Output commands or operations with respect to one or more of the storage devices A in the array of storage devices . Computer is generally supported by an operating system to which controller communicates. Controller also communicates with the storage devices for controlling access to storage devices A and I O requests made by computer .

Controller may be one or more disk array controllers for controlling I O commands with respect to one or more of the storage devices A in the array of storage devices and or for changing firmware not shown within the storage devices A . Controller is communicatively coupled across interface to a data storage system comprising an array of storage devices . Storage devices A may include one or more of the following magnetic disks optical disks solid state disks or non volatile electronic storage elements. Controller may include a processor not shown for fetching data and instructions stored in memory not shown to perform or execute commands including I O operations and coordinating data management operations across the array of storage devices .

Application may comprise an issuing module and a receiving module to perform the functions listed above as well as additional functionality. In an embodiment these modules may communicate with each other and with device driver and or controller . Each module may be implemented in software hardware firmware or any combination thereof. It shall be noted all or part of the functionality of each of the modules may be combined together or divided into sub modules. In an embodiment all or part of the functionality of the modules in application may be performed by one or more of the following computer device driver controller and one or more of the storage devices .

Firmware of controller provides API application programming interfaces or controller commands to access firmware data structure. When problem occurs a developer can access the firmware data structures via the controller commands. When a debug command is issued the firmware can execute this command. In an embodiment the firmware may be issued with high priority set so that the command may be executed immediately.

Different vendors of controllers and storage devices may employ different or proprietary commands. An embodiment of the present invention may include the use of standard commands at a user level e.g. step regardless of the controller or storage devices being accessed. If necessary the standard command is mapped to a corresponding proprietary command.

In an embodiment an IOCTL command or commands may prepared . IOCTL stands for Input Output Control and is an operating system format of the command. The formatted command is sent to the device driver . In an embodiment the method illustrated in may be performed by issuing module .

In an embodiment the commands may be provided such that a developer can have full access GET SET to data structures and be able to step though the entire life cycle of the command. It should be noted that even the execution of the firmware code may be modified. Thus the present invention provides much of the features of hardware debuggers but without requiring hardware attached to the system. In an embodiment access to internal data structures may be password protected so that data is secured and only intended persons can have access. In yet a further embodiment varying levels of access may be granted such that access may be limited to particular sets of commands. In an embodiment these kinds of feature may be set during implementation of the firmware.

If the command involves reading data the requested data is read from the DRAM NVRAM register and or storage devices and transferred into the host buffer. The status is updated and the status information and data may be returned to the application for display.

If the command involves writing data the given host data is written to the specified location which may include the DRAM NVRAM register and or storage devices . The status is updated and the status information may be returned to the application for display.

One skilled in the art will recognize that the present invention includes a number of advantages. The present invention provides new methods of data gathering with minimal changes in the firmware and utility. The present invention provides much of the functionality of a hardware debugger without requiring the additional hardware. The present invention may be made platform or operating system independent and may be implemented for a number of embedded systems. Thus these systems and methods may be applicable to any of a number of kinds of embedded systems where external hardware is typically required to analyze and or gather firmware information.

When a problem occurs at a customer s site the present invention provides ready and easy methods for a developer to debug a problem directly instead of relying solely on log data or waiting for a tester to reproduce the problem assuming that the tester is successful in reproducing the problem. One skilled in the art will also recognize that there is no need for a developer to be physically present to debug the problems. A developer may be remotely present and debug the problem the same way as if the developer were sitting at the system . This added functionality allows for a number of customer issues to be solved quicker and more readily since a problem can be addressed as soon as it occurs.

These advantages also result in reducing the time to fix problems. The present invention also allows a developer to address more issues in a shorter time span as compared with old methods of debugging. Since the time of fixing a problem is reduced the stability of the system increases as compared to using old methods of debugging. Furthermore because the present invention increases a developer s ability to debug a system that has been deployed to a customer it can reduce the probability that a problem will reoccur since the problem is more likely to be solved when it is reported.

The above description is included to illustrate embodiments of the present invention and is not meant to limit the scope of the invention. One skilled in the art will recognize that the present invention has applications beyond embodiments and illustrated examples. Accordingly it shall be understood that neither the number of storage devices nor their configuration are critical to the present invention. The scope of the invention is to be limited only by the following claims. From the above discussion many variations will be apparent to one skilled in the art that would yet be encompassed by the scope of the present invention.

