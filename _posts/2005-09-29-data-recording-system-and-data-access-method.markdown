---

title: Data recording system and data access method
abstract: A data recording system and method are provided which, when the removal of a recording medium is detected during data writing, the data recording system retains accessed processing not executed in the data writing, and executes the retained access processing when the removed recording medium is inserted again into the data system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07620994&OS=07620994&RS=07620994
owner: Canon Kabushiki Kaisha
number: 07620994
owner_city: Tokyo
owner_country: JP
publication_date: 20050929
---
The present invention relates to techniques for preventing a file system of a removable storage medium from being destroyed.

Currently removable storage media such as secure digital SD memory cards that provide excellent transportability and are less expensive than fixed disks are used for example in personal computers personal digital assistants PDAs mobile phones and digital still cameras. Such SD memory cards serve as storage devices for storing files. Magneto optical disks and the like are also widely used.

A removable storage medium such as an SD memory card has an advantage in that it is excellent in regard to transportability. However since the user can remove a removable storage medium from a drive unit at any time a file system may be destroyed and files stored in the storage medium may no longer be accessible if the storage medium is removed from the drive unit during the execution of file access to the medium.

In response Japanese Patent Laid Open No. 6 161863 discloses a method in which unique information is compared for the protection of data. Specifically a drive unit writes unique information to a removable storage medium temporarily suspends access processing to the medium during the removal of the medium and retains the unique information in memory. When the storage medium is inserted again the drive unit compares the unique information retained in its memory to that written in the storage medium. Then only when they match the drive unit permits access to the storage medium therein and restarts access processing to the medium.

However this method has an inherent problem in that although data can be protected with respect to a first information processing system from which a storage medium has been removed during the execution of input and output operations to and from the storage medium data cannot be protected with respect to a second information processing system differing from the first information processing system. There are a couple of reasons why the aforementioned problem is caused both of which are discussed below.

First when a storage medium is inserted into an information processing system it cannot be determined based only on the comparison of unique information whether or not the storage medium has been removed from another information processing system during the execution of input and output operations and in this case data stored in the storage medium may be modified.

And second even if a forced removal flag indicating whether or not input and output operations are in progress is written to the storage medium together with unique information data may be modified because an information processing system without the above described data protection function cannot recognize the forced removal flag. In this scenario once data is modified the data cannot be recovered or sometimes it may even be destroyed if the storage medium is inserted again into the first information processing system from which the medium has been removed.

The present invention overcomes the problems described above and further provides a data recording system and a data access method that can ensure that data is not modified in other systems. The present invention further can prevent a file system of a recording medium from being inadvertently destroyed.

According to an embodiment of the present invention a data recording system is provided which includes a removable recording medium a removal detecting unit configured to detect the removal of the recording medium a data writing unit configured to write a string of data to the recording medium an access processing retaining unit configured to retain access processing left unexecuted by the data writing unit when removal of the recording medium is detected by the removal detecting unit during data writing by the data writing unit and an unexecuted access processing executing unit configured to execute access processing retained by the access processing retaining unit when the removed recording medium is inserted again into the data recording system.

Further aspects features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached Figures.

Several embodiments and aspects thereof the present invention will now be described with reference to the Figures.

Light passes through a lens and is output as electric signals from a charge coupled device CCD unit . An analog to digital A D converter converts analog signals from the CCD unit into digital signals. A synchronizing signal generator SSG unit supplies synchronizing signals to the CCD unit and A D converter . A central processing unit CPU implements various control operations in the camera system .

A signal processing accelerator achieves high speed signal processing. A direct current to direct current DC DC converter is provided for supplying power from a battery to the entire electronic camera . A power supply controller unit controls the DC DC converter . A microcomputer controls panel operations a display device and the power supply. A display device such as a liquid crystal panel displays various information to the user. A control panel provides a release switch and menu buttons that the user manipulates directly.

System programs including an operating system OS are stored in read only memory ROM . Dynamic random access memory DRAM serves as main memory of the electronic camera. Flash ROM serves as an internal storage medium. Further the camera system includes an interface for an SD card a direct memory access DMA controller and a flash lamp .

Various operations of the electronic camera during photographing will now be described. First the CPU detects that the user has pressed the release switch on the control panel and initiates a photographing sequence. The following exemplary operations which will be described below may be performed under the control of the CPU .

Pressing the release switch causes the SSG unit to drive the CCD unit . Analog signals output from the CCD unit are converted by the A D converter into digital signals. Output from the A D converter is transferred by the DMA controller to the DRAM . Upon completion of a frame by DMA transfer the CPU initiates a signal processing sequence.

In the signal processing sequence a signal processing program is read from the flash ROM into the DRAM main memory data in the main memory is transferred to the signal processing accelerator which then performs signal processing. The signal processing accelerator which serves as an arithmetic circuit does not perform the entire signal processing but assists the CPU in performing particularly time consuming processing and operates in concert with processing software in the CPU . Upon completion of all or a part of the signal processing the processed data is recorded as an image file in the external storage medium via the card interface . Data compression is also performed if required for the file format to be used in recording the data.

Furthermore a block device layer constitutes a layer L at the bottom. The file system architecture layer L uses services provided by the block device layer L to implement file input output operations. The block device layer L manages data on a sector e. g. 512 bytes basis. The block device layer L compensates for differences in inputs outputs among devices and differences in parameters of a head cylinder and the like. A camera system with a plurality of different types of devices thereon can thus be provided.

In the camera system of the present embodiment a plurality of services provided by the external storage medium constituting the block device to the file system are provided including but not limited to B. reading of data from sectors specified by logical sector numbers B. writing of data to sectors specified by logical sector numbers and B. erasure of data in sectors specified by logical sector numbers. The camera system of the present embodiment includes an external storage medium capable of providing at least services B. and B. .

Another aspect of the present embodiment is that an access lock can be applied to the external storage medium . The access lock disables at least services B. and B. to prevent internal data from being modified. Except for a system in which the access lock has been set the access lock cannot be automatically released without the user s input. That is to say an access lock is applied with a password. An example of the external storage medium with the above described features includes an SD memory card. For exemplary purposes an SD memory card having a password lock function allowing an access lock with a password will be utilized as the external storage medium. However it is noted and acknowledged that other forms of memory may also be utilized in the present embodiment and thus should not be limited to only the use of an SD memory. Furthermore a file allocation table FAT file system will be utilized as an example of the file system architecture for the present embodiment.

The password lock function of the SD memory card will now be described. Except for access for the release of a password lock the password lock function is configured to disable all access including services B. and B. involving the modification of data in the SD memory card. The password lock function allows the registration of only a single password and does not allow a multiple lock.

The SD memory card provides a plurality of card access functions C. to C. that perform password control operations including but not limited to 

 C. Password change by specifying an old password and a new password when a password has already been set 

 C. Password unlock executed when a password lock is applied by specifying a password With regard to this the password is not deleted by this operation and

 C. Forced password unlock executed when a password lock is applied by simultaneously executing the release of the password lock and the deletion of all data in the SD memory card without specifying a password.

In step S it is determined whether or not a password has already been set for the SD memory card. If it is determined that a password has already been set the password setting sequence fails in step S and the process ends. If it is determined in step S that a password has not been set yet a password is set in step S and the process ends.

In step S it is determined whether or not a password has already been set for the SD memory card. If it is determined that a password has already been set it is further determined in step S whether or not the set password and the obtained old password match. If it is determined that they match it is further determined in step S whether or not a password lock is currently applied. If it is determined that a password lock is not applied the new password is set in step S and the process ends. If it is determined in step S that no password has been set determined in step S that the set password and the old password do not match or determined in step S that the password lock is applied the password change fails in step S and the process ends.

In step S it is determined whether or not a password is currently set. If it is determined that a password is set it is further determined in step S whether or not the set password and the obtained password match. If it is determined that they match it is further determined in step S whether or not a password lock is currently applied. If it is determined that a password lock is not applied the password is deleted in step S and the process ends. If it is determined in step S that no password is set determined in step S that the set password and the obtained password do not match or determined in step S that the password lock is currently applied the password deletion fails in step S and the process ends.

In step S it is determined whether or not a password is currently set for the SD memory card. If it is determined that a password is set it is further determined in step S whether or not the set password and the obtained password match. If it is determined that they match it is further determined in step S whether or not a password lock is currently applied. If it is determined that a password lock is not applied a password lock is applied to the SD memory card in step and the process ends. If it is determined in step S that no password is set determined in step S that the set password and the obtained password do not match or determined in step S that the password lock is currently applied the password lock fails in step S and the process ends.

In step S it is determined whether or not a password is currently set for the SD memory card. If it is determined that a password is set it is further determined in step S whether or not the set password and the obtained password match. If it is determined that they match it is further determined in step S whether or not a password lock is currently applied. If it is determined that a password lock is applied the password lock for the SD memory card is released in step S and the process ends. If it is determined in step S that no password is set determined in step S that the set password and the obtained password do not match or determined in step S that a password lock is not currently applied the password unlock fails in step S and the process ends.

It is further noted that the card access functions C. to C. to the SD memory card are performed by sending a command with subsequent password control data to the SD memory card. Exemplary architectures of password control data to be sent to the SD memory card for the execution of the card access functions C. to C. will be described in . It is noted that each line represents a byte of data. All bytes and all bits in each byte are given numbers starting with zero. Further numbers in parentheses represent specific values.

Since card access that involves password control is processed synchronously a password is prevented from being changed or deleted if a password lock is applied. Moreover the SD memory card is provided with an automatic password lock function that allows if a password is set a password lock to be automatically applied to the SD memory card when power supply is started e. g. when the SD memory card is inserted into a system that is ON or when a system to which the SD memory card is attached is turned ON .

Now referring back to the FAT S and a FAT contain positional information about files stored in a user data area S. The FAT file system obtains from the FAT S and the FAT S positional information about files stored in partitions. Even if files are stored in the user data area S the FAT file system cannot recognize them as files if their positional information is not stored in the FAT S and the FAT S. A directory entry S therefore contains management information about files stored in a root directory. Furthermore the bodies of files are stored in the user data area S.

There are provided numerous exemplary file access functions features units modules 1 to 7 configured to provide file access to the FAT file system including but not limited to 

 1 A file creating feature unit module configured to create an empty file wherein a file created by the file creating feature unit module is opened 

 3 A file opening feature unit module configured to open an already existing file wherein the file opening feature unit module detects the beginning of a file when opening it 

 5 A file reading feature unit module configured to read in an opened file file content of a specified size from the position currently detected 

 6 A file writing feature unit module for writing in an opened file specified data of a specified size from the position currently detected wherein if the position currently detected is not the end of the file the file writing feature unit module overwrites the current file content and

 7 A file seeking feature unit module configured for moving in an opened file wherein the file seek feature unit module is capable of moving to specified positions for example to a relative position from the position currently detected or to an absolute position such as to the beginning of a file.

When the file access features functions 1 to 7 described above are used the FAT file system divides the file access into operations of the services B. to B. provided by the block device on the lower layer issues them as instructions to the block device thereby storing file data in a storage medium. For example to perform file storing processing to store file data in a storage medium FAT write access that is a writing operation through which positional information about a file is written in the FATs S and S and file write access that is a writing operation through which file content is written in the user data area S are performed. In this case each of the FAT write access and the file write access is divided into one or more operations of the service B. and issued as instructions to the block device layer. Upon receipt of the instructions the block device layer performs data access to the storage medium. Thus the FAT file system stores a file as data in the storage medium.

In the file storing processing described above the FAT file system cannot recognize a file until a group of services issued to the block device layer including at least two operations of the service B. have all been performed. Like the above described file storing processing that includes at least one FAT write access and one file write access a file access processing set that allows the FAT file system to recognize a file only after the execution of all the access operations is called a FAT file system access processing set in the present embodiment.

An executing feature unit module configured to execute the FAT file system access processing set in file access to the FAT file system according to the present embodiment will now be described. First to distinguish the removal of the SD memory card during the execution of the FAT file system access processing set from that during any other time the former is called forced removal and the latter is simply called removal .

In the case of the forced removal of the SD memory card a password lock is applied to the SD memory card. This prevents data in the SD memory card from being modified during the period between the forced removal and the time when the SD memory card is inserted again. Therefore if the SD memory card is inserted again a file system recovery operation can be performed such that access processing that has not been executed before the forced removal can be performed to allow the recovery of the FAT file system.

To perform the file system recovery operation an unexecuted processing list of access processing in the FAT file system access processing set is created before the execution of the FAT file system access processing set. Moreover a password is set for the SD memory card to use the automatic password lock function. To prevent the same password from being set for a plurality of SD memory cards in the case where the forced removal occurs a plurality of times in succession a unique password creating feature unit Module configured to create a unique password for each SD memory card is used to generate and set a new password. For example the unique password creating feature unit module is adapted to create a unique password according to a specific algorithm based on the combination of attribute information and a serial number of the SD memory card as attribute information and a serial number can be obtained even if the SD memory card is password locked.

In some scenarios there is a possibility that a password has already been set before setting the new password. If a password has been set it is determined whether or not the SD memory card is password locked. If it is determined that the SD memory card is password locked the FAT file system access processing set is terminated without being executed. If it is determined that the SD memory card is not password locked the password is changed to the new password and an old password previously set is retained.

The execution of the FAT file system access processing set is implemented by unexecuted processing list serial processing through which the unexecuted processing list is serially processed and completed access processing is deleted from the list. If the forced removal of the SD memory card occurs during the execution of the unexecuted processing list serial processing the new password is associated with the unexecuted processing list at that point. If the old password is retained the new password is also associated with the old password. The new password and those associated therewith may be registered in a forced removal password table. To prepare for the case where the forced removal occurs a plurality of times in succession the forced removal password table allows a plurality of items to be registered. If the unexecuted processing list serial processing is completed without the occurrence of the forced removal it is determined whether or not the old password is retained. If it is determined that the old password is retained the password is changed to the old password. If it is determined that the old password is not retained the new password is deleted and the process ends.

If the forcibly removed SD memory card is inserted again the unique password creating feature unit module creates a target password. Then the forced removal password table is searched for the target password. If the target password has been found the unexecuted processing list associated with the target password is obtained. Before the execution of the unexecuted processing list serial processing based on the obtained unexecuted processing list a password lock is released to use the automatic password lock function. While the release of the password lock involves the release of the lock the password is not deleted and remains unchanged as it was set. Then based on the unexecuted processing list access processing is executed at the end. The forced removal of the SD memory card during this execution is handled similarly to the forced removal of the SD memory card during the execution of the unexecuted processing list serial processing.

First in step S the unexecuted processing list is generated from the FAT file system access processing set. In step S the unique password creating feature unit module creates the new password. In step S it is determined whether or not a password has already been set for the SD memory card. If it is determined that no password is currently set the new password is set for the SD memory card in step S. If it is determined in step S that a password has already been set it is determined in step S whether or not the SD memory card is password locked. If it is determined that the SD memory card is not password locked the password is changed to the new password in step S and the old password is retained in step S. If it is determined in step S that the SD memory card is password locked the process ends with an error.

The following process is repeated until it is determined in step S that the unexecuted processing list is empty or it is determined in step S that the SD memory card is not in the camera system. First in step S it is determined whether or not the unexecuted processing list is empty. If it is determined that the unexecuted processing list is not empty access processing to be initially executed is obtained from the unexecuted processing list and executed in step S. Then in step S it is determined whether or not the execution of the access processing has been successful. If it is determined that the execution has been successful the access processing is deleted from the unexecuted processing list in step S and the process returns to step S. If it is determined in step S that the execution has been unsuccessful it is determined in step S whether or not the SD memory card is in the camera system. If it is determined that the SD memory card is in the camera system the process returns to step S.

If it is determined in step S that the SD memory card is not in the camera system the unexecuted processing list is associated with the new password in step S based on the determination that the forced removal has been detected. Then it is further determined in step S whether or not the old password is retained. If it is determined that the old password is retained the old password is associated with the new password in step S. In step S the new password and those associated with the new password are registered in the forced removal password table and the process ends with an error. If it is determined in step S that the unexecuted processing list is empty it is determined in step S whether or not the old password is retained. If it is determined that the old password is retained the password for the SD memory card is changed from the new password to the old password in step S and the process ends normally. If it is determined in step S that the old password is not retained the new password is deleted in step S and the process ends normally.

First in step S it is determined whether or not the detected SD memory card is password locked. If it is determined that the SD memory card is password locked the unique password creating feature unit module creates a target password in step S. The release of the password lock is executed with the target password in step S and it is determined in step S whether or not the password lock has been successfully released. If it is determined that the password lock has been successfully released the forced removal password table is searched for the target password in step S and it is determined in step S whether or not the target password has been found. If it is determined that the target password has been found the unexecuted processing list associated with the target password is obtained from the forced removal password table in step S. Moreover if it is determined in step S that there is the old password associated with the target password the old password is obtained and retained in step S. Then in step S the target password and those associated with the target password are unregistered from the forced removal password table.

The following process is repeated until it is determined in step S that the unexecuted processing list is empty or it is determined in step S that the SD memory card is not in the camera system. First in step S it is determined whether or not the unexecuted processing list is empty. If it is determined that the unexecuted processing list is not empty access processing to be initially executed is obtained from the unexecuted processing list and executed in step S. Then in step S it is determined whether or not the execution of the access processing has been successful. If it is determined that the execution has been successful the access processing is deleted from the unexecuted processing list in step S and the process returns to step S. If it is determined in step S that the execution has been unsuccessful it is determined in step S whether or not the SD memory card is in the camera system. If it is determined that the SD memory card is in the camera system the process returns to step S.

If it is determined in step S that the SD memory card is not in the camera system the unexecuted processing list is associated with the new password in step S based on the determination that the forced removal has been detected. Then it is further determined in step S whether or not the old password is retained. If it is determined that the old password is retained the old password is associated with the new password in step S. In step S the new password and those associated with the new password are registered in the forced removal password table and the process ends with an error. If it is determined in step S that the unexecuted processing list is empty it is determined in step S whether or not the old password is retained. If it is determined that the old password is retained the password for the SD memory card is changed from the new password to the old password in step S and the process ends normally. If it is determined in step S that the old password is not retained the new password is deleted in step S and the process ends normally.

If it is determined in step S that the SD memory card is not password locked or if it is determined in step S that the release of the password lock has been unsuccessful the process ends normally because the forced removal of the SD memory card in the camera system has not occurred. Moreover if it is determined in step S that the target password has not been found the forced removal of the SD memory card has not occurred. In this case in step S a password lock is applied to the SD memory card again and the process ends normally.

Thus even if the forced removal of the SD memory card has occurred during the execution of the FAT file system access processing set the application of a password lock ensures that data is not modified in other systems and allows unexecuted processing to be executed when the SD memory card is inserted into the camera system again. The FAT file system can thus be prevented from being destroyed.

A second exemplary embodiment of the present invention will now be described based on the camera system and an SD memory card similar to that of the first embodiment. In the second embodiment if the SD memory card has been forcibly removed from the camera system during the execution of the FAT file system access processing set the unexecuted processing list and the old password are stored in a specific area of the SD memory card. Examples of the specific area include an unused block not secured by the file system and a storage area other than the user data area. An example of the storage area is a protected area of the SD memory card. Storing the unexecuted processing list and the old password in a specific area of the SD memory card allows a file system recovery operation in a second camera system that differs from a first camera system from which the SD memory card has been forcibly removed. In this case the unique password creating feature unit module needs to create a password that allows a password lock to be released at least in both the first camera system and the second camera system. Since the first camera system and the second camera system have nothing in common other than the SD memory card therein the password is created based on unique information such as attribute information about the SD memory card the information being independent of the information processing systems.

The following process is repeated until it is determined in step S that the unexecuted processing list is empty or it is determined in step S that the SD memory card is not in the camera system. First in step S it is determined whether or not the unexecuted processing list is empty. If it is determined that the unexecuted processing list is not empty it is further determined in step S whether or not the SD memory card is in the camera system. If it is determined that the SD memory card is in the camera system access processing to be initially executed is obtained from the unexecuted processing list and executed in step S. Then in step S it is determined whether or not the execution of the access processing has been successful. If it is determined that the execution has been successful the executed access processing is deleted from the unexecuted processing list in step S the unexecuted processing list is stored in a specific area of the SD memory card in step S and the process returns to step S. If an unexecuted processing list already exists in the specific area the existing unexecuted processing list is overwritten. If it is determined in step S that the execution has been unsuccessful the process returns to step S to execute the access processing again.

If it is determined in step S that the unexecuted processing list is empty the old password is read from a specific area of the SD memory card and deleted from the specific area in step S. In step S it is determined whether or not the old password has been successfully read. If it is determined that the old password has been successfully read the set password is replaced with the old password in step S and the process ends normally. If it is determined in step S that the old password has not been successfully read the password is deleted in step S and the process ends normally. If it is determined in step S that the SD memory card is not in the camera system the process ends with an error based on the determination that the forced removal has occurred.

A file system recovery operation of the second embodiment of the present invention will now be described. When the SD memory card is inserted into the second camera system it is determined whether or not the SD memory card was forcibly removed previously. If forcibly removed the SD memory card is locked with a password created by the unique password creating feature unit module . Therefore the unique password creating feature unit module creates a password and attempts to release the password lock with the created password. Here the unique password creating feature unit module is implemented in the first camera system and second camera system according to the algorithm based on unique information about the SD memory card.

If it is determined in step S that the unexecuted processing list has been successfully read the following process is repeated until it is determined in step S that the unexecuted processing list is empty or it is determined in step S that the SD memory card is not in the camera system. First in step S it is determined whether or not the unexecuted processing list is empty. If it is determined that the unexecuted processing list is not empty it is further determined in step S whether or not the SD memory card is in the camera system. If it is determined that the SD memory card is in the camera system access processing to be initially executed is obtained from the unexecuted processing list and executed in step S. Then in step S it is determined whether or not the execution of the access processing has been successful. If it is determined that the execution has been successful the executed access processing is deleted from the unexecuted processing list in step S the unexecuted processing list is stored in a specific area of the SD memory card in step S and the process returns to step S. If an unexecuted processing list already exists in the specific area the existing unexecuted processing list is overwritten. If it is determined in step S that the execution has been unsuccessful the process returns to step S to execute the access processing again.

If it is determined in step S that the unexecuted processing list is empty the old password is read from a specific area of the SD memory card and deleted from the specific area in step S. In step S it is determined whether or not the old password has been successfully read. If it is determined that the old password has been successfully read the set password is replaced with the old password in step S and the process ends normally. If it is determined in step S that the old password has not been successfully read the password is deleted in step S and the process ends normally. If it is determined in step S that the SD memory card is not in the camera system the process ends with an error based on the determination that the forced removal has occurred.

When the FAT file system access processing set is executed as described above even if the forced removal of the SD memory card has occurred during the execution of the FAT file system access processing set in the first camera system the FAT file system can be prevented from being destroyed since the SD memory card is password locked the unexecuted processing list is stored in the SD memory card and the unexecuted processing is executed when the SD memory card is inserted into the second camera system.

While the camera system is used as an example in the first and second embodiments described above the present invention is applicable to any system that can accommodate an SD memory card or the like. Moreover while the FAT file system is taken as an example of a file system architecture in the first and second embodiments described above the present invention is applicable to any file system architecture. Furthermore while the SD memory card is taken as an example in the first and second embodiments described above the present invention is applicable to any other removable external storage medium having the access lock function using a password and the automatic password lock function.

While the external storage medium having the access lock function using a password and the automatic password lock function is taken as an example in the first and second embodiments described above the present invention is applicable to any external storage medium that can be password locked after the forced removal.

Further it is noted that the present invention is not limited to the first and second embodiments where the entire FAT file system access processing set is retained as an unexecuted processing list. For example to protect only the consistency of the FAT file system partial access processing which is included in the FAT file system access processing set and in which a minimum access processing group that can protect the FAT file system is included is retained as a minimum processing list. Then in the case of the occurrence of forced removal of the SD memory card access processing included in both an unexecuted processing list at that point and the minimum processing list is associated with a password and is registered as an unexecuted processing list in the forced removal password table. Moreover the present invention is applicable not only to the first and second embodiments but also to the case where retaining and registering means such as those described above are used.

While the password lock function that does not allow a multiple lock is taken as an example in the first and second embodiments described above the present invention is applicable even if the password lock function allows a multiple lock to the case as long as the system includes a multiple password retaining feature unit module D. and a multiple lock recovery feature unit module D. both of which are now herein described in further detail below.

The multiple password retaining feature unit module D. is configured to execute in performing the FAT file system access processing set on a multi locked external storage medium the release of all password locks applied at that point before starting the unexecuted processing list serial processing and retains all passwords used for releasing the password locks and data representing the order of use of all the passwords. The multiple lock recovery feature unit module D. is configured to bring the external storage medium back to a multi locked state by using a plurality of passwords and data representing the order of application of password locks that are retained by the multiple password retaining feature unit module .

While in the first and second embodiments described above the password locking feature unit module is taken as an example of access locking feature unit module for blocking access to an external storage medium it is also acknowledged that the present invention is applicable to any external storage medium having an access locking feature unit module that can ensure that the access lock is not automatically released in other systems without the user s intention.

While in the first and second embodiments described above the locking function of the SD memory card is taken as an example of a function that can ensure that no modification is made to internal data during the period between the forced removal and the reinsertion of an external storage medium it is acknowledged that the present invention is applicable to any case where a function that can ensure that no modification is made to internal data during the period between the forced removal and the reinsertion is provided.

While in the first and second embodiments described above the forced removal of an external storage medium is taken as an example of a cause of forced interruption of file access processing it is acknowledged that the present invention is applicable to any case where the forced interruption of file access processing is caused by anything. However it should be noted that if postprocessing to be executed after an event causing the forced interruption cannot be executed because the forced interruption is caused for example by system power off the postprocessing may be executed before the occurrence of the event that causes the forced interruption. In other words the present invention is applicable to any case where postprocessing to be executed after an event causing the forced interruption can be executed before the occurrence of the event even if the postprocessing cannot be executed after the event due to for example system power off.

While the present invention has been described with reference to several exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all modifications equivalent structures and functions.

This application claims the benefit of Japanese Application No. 2004 287651 filed Sep. 30 2004 which is hereby incorporated by reference herein in its entirety.

