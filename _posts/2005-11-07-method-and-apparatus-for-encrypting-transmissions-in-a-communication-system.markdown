---

title: Method and apparatus for encrypting transmissions in a communication system
abstract: Method and apparatus for encrypting transmission traffic at separate protocol layers L1, L2, and L3 so that separate encryption elements can be assigned to separate types of transmission traffic, which allows the implementation of different levels of encryption according to service requirements. Encryption elements use variable value inputs, called crypto-syncs, along with semi-permanent encryption keys to protect from replay attacks from rogue mobile stations. Since crypto-sync values vary, a method for synchronizing crypto-syncs at the mobile station and base station is also presented.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08787578&OS=08787578&RS=08787578
owner: QUALCOMM Incorporated
number: 08787578
owner_city: San Diego
owner_country: US
publication_date: 20051107
---
The present Application for Patent claims priority to Provisional Application No. 60 156 905 entitled CDMA2000 ENCRYPTION ARCHITECTURE AND RLP OPERATION ON COMMON CHANNELS filed Sep. 30 1999 and assigned to the assignee hereof and hereby expressly incorporated by reference herein.

The present application for patent is a Divisional of patent application Ser. No. 09 676 036 entitled METHOD AND APPARATUS FOR ENCRYPTING TRANSMISSIONS IN A COMMUNICATION SYSTEM filed Sep. 28 2000 now U.S. Pat. No. 6 980 658 and assigned to the assignee hereof and hereby expressly incorporated by reference herein.

The present invention pertains generally to the field of wireless communications and more specifically to methods and apparatus for providing secure transmissions in a wireless communication system.

A modern day communication system is required to support a variety of applications. One such communication system is a code division multiple access CDMA system that conforms to the TIA EIA IS 95 Mobile Station Base Station Compatibility Standard for Dual Mode Wideband Spread Spectrum Cellular System hereinafter referred to as the IS 95 standard or a CDMA system that conforms to the TIA EIA IS 2000 Standard for cdma2000 Spread Spectrum Systems hereinafter referred to as the IS 2000 standard. Another CDMA standard is the W CDMA standard as embodied in 33 Document Nos. 3G TS 25.211 3G TS 25.212 3G TS 25.213 and 3G TS 25.214. A CDMA system allows for voice and data communications between users over a terrestrial link. The use of CDMA techniques in a multiple access communication system is disclosed in U.S. Pat. No. 4 901 307 entitled SPREAD SPECTRUM MULTIPLE ACCESS COMMUNICATION SYSTEM USING SATELLITE OR TERRESTRIAL REPEATERS and U.S. Pat. No. 5 103 459 entitled SYSTEM AND METHOD FOR GENERATING WAVEFORMS IN A CDMA CELLULAR TELEPHONE SYSTEM both assigned to the assignee of the present invention and incorporated by reference herein. Other examples of communication systems are time division multiple access TDMA systems and frequency division multiple access FDMA systems.

In this specification base station refers to the hardware with which the remote stations communicate. Cell refers to the hardware or the geographic coverage area depending on the context in which the term is used. A sector is a partition of a cell. Because a sector of a CDMA system has the attributes of a cell the teachings described in terms of cells are readily extended to sectors.

In a CDMA system communications between users are conducted through one or more base stations. A first user on one remote station communicates to a second user on a second remote station by transmitting data on the reverse link to a base station. The base station receives the data and can route the data to another base station. The data is transmitted on the forward link of the same base station or a second base station to the second remote station. The forward link refers to transmission from the base station to a remote station and the reverse link refers to transmission from the remote station to a base station. In IS 95 and IS 2000 FDD mode systems the forward link and the reverse link are allocated separate frequencies.

In the field of wireless communications security of over the air transmissions has become an increasingly important aspect in communication systems. Security is often maintained through encryption protocols that prevent disclosure of private communications between parties and or prevent rogue mobile stations from accessing services for which payment has not been rendered to the communication service provider. Encryption is a process whereby data is manipulated by a random process such that the data is made unintelligible by all but the intended recipient. Decryption is simply the process of recovering the original data. One type of encryption algorithm commonly used in the industry is the Enhanced Cellular Message Encryption Algorithm ECMEA which is a block cipher. Due to the sophistication of modem day code breakers and hackers a need presently exists to create stronger more secure encryption processes to protect users of wireless communication services and service providers.

A novel and improved method and apparatus for encrypting transmissions is presented wherein the method for encrypting transmission traffic comprises generating a variable value and inputting the variable value an encryption key and the transmission traffic into an encryption algorithm.

In one aspect a method for transmitting authentication variables from a transmission end to a receiving end is presented the method comprising generating a crypto sync value at the transmission end generating a first authentication signature from the crypto sync value and an encryption key at the transmission end transmitting the crypto sync value and the first authentication signature to the receiving end generating a second authentication signature from the crypto sync value and the encryption key at the receiving end incrementing the crypto sync value at the receiving end if the first authentication signature and the second authentication signature match and requesting an encryption key exchange if the first authentication signature and the second authentication signature do not match.

In another aspect a method for synchronizing crypto sync values of an encryption algorithm at a transmission end and a receiving end is presented the method comprising transmitting an encrypted message frame to the receiving end verifying a current crypto sync value associated with the encrypted message frame at the receiving end incrementing the current crypto sync value at the transmission end and the receiving end if the current crypto sync value is verified and transmitting a failure message from the receiving end to the transmission end if the current crypto sync value is not verified.

In another aspect a system for encrypting transmission traffic is presented wherein the transmission traffic comprise at least two traffic types the system comprising at least two encryption elements wherein each of the at least two encryption elements is associated with at least one of the at least two traffic types and at least one sequence number generator for generating a plurality of sequence numbers wherein the at least one sequence number generator is coupled to the at least two encryption elements.

The exemplary embodiments described herein below reside in a wireless telephony communication system configured to employ a CDMA over the air interface. Nevertheless it would be understood by those skilled in the art that a method and apparatus for encrypting transmissions may reside in any of various communication systems employing a wide range of technologies known to those of skill in the art.

As illustrated in a CDMA wireless telephone system generally includes a plurality of mobile subscriber units a plurality of base stations base station controllers BSCs and a mobile switching center MSC . The MSC is configured to interface with a conventional public switch telephone network PSTN . The MSC is also configured to interface with the BSCs . The BSCs are coupled to the base stations via backhaul lines. The backhaul lines may be configured to support any of several known interfaces including e.g. E1 T1 ATM IP Frame Relay HDSL ADSL or xDSL. It is understood that there may be more than two BSCs in the system. Each base station advantageously includes at least one sector not shown each sector comprising an omnidirectional antenna or an antenna pointed in a particular direction radially away from the base station . Alternatively each sector may comprise two antennas for diversity reception. Each base station may advantageously be designed to support a plurality of frequency assignments. The intersection of a sector and a frequency assignment may be referred to as a CDMA channel. The base stations may also be known as base station transceiver subsystems BTSs . Alternatively base station may be used in the industry to refer collectively to a BSC and one or more BTSs . The BTSs may also be denoted cell sites . Alternatively individual sectors of a given BTS may be referred to as cell sites. The mobile subscriber stations are typically cellular or PCS telephones . The system is advantageously configured for use in accordance with the IS 95 standard.

During typical operation of the cellular telephone system the base stations receive sets of reverse link signals from sets of mobile stations . The mobile stations are conducting telephone calls or other communications. Each reverse link signal received by a given base station is processed within that base station . The resulting data is forwarded to the BSCs . The BSCs provides call resource allocation and mobility management functionality including the orchestration of soft handoffs between base stations . The BSCs also routes the received data to the MSC which provides additional routing services for interface with the PSTN . Similarly the PSTN interfaces with the MSC and the MSC interfaces with the BSCs which in turn control the base stations to transmit sets of forward link signals to sets of mobile stations . It should be understood by those of skill that the subscriber stations may be fixed stations in alternate embodiments.

At layer L3 voice traffic packet data traffic and system services are conveyed via data units constructed in accordance with the standards discussed above. However encryption is performed at this level upon the data units carrying system services but encryption is not performed for packet data traffic or voice traffic . In this embodiment encryption of the packet data traffic and the voice traffic is implemented by lower layers.

ENC SEQ generator provides a sequence number that is used to construct a crypto sync value. In one aspect of the embodiment the four least significant bits of a sequence number are used to construct a crypto sync value. A crypto sync value is a variable that is inputted to an encryption algorithm along with an encryption key. The encryption algorithm generates a mask through which unencrypted data is encrypted. Crypto syncs differ from encryption keys in that an encryption key is a semi permanent shared secret while a crypto sync value will vary with respect to the data units transmitted during the link in order to protect against a replay attack. In this embodiment the crypto sync value will vary due to a dependence upon either a generated sequence number a system time or any other designated identifier. It should be noted that one may alter the number of bits used for the crypto sync value without changing the scope of the embodiment.

The crypto sync value is inputted to encryption elements along with data from the L3 Signaling element and a teleservices element . Teleservices may comprise system services such as Short Data Burst Transmission Services Short Messaging Services Position Location Services etc. In a separate encryption element is assigned to process each system service output. An advantage of this structure is that each service can determine the level of encryption needed according to service requirements. However an alternate embodiment may be implemented wherein an encryption element may be shared by multiple system services. In the present embodiment the output of the encryption elements are multiplexed together at multiplexer de multiplexer element . In an alternative embodiment frames of data traffic from the packet data element are also encrypted at level L3 .

At level L2 the output from the multiplexer de multiplexer element passes through a Signaling LAC . At level L1 message frames from the packet data element passes through the Radio Link Protocol RLP layer wherein encryption occurs based upon crypto syncs constructed with RLP sequence numbers. In this embodiment the RLP layer resides in layer L2 and is responsible for retransmitting packet data traffic when a transmission error occurs. Frames of voice traffic from voice element are encrypted separately at encryption element in order to advantageously utilize system time as part of the crypto sync for each voice frame rather than sequence numbers from ENC SEQ generator element .

The outputs of encryption element RLP layer and the Signaling LAC are multiplexed together at the MUX and QoS Sublayer .

The advantages of this particular architecture are numerous. First each of the teleservices and L3 signaling elements on level L3 can specify the level of encryption security performed by each of the respective connected encryption elements.

Second each of the traffic types can expediently utilize system resources to construct the crypto sync for each frame of traffic. For example voice traffic frames do not have extra space for carrying ENC SEQ. However system time can be used as a substitute since the system time varies from frame to frame and the system time is implicitly known at both the transmission end and the receiving end. System time should not be used for encrypting packet data traffic and teleservices. If system time is used to construct the crypto sync the data to be encrypted must be encrypted just prior to transmission in order to use the system time at transmission. Hence encrypted frames could not be buffered. If the RLP sequence number or the ENC SEQ number is used then transmission frames can be encrypted and temporarily stored in a buffer until transmission. In addition it is advantageous to use the ENC SEQ value rather than a message sequence number MSG SEQ because resets of the LAC layer cause the encryption of different non encrypted text with the same encryption mask which would compromise the security of the encryption process.

Third placing encryption elements at a level above LAC solves a problem of efficiency. If the encryption decryption occurred at the physical layer then ARQ fields would need to be encrypted and decrypted before an ACK could be transmitted. ARQ is an acronym for Automatic Retransmission reQuest which is a method for checking transmitted data through transmitted acknowledgments and negative acknowledgments. Another difficulty that occurs if the encryption decryption occurs at the physical layer is that cyclic redundancy check CRC bits used for determining transmission errors at a receiver would be computed based on un encrypted data.

In and the message CRC field is encrypted. However encryption of the CRC bits makes validation of the message length field impossible. Hence is the preferred transmission frame that is used in the exemplary embodiment.

In general an individual crypto sync value is determined for each data unit that is to be encrypted. Hence each crypto sync value results in a different cipher text even for the same clear text.

As illustrated above the encryption at the RLP layer is accomplished through the use of an extended sequence number an sr id and a direction of the channel. These three variables comprise the crypto sync for use with packet data traffic. In some instances packet data traffic may be encapsulated in frames that indicate a short data burst SDB wherein the encapsulated frames are transmitted on common channels. illustrates an example of an encapsulated RLP frame wherein ARQ fields are encrypted. In frame the payload of a data burst message comprises three fields sr id field sequence number field and an encrypted RLP frame .

In the description of the embodiments above the security of the encryption process is accomplished through the use of a secure crypto sync wherein the crypto sync used to encrypt a data unit differs from the crypto syncs used to encrypt other data units. Hence the base station and the mobile station must be able to generate the same crypto sync to code and to decode the same data at the appropriate time. In order to maintain the synchronicity of the crypto syncs generated by a mobile station and a base station some over the air transmissions must be made. However over the air transmissions are open to attack by rogue mobile stations RMS . In the proposed security schemes the base station refuses to accept the value of the crypto sync proposed by the mobile station until the mobile station proves to be a legitimate subscriber. A refusal to accept the value of the crypto sync prevents a replay attack wherein the RMS forces the base station to apply the same encryption mask to two different plain texts which compromises the security of the encryption. For example suppose E is cipher text P is plain text and M is the encryption mask. If the crypto sync is the same for plain text P and plain text P then E M P and E M P using modular 2 addition. Therefore E E P P . Even though the RMS does not know the encryption mask M plain text P and plain text P can be determined. Hence in one specific example of an attack a RMS may transmit repeated registration messages to a base station which would force a base station to use the same crypto sync.

In one embodiment synchronization of the most significant bits of the crypto sync is maintained between a legitimate mobile station LMS and a base station while protecting the encryption strength. In the exemplary embodiment the LMS transmits authentication variables which comprise the most significant bits of the crypto sync and an authentication signature during the registration process. The most significant bits of crypto sync will hereinafter be alternatively referred to as CS h. An example of the registration process of a mobile station entering the range of a base station is described in U.S. Pat. No. 5 289 527 entitled Mobile Communication Device Registration Method and is incorporated by reference herein.

In the illustration above the base station is protected from the above mentioned attack by an RMS because the RMS cannot compute a valid authentication signature for the CS h.

In an alternative embodiment the security of the communications between a base station and an LMS is protected from an RMS that has recorded the registration message from a legitimate LMS. In order to prevent the RMS from forcing the base station to use the same CS h that is intended for use with an LMS the base station can be set to increment the least significant bits of the crypto sync each time a registration message from a mobile station is uploaded to the base station. The least significant bits of the crypto sync will hereinafter be referred to as CS . Hence the crypto sync value comprise CS h concatenated with the variable CS . In this embodiment the base station is prevented from repeatedly using the identical crypto syncs in the encryption process. In those instances wherein the base station does not have a prior value for CS  associated with the LMS the base station can either generate CS  randomly or set CS  equal to zero.

If the base station cannot generate the same authentication signature as the one transmitted by a mobile station then the system determines that the encryption key held by the base station is not the same encryption key as held by the mobile station. A key exchange must then be performed.

In one embodiment a novel and nonobvious use of Cyclic Redundancy Check CRC bits can be implemented to verify that the crypto sync generated by both a base station and a mobile station for the same data unit are identical. In this embodiment an encryption CRC also referred to as CRC enc is included in the encrypted data unit. The encryption CRC is computed before the unencrypted data unit is encrypted and is then appended to the unencrypted data unit. When the unencrypted data unit is encrypted with the associated crypto sync CS h and the encryption key Ks the encryption CRC is also encrypted by the same crypto sync CS h and encryption key Ks. After the encrypted text is generated a transmission error detection CRC called MSG CRC is appended to the encrypted data unit along with the assorted fields necessary for transmission. If the MSG CRC passes a check at the receiving end then the CRC enc is also checked at the receiving end. If the CRC enc fails to pass a determination is made that a CS h mismatch has occurred. It should be noted that the validity of the encryption key Ks was already verified during the registration process when a correct authentication signature f CS h Ks was computed.

If a determination is made based on the CRC enc computed at the receiving end that the crypto sync CS h is out of synchronization with the crypto sync at the transmission end then a recovery procedure must be implemented. and are two message flow charts that illustrate an error recovery procedure. In a base station detects a failure in decryption. In a mobile station detects a failure in decryption.

In an LMS transmits an encrypted message to a base station . The CRC bits of the encrypted message pass indicating that there are no transmission errors or a recoverable amount of transmission errors. However base station cannot decode the encoder CRC CRC enc. The base station transmits a Cannot Decrypt message to the LMS . The LMS then transmits a registration message comprising the crypto sync CS h the authentication signature f CS h Ks and a hook exchange parameter. At this point both the LMS and the base station have the same crypto sync CS h. The LMS then retransmits the encrypted message .

In a base station transmits an encrypted message to an LMS . The CRC bits of the encrypted message pass indicating that there are no transmission errors or a recoverable amount of transmission errors. However LMS cannot decode the encoder CRC CRC enc. The LMS then transmits a registration message comprising the crypto sync CS h the authentication signature f CS h Ks and a hook exchange parameter. At this point both the LMS and the base station have the same crypto sync CS h. The base station then retransmits the encrypted message .

Hence in both methods illustrated in and a message frame that fails to pass the decryption step at the receiving end is to be re transmitted as though the message frame was transmitted with unrecoverable errors.

It should be noted from the examples above that the CS h field initializes the most significant bits of the crypto sync for both forward and reverse links. Although both forward and reverse links use the same CS h differing encryption results are derived because the direction of the transmission is a variable that is inputted to the encryption key generation algorithm i.e. 0 may indicate a forward link message while 1 indicates a reverse link message. In one embodiment the crypto sync values may increment independently after initialization.

The choice of a crypto sync value made by a mobile station can also be important. In order to maintain the security of the encryption a crypto sync should not be repeated during over the air transmissions. In one embodiment the mobile station sets the crypto sync value equal to one 1 added to the maximum value between the most significant bits of the current forward link crypto sync value CS and the most significant bits of the current reverse link crypto sync value CS. Hence CS h 1 max CS h CS h .

Thus a novel and improved method and apparatus for encrypting transmissions have been described. Those of skill in the art would understand that the data instructions commands information signals bits symbols and chips that may be referenced throughout the above description are advantageously represented by voltages currents electromagnetic waves magnetic fields or particles optical fields or particles or any combination thereof. Those of skill would further appreciate that the various illustrative logical blocks modules circuits and algorithm steps described in connection with the embodiments disclosed herein may be implemented as electronic hardware computer software or combinations of both. The various illustrative components blocks modules circuits and steps have been described generally in terms of their functionality. Whether the functionality is implemented as hardware or software depends upon the particular application and design constraints imposed on the overall system. Skilled artisans recognize the interchangeability of hardware and software under these circumstances and how best to implement the described functionality for each particular application. As examples the various illustrative logical blocks modules circuits and algorithm steps described in connection with the embodiments disclosed herein may be implemented or performed with a digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable logic device discrete gate or transistor logic discrete hardware components such as e.g. registers and FIFO a processor executing a set of firmware instructions any conventional programmable software module and a processor or any combination thereof designed to perform the functions described herein. The processor may advantageously be a microprocessor but in the alternative the processor may be any conventional processor controller microcontroller or state machine. The software module could reside in RAM memory flash memory ROM memory EPROM memory EEPROM memory registers hard disk a removable disk a CD ROM or any other form of storage medium known in the art. An exemplary processor is advantageously coupled to a storage medium so as to read information from and write information to the storage medium. In the alternative the storage medium may be integral to the processor. The processor and the storage medium may reside in an ASIC. The ASIC may reside in a telephone. In the alternative the processor and the storage medium may reside in a telephone. The processor may be implemented as a combination of a DSP and a microprocessor or as two microprocessors in conjunction with a DSP core etc.

Preferred embodiments of the present invention have thus been shown and described. It would be apparent to one of ordinary skill in the art however that numerous alterations may be made to the embodiments herein disclosed without departing from the spirit or scope of the invention. Therefore the present invention is not to be limited except in accordance with the following claims.

