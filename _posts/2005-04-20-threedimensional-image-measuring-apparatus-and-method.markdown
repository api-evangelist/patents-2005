---

title: Three-dimensional image measuring apparatus and method
abstract: The present invention provides a three-dimensional image measuring apparatus and method capable of measuring projections and depressions on a surface of an object with fine precision, as well as ensuring stable convergence, even for stereo images with significant project distortion. The apparatus includes an area setting section  for setting a reference area  in one image  of a pair of stereo images  and a search area  in the other image  in a position corresponding to the reference area , a search image distortion correcting section  for applying an image distortion correction to either one of the one image  or the other image  according to the positional relationship between the reference area  and the search area  corresponding to the reference area , and an area shape measuring section  for measuring a shape of a measuring object  photographed in the stereo images  based on the reference area  in the one image  and the search area  in the other image , either one of which has been corrected by the search image distortion correcting section 
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07711180&OS=07711180&RS=07711180
owner: Topcon Corporation
number: 07711180
owner_city: Tokyo
owner_country: JP
publication_date: 20050420
---
The present invention relates to a three dimensional image measuring apparatus and method for acquiring three dimensional shape data on a measuring object using photographed image data. The present invention is directed to image measurement of measuring objects at short to middle distances where significant projection distortion occurs in images photographed in stereo rather than long distance objects such as in aerial photography.

Methods for obtaining 3D data on a working object a manufacturing object or geographic features include an approach using a measuring instrument total station that obtains 3D data at points based on the distance and angle to an object a motor driven measuring instrument that acquires data in a surface manner by scanning with a beam or a laser scanner that acquires data by rapidly oscillating a laser beam.

Meanwhile other methods include a stereo image measurement approach in which 3D data is obtained at points or in a surface manner by stereo measurement of stereo images photographed using an object and a comparative calibration body.

In the former approach 3D data can be automatically acquired simply when the installation is complete. However since the bare information which can be acquired includes no image but only distance data and angle data the details of the measuring object and its surroundings cannot be known. Thus another instrument needs to be used to photograph an image and affix the image to the distance data. The former approach also involves a serious problem of disturbance noise due to long hours of installation for measurement.

In the latter approach cameras perform the photographing only momentarily which causes no problem of disturbance noise. In addition since images are used in the measurement there is no need to affix images afterward.

However measuring objects with significant projections and depressions are difficult to measure in both approaches.

It has become apparent with the latter approach that photographed images of some measuring objects in particular at short to middle distances are not a little affected by projection distortion due to their projections and depressions and that it is therefore difficult to perform precise three dimensional position measurement using such images.

The present invention has been made to solve the above mentioned problem and therefore has an object to provide a three dimensional image measuring apparatus and method capable of measuring projections and depressions on a surface of an object with fine precision as well as ensuring stable convergence even for stereo images with significant project distortion.

In order to achieve the above object a three dimensional image measuring apparatus of the present invention comprises as shown in for example an image search area setting section for setting a reference area which will hereinafter be used as a generic term for . . . in one image which will hereinafter be used as a generic term for . . . of a pair of stereo images and a search area which will hereinafter be used as a generic term for . . . in the other image which will hereinafter be used as a generic term for . . . in a position corresponding to the reference area a search image distortion correcting section for applying an image distortion correction to either one of the images according to positional relationship between the reference area and the search area corresponding to the reference area and an area shape measuring section for measuring a shape of a measuring object photographed in the stereo images based on the reference area in the one image and the search area in the other image to either one of which the image distortion correction has been applied.

With this configuration the image search area setting section sets a reference area in one image of a pair of stereo images and a search area in the other image in a position corresponding to the reference area as a preprocess for obtaining the positional relationship with respect to the search area corresponding to the reference area . The search image correcting section applies an image distortion correction to either one of the one image or the other image according to the positional relationship between the reference are and the search area corresponding to the reference area so that the positional correspondence can be easily achieved in consideration of image distortion included in the pair of stereo images and attributable to the distortion of the optical system image blur the shadow on the measuring object and the like. The area shape measuring section measures a shape of the measuring object photographed in the stereo images based on the reference area in the one image and the search area in the other image either one of which has been corrected by the search image distortion correcting section .

Preferably the three dimensional image measuring apparatus of the present invention may further comprise as shown in for example a unitary geometric shape network forming section for forming a unitary geometric shape network that covers the one image and the other image of the stereo images by duplicating a unitary geometric shape two dimensionally wherein the reference area and the search area set by the image search area setting section are of the unitary geometric shape and the search image distortion correcting section corrects a distortion of the search area with respect to the reference area . When the one image and the other image of the stereo images are covered with a unitary geometric shape network grid points of the unitary geometric shape and with a generally uniform density are distributed over the entire region of the one image and the other image covered with the unitary geometric shape network. The search image distortion correcting section corrects the distortion of the search area with respect to the reference area over the entire region covered with the unitary geometric shape network thereby distributing the image distortion to the respective grid points of the unitary geometric shape. This allows the area shape measuring section to yield reasonable results from the measurement of a shape of the measuring object photographed in the stereo images .

Preferably the three dimensional image measuring apparatus of the present invention may further comprise as shown in for example a corresponding area determining section for determining by a correlation process a corresponding reference area which will hereinafter be used as a generic term for . . . corresponding to the reference area set by the image search area setting section wherein the image search area setting section sets the corresponding reference area obtained by the corresponding area determining section as the search area in the other image corresponding to the reference area .

Preferably in the three dimensional image display apparatus of the present invention the search image distortion correcting section may be configured to determine an image distortion correction amount applied to an adjacent search area positioned near the search area based on information on the adjacent search area corresponding to an adjacent reference area.

Preferably in the three dimensional image display apparatus of the present invention as shown in and for example the unitary geometric shape network forming section may form coarse to fine geometric shapes and bay be configured to sequentially form a finer geometric shape from a coarser geometric shape for an image distortion correction. With this configuration an approximate image distortion correction is performed with a coarse geometric shape and then a more precise image distortion correction is performed with a finer geometric shape using the results of the approximate image distortion correction. In this manner reliable image distortion correction can be performed with a small amount of calculation.

Preferably in the three dimensional image display apparatus of the present invention the search image distortion correcting section may be configured to determine an image distortion correction amount applied to each search area provided in the other image such that image distortions in the one image and the other image of the pair of stereo images are equal to each other.

In order to achieve the above object a three dimensional image measuring method of the present invention implemented on a computer comprises as shown in for example the steps of forming a unitary geometric shape network step S that covers one image and the other image of a pair of stereo images by duplicating a unitary geometric shape two dimensionally correcting the other image steps S S using an image distortion correction amount obtained from positional relationship between the one image and the other image of the stereo images of the unitary geometric shape network setting a reference area in the one image of the pair of stereo images and a search area in the other image of the stereo images in a position corresponding to the reference area step S obtaining positional relationship between the reference area and the search area corresponding to the reference area step S using the one image and the other image corrected by the image distortion correction amount and measuring a shape of a measuring object photographed in the stereo images step S based on the reference area in the one image on which the unitary geometric shape network is formed and the search area in the other image which has been corrected.

In order to achieve the above object a three dimensional image measuring apparatus of the present invention comprises as shown in for example an image search area setting section for setting a reference area in one image of a pair of stereo images and a search area in the other image in a position corresponding to the reference area a reference area deforming section for deforming the reference area in at least one of size or shape a corresponding area determining section for determining by a correlation process the search area corresponding to the reference area set by the image search area setting section or deformed by the reference area deforming section a search image distortion correcting section for applying a predetermined image distortion correction to the other image according to positional relationship between the reference area and the search area corresponding to the reference area and an area shape measuring section for measuring a shape of a measuring object photographed in the stereo images based on the reference area in the one image and the search area in the other image corrected by the search image distortion correcting section .

Preferably the three dimensional image measuring apparatus of the present invention may further comprise as shown in for example a unitary geometric shape network forming section for forming a unitary geometric shape network that covers the one image and the other image of the stereo images by duplicating a unitary geometric shape two dimensionally wherein the reference area and the search area set by the image search area setting section are of the unitary geometric shape and the search image distortion correcting section corrects a distortion of the search area with respect to the reference area .

Preferably in the three dimensional image display apparatus of the present invention as shown in for example the reference are a deforming section may be configured to correct the reference area in at least one of set position or shape based on measurement results obtained by the area shape measuring section .

Preferably in the three dimensional image display apparatus of the present invention as shown in for example the unitary geometric shape network forming section may form coarse to fine geometric shapes and may be configured to sequentially form a finer geometric shape from a coarser geometric shape for an image distortion correction.

In order to achieve the above object a three dimensional image measuring method of the present invention implemented on a computer comprises as shown in for example the steps of forming a unitary geometric shape network step S that covers one image and the other image of a pair of stereo images by duplicating a unitary geometric shape two dimensionally setting a reference area in the one image of the pair of stereo images and a search area in the other image of the stereo images in a position corresponding to the reference area step S changing a position of an arbitrary grid point constituting the unitary geometric shape network to deform at least one of the reference areas in at least one of size or shape step S correcting the other image steps S S using an image distortion correction amount obtained from positional relationship between the other image and the one image with the set reference area or with the reference area with the deformed size or shape obtaining positional relationship between the reference area and the search area corresponding to the reference area step S using the one image and the other image corrected with the image distortion correction amount and measuring a shape of a measuring object step S photographed in the stereo images based on the reference area in the one image on which the unitary geometric shape network is formed and the search area in the other image which has been corrected.

With a three dimensional image measuring apparatus and method of the present invention projections and depressions on a surface of an object can be measured with fine precision as well as stable convergence can be ensured even for stereo images with significant project distortion. Images with significant projection distortion include central projection images resulting from measurement at relatively short to middle distances and parallel projection images in which significant ups and downs are captured. Typical examples of the latter include for example photographing of semiconductor samples and objects with such projections and depressions that significantly affect the photographing distance.

The basic Japanese Patent Application No. 2004 126090 filed on Apr. 21 2004 is hereby incorporated in its entirety by reference into the present application.

The present invention will become more fully understood from the detailed description given hereinbelow. The other applicable fields will become apparent with reference to the detailed description given hereinbelow. However the detailed description and the specific embodiment are illustrated of desired embodiments of the present invention and are described only for the purpose of explanation. Various changes and modifications will be apparent to those ordinary skilled in the art on the basis of the detailed description.

The applicant has no intention to give to public any disclosed embodiments. Among the disclosed changes and modifications those which may not literally fall within the scope of the present claims constitute therefore a part of the present invention in the sense of doctrine of equivalents.

The use of the terms a and an and the and similar referents in the context of describing the invention especially in the context of the following claims are to be construed to cover both the singular and the plural unless otherwise indicated herein or clearly contradicted by context. The use of any and all examples or exemplary language e.g. or the like provided herein is intended merely to better illuminate the invention and does not pose a limitation on the scope of the invention unless otherwise claimed.

The present invention is described below with reference to the drawings. A three dimensional image measuring apparatus of the present invention calculates a three dimensional shape of a measuring object based on plural at least two photographed images with the two left and right images constituting stereo images as one unit. The apparatus also uses 3D data obtained externally or through 3D measurement on the entire measuring object to apply a texture that produces a stereoscopic effect to a two dimensional image of the measuring object . Here the texture refers to a pattern and an actual image photograph of an object given on a surface of a figure and what is drawn thereon to express its feel in the graphics and so on.

An orientation processing section performs an interior orientation and an exterior orientation on the stereo photographed image data photographed by the left and right stereo cameras to allow a stereo matching process. The interior orientation refers to a process to perform a correction calibration on internal geometric structure relating to the cameras and the imaging surface film used in the photographing. In the interior orientation the lens distortion the positional relationship such as an eccentricity between the lens and the film and the planarity of the film for example are corrected. The exterior orientation refers to a process to determine the positions postures of the cameras at the time of photographing and is formulated using for example a collinearity condition equation. The collinearity condition equation refers to a relational equation formulating the relationship that the projection center the object and its position on the film are in alignment. A pair of left and right stereo images resulting from the orientation by the orientation processing section are stored in a stereo image recording section . The stereo image recording section is a medium for storing image information as electromagnetic information such as a flexible disk a CDROM or a DVD for example. The orientation process may be performed in advance to obtain parameters for the apparatus or to obtain parameters as the apparatus measures the images. Note that the lens as meant here includes an electron lens for electron microscopes.

An image measuring device includes an approximate position measuring section a resolution specific grid image forming section an image processing section an image search area setting section a triangulated irregular network forming section as a unitary geometric shape network forming section a search image distortion correcting section a corresponding area determining section an area shape measuring section an image rebuilding section and a left right image correspondence database . The image measuring device handles data such as a reference image a search image a reference area a search area a corresponding reference area and triangulated irregular network data . A computer such as a personal computer with advanced calculation processing function or a workstation may be used as the image measuring device . The respective components of the image measuring device may be implemented by application software or a highly integrated electronic circuit such as an ASIC. The geometric shape formed by the unitary geometric shape network forming section is not limited to a triangle but may be a unitary surface of any shape that allows interpolation of the height such as a square or one defined by line segments.

The approximate position measuring section has functions of extracting marks or characteristic points in the pair of stereo images and finding approximate positions of the marks or the characteristic points in the pair of stereo images by a projective transformation using the extracted marks or characteristic points.

The resolution specific grid image forming section generates with respect to the pair of stereo images a reference image and a search image or more specifically reference images . . . and search images . . . sequentially from high resolution ones to low resolution ones. Typically the reference image is generated with respect to the left one of the pair of stereo images while the search image is generated with respect to the image other than the one with respect to which the reference image is generated namely the right image. The resolution of an image is a parameter that determines the expressive power or fineness of the image which is coarse in low resolution images and fine in high resolution images. An amount of data included in an image is huge. Therefore in order to decrease an amount of calculation in stereo matching approximate positions of the corresponding points are extracted using the low resolution images and then more precise positions thereof are sequentially extracted using the higher resolution images. Typically such images may be generated in two layers of resolution namely a low resolution as a first resolution and a high resolution as a second resolution. The layer structure of image resolution involves a Coarse To Fine method which will be described in detail later. Note that the reference image and the search image generated by the resolution specific grid image forming section may be generated in three layers or more.

The image processing section sharpens enhances the contrast of or enhances the edges in the pair of stereo images handled by the resolution specific grid image forming section namely the reference image and the search image . The image processing section also performs an interpolation or a compression on image data which is necessary to prepare images with different resolutions or extracts characteristics from image data.

The image search area setting section sets a reference area with respect to the reference image and a search area with respect to the search image . The reference area is in the shape of a square for example and referred to as a template. The search area confines an area of the reference area to be searched and is preferably smaller than the entire search image but larger than the reference area . In cases where the resolution specific grid image forming section generates the reference image and the search image in two layers of low and high resolutions the image search area setting section also generates the reference area and the search area in two layers of low and high resolutions. In cases where the resolution specific grid image forming section generates the reference image and the search image in three layers of resolution the image search area setting section also generates the reference area and the search area in three layers of resolution.

Returning to the triangulated irregular network forming section forms a Triangulated Irregular Network TIN that covers the reference image and the search image with irregular triangles. Irregular triangles as a unitary geometric shape preferably use equivalent locations in the reference image and the search image as their vertexes. The irregularity of the triangles is attributable to the projections and depressions on the object surface photographed in the pair of stereo images or the difference in visual axis between the cameras . That is although a considerably symmetric figure such as an equilateral triangle or an isosceles triangle is typically used as the unitary geometric shape irregularity is caused by distortion due to the nature of the pair of stereo images . The triangulated irregular network does not necessarily cover the entire reference image and search image but may cover only a region as an object of the three dimensional image measurement. The triangulated irregular network will be described in detail later.

The search image distortion correcting section applies an image distortion correction to the search image according to the positional relationship between the reference area and the search area corresponding to the reference area . The search image distortion correcting section performs a corresponding point detection between the reference area and the search area as follows. In the corresponding point detection pass points and reference points used in photogrammetry for example are provided in the reference image and the search image . In order to match the left and right images of the pair of stereo images a window of the same size as the template or the reference area is moved with respect to the search image set by the image search area setting section and the search image distortion correcting section performs a function of corresponding point detection to detect a position where density values are most similar between the reference area and the search area .

In the corresponding point detection the work efficiency of the measurement of image coordinates on the pass points and the reference points can be improved by the additional use of stereo matching. For example the corresponding point detection with a matching method using a normalized correlation coefficient or a Least Squares Matching LSM allows high precision automatic measurement of orientation points such as pass points and reference points.

Then the search image distortion correcting section performs the matching method using a normalized correlation coefficient for example. With reference to the process of the matching method is described. In the right image corresponds to the reference image and the left image corresponds to the search image . The reference area is constituted of N pieces of data and the search area has an image coordinate U V as its starting point. In the matching method using a normalized correlation coefficient the reference area is moved in the search area from left to right and on reaching the right end of the search area returned to the left end of the row below and again moved from left to right. In respective positions of the reference area during this raster scanning a calculation formulated by the equation 1 is performed. 1 1 where M represents a normalized value for the reference area and I represents a normalized value for the search area .

Then the similarity between the reference area and the search area is given by a normalized correlation coefficient R U V as follows. SQRT 2 Here the normalized correlation coefficient R always takes a value from 1 to 1. When the normalized correlation coefficient R is 1 the reference area as a template and the corresponding image in the search area completely coincide with each other. Thus it is possible to find in the search area a corresponding reference area where the image is most similar to the reference area by finding a position where the correlation coefficient value is maximum by the corresponding area determining section .

In cases where the search area includes no point where the image is similar to the reference area the maximum value of the normalized correlation coefficient R is small 0.1 for example and therefore the search for the corresponding reference area should be determined to have failed. However in the search the corresponding area determining section uses as the coordinate value for the corresponding reference area the value for a coordinate where the value of the normalized correlation coefficient R is maximum. Under such a condition even a coordinate value for the low normalized correlation coefficient which in some cases is as low as to satisfy R 0.1 and almost equivalent to that of noise can be used as the coordinate value for the corresponding reference area . Thus in cases where the maximum value of the normalized correlation coefficient R is so small and not more than a preset threshold 0.2 0.3 for example the search for the corresponding reference area is determined to have failed.

Now the corresponding point detection using the least squares matching is described. illustrates the corresponding point detection using the least squares matching in which shows a window corresponding to the reference area in the reference image and shows a window corresponding to the search area in the search image after an affine deformation. In the figure the search image distortion correcting section performs a matching calculation of a window in the search image with that corresponding to the reference area in the reference image while performing the affine deformation on the former to measure the corresponding points by the sub pixel.

First of all defining a template within the search image corresponding to the reference area before the affine deformation as f j and a matching window corresponding to the search area after the affine deformation as f y deformation of the matching window is approximated by the affine deformation formulated by the equation 3 .

The search image distortion correcting section may alternatively use a least squares matching using an epipolar constraint. That is in cases where the reference image and the search image are rectified images and the search image distortion correcting section performs a stereo matching between the rectified images one dimensional search is performed along an epipolar line to achieve the matching and therefore the speed and reliability of the matching can be improved. While the least squares matching uses the affine transformation equation 3 representing deformation of the matching window a simplified form such as the equation 6 can be used here by the effect of epipolar constraint conditions. y j 6 

The corresponding area determining section searches in the search image for a search area corresponding to the reference area provided in the reference image using for example the above mentioned affine transformation. The corresponding area determining section handles image data and thus searches in the reference image and the search image of the same resolution for a search area which is the same as or has similarity to the reference area . In other words the corresponding area determining section does not search in and detect correspondence between the reference image and the search image of different resolutions.

The area shape measuring section uses the obtained positional relationship to measure the object photographed in the pair of stereo images. The area shape measuring section of the present embodiment combines the coarse to fine method and the triangulated irregular network method as well as systematically combines the least squares method and the normalized correlation method to perform a measurement on the object by the sub pixel which is more precise than the pixels in the stereo images with a small amount of calculation.

The image rebuilding section rebuilds a two dimensional or three dimensional image of the object based on the results of the measurement obtained by the image measuring device on the object photographed in the pair of stereo images . A rebuilt image includes various images such as a three dimensional bird s eye view and an orthographic view. The left right image correspondence database stores information on the corresponding points between the left and right images photographed in the pair of stereo images and is commonly used by the approximate position measuring section the resolution specific grid image forming section the image processing section the image search area setting section the corresponding area determining section the area shape measuring section and the image rebuilding section . Note that the 3D modeling of the object requires the concept of a surface and therefore the DSM Digital Surface Model data obtained from the measurement in the stereo matching should be processed not as a group of points but as a TIN Triangulated Irregular Network model in a surface manner. Polyline data obtained by manual measurement such as an outline may also be used as a TIN model.

Next with reference to the drawings the operations of the respective components are described in further detail. Note that the descriptions here are only for illustration and not for limitation. For example the degree of coarseness fineness or the number of layers may be set arbitrarily. Also the density of the TIN Triangulated Irregular Network model may be changed set arbitrarily.

Specifically the foregoing pyramid structure of reference images and search images is constructed to have a first layer to an L th layer where the lowermost layer is defined as an L th layer by applying the equation 7 with the image processing section and the resolution specific grid image forming section . Here the L th layer is represented as follows.

Now the operation of an apparatus constituted as described above will be described. is a flowchart for explaining the entire process of three dimensional image measurement on a pair of stereo images. First of all the left and right stereo cameras are used to acquire left and right images of the object from the cameras step S . The left and right images from the cameras are corrected by the orientation processing section and preferably made free of vertical parallax at the same time as stereo photographed image data step S . The resulting stereo images are stored in the stereo image recording section as a pair of stereo images . A stereo matching process is performed on the pair of stereo images step S . Using the pair of stereo images on which the stereo matching has been performed a three dimensional coordinate measurement is performed on the object photographed in the stereo images step S . A three dimensional image of the object is rebuilt in an appropriate form step S .

Using a description is made of the operation of the image measuring device of . is a flowchart for explaining an embodiment of the present invention explaining the combined operation of the coarse to fine method the triangulated irregular network and the least squares method. The image measuring device captures a pair of stereo images from the stereo image recording section and the resolution specific grid image forming section sets a reference image and a search image with respect to the left and right images of the pair of stereo images step S . A matching object region in the left and right images is designated by inputting boundary points defining its outline for example by an operator step S . illustrates the outlines set in the pair of stereo images in which shows the left image search image and the right image reference image . When the operator designates a matching object region by inputting boundary points defining its outline in one of the pair of stereo images the image search area setting section performs its input assist function to automatically set corresponding boundary points defining an outline in the other.

Initial values for the triangulated irregular network are set by the operator or an initial value setting function of the image measuring device step S . The triangulated irregular network forming section duplicates an irregular triangle two dimensionally to form a triangulated irregular network that covers the reference image and the search image of the stereo images . The resolution specific grid image forming section generates a grid in the low resolution layer in the coarse to fine method step S . illustrates the grids generated by the resolution specific grid image forming section in which shows one in a low resolution layer one in a middle resolution layer and one in a high resolution layer. As described above single grids in a lower resolution layer are respectively divided into plural grids in a higher resolution layer so that the positional information obtained in the lower resolution layer can be effectively used in the higher resolution layer.

Initial values for corresponding positions of the search image to the reference image are obtained by triangulated irregular network interpolation step S . Here the triangulated irregular network interpolation refers to a process to form a digital elevation model DEM made up of a group of triangles generated from topographic points disposed in a random manner so as to obtain positions of arbitrary points by interpolation using values for known points. illustrates search width correction at respective points in the search image after the triangulated irregular network interpolation in which illustrates the grids in the search image in an initial state and the grids deformed according to the initial values for the corresponding positions in the search image obtained by the triangulated irregular network interpolation. The grids in the search image in the initial state are deformed according to the initial values for the corresponding positions in the search image obtained by the triangulated irregular network interpolation into a state such as shown in .

The corresponding area determining section determines an initial value for an amount of distortion correction for the search image based on the triangulated irregular network by the least squares method step S . illustrates the distortion correction for the search image in which illustrates a state before the distortion correction for the search image and a state after the distortion correction for the search image. The initial value for the distortion correction amount for the search image is obtained based on the coefficients a1 a6 in the affine deformation equation in the corresponding point detection using the least squares matching. The transformation coefficients in the corresponding point detection using the least squares matching obtained with respect to the search image in a current resolution layer can be used as initial values in matching in a higher resolution layer and eventually contribute to the determination of optimum positions of the corresponding points in images of the original resolution.

The search image distortion correcting section corrects the search image with the search image distortion correction amount obtained in step S step S . The search image distortion correcting section determines search widths at respective points in the search image after the search image distortion correction according to the tilts of the respective irregular triangles step S . illustrates the search width correction at respective points in the search image after the tilt distortion correction in which illustrates the grids in the search image and the grids in the search image deformed according to the tilts of the irregular triangles. The search widths for the grids in the search image are corrected according to the tilts of the irregular triangles including respective pixels. In other words the search image distortion correcting section corrects the positional relationship between the reference image and the search image of the stereo images or specifically corrects the search image in consideration of the entire images according to the amount of deformation obtained from the triangulated irregular network and corrects the search image locally at individual pixels according to the tilts of the irregular triangles including the respective pixels.

The image search area setting section sets a reference area in the reference image of the pair of stereo images and sets a search area in the search image of the stereo images in a position corresponding to the reference area step S . The search image distortion correcting section performs searches for the search area at respective points in the search image using the search image corrected with the search image distortion correction amount step S . This allows the positional relationship between the reference area and the search area corresponding to the reference area to be obtained using the reference image and the search image corrected with the image distortion correction amount. The image measuring device determines whether or not there exists a layer of a resolution one step higher than the current one in the coarse to fine method step S and if there does the resolution specific grid image forming section generates grids in the layer of the higher resolution step S and the process returns to step S. The above processes steps S S are repeated until the image distortion of the search image is corrected well. The state of being corrected well is achieved by appropriately setting the range of resolution for example.

If the triangulated irregular network is formed up to the layer of the highest resolution the process branches from step S to step S. The area shape measuring section performs a three dimensional image measurement at respective points using the reference image and the search image in which triangulated irregular networks are formed up to the highest resolution layer and image distortion is corrected step S raising expectations for more precise measurement results. It is determined whether or not the process ends step S . When No the process returns to step S and when Yes the process ends.

In the first embodiment the search image distortion correcting section applies an image distortion correction to the other image according to the positional relationship between the reference area and the search area corresponding to the reference area . However in an alternative embodiment an image distortion correction may be applied to the reference image instead of the search image .

In the figure components having the same functions as those in are given the same reference numerals and symbols and descriptions of such components will not be repeated. An image measuring device includes a reference area deforming section a corresponding area determining section an area shape measuring section an image rebuilding section and a left right image correspondence database . The reference area deforming section deforms the reference area in at least one of size or shape and for example an operator views an image of the search area corresponding to the reference area to determine appropriately or utilizes the orientation results. Preferably the reference area deforming section corrects the reference area in at least one of set position or shape based on the measurement results obtained by the area shape measuring section such that the image distortion of the reference image is reduced.

The corresponding area determining section determines a search area corresponding to the reference area either set by the area setting section or deformed by the reference area deforming section by the correlation process described already. The search image distortion correcting section applies a predetermined image distortion correction to the search image according to the positional relationship between the reference area and the search area corresponding to the reference area . The area shape measuring section measures a shape of a measuring object photographed in the stereo images based on the reference area in the reference image and the search area in the search image corrected by the search image distortion correcting section .

Using a description is made of the operation of the image measuring device of . is a flowchart for explaining a second embodiment of the present invention explaining the combined operation of the coarse to fine method the triangulated irregular network and the least squares method. The image measuring device captures a pair of stereo images from the stereo image recording section and the resolution specific grid image forming section sets a reference image and a search image with respect to the left and right images of the pair of stereo images step S . A matching object region in the left and right images is designated by inputting boundary points defining its outline for example by an operator step S .

Initial values for the triangulated irregular network are set by the operator or an initial value setting function of the image measuring device step S . The triangulated irregular network forming section forms a triangulated irregular network that covers the reference image and the search image of the stereo images by duplicating an irregular triangle two dimensionally. The resolution specific grid image forming section generates a grid in the low resolution layer in the coarse to fine method step S .

The image search area setting section sets a reference area in the reference image of the pair of stereo images and sets a search area in the search image of the stereo images in a position corresponding to the reference area step S . The reference area deforming section changes a position of an arbitrary grid point constituting the triangulated irregular network to deform at least one of the reference areas in at least one of size or shape step S . Initial values for corresponding positions between the reference image and the search image are obtained by triangulated irregular network interpolation step S . The corresponding area determining section determines an initial value for a distortion correction amount for the search image based on the triangulated irregular network by the least squares method step S .

The search image distortion correcting section corrects the search image with the search image distortion correction amount obtained in step S step S . The search image distortion correcting section determines search widths at respective points in the search image after the search image distortion correction according to the tilts of the respective irregular triangles step S .

The search image distortion correcting section performs searches at respective points in the search image using the search image corrected with the search image distortion correction amount step S . For example the image search area setting section sets a reference area in the reference image of the pair of stereo images and sets a search area in the search image of the stereo images in a position corresponding to the reference area .

The image measuring device determines whether or not there exists a layer of a resolution one step higher than the current one in the coarse to fine method step S and if there does the resolution specific grid image forming section generates grids in the layer of the higher resolution step S and the process returns to step S. If necessary the process may return to step S instead of step S to correct the reference area in at least one of set position or shape based on the measurement results obtained by the triangulated irregular network forming section .

If the triangulated irregular network is formed up to the layer of the highest resolution in the coarse to fine method the process branches from step S to step S. The area shape measuring section performs a three dimensional image measurement at respective points using the reference image and the search image where the image distortion is corrected in both of which triangulated irregular networks are formed up to the highest resolution layer step S raising expectations for more precise measurement results. It is determined whether or not the process ends step S . When No the process returns to step S and when Yes the process ends.

As in the embodiments 3D measurement data obtained from stereo images can be integrated and visualized with an image of a measuring object with a stereoscopic texture with the availability of a three dimensional image measuring apparatus implemented by a computer including an information processor such as a PC personal computer a display device such as an LCD liquid crystal display monitor software for the three dimensional image measuring apparatus installed on the PC and a calibrated photographing device for photographing stereo images of the measuring object such as digital cameras. Thus it is possible to construct an inexpensive system using an inexpensive general purpose computer and monitor device without the need for an expensive and precise stereoscopic system conventionally required to handle 3D data measured in stereo.

The measurement resolution in photogrammetry is determined by a base and height ratio B H which is a ratio of a distance between cameras B to a photographing distance H. However in ground based phogotrammetry in some cases where an object with complicated projections and depressions is photographed with an increased base and height ratio the stereo matching may fail under the influence of occlusion or projection distortion associated with relative height difference. Even in such cases of a complicated object the application of the least squares matching in the present embodiment allows sub pixel image measurement by a stereo matching using images photographed with a reduced base and height ratio. With its algorithm integrating the TIN interpolation and the coarse to fine method the present invention yields reliable results even for oblique images or images with deformation magnification rotation due to the projection distortion of the object or the like.

The success or failure of the least squares matching depends on the density levels of the left and right images and the texture in the window. Thus the texture is preferably analyzed using the density values of the left and right images as a preprocess before the least squares matching of the present invention. In deforming the window it is preferable that the image is sampled accurately using a bilinear method or the like.

In digital photogrammetry since the relationship between three dimensional positions of TIN data obtained by the measurement of respective stereo models and photographed images are established by the orientation work there is no need to synthesize TIN models or to perform alignment work for the texture. Since lens distortion and projection distortion of the cameras at the time of photographing are corrected with respect to the texture at the same time the images used in the measurement can be texture mapped with a resolution coincident with the measurement accuracy. The correspondence between the TIN models and the texture is maintained for each layer of resolution.

A resulting 3D model with a texture can be freely rotated and enlarged on a PC screen to allow confirmation of its surface shape in a real manner. This allows checking and editing of the measurement data without the use of a stereoscopic screen 3D monitor . In order to perform measurement to form a complicated all around model of an architecture a structure or the like multiple images photographed from around are used to form a TIN model for each stereo model. In this case since TIN models are automatically synthesized in correct positions in the same coordinate system it is possible to proceed with the work while confirming the measurement data.

APIs Application Programming Interfaces for realizing fast 3D graphics in Windows registered trademark environments include OpenGL developed mainly by Silicon Graphics Inc. and Direct3D developed by Microsoft Corporation which are currently in wide use in many CG software products CAD software products game software products and the like. Both allow significantly fast graphics drawing when a video card with a 3D acceleration function is installed in a personal computer.

The following are reference numerals for major components used in the descriptions above. measuring object stereo images image measuring device approximate position measuring section resolution specific grid image forming section reference image one image search image other image image processing section image search area setting section reference area search area corresponding reference area triangulated irregular network forming section unitary geometric shape network forming section triangulated irregular network data search image distortion correcting section corresponding area determining section area shape measuring section image rebuilding section left right image correspondence database reference area deforming section.

