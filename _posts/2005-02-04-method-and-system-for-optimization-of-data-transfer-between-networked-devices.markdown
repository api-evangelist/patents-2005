---

title: Method and system for optimization of data transfer between networked devices
abstract: The invention relates to a method of arranging communication in a local area networking system comprising a first device, a second device and an intermediate node for arranging data transmission between the first device and the second device. The second device is arranged to multicast and/or broadcast messages to devices in the system. The transmission of multicast and/or broadcast messages to the first device is prevented by the interworking means.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08451848&OS=08451848&RS=08451848
owner: Nokia Corporation
number: 08451848
owner_city: Espoo
owner_country: FI
publication_date: 20050204
---
Available wireless local area networking technologies such as the Bluetooth technology are widely included in various mobile devices. The devices are typically allocated an IP Internet Protocol address and they may communicate with other devices using the IP protocol stack. Besides desktop laptop computers and mobile terminals networking technologies are also incorporated to various domestic appliances such as TV sets set top boxes stereo systems personal music players cameras home management systems and fridges. It is expected that various domestic appliances will be capable of interacting with other devices and sharing information by using especially wireless local area networking technologies and IP based technologies.

UPnP Universal Plug and Play technology by UPnP Forum defines an architecture for peer to peer network connectivity of intelligent appliances wireless devices and personal computers of all form factors. It is designed to bring easy to use flexible standard based connectivity to ad hoc or unmanaged networks whether in the home in a small business public spaces or attached to the Internet. UPnP technology provides a distributed open networking architecture that leverages TCP IP Transport Control Protocol Internet Protocol and the Web technologies to enable seamless proximity networking in addition to control and data transfer among networked devices from a wide range of vendors. According to the UPnP Device Architecture UDA a device can dynamically join a network obtain an IP address convey its capabilities to other devices and learn about the presence and capabilities of other devices.

The DHWG Digital Home Working Group HNv1 Home Network version 1 specification describes an environment formed by devices like PCs TV sets set top boxes stereo systems etc. that are connected to the network via an IEEE 802.x interface including the Ethernet and the wireless local area network WLAN. The devices forming the HNv1 environment are by their nature static or with very limited mobility allowing them to be always connected to an AC Alternating Current power supply. At the same time the connectivity technology they use allows high data rates and low latency.

Constrained devices like mobile phones PDAs Personal Digital Assistant portable music players or cameras are typically not able to support 802.x communication technology but they often deploy energy saving short range communication media such as Bluetooth. Short range communication media typically exhibits more limited bandwidth and longer delays than an IEEE802.x media. Since these constrained devices or in DHWG terminology mobile handheld devices use different communication media than HNv1 devices an interworking unit is required. Connecting different networks together as such is commonly used technology but the architecture of HNv1 exhibits communication environment which is problematic for mobile handheld devices that have limited energy resources and or slow communication link. HNv1 specifies that the UPnP is used as service discovery and controlling protocol suite which potentially and in certain conditions may result in a considerable amount of communication for which the device needs to response. More particularly according to the UPnP discovery protocol the UPnP devices advertise their services to other devices in the system by sending multicast messages. Further also services and or interested devices may be searched by multicast requests. The UPnP specification specifies that a UPnP devices should send each advertisement message more than once due to the usage of unreliable UDP User Datagram Protocol . The result is that the numerous multicast messages will consume the battery of the receiving device within a much shorter time causing unsatisfactory user experience. Also in some conditions a considerable amount of the capacity of the connecting link is used for control communication which prevents the use of the services available.

There is a need to alleviate the above disadvantages. The needs are fulfilled by a method a system a device a chip and a computer program product which are characterized by what is stated in the independent claims. Some embodiments of the invention are disclosed in the dependent claims.

The invention is based on the idea of preventing the transmission of at least some multicast and or broadcast messages from a second device to a first device by an intermediate node arranging data transmission between the first device and the second device. The local area networking system may be any local network configuration. For instance it may comprise a Bluetooth network and or an IEEE 802.11 WLAN network.

An advantage of the method and arrangement of the invention is that less processing is required in the first device because fewer messages are received. Thereby the power consumption of the constrained devices such as handheld PDAs mobile stations or music players can be reduced. For bandwidth limited links the reduced bandwidth usage is naturally also an advantage and thus a faster link is available for other data transmission. As the transfer of multicast and or broadcast messages is reduced the response time of the system and the average propagation time are shorter. Further the first devices not receiving multicast messages can still support all functions of the system e.g. full UPnP stack to be available in case they are connected to the system such that multicast messages can be received. This makes it easier to reach full compatibility with the second device for example for enabling connectivity in configurations where there is direct connection between the first and the second device. One further advantage of the invention is that it is easy to implement for various technologies thereby enabling a reduction in the costs of the end product.

An embodiment of the invention will be illustrated in the following in a UPnP system but the invention can also be applied to other networking systems in which communication is arranged between handheld like constrained devices and devices without such constraints.

Referring to the system comprises mobile handheld devices MHD an intermediate node in the embodiment of an interworking unit IWU and home network devices HND supporting the UPnP home network version 1 HNv1 specification. The devices HND form the HNv1 domain and the devices MHD form the MHS Mobile Handheld Subcommittee domain. The interworking unit IWU is at the edge of these domains and it provides adaptation of the data transmission between these domains. It is to be noted that there may also be other devices between the IWU and the MHD and or between the IWU and the HND. The IWU may be a specific device or implemented as a part of another device such as a router an extended bridge or a multimedia set top box. In the example of the HNv1 domain uses a wired network e.g. Ethernet and the MHS domain utilizes wireless networking technology e.g. Bluetooth. As further shown in it is feasible that a MHD may connect with the IWU using a wired link such as USB Universal Serial Bus and the handheld devices MHD may also communicate between themselves and thus form a Bluetooth piconet for instance. Further the HNv1 domain may be connected to other networks such as the Internet. It is to be noted that the handheld devices MHD or the HNv1 devices HND may also comprise other communication means. For instance a mobile handheld device MHD may comprise a transceiver for communicating with the PLMN Public Land Mobile Network . Some examples of devices MHD are PDAs laptop computers personal music players headsets mobile phones and cameras. HNv1 devices HND are typically always connected to an AC power supply and these devices include TV sets stereo devices and home management devices.

HTTP protocol is used between the MHD and HND above a TCP layer not shown in to transfer the UPnP layer messages. For sending and receiving advertisements and search requests according to the UPnP discovery protocol the devices MHD and HND use multicast variant of HTTP and for responses a unicast variant of HTTP is used. Both of these HTTP variants use UDP instead of the TCP. UPnP specific functions are implemented in the MHD and HND by UPnP and UPnP AV Audio Visual Profile functions. Applications and various media formats may then utilize the UPnP functions.

As illustrated in the device functioning as the IWU comprises memory MEM a user interface UI I O means I O for arranging communication and a central processing unit CPU comprising one or more processors. Computer program codes executed in the central processing unit CPU may be used for causing the device IWU to implement the interworking means IWM for arranging transfer of data between the MHD and the HND. Further computer program codes executed in the central processing unit CPU may be used for causing the device IWU to implement the inventive functions relating to the forwarding of messages to the MHD some embodiments of which are illustrated later in association with . As one example the inventive functions may be provided as an extension to the application implementing the interworking means IWM. A chip unit or some other kind of module for controlling a data processing device IWU for a local area networking system may in one embodiment cause the device to perform the inventive functions. The module may form part of the device IWU and could be removable i.e. it can be inserted into another unit or device. Computer program codes can be received via a network and or be stored in memory means for instance on a disk a CD ROM disk or other external memory means from where they can be loaded into the memory MEM of the processing device. Hardware solutions or a combination of hardware and software solutions may also be used to implement the inventive functions.

Instead of the above illustrated method the data transmission between the constrained device MHD and the non constrained device HND may also be arranged by other means. For instance after step there could be an additional checking step in UPnP system on whether the message was received on an HNv1 interface. If in such a case the message is received on HNv1 interface the method will proceed to current step otherwise the method will not proceed. Thus only HNv1 interface packets need to be analysed.

According to still another embodiment there can be one or more other additional checking steps relating to the receiving device MHD before entering the step . The IWU may check whether the link is available to the MHD. For instance in the case of Bluetooth the system checks if the BT is in the sleep mode. If it is in the sleep mode the IWU will wake up the BT before entering step . If BT is active step can be entered directly.

According to an embodiment not all multicast and or broadcast messages are prevented from being transmitted to the MHD. The IWU may be provided with message transmission conditions including information on message types and or with other message details and the IWU may be arranged to check in step or in an additional step preferably before step whether the received message complies with the predetermined conditions. This embodiment provides the advantage that even very detailed conditions on transferred or blocked messages can be determined thereby still enabling critical messages to be forwarded but preventing the transmission of less important messages. This further optimizes the usage of transmission capabilities in the system. Depending on the desired implementation the message complying with the conditions may be forwarded to the MHD or prevented from being forwarded to the MHD in a case where the conditions determine the blocked or filtered messages. For instance certain types of messages or multicast and or broadcast messages using a particular number are forwarded to the MHD but other multicast and or broadcast messages are not. In the UPnP system the following embodiment becomes important The IWU is arranged only to prevent the transmission of multicast messages and it will forward at least part of or all broadcast messages to the MHD.

Two general classifications of devices are defined by the UPnP architecture controlled devices and control points. A controlled device functions in the role of a server responding to requests from control points. Both control points and controlled devices can be implemented on a variety of platforms including personal computers and embedded systems. Multiple devices control points or both may be operational on the same network endpoint simultaneously. Thus the MHD and the HND in may be arranged to operate as the controlled device the control point or both.

A UPnP device MHD IWU or HND may have a Dynamic Host Configuration Protocol DHCP client and it may search for a DHCP server when the device is first connected to the network. Alternatively the devices autoconfigure Auto IP themselves when a DHCP server is not present in the network. The prerequisite for using the UPnP functions is to obtain an IP address Step 0 . According to an embodiment the IWU is arranged to forward the broadcast messages related to address acquisition to the MHD. Broadcast messages are used by the address resolution protocol that is used to find out which device has a specific IP address. Broadcasts are also used when autoconfiguring the system. It is also feasible that some other broadcast messages are forwarded to the MHD whereas some broadcast messages may be prevented from being transmitted.

Once an IP address is allocated to a UPnP device the following UPnP functions are available. Discovery is Step 1 in UPnP networking. Through discovery control points find interesting device s . Discovery enables description Step 2 where control points learn about device capabilities control Step 3 where a control point sends commands to device s eventing Step 4 where control points listen to state changes in device s and presentation Step 5 where control points display a user interface for device s . For more details on these functions reference is made to UPnP Forum specification 1.0 version 1.0.1 6 May 2003.

Referring to the UPnP Discovery i.e. Step 1 the UPnP multicast messages are used by SSDP Simple Service Discovery Protocol in order to enable UPnP controlled devices to advertise their root embedded devices and services and for UPnP control points to discover UPnP devices that are of interest to them. According to an embodiment in the UPnP system the interworking unit IWU is however in step of arranged to discard on the MHS interface at least part of or all of the UPnP Discovery multicast messages that are originated in the HNv1. UPnP multicast messages are sent to a standard address and port 239.255.255.250 1900. The IWU is arranged to monitor the IP headers of the incoming packets and to prevent the transmission of messages having said address as the destination IP address. Thus the IWU is a link layer device with IP snooping capabilities. The properties of the UPnP messages relating to the Discovery are described in Chapter 1.1.2 1.1.3 1.2.2 and 1.2.3.

The IWU does not allow UPnP multicasting to enter MHS domain but does not prevent multicasting in the opposite direction to the HNv1 domain. In one embodiment the MHD fulfills the advertisement requirements of UPnP system and advertises itself by multicast messages at least when entering the UPnP system. The MHD may also make inquiries when it needs services from HNv1 domain. The MHD keeps its existence known to the HNv1 control points and refreshes advertisements as needed. In fact the MHD should be active to be known in the UPnP network and to obtain the current status from the HNv1 network. According to a further embodiment the level of activity can be adjusted in the MHD for instance by adjusting the transmission periods of the messages. In the following UPnP functions are illustrated for an MHD functioning as the controlled device in view of the UPnP system. For advertising itself the MHD according to initiates the BT Bluetooth PAN formation obtains an IP address DHCP or Auto IP and thereafter advertises its services via SSDP by one or more multicast messages. The IWU forwards these multicast messages to the HVn1 domain. Interested control points may then download the device description and subscribe to events in the MHD. After a time out period has expired the PAN is turned to the sleep mode. The MHD may refresh its advertisement by sending a new multicast message.

When an HNv1 controlled device HND advertises its services the IWU receives the advertisement message and checks at least the IP destination address. As the message is a multicast message it is not forwarded to the MHD. The IWU treats a search query from an HNv1 device functioning as a control point in a similar fashion i.e. it is not forwarded to the MHD while it is a multicast message.

However the IWU is in step arranged to forward unicast messages intended for MHD originated in the HNv1. In this embodiment the IWU forwards unicast messages originated in the HNv1 domain HND and addressed to the MHD. Thus the IWU in accordance of may wake up the Bluetooth PAN when it receives a unicast message to the MHD. For instance when a HNv1 control point wishes to perform an action on the MHD it will send an SOAP Simple Object Access Protocol unicast message. The IWU snoops the IP traffic and notices that the control point tries to establish a unicast HTTP session with the MHD. As based on check in steps in the message is not a multicast message the IWU re establishes the BT PAN with the MHD. After the BT BAN is available the IWU forwards the message to the MHD. The action is performed and a response is transmitted to the control point. After a predetermined time period the BT PAN between the MHD and the IWU goes to the sleep mode.

The MHD may also function as a control point in view of the UPnP system. In this embodiment the above illustrated principles apply the IWU forwards all unicast messages to and from the MHD and multicast messages only from the MHD. Thus the MHD may send search queries receive GENA General Event Notification Architecture events and respond to SOAP actions via the IWU to an HNv1 device but it does not receive multicast advertisements from HNv1 devices or search queries from HNv1 control points.

In one embodiment not described in some or all of the above illustrated features relating to preventing transmission of multicast and or broadcast messages are implemented in a system where both devices MHD HND use the same networking technology. Thus the intermediate node does not have to provide any adaptation between two different transmission protocols. The intermediate node may then support one to one associations between the IWU and the device MHD HND. Examples of such associations are the IEEE 802.11 association between a mobile terminal and an access point or the association between the LAN MAC of a network card and a single LAN MAC of a switch. The intermediate node may learn which attached devices belong to the HNv1 domain and which belong to the MHS domain by inspecting layer 2 traffic possibly also IP snooping by using heuristic means. Then the transmission of the multicast and or broadcast messages is prevented for the MHDs. For instance both sides of the intermediate node may be WLAN Ethernet or BT and the above illustrated optimization features may still be applied.

Above some examples of feasible identification features were illustrated. However the invention is not limited to the above illustrated embodiments but any properties of the message may be compared to the properties determined in predetermined message transmission conditions in order to determine if the transmission of the message should be prevented. For instance it is possible to use link layer address information such as IEEE 802 MAC layer multicast address identification only port number or a combination of multiple identifiers for instance the combination of IP address and port number as already illustrated.

It will be obvious to a person skilled in the art that as the technology advances the inventive concept can be implemented in various ways. The invention and its embodiments are not limited to the examples described above but may vary within the scope of the claims.

