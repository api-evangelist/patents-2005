---

title: Simplified creation and termination of an ad hoc wireless network with internet connection sharing
abstract: Methods and systems are described for simplified creation of, connection to, and termination from an ad hoc wireless network. Graphical user interfaces are used to guide users though creation and joining ad hoc network. The option to share one user's Internet connection with the entire ad hoc network is also described. The ad hoc networks described can provide some managed services traditionally unavailable in ad hoc networks, such as IP address assignment and name resolution services. The ad hoc networks can be created with termination criteria, such that a computer's connection to the ad hoc network is automatically terminated and previous network configuration settings are restored when one or a combination of termination criteria are met.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07616588&OS=07616588&RS=07616588
owner: Microsoft Corporation
number: 07616588
owner_city: Redmond
owner_country: US
publication_date: 20050331
---
This application is related to co pending application Ser. No. 10 806 836 filed Mar. 23 2004 by Manchester et al. entitled CONFIGURING AN AD HOC WIRELESS NETWORK USING A PORTABLE MEDIA DEVICE which is hereby incorporated by reference in its entirety for all that it teaches without exclusion of any part thereof.

This invention relates generally to the field of wireless computing and more particularly to the areas of ad hoc wireless networking and connection sharing.

Wireless networking today is dominated by devices operating according to IEEE 802.11 protocols such as 802.11b WiFi . The 802.11 protocols provide for two distinct types of wireless networking infrastructure and ad hoc. In an infrastructure network a single device usually a wireless access point acts as a central server for providing managed services such as providing Internet Protocol addresses via e.g. DHCP and IP address discovery and resolution via e.g. DNS . The wireless access point further is typically connected via physical connection to the Internet and provides routing capabilities enabling wirelessly networked devices to access the Internet via the access point. All network communications in an infrastructure network pass through the wireless access point.

In an ad hoc network or computer to computer network networked computing devices communicate directly with one another in peer to peer fashion. Although one computer might set up the network no centrally managed services exist. For this reason ad hoc networks are typically small and closed without access to external services.

The ability to quickly and easily set up an ad hoc wireless network is desirable in a number of scenarios. One simple example of such a scenario is when two or more users come together with their wireless enabled laptops computers they may wish to participate and collaborate together for activities such as file sharing in a peer to peer fashion without requiring a centralized server or hub to manage the network. In these situations it is possible for the users to create an ad hoc network according to an IEEE 802.11 wireless protocol. However although the 802.11 protocol provides the ability to create an ad hoc network current software does not exist to ease and quicken the process it is currently an extremely difficult error prone and time consuming process.

Furthermore once set up it is also currently difficult to deconstruct such a network so that each participating computer is restored to its previous networking state. As a result users of ad hoc networks may experience problems subsequently connecting to other wireless networks or may find their computers attempting to reconnect to the ad hoc network at a later time thereby disconnecting a new network connection.

Another shortcoming of existing ad hoc network creation and management tools is revealed when one computer in an ad hoc network has access to the Internet other computers participating in the ad hoc network presently have no easy way of taking advantage of this accessibility.

Some existing computer operating systems include an Internet connection sharing ICS feature. This feature has been exclusively used by computing devices containing two network adapters. Typically one network adapter is connected to a LAN or another computer the other network adapter is connected to a WAN or the Internet. By invoking the ICS feature other computers connected to the device by the LAN or directly are permitted to access the WAN or Internet. The ICS feature typically operates through a number of embedded networking components such as DHCP and DNS services but those embedded components have not historically been separable from the general ICS feature. Thus if an application wished to access only one of the ICS components it needed to be able to access the entire suite of ICS components.

However the suite of ICS components has not been made available to devices containing only one network adapter. Thus a computer containing only one network adapter on existing systems cannot avail itself of the embedded components of the ICS feature.

The problems outlined are largely addressed by systems and methods for simplified creation and termination of ad hoc wireless networks as described herein. The following presents a simplified summary of the disclosure in order to provide a basic understanding to the reader. This summary is not an exhaustive or limiting overview of the disclosure. The summary is not provided to identify key and or critical elements of the invention delineate the scope of the invention or limit the scope of the invention in any way. Its sole purpose is to present some of the concepts disclosed in a simplified form as an introduction to the more detailed description that is presented later.

A shortcoming of existing wireless networking management systems is their inability to allow users to easily create and maintain ad hoc networks. Existing processes for creation of ad hoc networks are laborious and difficult for average users. Embodiments of the present invention address this shortcoming by simulating a simple managed environment in an unmanaged space. This is advantageous to users who gain the ability to quickly and rapidly setup a network meeting space between themselves without having to realize or understand all the different software pieces that work together to make this possible. Embodiments of the invention provide such functionality for networks supporting IPv4 or IPv6. Some embodiments of the invention facilitate a simplified user friendly process for creation of ad hoc networks through the use of graphical user interfaces including step by step instructions.

An additional feature found in embodiments of the invention is the ability to share one participant s Internet connection with the other participants on an ad hoc network. Such a feature is achieved by for example unbundling IP address assignment and name resolution services from packaged bundles of networking services such as an existing Internet Connection Sharing package. This allows simplified management of selected network sharing services by leveraging the package s existing interfaces while alleviating restrictive requirements that might prohibit the use of the entire package.

Furthermore embodiments of the invention include features for automatically terminating connection to an ad hoc network and restoration of previous network settings. Automatic terminations can be triggered by any number of user specified or default criteria such as for example leaving the physical proximity of the ad hoc network expiration of a fixed amount of time or logging out of the computer by the user.

In one embodiment a method is provided for establishing an ad hoc wireless network performable by a first computing device the first computing device comprising a first wireless network adapter for communicating with the ad hoc network and further comprising a second network adapter for communicating with a second network the method comprising the steps of guiding a user of the first computing device through a process for generating network configuration parameters for creating the ad hoc network informing the user of at least one method for transferring the network configuration parameters to a second computing device by which the second computing device can connect to the ad hoc network and allowing the second computing device to communicate with the second network through the ad hoc network and the second network adapter on the first computing device.

In another embodiment a method is provided for establishing an ad hoc wireless network performable by a first computing device the first computing device comprising a first wireless network adapter for communicating with the ad hoc network the method comprising the steps of guiding a user of the first computing device through a process for generating network configuration parameters for creating the ad hoc network informing the user of at least one method for transferring the network configuration parameters to a second computing device by which the second computing device can connect to the ad hoc network invoking a network protocol address assignment server on the first computing device to assign a network address to the second computing device after the second computing device has connected to the ad hoc network and invoking a name resolution server on the first computing device to provide name resolution service to the second computing device.

In still another embodiment a system is provided for establishing an ad hoc wireless network between two or more computing devices each computing device comprising a wireless network adapter for communicating with the ad hoc network the system comprising an ad hoc network initiator user interface for execution on a first computing device a transfer mechanism for transferring ad hoc network configuration information from the first computing device to one or more other computing devices and an ad hoc network joining user interface for execution on the one or more other computing devices wherein the initiator user interface provides user instruction for using the transfer mechanism to convey the network configuration information and wherein the joining user interface provides user instruction for using the transfer mechanism to input the conveyed network configuration information onto the one or more computing devices.

Methods and systems to simply create and terminate an ad hoc wireless network according to embodiments of the invention will now be described with respect to preferred embodiments however the methods and systems of the present invention are not so limited. Moreover the skilled artisan will readily appreciate that the methods and systems described herein are merely exemplary and that variations can be made without departing from the spirit and scope of the invention. After reviewing this description it will be apparent to those skilled in the art that the foregoing is merely illustrative and not limiting having been presented by way of example only. Numerous modifications and other illustrative embodiments are within the scope of one of ordinary skill in the art and are contemplated as falling within the scope of the invention. In particular although many of the examples presented herein involve specific combinations of method operations or system elements it should be understood that those operations and those elements may be combined in other ways to accomplish the same objectives. Operations elements and features discussed only in connection with one embodiment are not intended to be excluded from a similar role in other embodiments. Moreover use of ordinal terms such as first and second in the claims to modify a claim element does not by itself connote any priority precedence or order of one claim element over another or the temporal order in which operations of a method are performed but are used merely as labels to distinguish one claim element having a certain name from another element having a same name but for use of the ordinal term to distinguish the claim elements.

The present invention will be more completely understood through the following detailed description which should be read in conjunction with the attached drawings. In this description like numbers refer to similar elements within various embodiments of the present invention. Aspects of the invention are illustrated as being implemented in a suitable computing environment. Although not required the invention will be described in the general context of computer executable instructions such as procedures being executed by a computing device. Although the invention has applicability to portable computing devices it will be appreciated that the same techniques apply to any computing device enabled for wireless network connectivity.

Generally procedures include program modules routines functions programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Moreover those skilled in the art will appreciate that the invention may be practiced with other computer system configurations including hand held devices multi processor systems microprocessor based or programmable consumer electronics network PCs minicomputers mainframe computers and the like. The invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules may be located in both local and remote memory storage devices. The term computer system may be used to refer to a system of computers such as may be found in a distributed computing environment.

With reference to an exemplary system for implementing the invention includes a general purpose computing device in the form of a computer . Components of the computer may include but are not limited to a processing unit a system memory and a system bus that couples various system components including the system memory to the processing unit . The system bus may be any of several types of bus structures including a memory bus or memory controller a peripheral bus and a local bus using any of a variety of bus architectures. By way of example and not limitation such architectures include Industry Standard Architecture ISA bus Micro Channel Architecture MCA bus Enhanced ISA EISA bus Video Electronics Standards Association VESA local bus and Peripheral Component Interconnect PCI bus also known as Mezzanine bus.

The computer typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by the computer and includes both volatile and nonvolatile media and removable and non removable media. By way of example and not limitation computer readable media may comprise computer storage media and communication media. Computer storage media includes volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Computer storage media includes but is not limited to RAM ROM EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical disk storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by the computer . Communication media typically embodies computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example and not limitation communication media includes wired media such as a wired network or direct wired connection and wireless media such as acoustic RF infrared and other wireless media. Combinations of the any of the above should also be included within the scope of computer readable media.

The system memory includes computer storage media in the form of volatile and or nonvolatile memory such as read only memory ROM and random access memory RAM . A basic input output system BIOS containing the basic routines that help to transfer information between elements within computer such as during start up is typically stored in ROM . RAM typically contains data and or program modules that are immediately accessible to and or presently being operated on by processing unit . By way of example and not limitation illustrates operating system application programs other program modules and program data .

The computer may also include other removable non removable volatile nonvolatile computer storage media. By way of example only illustrates a hard disk drive that reads from or writes to non removable nonvolatile magnetic media a magnetic disk drive that reads from or writes to a removable nonvolatile magnetic disk and an optical disk drive that reads from or writes to a removable nonvolatile optical disk such as a CD ROM or other optical media. Other removable non removable volatile nonvolatile computer storage media that can be used in the exemplary operating environment include but are not limited to magnetic tape cassettes flash memory cards digital versatile disks digital video tape solid state RAM solid state ROM and the like. The hard disk drive is typically connected to the system bus through a non removable memory interface such as interface and magnetic disk drive and optical disk drive are typically connected to the system bus by a removable memory interface such as interface .

The drives and their associated computer storage media discussed above and illustrated in provide storage of computer readable instructions data structures program modules and other data for the computer . In for example hard disk drive is illustrated as storing operating system application programs other program modules and program data . Note that these components can either be the same as or different from operating system application programs other program modules and program data . Operating system application programs other program modules and program data are given different numbers hereto illustrate that at a minimum they are different copies. A user may enter commands and information into the computer through input devices such as a tablet or electronic digitizer a microphone a keyboard and pointing device commonly referred to as a mouse trackball or touch pad. Other input devices not shown may include a joystick game pad satellite dish scanner or the like. These and other input devices are often connected to the processing unit through a user input interface that is coupled to the system bus but may be connected by other interface and bus structures such as a parallel port game port or a universal serial bus USB . A monitor or other type of display device is also connected to the system bus via an interface such as a video interface . The monitor may also be integrated with a touch screen panel or the like. Note that the monitor and or touch screen panel can be physically coupled to a housing in which the computing device is incorporated such as in a tablet type personal computer. In addition computers such as the computing device may also include other peripheral output devices such as speakers and printer which may be connected through an output peripheral interface or the like.

The computer may operate in a networked environment using logical connections to one or more remote computers such as a remote computer . The remote computer may be a personal computer a server a router a network PC a peer device or other common network node and typically includes many or all of the elements described above relative to the computer although only a memory storage device has been illustrated in . The logical connections depicted in include a local area network LAN and a wide area network WAN but may also include other networks. Such networking environments are commonplace in offices enterprise wide computer networks intranets and the Internet.

When used in a LAN networking environment the computer is connected to the LAN through a network interface or adapter . When used in a WAN networking environment the computer typically includes a modem or other means for establishing communications over the WAN such as the Internet. The modem which may be internal or external may be connected to the system bus via the user input interface or other appropriate mechanism. In a networked environment program modules depicted relative to the computer or portions thereof may be stored in the remote memory storage device. By way of example and not limitation illustrates remote application programs as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used. In particular the computer may also contain a wireless networking interface or wireless card such as operating according to an IEEE 802.11 protocol. Additionally the computer may contain one or more additional wireless networking interfaces or wireless cards such as operating according to GPRS or Bluetooth protocols.

An exemplary scenario in which embodiments of the invention can be used is shown in and described in the following overview. Users of four computing devices and have gathered and wish to create an ad hoc wireless network to enable mutual sharing of files or playing of a networked game. Each of the computing devices and is equipped with a wireless adapter preferably according to an IEEE 802.11 protocol. An embodiment of the invention provides a graphical user interface GUI on computing device through which its user is guided into creating an ad hoc network. Associated with the network are preferably a name SSID authentication model and termination method. The name authentication model and termination method can be chosen by the user of computing device or alternatively may be selected automatically by the computing device perhaps according to one or more default settings. For example the authentication model can be a passphrase chosen by the user or a randomly selected phrase selected by the computing device or some other authentication model.

Once the user of computing device has completed the steps of the GUI he is prompted to communicate network information out of band to another user who wishes to join the network. For example if the user chose the name John s Network and a passphrase of I was talking to the duck the GUI would prompt the user Tell the next user to join John s Network using the passphrase I was talking to the duck . The user would then communicate this information to the users of computing devices and . The users of computing devices and each attempt to join the ad hoc network by using a GUI for joining. The GUI prompts the users with the names of available networks including John s Network. When the users select John s Network the GUI prompts them to enter the correct passphrase and informs them that the passphrase should be available from the user who set up the ad hoc network.

Alternatively the user of computing device does not communicate the network information directly to the other users but instead uses the GUI to save the necessary network information to a storage device such as a USB flash drive or the like. The GUI further prompts the user to pass the storage device to another user who wishes to join the ad hoc network. A user of for example computing device obtains the storage device and is prompted by GUI to insert the device and the network information is transferred into the user s computing device . The GUI further prompts the user to pass the storage device to another user who wishes to join the ad hoc network.

Additionally the initiating computing device preferably has access to software for managing the dispensing of IP addresses to networked devices such as DHCP services and for discovering other devices IP addresses such as DNS services . Once all the computing devices and have joined the ad hoc network created by the initiating computing device each device has a unique discoverable IP address within the network and all the computing devices can share files or play a networked game as desired.

In the example of computing device is additionally connected to the Internet . Computing device preferably contains at least two network adapters one an 802.11 wireless adapter for connecting to the ad hoc network the other an Ethernet GPRS Bluetooth or other type of adapter for connecting to a wide area network and or the Internet via a GPRS tower local area network or Bluetooth networked device . In an embodiment of the invention the GUI provides the user of computing device with the option to share its connection to the Internet . If the user selects this option then computing devices and are automatically provided with necessary networking information including for example temporary Internet Protocol address and domain name resolution services in order to communicate with the Internet via computing device .

The ad hoc network created by computing device in can be terminated in any number of ways as preferably configured by its user through the GUI . For example the ad hoc network can be configured to terminate after a preset amount of time a time to live or TTL . Alternatively the ad hoc network can be configured such that if a computing device s signal quality to the network becomes sufficiently weak then it is disconnected from the ad hoc network and it reverts to its previous network settings. Alternatively the ad hoc network can be configured to allow only manual termination so that a user must affirmatively choose to leave the network. Countless other variations are possible and are encompassed within embodiments of the invention.

In an embodiment of the invention a system for creating and terminating an ad hoc network with internet connection sharing consists of several components as illustrated in . A computing device typically comprises an operating system such as one member of the MICROSOFT WINDOWS family of operating systems. Within the operating system are several sub components or modules including for example a general networking module a wireless networking module and an Internet Connection Sharing ICS module . Applications running on the computing device generally communicate high level commands to the operating system through application programming interfaces APIs . As illustrated in a particular application for creating an ad hoc network is a graphical user interface wizard application communicating with the operating system through an ad hoc network API . Similarly a wizard application is used for joining an ad hoc network. The ad hoc network API communicates with the wireless networking module and the ICS module . In particular the API communicates directly with subcomponents of the ICS module a mini domain name service DNS server and a mini DHCP server . Prior to the present invention it was not possible to communicate directly with these subcomponents embodiments of the invention effectively unbundle them from the more general ICS module .

The operating system communicates through a Network Driver Interface Specification NDIS layer to hardware specific software drivers such as an 802.11 driver a GPRS driver and an Ethernet driver . The drivers communicate low level commands with network adapter hardware such as an 802.11 Wi Fi card a GPRS card or a Network Interface Card NIC .

Turning to a general method is shown for simplified creation and termination of an ad hoc wireless network with Internet connection sharing in accordance with an embodiment of the invention. At step the user of a creating computing device uses a graphical user interface to set up an ad hoc network inputting configuration parameters as necessary. The user has an option at step to share a connection he may have to the Internet via a second network adapter on the computing device. If the user chooses to share an Internet connection DHCP and DNS services are invoked at step . Alternatively DHCP and DNS services or other name resolution services are invoked regardless of whether the user chooses to share an Internet connection. At step information necessary for joining the ad hoc network is communicated out of band e.g. by voice USB flash drive etc. to another user. The other user uses the communicated information with a graphical user interface to join the ad hoc network at step . Additional users can join the network by repeating steps and . Network functions are available for the creating user and joining user until a termination condition is satisfied at step . At that point the user s computing device is removed from the ad hoc network at step the device reverts to its previous network settings and is available for joining or creating another wireless network.

In more detail a method for setting up an ad hoc network on a computing device is shown in in accordance with an embodiment of the invention. The user of the device first is presented at step with an option for manual or automatic SSID and network key generation. The network key corresponds to a network security method or authentication model such as WEP or WPA. If the user chooses the manual option then at step the user chooses a key along with a network name SSID . Additionally the user can choose a level of network security such as WEP or WPA for example. Alternatively the user can generate a passphrase random string graphical picture or other representation that is converted into a network key and SSID. If the user chooses the automatic option then at step the computing device selects some or all of the network configuration parameters. Networking modules in the device take this information and at step start broadcasting the new SSID in ad hoc mode.

The method continues at step where the computing device simulates a managed network by invoking DHCP functionality for assigning and managing IP addresses of networked devices and DNS functionality for managing name IP resolution for networked devices. The simulation is preferably performed by directly accessing those subfunctions of an Internet Connection Sharing component within the device s operating system. Alternatively the computing device does not use DNS for name resolution between devices and or the computing device does not use DHCP originated addresses. In their place it uses instead Link Local Multicast Name Resolution LLMNR to provide link layer name resolution between devices and self assigned AutoNet 169.254.x.x IPv4 addresses. Alternatively if all other devices to be networked support IPv6 and LLMNR then all the devices already have link local addresses and LLMNR is used for local resolution.

At step the user is presented with an option of whether a USB Flash Drive configuration device will be used to transmit the ad hoc network information to the other users. If so the user is instructed to insert a USB flash drive configuration device remove it and pass it to another user who wishes to join the network at step . Otherwise the user is instructed to transmit the network information to another user in any of a number of ways at step . For example the user can be instructed simply to tell the other user the SSID and network key verbally. Or he could be instructed to write the passphrase on a chalkboard.

At step the user is asked whether he wishes to share an Internet connection. In one embodiment step is only performed if an Internet connection is detected on the computing device. If the user chooses to share his connection then the ICS feature of the operating system is activated at step to allow other networked devices to access the Internet through the user s device. The user is also presented at step with an option to choose the ad hoc network termination criteria. A wide variety of criteria are preferably made available such that if the chosen criterion is satisfied then the ad hoc network is automatically terminated and cleaned. For example some criteria are a pre set Time To Live and a signal quality threshold. Alternatively an option for manual termination is presented so that no automatic termination takes place.

In more detail a method for a computing device to join an ad hoc network is shown in in accordance with an embodiment of the invention. The user of the device first is presented at step with a list of visible wireless networks to potentially join preferably along with additional information about each network such as whether it requires additional user input or a password etc. . The user chooses at step one of the networks listed and is prompted at step to enter authentication information for accessing the network. The authentication information can take the form of a password passphrase visual symbol or other form as determined by the network creator. Along with the prompt for authentication information the user can be instructed to contact the network initiator in order to receive the information out of band in a manner consistent with how the network initiator was instructed to transmit the information e.g. verbal on a chalkboard etc. . Alternatively the user is instructed at step to obtain a USB Flash Drive configuration device from a current participant in the ad hoc network and to insert it into a USB port on his computing device thereby transferring the necessary network information. In one embodiment the user inserts the USB Flash Drive into his computing device without any prompting or user interface and the network information is automatically transferred to the computing device the device can then be automatically joined to the ad hoc network without any user intervention. Additional details on the use of a USB Flash Drive in this manner can be found in co pending application Ser. No. 10 806 836 filed Mar. 23 2004 by Manchester et al. entitled CONFIGURING AN AD HOC WIRELESS NETWORK USING A PORTABLE MEDIA DEVICE which is hereby incorporated by reference in its entirety for all that it teaches without exclusion of any part thereof.

Turning to a more detailed process for terminating connection to an ad hoc network is illustrated in accordance with an embodiment of the invention. In order to terminate a computing device s connection to the ad hoc wireless network either an automatic or manual process is taken. The choice between automatic and manual and the particular termination criteria are preferably chosen by the initiator of the network at step and are passed to the joining device within the setup information transferred by the initiator at step . At step the device determines if termination is to be automatic or manual. If it is manual then no network settings are adjusted until the user of the device intervenes at step . If automatic then the device continuously monitors the termination criteria at step . As discussed earlier the termination criteria can take any of a number of forms including for example a time to live to set a fixed lifetime for the network if signal quality drops below some threshold value for some duration of time if no other devices are visible on the ad hoc network if the user of a networked device is logging out of his system combinations of the above and others. If the termination criteria is met then the device disconnects from the ad hoc network at step and restores its network settings to their previous state at step .

In view of the many possible embodiments to which the principles of the present invention may be applied it should be recognized that the embodiments described herein with respect to the drawing figures are meant to be illustrative only and should not be taken as limiting the scope of the invention. For example those of skill in the art will recognize that the illustrated embodiments can be modified in arrangement and detail without departing from the spirit of the invention. Although the invention is described in terms of software modules or components those skilled in the art will recognize that such may be equivalently replaced by hardware components. Therefore the invention as described herein contemplates all such embodiments as may come within the scope of the following claims and equivalents thereof.

