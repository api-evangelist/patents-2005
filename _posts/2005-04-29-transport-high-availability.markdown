---

title: Transport high availability
abstract: Failover systems and methods for providing redundant backup of data transmitted over a network to provide transport high availability of electronic data. The present invention relates to creating redundant backup copies of electronic data as well as transmission of the backup copies over a network in the event of a failure of a network component.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07681074&OS=07681074&RS=07681074
owner: Microsoft Corporation
number: 07681074
owner_city: Redmond
owner_country: US
publication_date: 20050429
---
Embodiments of the present invention relate to the field of transport high availability of electronic data. In particular embodiments of this invention relate to creating redundant backup copies of electronic data as the electronic data is received to provide a failover mechanism for transport of electronic mail.

Transport relates to both the quality of service and accurate delivery of electronic data. Specifically transport involves the accurate delivery of data from a source to a target location. High availability relates to a computer system or component thereof that remains operational in spite of a component failure in the system. Thus the present invention relating to transport high availability generally refers to systems and methods that maintain the accurate delivery of electronic data over a computer network in the event of a failure of a component within the network.

Some prior systems periodically back up electronic data on a regular or snapshot basis such as a nightly backup of electronic data stored on a system. Such systems capture the electronic data that are located on a server at a particular time for example at the end of a business day. However while these systems and methods may backup electronic data that remains at a specific location such as text documents or database files specific to a local company site such prior systems and methods fail to capture electronic data that only temporarily resides on a server as it is transmitted from a source location to a target location on a network. An example of such data includes email messages or other electronic data that pass through several servers on a network as the data is sent or transmitted from a source server to a target server. Since transmitted data may be stored at a particular server for only a fraction of a day before being forwarded to another server and deleted a nightly download would not adequately backup the electronic data in the event a component fails in the network.

Accordingly a system for transport high availability is desired to address one or more of these and other disadvantages.

The present invention overcomes the deficiencies of the known art by providing a transport high availability system and method wherein transmitted electronic data is received by a first device and redundantly backed up to a second device prior to the first device confirming receipt of the data. Thus if the first device fails prior to sending the data to a subsequent device the data can be recovered and forwarded to the subsequent device on the data s path to a target without loss of data.

In accordance with the present invention one aspect provides a computer implemented method for redundantly saving electronic data transported over a computer network. The method includes receiving the data at a location from a source. The data received from the source is saved to a primary computing device. Primary backup data corresponding to the saved data is saved to a secondary computing device remote from the location. The method also includes confirming when the primary backup data is saved to the secondary computing device and confirming to the source that the data has been received.

Another aspect of the present invention includes a system for providing recovery of electronic data transported over a computer network wherein the network connects a source server and a target server. The system comprises a primary server for receiving data from a source server and storing the received data in a primary server memory area and a secondary server remote from the primary server. The primary server is configured to execute computer executable instructions for receiving data from the source server saving data to the primary server memory area and sending primary backup data corresponding to data received from the source server to the secondary server. The secondary server is configured to execute computer executable instructions for receiving primary backup data saving primary backup data to a secondary server memory area and providing confirmation to the primary server when the primary backup data has been saved.

Another aspect of the present invention includes computer readable media having computer executable components for providing high availability transport of electronic data. The components comprise a primary component receiving data from a source and storing the received data in primary storage a storage component saving data to a remote computer device and confirming it has been saved and a source component confirming to the source that the data has been received.

Referring first to a block diagram illustrates an exemplary embodiment of a system in which one embodiment of the present invention may be implemented. A system has source primary secondary and target all having access to network . Primary has access to primary storage and secondary has access to secondary storage in which data may be stored. Secondary and secondary storage may be remotely located from primary and primary storage .

Source transmits data via network for ultimate receipt by target . Primary is an intermediate data transfer device within the pathway of network through which data is transferred as it is sent from source to target . Primary receives data from source via network . Primary stores data in primary storage and sends a copy of the data to secondary for backup storage in the event that a failure of primary should occur. Secondary saves a backup copy of the data to secondary storage . Secondary confirms to primary when a backup copy of the data has been saved. As used herein a confirmation action relates to a receiving device that sends a confirmation to a sending device that an action has been taken by the receiving device. Once confirmation has been made that a backup copy of data exists primary provides confirmation to source that it has received the data. Primary then transfers the data via network to the next data transfer device in the pathway to target or alternatively directly to target .

In one embodiment primary sends the data directly to target . Target upon successfully receiving the data provides confirmation to primary that the data has been received. Upon being notified that the data has been successfully transferred and received by target primary deletes the copy of the data saved on primary storage . Primary notifies secondary that target confirmed the receipt of the data. Upon receiving notification of the confirmation by target secondary deletes the backup copy of the data saved on secondary storage .

In one embodiment primary sends the data directly to target . Target upon successfully receiving the data provides confirmation to primary that the data has been received. Upon being notified that the data has been successfully transferred and received by target primary notifies secondary that target confirmed the receipt of the data. Upon receiving notification of the confirmation by target secondary deletes the backup copy of the data saved on secondary storage . Primary then deletes the copy of the data saved on primary storage . An advantage of primary instructing secondary to delete its backup copy first is manifested during a failure wherein primary fails to tell secondary to delete the backup copy of the data saved on secondary storage .

In another embodiment primary transfers the data to the next transfer device in the pathway to target . Upon receipt of the data the next data transfer device similar to the process described above would save a copy to its local storage and send a backup copy to a remote device for saving a backup copy of the data. Once the next data transfer device receives confirmation that a backup copy has been saved it provides confirmation to primary that the data has been received. Primary having received confirmation that the data has been successfully transferred and received by the next transfer device deletes the copy of the data saved on primary storage . Primary notifies secondary that the next transfer device has confirmed receipt of the data. Upon receiving notification of the confirmation by the next transfer device secondary deletes the backup copy of the data saved on secondary storage . This process is continued until the data is ultimately received by target .

In another embodiment a single message is relayed to multiple destinations and thereby follows a tree of delivery rather than a path.

At primary determines whether secondary has saved a backup copy of the data. If primary does not receive confirmation that secondary has saved a backup copy of the data primary proceeds to to determine whether secondary has failed. If primary determines that secondary has not failed primary again determines if secondary has saved a backup of data at .

If primary receives confirmation that a backup of data has been saved by secondary at primary provides confirmation at to source that the data has been received. Primary may optionally perform transformations on the data at . Primary may or may not relay these changes to secondary . Non limiting examples of optional transformations include expanding distribution lists adding Alternate recipients adding disclaimers removing viruses substituting addresses and the like. At primary sends the data to target . Non limiting examples of target include an computing device server component and the like that is the intended recipient of the transmitted data or alternatively a computing device server component and the like that is immediately downstream from primary in the pathway along a computer network from the initiating source to target recipient hereinafter collectively referred to as target .

At primary determines whether target has confirmed receipt of the data. If target has not confirmed receipt of the data primary again repeats the determination at until target has confirmed receipt of the data.

When target has confirmed the receipt of the data to primary at primary deletes the locally stored copy of the data on primary storage at . At primary provides to secondary confirmation that target received the data. Secondary then deletes the backup copy of the data at and the process of can be repeated.

If primary determines that a failure of secondary has occurred at primary determines if an alternative backup device is acquired at to remotely save primary backup data. If an alternative backup device is acquired primary confirms receipt of the data from source at .

If an alternative backup device is not acquired primary does not confirm receipt of data from source at and sends out all the data that it previously confirmed to target at .

At primary determines whether target has confirmed receipt of the data. If target has not confirmed receipt of the data primary again determines whether target has confirmed receipt of the data at . When primary determines that target has confirmed data primary deletes the locally stored copy of the data at .

At primary determines if the failure of secondary has been repaired such that secondary is operable again. Alternatively primary determines if an alternative backup device has been acquired to save backup data at a location remote from primary . If primary determines either that secondary is not operable that the operability of cannot be determined or that an alternative backup device has not been acquired primary repeats its determination at . Once primary determines that secondary is operable again or that an alternative backup device has been acquired at primary can receive data from source at confirm its receipt and repeat the process of .

Secondary determines whether primary has failed at . If primary has not failed secondary determines whether primary has received confirmation that data has been received by target at . If target has confirmed receipt of the data secondary deletes locally stored primary backup data at and the process of is repeated at . If primary has not received confirmation that target has received the data secondary again determines whether primary has failed at .

If secondary determines at that a failure of primary has occurred at secondary sends target all saved primary backup data. At secondary determines whether target has confirmed receipt of the primary backup data. If secondary determines that target has not confirmed receipt of the primary backup data secondary again repeats its determination at .

If secondary determines that target has confirmed the receipt of the primary backup data at secondary deletes the locally stored primary backup data that has been confirmed by target at .

Secondary determines if primary is operable at . If primary is not operable secondary repeats its determination at . If primary is determined to be operable the process of is repeated at .

The systems and methods of the present invention provide for transport high availability of electronic data that is transmitted over a network. In one embodiment secondary is remotely located from primary such that an event that may result in a failure of primary is unlikely to also cause the failure of secondary . For example primary and secondary may be located in different buildings different cities different countries or different continents. Alternatively primary and secondary may be located on separate power grids have separate backup power supplies be connected to different clusters in a computer network and the like.

A failure of a component may be determined through automated or manual methods. Some non limiting examples of automated methods include one component polling a second component one component determining the failure of a second component when transmitted notifications fail to be received voting mechanisms among multiple devices to determine network partition versus machine failure and the like. Human intervention may also identify the failure of a component such as when a communication links have been disrupted a server is known to be broken or in the process of beginning repaired and the like.

While disclose a primary and a secondary the present invention includes additional designs of primary and secondary components. In one embodiment the design of primary and secondary components form a ring wherein primary device sends primary data received from a source as primary backup data to secondary for remotely saving a backup copy of the primary data. Secondary in turn sends secondary data it receives from a source as secondary backup data to tertiary for remotely saving a backup copy of the secondary data. Tertiary in turn sends tertiary data it receives from a source as tertiary backup data to primary for remotely saving a backup copy of the tertiary data. Thus in this embodiment three devices are in a ring formation wherein they each locally save data received from a source and send a backup copy to a remote component to be saved remotely. This design can be altered to include additional devices in the ring. An illustration of one embodiment of this design is presented in . In this illustration the secondary databases are depicted as being located in the node to the right on the ring. In one aspect of the present invention bridgeheads are arranged in a ring with a single secondary database in each bridgehead.

In one embodiment upon failure of a server or node an SQL query can be performed to move the work from the secondary database to other existing bridgehead databases either primary or secondary. This operation may require manual intervention. Alternatively the operation may also occur automatically upon failure of a server or node. The bridgehead databases receiving the transferred backup data can then transmit the data to the appropriate target server or node.

In one embodiment the present invention is used as a failover design using SQL replication. In another embodiment the present invention is used as a failover design using an Edge Application Microsoft Corp. Redmond Wash. . Examples of these embodiments are illustrated in . SQL replicates all changes Edge application can optimize and batch changes to reduce latency or network load. The difference is the storage mechanism. Additionally there are many options that may be utilized including other file systems other databases log based file systems and so forth.

In another embodiment the failover design is in the form of a star rather than a ring. An illustration of this design is presented in illustrating one example of a failover design having a star design wherein one secondary device serves as a backup storage device for a plurality of primary devices. In this embodiment Server A Server B Server C and Server D which function as primary servers are arranged such that they each have access to Server E a secondary server. Server E is utilized to which remotely backup data received by Server A Server B Server C and Server D.

In another embodiment storage area network SAN based storage of data is used wherein the hard disk storage for backup data is remotely located. San devices can be attached to a machine virtually and so reduce manual intervention to move storage from one compute node to another. SAN devices allow resources to be shared more effective among compute devices

The present invention is not limited to a single transfer protocol. A non limiting list of protocols which may be used to transfer data through a network and between source primary secondary and target include SMTP TSQL CIFS HTTP and FTP x400 fax among others. Data transfer may also be transmitted over the internet via TCP wirelessly sent to another device or server or document processing system office automation system order processing system and the like. An illustration of a block diagram illustrating one example of a SMTP Geo Cluster arrangement is provided in . In this design a primary node has access to the internet a corporate intranet and a secondary node. In such a design a primary node can receive and send data between the internet an a corporate intranet while maintaining transport high availability.

The present invention may be used as a method for transport high availability in a single cluster of devices or servers located in a building. Alternatively the present invention may be used as a method for transport high availability in two or more clusters of devices or servers located in a single geographic location such as a building corporate campus or city. In another embodiment the present invention may be used on a network such as a corporate network or university network that includes devices or servers in multiple states countries or continents. In yet another embodiment devices or servers may be connected through the internet.

The computer typically has at least some form of computer readable media. Computer readable media which include both volatile and nonvolatile media removable and non removable media may be any available medium that may be accessed by computer . By way of example and not limitation computer readable media comprise computer storage media and communication media. Computer storage media include volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. For example computer storage media include RAM ROM EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical disk storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium that may be used to store the desired information and that may be accessed by computer . Communication media typically embody computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and include any information delivery media. Those skilled in the art are familiar with the modulated data signal which has one or more of its characteristics set or changed in such a manner as to encode information in the signal. Wired media such as a wired network or direct wired connection and wireless media such as acoustic RF infrared and other wireless media are examples of communication media. Combinations of any of the above are also included within the scope of computer readable media.

The system memory includes computer storage media in the form of removable and or non removable volatile and or nonvolatile memory. In the illustrated embodiment system memory includes read only memory ROM and random access memory RAM . A basic input output system BIOS containing the basic routines that help to transfer information between elements within computer such as during start up is typically stored in ROM . RAM typically contains data and or program modules that are immediately accessible to and or presently being operated on by processing unit . By way of example and not limitation illustrates operating system application programs other program modules and program data .

The computer may also include other removable non removable volatile nonvolatile computer storage media. For example illustrates a hard disk drive that reads from or writes to non removable nonvolatile magnetic media. also shows a magnetic disk drive that reads from or writes to a removable nonvolatile magnetic disk and an optical disk drive that reads from or writes to a removable nonvolatile optical disk such as a CD ROM or other optical media. Other removable non removable volatile nonvolatile computer storage media that may be used in the exemplary operating environment include but are not limited to magnetic tape cassettes flash memory cards digital versatile disks digital video tape solid state RAM solid state ROM and the like. The hard disk drive and magnetic disk drive and optical disk drive are typically connected to the system bus by a non volatile memory interface such as interface .

The drives or other mass storage devices and their associated computer storage media discussed above and illustrated in provide storage of computer readable instructions data structures program modules and other data for the computer . In for example hard disk drive is illustrated as storing operating system application programs other program modules and program data . Note that these components may either be the same as or different from operating system application programs other program modules and program data . Operating system application programs other program modules and program data are given different numbers here to illustrate that at a minimum they are different copies.

A user may enter commands and information into computer through input devices or user interface selection devices such as a keyboard and a pointing device e.g. a mouse trackball pen or touch pad . Other input devices not shown may include a microphone joystick game pad satellite dish scanner or the like. These and other input devices are connected to processing unit through a user input interface that is coupled to system bus but may be connected by other interface and bus structures such as a parallel port game port or a Universal Serial Bus USB . A monitor or other type of display device is also connected to system bus via an interface such as a video interface . In addition to the monitor computers often include other peripheral output devices not shown such as a printer and speakers which may be connected through an output peripheral interface not shown .

The computer mayoperate in a networked environment using logical connections to one or more remote computers such as a remote computer . The remote computer may be a personal computer a server a router a network PC a peer device or other common network node and typically includes many or all of the elements described above relative to computer . The logical connections depicted in include a local area network LAN and a wide area network WAN but may also include other networks. LAN and or WAN may be a wired network a wireless network a combination thereof and so on. Such networking environments are commonplace in offices enterprise wide computer networks intranets and global computer networks e.g. the Internet .

When used in a local area networking environment computer is connected to the LAN through a network interface or adapter . When used in a wide area networking environment computer typically includes a modem or other means for establishing communications over the WAN such as the Internet. The modem which may be internal or external is connected to system bus via the user input interface or other appropriate mechanism. In a networked environment program modules depicted relative to computer or portions thereof may be stored in a remote memory storage device not shown . By way of example and not limitation illustrates remote application programs as residing on the memory device. The network connections shown are exemplary and other means of establishing a communications link between the computers may be used.

Generally the data processors of computer are programmed by means of instructions stored at different times in the various computer readable storage media of the computer. Programs and operating systems are typically distributed for example on floppy disks or CD ROMs. From there they are installed or loaded into the secondary memory of a computer. At execution they are loaded at least partially into the computer s primary electronic memory. The invention described herein includes these and other various types of computer readable storage media when such media contain instructions or programs for implementing the steps described below in conjunction with a microprocessor or other data processor. The invention also includes the computer itself when programmed according to the methods and techniques described herein.

For purposes of illustration programs and other executable program components such as the operating system are illustrated herein as discrete blocks. It is recognized however that such programs and components reside at various times in different storage components of the computer and are executed by the data processor s of the computer.

Although described in connection with an exemplary computing system environment including computer the invention is operational with numerous other general purpose or special purpose computing system environments or configurations. The computing system environment is not intended to suggest any limitation as to the scope of use or functionality of the invention. Moreover the computing system environment should not be interpreted as having any dependency or requirement relating to any one or combination of components illustrated in the exemplary operating environment. Examples of well known computing systems environments and or configurations that may be suitable for use with the invention include but are not limited to personal computers server computers hand held or laptop devices multiprocessor systems microprocessor based systems set top boxes programmable consumer electronics mobile telephones network PCs minicomputers mainframe computers distributed computing environments that include any of the above systems or devices and the like.

The invention may be described in the general context of computer executable instructions such as program modules executed by one or more computers or other devices. Generally program modules include but are not limited to routines programs objects components and data structures that perform particular tasks or implement particular abstract data types. The invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules may be located in both local and remote computer storage media including memory storage devices.

An interface in the context of a software architecture includes a software module component code portion or other sequence of computer executable instructions. The interface includes for example a first module accessing a second module to perform computing tasks on behalf of the first module. The first and second modules include in one example application programming interfaces APIS such as provided by operating systems component object model COM interfaces e.g. for peer to peer application communication and extensible markup language metadata interchange format XMI interfaces e.g. for communication between web services .

The interface may be a tightly coupled synchronous implementation such as in Java 2 Platform Enterprise Edition J2EE COM or distributed COM DCOM examples. Alternatively or in addition the interface may be a loosely coupled asynchronous implementation such as in a web service e.g. using the simple object access protocol . In general the interface includes any combination of the following characteristics tightly coupled loosely coupled synchronous and asynchronous. Further the interface may conform to a standard protocol a proprietary protocol or any combination of standard and proprietary protocols.

The interfaces described herein may all be part of a single interface or may be implemented as separate interfaces or any combination therein. The interfaces may execute locally or remotely to provide functionality. Further the interfaces may include additional or less functionality than illustrated or described herein.

Server A B and C are located remotely from each other on a network and form a ring of backup servers to each other. Server A receives data from Source A that is being sent to Target A. Server A sends data received from Source A to Server B for remote backup storage A backup data . Server B receives data from Source B that is being sent to Target B. Server B sends data received from Source B to Server C for remote backup storage B backup data . Server C receives data from Source C that is being sent to Target C. Server C sends data received from Source C to Server A for remote backup storage C backup data .

Server B fails. Server A which sends A backup data to Server B determines that Server B has failed. Server A immediately ceases confirming receipt of additional data from Source A. Server A then begins sending the data received from Source A which it has confirmed receipt and saved locally to Target A. Server A does not confirm the receipt of additional data sent by Source A until either it determines that Server B is again able to receive and store A backup data or Source A acquires another server to provide remote storage of A backup data.

Server C which receives B backup data from Server B determines that Server B has failed. Server C immediately begins sending to Target B all the

B backup data that is saved in Server C s storage. Server C queues of B backup data are continued to be transferred to Target B until either the queue is empty or Server C determines that Server B is properly functioning again and able to send data to Target B.

Once Server B has been repaired or restored to functionality Server B can perform its function of saving A backup data and transferring data received from Source B to Target B. Server B can send the data that is still remaining in Server C queues of B backup data that have not been already been transferred to Target B by Server C.

The order of execution or performance of the methods illustrated and described herein is not essential unless otherwise specified. That is elements of the methods may be performed in any order unless otherwise specified and that the methods may include more or less elements than those disclosed herein. For example it is contemplated that executing or performing a particular element before contemporaneously with or after another element is within the scope of the invention.

When introducing elements of the present invention or the embodiment s thereof the articles a an the and said are intended to mean that there are one or more of the elements. The terms comprising including and having are intended to be inclusive and mean that there may be additional elements other than the listed elements.

In view of the above it will be seen that the several objects of the invention are achieved and other advantageous results attained.

As various changes could be made in the systems and methods without departing from the scope of the invention it is intended that all matter contained in the above description and shown in the accompanying drawings shall be interpreted as illustrative and not in a limiting sense.

