---

title: Method of reconstructing computed tomography (CT) volumes suitable for execution on commodity central processing units (CPUs) and graphics processors, and apparatus operating in accord with those methods (rotational X-ray on GPUs)
abstract: The invention provides in one aspect methods and apparatus for use with C-arm and other CT systems, e.g., with non-rigid geometries. In such systems, by way of example, calibration can be performed to determine the exact position of the x-ray source and the exact orientation of the detector where each projection measurement is made. Next, a weighting coefficient can be determined for the voxels in each plane of a reconstruction volume at every possible projection. Finally, the order in which to process the voxels during image reconstruction can be determined. Following an actual CT scan procedure in which scans are obtained of a volume to be constructed, a system according to these and related aspects of the invention can use an optimal, pre-calculated processing method, while utilizing offsets and weighting coefficients determined during calibration, for performing backprojection image reconstruction.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07778392&OS=07778392&RS=07778392
owner: PME IP Australia Pty Ltd
number: 07778392
owner_city: Richmond, Victoria
owner_country: AU
publication_date: 20051101
---
This application claims priority to U.S. Provisional Patent Application Ser. No. 60 624 465 entitled Method of Reconstructing Computed Tomography CT Volumes Suitable For Execution On Commodity. Central Processing Units CPUs And Graphics Processors And Apparatus Operating In Accord With Those Methods Rotational X Ray on GPUs filed Nov. 2 2005 the teachings of which are incorporated herein by reference.

The present invention relates to digital data processing and particularly to computed tomography CT . It has application by way of non limiting example in systems and methods of CT volume reconstruction by use of backprojection on central processing units CPUs and graphic processing units GPUs e.g. in health care and more particularly by way of non limiting example in medical diagnostics defense airline and biology industries to name but a few.

A computerized axial tomography CAT or computed tomography CT scan is a procedure used for visualizing features throughout the interior of opaque solid objects. The most traditional use is for imaging the human body as a medical diagnostic tool. CT scanning also has applicability to a variety of other industries including but not limited to defense airline and biology industries. A typical CT scan system is formed of a radiation source such as an x ray tube a radiation detector and a computer system. The radiation source and detector are positioned on opposite sides of an object to image. A beam of radiation is then projected from the source towards the detector and those photons not absorbed in the object are transmitted toward and impact on the detector. The result is an image on the detector that represents a two dimensional projection image of the object from the current position. The source and radiation detector are rotated around the object typically 180 or 360 during which the imaging process is repeated at a number of intermediate positions so that a series of two dimensional images of the object over a range of angular orientations is acquired. A series of these projection images is then fed from the detector into the computer system. The computer system can then use these two dimensional projections to create various reconstructions of the object.

This concept is known as image reconstruction and there are a variety of mathematical algorithms that can be used to accomplish this. Feldkamp backprojection algebraic reconstruction technique ART and maximum likelihood expectation maximization MLEM are three such examples. Most algorithms are based on the assumption that a large number of projection measurements are made such that every point in the object is included in radiation paths from many angles. Feldkamp backprojection is a common reconstruction technique in which projection data is first convolved with a filter and each view is successively superimposed over a square grid which represents the volume that was imaged at an angle that corresponds to its acquisition angle.

One example of backprojection is illustrated in U.S. Pat. No. 6 324 241 entitled Method and apparatus for CT reconstruction which is said to describe a method for reconstructing a scanned CT image that includes the steps of acquiring projection data of an object by use of a flat panel detector and filtering and back projecting the projection data in order to reconstruct a three dimensional image of the object. That patent purports to provide for direct fan parallel and three dimensional reconstruction of computed tomographic images without loss of resolution associated with radial interpolation while retaining imaging quality and backprojection speed gains associated with parallel reconstruction.

While the 241 patent is among the prior art that provides means for performing backprojections depending on the size of the object to image and the number of projections acquired filtered backprojection can be a time and computation intensive process. Presently the time required for most CT scan systems to perform acquisition and reconstruction of an 512 512 512 voxel object reconstructed from a collection of 500 512 512 projection images is in the order of one hour on a high end workstation.

Conventional spiral CT scan machines have large extremely rigid toroidal shaped gantries. To image an object or a patient the patient is passed through the machine via a moving table. The radiation source and detector s travel around the gantry and completely encircle the object or patient while it is moved through the machine. While conventional CT scanners are still widely used they have a number of drawbacks. The closed toroidal shape of the gantry does not allow a physician easy access to a patient while the patient is in the imaging device. Furthermore conventional CT scanners are large and very expensive machines. An alternative design is a free standing C arm based CT scanning system in which the radiation source and detector are suspended masses attached to an open C arm that moves in an orbit around the patient in a variety of orientations. C arm based systems are smaller and less expensive than are conventional CT scan machines. However because the source and detector of C arm based CT scanning systems are supported by fairly long arms a typical C arm arc has about a 6 foot diameter as the system rotates around the object to image the movements of the source and detector do not conform rigidly to a perfectly circular orbit. The location of the source can be modeled to have just three degrees of freedom however the orientation of the detector must also be considered so that it moves effectively with six degrees a freedom. This creates a problem as the trajectory of the source and the detector rarely represent a true circular orbit which is a requirement for using Feldkamp backprojection image reconstruction. Therefore acquired projection data might be different from that which was expected.

It is therefore an object of this invention to provide improved methods and apparatus for digital data processing and more particularly computed tomography.

A related object of the invention is to provide such methods and apparatus as improve the speed at which CT computer systems perform three dimensional reconstruction particularly for example by backprojection.

It is yet another object of this invention to provide such methods and apparatus as maintain a cost effective approach when the CT computer system is used in processing.

A further object of the invention is to provide such methods and apparatus as are suitable for use with non rigid CT scanning systems such as those that employ C arms.

The foregoing are among the objects attained by the invention which provides in some aspects improved methods and apparatus for digital data processing and more particularly computed tomography volume reconstruction e.g. by backprojection. These can be implemented by way of non limiting example on commodity central processing units and graphics processors.

In one such aspect the invention provides such methods and apparatus for use with C arm and other CT systems e.g. with non rigid geometries. In such systems by way of example calibration can be performed to determine the exact position of the x ray source and the exact orientation of the detector where each projection measurement is made. Next a weighting coefficient can be determined for the voxels in each plane of a reconstruction volume at every possible projection. Finally the order in which to process the voxels during image reconstruction can be determined. Following an actual CT scan procedure in which scans are obtained of a volume to be constructed a system according to these and related aspects of the invention can use an optimal pre calculated processing method while utilizing offsets and weighting coefficients determined during calibration for performing backprojection image reconstruction.

Related aspects of the invention provide such methods and apparatus in which one or more of the foregoing computations are executed on a commodity graphical processing unit GPU or other coprocessor and or central processing unit.

Still other aspects of the invention provide methods and apparatus as described above in which pre calculation of mathematical corrections for geometric distortion of non rigid CT systems such as those employing C arms is performed by execution of one of more of the following steps i calculating central axis of rotation ii defining a coordinate system of reconstruction volume iii calculating a resampled detector plane iv defining source normal ray and or v calculating and storing offset.

Yet still other aspects of the invention provide methods and apparatus as described above in which pre calculation of a weighting coefficient for projection voxels is performed by execution of one or more of the following steps i moving to a projection position e.g. by aligning the radiation source and detector at a given projection position ii calculating S offset value iii building linear array of w values for S iv storing w values and v looping back to perform these steps for another projection.

Yet other aspects of the invention provide such methods and apparatus in which pre calculation for determining the optimal order in which to process individual voxels for backprojection reconstruction is performed by executing one or more steps which can include i defining brick size ii defining projection sets iii building a table of u axis and v axis coordinates at which each brick in reconstruction volume of interest will be projected onto resampled detector plane iv defining an order to process bricks e.g. based on each brick s proximity to one another when projected on resampled detector plane v defining an order to process voxels including selecting a primary axis to occupy consecutive locations in memory of digital data processor and vi determining whether there are further bricks to process.

Still yet other aspects of the invention provide such methods and apparatus in which backprojection reconstruction is performed by executing one or more steps which can include i choosing a slab e.g. a plane of bricks to process ii choosing a set of projections over which calculations will be performed as determined for example during a prior pre calculation stage iii loading data from projection images iv performing geometric normalization of a current slab v performing one dimensional pre correction for Feldkamp backprojection of the current slab of data vi choosing a brick in the current slab of reconstruction volume of interest to process e.g. with u axis and v axis projection coordinates ordered as determined in during a prior pre calculation stage vii choosing x and y coordinates to process e.g. with coordinate ordering determined in during a prior pre calculation stage xii determining a weighting coefficient e.g. in accord with a prior pre calculation stage xiii choosing a z coordinates of voxels in a current brick to process e.g. in accord with an ordering determined during prior pre calculation stage and ix calculating intensity value of each voxel along the current z coordinate for the selected x and y coordinates of the current brick.

Still other aspects of the invention provide methods and apparatus as described above that take advantage of recognition that perspective projection of a linear vector in the volume to the projection data is nearly linear over short sections of the volume and as such a linear interpolation is an acceptable approximation. By decomposing the reconstruction volume into a set of small bricks systems and methods according to the invention can reduce the number of projection calculations by a factor that is equal to the number of voxels in a brick. This allows the address generation of the individual source data pixels to be performed by the vertex shaders of a GPU. This technique also allows the GPU s iterators to calculate the resampling coordinates and this further allows our implementation to employ the bilinear resampling hardware that is built into the GPU pipeline. In this way the projection data can be accessed as a simple independent rather than dependent read of the GPU s texture memory.

Methods and systems according to the invention have numerous advantages among which are that they can perform acquisition and reconstruction in real time such as a system that produces a continuous stream of two or three dimensional reconstructions of an object. One application for such systems and methods are for physicians performing image guided surgery.

Such systems and methods also decrease the time it takes for a computer system to perform backprojection and other image reconstruction methods for computed tomography. Furthermore they permit this to be done cost effectively e.g. without specialized CT hardware.

Moreover such systems provide for determining the effect that a non circular orbit has on C arm and other image acquisition equipment thereby allowing the volume reconstruction data processor to compensate for such effects and furthermore to transfer such projection sets into a usable form for backprojection e.g. by the Feldkamp technique .

Yet still other aspects of the invention provide a computerized tomography CT system which includes an image acquisition apparatus which further includes a C arm a radiation source a detector a patient or subject of interest and a reconstruction volume of interest a plurality of projection images and a digital data processor which further includes a random access memory RAM an input output I O channel a central processing unit CPU a graphics processing unit GPU and a personal computer PC bus. The GPU further includes a personal computer PC bus interface a GPU bus a GPU RAM a geometric mapping section which further includes a plurality of vertex shaders and a pixel processing section which further includes a render target direct memory access DMA engine a plurality of filters and a plurality of pixel shaders.

Still yet other aspects of the invention provide methods for operation of the foregoing and other CT systems including the steps of pre calculating a transform to normalize geometry pre calculating a matrix of weight coefficients pre calculating an optimal brick order acquiring projection image data and performing backprojection.

Yet still other aspects of the invention provide a CT system as described above for performing geometric calibration which includes a plurality of detector image points a plurality of resampled detector planes a plurality of resampled center points a resampled circle a z axis a u axis a v axis a x axis a y axis a angle an S offset a T offset a source normal ray and an f f intercept.

A method of performing geometric calibration on such and other CT system can include the steps of calculating a central axis of rotation defining a coordinate system of the reconstruction volume calculating a resampled detector plane defining a projection normal and calculating and storing a matrix of S and T offsets and their corresponding weighting coefficient w .

According to still further aspects of the invention a CT system as described above can include means for calculating a weighting coefficient which means includes a source to image distance SID a source to object distance SOD an fcalculation and an r calculation and a plane with a constant SOD SID ratio. A method of calculating a weighting coefficient includes the steps of moving to a projection position calculating a w value building a linear array of w values for S storing w values and repeating for additional projections.

In still further aspects of the invention a CT system as described above can include means for pre calculating the optimal order in which to process individual voxels includes a plurality of bricks each of which contain a plurality of voxels and a resampled detector plane which further includes a plurality of brick shadows. A method of pre calculating the optimal order in which to process individual voxels can include the steps of defining the brick size defining the projection sets building a u v table for all bricks defining the order in which to process bricks defining the order in which to process voxels and repeating for additional bricks.

Yet still other aspects of the invention provides systems and methods as described above in which the performance of backprojection image reconstruction includes the steps of choosing a slab choosing a projection set loading data performing geometric normalization performing one dimensional pre correction choosing a brick choosing an X coordinate choosing a Y coordinate determining a weight coefficient choosing a Z coordinate calculating an intensity value determining whether to repeat for voxels along the z axis determining whether to repeat for voxels along the y axis determining whether to repeat for voxels along the x axis determining whether to repeat for other bricks determining whether to repeat for other projection sets and determining whether to repeat for other slabs.

The present invention is a system for and method of reconstructing CT volumes by use of backprojection on commodity central processing units and graphics processors. The CT system periodically performs pre calculations and stores the resulting information. First for systems with non rigid geometries calibration is performed to determine the exact position of the x ray source and the exact orientation of the detector where each projection measurement is made. Next a weighting coefficient is determined for every voxel in each plane of a reconstruction volume for every possible projection. Finally the order in which to process each voxel during image reconstruction is determined. Following an actual CT scan procedure the computer system of the present invention uses the optimal pre calculated processing method while utilizing offsets and weighting coefficients for performing backprojection image reconstruction.

Digital data processor represents a conventional workstation personal computer server or other computing device as is well known in the art which is responsible for controlling image acquisition apparatus capturing and storing projection images and performing image reconstruction. Digital data processor contains conventional input output channel which is used for communicating with image acquisition apparatus . RAM represents conventional memory used by the common processes of digital data processor whereas other memory used specifically for image processing will be described in reference to . CPU is a conventional general purpose processor unit that is also well known in the art. GPU is coupled with and provides assistance to CPU as a coprocessor. It is also understood that digital data processor may contain one or more GPUs . GPU represents a conventional graphics processor such as those offered by ATI or NVidia which is used specifically for performing computation intense graphic functions and thus lightens the processing load of CPU . The specific architectural components of GPU are described in more detail with reference to . All components within digital data processor communicate via conventional PC bus . PC bus is a group of connections or circuits over which multiple computing elements of digital processor communicate with one another.

Additional components of GPU are divided into geometric mapping section and pixel processing section . Geometric mapping section is responsible for mapping the three dimensional geometry of reconstruction volume of interest to the two dimensional geometry of a plurality of projection images during processing calculations such as image reconstruction. A plurality of vertex shaders alternately known in the art as vertex processors manipulate three dimensional vertex data values of reconstruction volume of interest or smaller sub elements of reconstruction volume of interest to be described in detail as bricks in reference to . Vertex shaders are graphical processing functions of graphical processing units such as GPU that change the vertex values of graphical data data such as color textures or positions in space. It is understood that because vertex shaders operate as n way single instruction multiple data SIMD processors additional processors that have greater or lesser processing speeds may be used to realize the invention especially in future implementations of GPU .

Source texture DMA engine allows the transfer of data from one memory area of digital data processor to pixel shaders via GPU bus without the need to go through CPU . A plurality of filters one for each pixel shader provide interpolation and other filtering functions on projection images during processing calculations such as image reconstruction. Pixel shaders alternately known in the art as pixel processors are data processing agents imbedded within graphical processing units such as GPU that change the pixel values of graphical data. Pixel shaders are responsible for calculating the values of voxels of a portion of projection images . The operation of pixel shaders are such that data is distributed into pixel shaders on a pixel by pixel or voxel by voxel basis and they work on consecutive pixels or voxels in a volume such as a reconstruction volume of interest . Additional optimization techniques for processing pixels and or voxels are presented in more detail in reference to B and . While a plurality of eight pixel shaders is shown it is understood that additional processors that have greater or lesser processing speeds may be used to realize the invention especially in future implementations of GPU . Render target DMA engine provides an additional direct memory engine for transferring data from pixel shaders back to GPU memory such as GPU RAM without the need to go through CPU .

In operation image acquisition apparatus generates a plurality of projection images by projecting radiation from radiation source through patient or subject of interest and reconstruction volume of interest to detector at a number of different angles or projection positions. The various projection positions of radiation source and detector with respect to reconstruction volume of interest are achieved through the mechanical rotation performed by a C arm . Projection images are collected by CPU of digital data processor and are stored in either short term RAM or written to long term storage not shown . Digital data processor performs image reconstruction by transferring projection images data from RAM to GPU . Vertex shaders map three dimensional geometric information of the projection data while pixel shaders perform read and write and arithmetic functions that change pixel and or voxel values of the reconstruction volume and projection images data.

In this step for non rigid C arm based CT systems prior to an actual CT scan procedure digital data processor pre calculates a transform to normalize the geometry of the non circular orbit of image acquisition apparatus . The preferred implementation of this step involves imaging a calibration phantom at various projection positions to compare the projected results of targets within the phantom to the expected results. This process is described in complete detail in reference to Method . Method proceeds to step .

In this step digital data processor pre calculates a weighting coefficient for each voxel in reconstruction volume of interest for each projection position. This weighting accounts for the positioning of material throughout the volume as positioning impacts the amount of radiation absorbed and the projection shadow cast on detector . Because reconstruction volume of interest encompasses patient or subject of interest during an actual CT scan procedure each weighting coefficient can be calculated prior to the actual procedure. The preferred implementation of this step involves calculating a weighting coefficient as a function of the distance from radiation source to reconstruction volume of interest the angle of the projection position and if necessary the transform to normalize the geometry of non rigid CT scanning systems as described in Step . This method requires calculating only a single plane of weighting coefficients per projection rather than an entire volume of weighting coefficients and will be described in complete detail in reference to Method . Method proceeds to step .

In this step digital data processor pre calculates the optimal order in which GPU should process projection images of reconstruction volume of interest during a reconstruction process. The preferred implementation of this step involves dividing reconstruction volume of interest into sections known as bricks and processing bricks sequentially based on the proximity of each brick s image data on projection image . Furthermore the optimal order in which GPU processes individual voxels of each brick is calculated. This process is described in complete detail in reference to Method . Method proceeds to step .

In this step digital data processor acquires and stores projection images data as image acquisition apparatus performs a CT scan process on patient or subject of interest across each projection position. Method proceeds to step .

In this step digital data processor performs backprojection to reconstruct a three dimensional representation of reconstruction volume of interest . The preferred implementation of this step involves dividing reconstruction volume of interest into cross sections known as slabs and processing voxels on a brick by brick basis for each slab across a set of projection images using the optimal order to process both bricks and voxels as described in Step . Results of pre calculation steps and are further used in step . This process is described in complete detail in reference to Method . Method ends.

Many CT systems utilize a C arm or other non rigid structure in which the position of radiation source and detector are subject to aforementioned geometric distortions. While there may be numerous methods that compensate for such distortion the following describes the preferred embodiment of the invention. illustrates CT system at three different projection positions during a system calibration process. System calibration is performed as preparation for operation in a specific orientation. This is done before the actual imaging process begins. A conventional calibration object alternatively known as a calibration phantom in the art is placed in the position in which a real patient or subject of interest would be imaged. Typically the calibration scan replicates the number of projection positions used during the system s intended operation. Each projection position and the resulting projection image is denoted as P where Pindicates the first projection position and Pindicates the last. A calibration phantom is an object of simple geometry such as a cube or sphere designed to allow for the assessment of volumetric measurement accuracy. With respect to the calibration phantom is illustrated as reconstruction volume of interest . The calibration phantom contains a number of high density targets whose true geometry is known. While six targets will suffice to compensate for a detector that moves with six degrees of freedom in the preferred embodiment of the invention a calibration phantom with eight or more targets is assumed. The expected target locations can be compared to the actual projected targets and a mathematical table of projection offsets can be calculated.

Note that at P detector is not tangential to a true circular orbit that passes through detector at the other two projection positions. Additionally note that the ray extending from radiation source to detector passes through reconstruction volume of interest but not the exact center of the volume. Although these positions are perhaps exaggerated for illustrative purposes they are representative of some of the common geometric distortions that occur in which radiation source and or detector wobbles during projection acquisition and therefore a slightly different projection image is acquired from that which was expected.

By comparing the expected target locations of a calibration phantom with the actual projected targets the true location of detector can be determined with respect to its six degrees of freedom and thus a detector image point can also be determined. With respect to this is illustrated as detector image point at projection position P. A true circle illustrated as resampled circle can be fit to these points to minimize the root mean square RMS error of the collective detector image points. Resampled circle is further illustrated from a side perspective in . The coordinate system of resampled circle is therefore established. The central axis of rotation of resampled circle passes through its center point and is illustrated as z axis . X axis and y axis form a plane perpendicular to z axis and parallel to the plane of resampled circle as illustrated in . It is important to note that both x axis and y axis remain fixed relative to reconstruction volume of interest at the original projection position P.

With respect to note that at each projection position detector is not tangential to resampled circle . Therefore a new plane must be established that is tangential to resampled circle at each projection position. This plane is represented as a resampled detector plane and is illustrated in as resampled detector plane at projection P. The coordinate system of each resampled detector plane can then be established as illustrated in . U axis is perpendicular to z axis and is parallel to a tangent of resampled circle . V axis is parallel to z axis and passes through the point of tangency at resampled circle . It is important to note that both v axis and u axis are relative to the resampled detector plane at each projection position. The intersection of u axis and v axis at each projection is the resampled center point and is illustrated in as resampled center point . Note that the ray originating at radiation source and extending through reconstruction volume of interest is parallel to x axis but does not typically intersect v axis or u axis . This ray illustrated as source normal ray passes through resampled detector plane at some offset from v axis and u axis illustrates this as f f intercept .

In this step digital data processor calculates the optimal central axis of rotation. While there are numerous models for performing this calculation the preferred method is described here. For each calibration projection as defined by P radiation source and detector are positioned to their respective locations around a calibration phantom shown as reconstruction volume of interest . Radiation source projects x ray energy towards reconstruction volume of interest . Those photons not absorbed in reconstruction volume of interest are transmitted toward and impact on detector . Digital data processor compares the expected target locations of reconstruction volume of interest which are known a priori and stored in long term memory not shown of digital data processor with the actual projected targets acquired. Once all target locations are compared and detector image points are calculated and stored for all projection positions digital data processor uses a conventional mathematical algorithm such as the Gauss Newton method for finding the Least Mean Square fit to calculate a best fit circle that minimizes the RMS of all detector image points. This best fit circle is illustrated as resampled circle . The plane that runs perpendicular to resampled circle and extends through its center point is calculated as the central axis of rotation shown as z axis . While there are other methods for calculating the central axis of rotation each method will always define a resampled circle and z axis. Method proceeds to step .

In this step digital data processor calculates and stores the coordinate system of reconstruction volume of interest . With respect to x axis is calculated as the plane that is aligned with resampled circle and intersects the mid point of resampled circle . Y axis is calculated as the plane that is aligned with resampled circle and passes through the mid point of reconstruction circle . Both x axis and y axis remain fixed with respect to the original position Pof reconstruction volume of interest . Method proceeds to step .

In this step for each projection position P digital data processor calculates and stores a resampled detector plane that is tangential to resampled circle . This calculation is performed by comparing the actual projected targets of reconstruction volume of interest with the expected targets and then aligning detector with resampled circle . illustrates three different examples of actual detector positions and their respective positions after resampling is performed. Method proceeds to step .

In this step for each projection position P digital data processor calculates and stores source normal ray which is calculated as the line that lies in the same plane as resampled circle and which passes through the center point of resampled circle and intersects the resampled center point of the resampled detector plane which is illustrated as resampled detector plane in . Method proceeds to step .

In this step for each projection position P digital data processor defines and calculates angle as the difference between x axis and S axis . Using angle digital data processor can also define and calculate the position of any voxel x y z in reconstruction volume of interest for any projection position P. This position is a function of S offset and T offset . S offset is calculated as S x cos y sin . T offset is calculated as T x sin y cos . Method ends.

While B and compensate for geometric distortion of non rigid CT systems the remaining aspects of the invention apply to any system in which backprojection is performed.

In reference to as radiation source and detector rotate around reconstruction volume of interest the distance from any voxel in reconstruction volume of interest to both radiation source and resampled detector plane varies. As a result the shadow size cast onto resampled detector plane correlates to the distance from radiation source to reconstruction volume of interest and from reconstruction volume of interest to resampled detector plane . Therefore a weighting coefficient must be calculated for each voxel in reconstruction volume of interest and factored when backprojection calculations are performed. Because these weights are a function of the geometry of the system and are not dependent on the actual projection data values these weights can be calculated prior to an actual CT scan procedure and stored in digital data processor .

With reference to the calculation of the weighting coefficient varies depending on whether the orbit of image acquisition apparatus is a circular or a non circular trajectory. For circular trajectories the weighting coefficient is a function of a source to object distance calculation represented as SOD and S offset . Mathematically the weighting coefficient is represented as w SOD SOD S . For non circular trajectories the ray originating at radiation source and extending through reconstruction volume of interest illustrated as source projection ray intersects resampled detector plane at some offset from resampled center point . This offset can occur along both u axis and v axis and with respect to is illustrated as f f intercept . The f f intercept describes the deviation of radiation source from its normal trajectory in terms of its projection of source normal ray onto resampled detector plane . Thus for non circular trajectories the weighting coefficient is also a factor of a SOD calculation and S offset . However SOD is illustrated by calculating f minus r . Mathematically this is represented as SOD f r. f represents the distance from radiation source to resampled detector plane where source normal ray intersects resampled detector plane at f f intercept . The r calculation represents the distance from z axis to the plane including resampled center point .

If a typical reconstruction volume of interest has dimensions of 500 500 500 voxels the number of weights that must be calculated is 500 or 125 million different voxel weights. Further this must be done at each projection position P which often pushes the calculations into the tens of billions. However making use of the knowledge that the alignment of the v axis of the resampled detector plane has been constructed to be exactly parallel to the z axis of the reconstruction volume a weighting coefficient can be calculated independent of a z axis offset of each voxel in reconstruction volume of interest . This reduces the number of calculations and the resulting size of a table of weighting coefficients by a factor of the length of z axis . illustrates this further.

In reference to SID and SOD are shown again with SOD ending at both z axis and a new plane illustrated as plane with constant SOD SID ratio . This plane is parallel to resampled detector plane . The voxels in this plane may have different SID and SOD measurements but all have the same SOD SID ratio. This is proven geometrically given the nature of the congruent angles between SOD and plane with constant SOD SID ratio and SID and resampled detector plane . As SID and SOD extend higher or lower while remaining fixed to radiation source and with respect to resampled detector plane the congruent angles are always equal and thus SOD SID ratios are always equal across plane with constant SOD SID ratio .

Given the nature of plane with constant SOD SID ratio additional vertical planes can be drawn parallel to resampled detector plane that collectively pass through every voxel in reconstruction volume of interest . Each plane has a different SOD SID ratio but voxels across each respective plane have the same SOD SID ratio. Therefore S offset can be established as intersecting with each vertical plane. The total number of voxels along this synthetic axis represents the maximum number of SOD SID ratios that must be calculated to calculate the weight of every voxel for this projection P. A table of weights can be established for each potential value of S offset and stored in digital data processor . This significantly reduces the number of calculations that must be performed by digital data processor by a factor of the length of the z axis of reconstruction volume of interest .

In this step radiation source and detector are aligned at projection position Pand a CT scan process is executed. Alternatively those systems performing correction for non rigid CT based systems such as those employing a C arm as described in reference to Method may skip this step as digital data processor already has the necessary data for calculating the weighting coefficient. Method proceeds to step .

In this step digital data processor calculates and stores the measured distance from radiation source to the center of each pixel in one x y plane of the reconstruction volume of interest illustrated in as SOD at each projection angle B. Alternatively those systems performing correction for non rigid C arm based geometry as described in reference to Method calculate SOD as the distance of focus from resampled detector plane on S axis illustrated in as fcalculation minus r calculation . Method proceeds to step .

In this step digital data processor calculates a weighting coefficient for each S offset that has a plane with constant SOD SID ratio and that intersects a part of reconstruction volume of interest . In the extreme case digital data processor could calculate a w entry for each voxel in one of the x y planes of reconstruction volume of interest for each projection. But because the table is fairly linear digital data processor can create a single linear table that contains about as many entries as the size of either the x or y dimension of reconstruction volume of interest and use the calculated value of S offset to index and interpolate a specific estimate of w. Method proceeds to step .

In this step digital data processor stores a table of calculated weighting coefficients and their respective calculated S offsets in long term memory not shown . Method proceeds to step .

In this decision step it is determined whether weight coefficients must be calculated at another projection position P. If yes method returns to step . If no method ends.

Ultimately every voxel in reconstruction volume of interest is calculated as the sum of a function of projection images data taken from each projection position. Each projection image is large enough so that it is impossible for the fastest memory of digital data processor to hold all projection images . An implementation in which voxels are processed in full raster order across the three dimensions results in the reading of data from projection images that is far from optimal from a memory access order standpoint. However by breaking up reconstruction volume of interest into artificial sub units or bricks defined as a collection of adjacent voxels and by processing all of the voxels in one brick before proceeding to another digital data processor is able to greatly improve the locality of the memory access of projection images data thus improving the memory access performance of digital data processor by significantly increasing the number of cache hits during image reconstruction.

Therefore an algorithm can be used to pre calculate an optimal number of bricks into which each reconstruction volume of interest should be divided. This allows CPU or GPU to work on areas of reconstruction volume of interest that project back to projection images in regions that are sequential or near in physical address. As a result this reduces further the processing time and resources needed for image reconstruction. The projection of each brick is only dependent on the geometry of CT system not on projection images data itself as such because the geometry of reconstruction volume of interest is known the optimal processing order can be calculated prior to an actual CT scan procedure and stored in digital data processor . The system does not need actual projection image data of patient or subject of interest .

As radiation source projects reconstruction volume of interest onto resampled detector plane there is a geometric correlation between the three dimensional location of data in reconstruction volume of interest and the two dimensional projected location on resampled detector plane . For example the top and leftmost voxel within reconstruction volume of interest is projected at the top and leftmost position on resampled detector plane . Likewise for each brick in reconstruction volume of interest the position at which each brick s voxels will be projected as pixels on resampled detector plane also can be calculated. For example with respect to brick projects brick shadow . While both brick and brick are adjacent to brick in reconstruction volume of interest brick projects brick shadow and is therefore the next top and leftmost brick on resampled detector plane . Note that brick would be the next brick to process which illustrates that a simple rastering pattern of bricks across a single axis would not be optimal. Furthermore the processing order will vary for each projection position depending on the orientation of reconstruction volume of interest at each position. Given the aforementioned relationship between voxels and pixels of image data digital data processor determines the optimal order in which to process bricks by ordering bricks based on top and leftmost position on resampled detector plane . In other embodiments of the invention the processing order may start at the top and rightmost brick bottom and leftmost brick or bottom and rightmost brick.

Note that while projection images appear as a perfect square on resampled detector plane in for illustrative purposes a cube shaped reconstruction volume of interest actually produces a shadow that is the outline of a pair of connected rhombuses for which the parallel edges are aligned with the vertical axis. In some cases one rhombus is completely enclosed in the other so the projection image is a rhombus in other shapes and or projection positions they overlap and produce an irregular hexagon.

It is the nature of the geometry of reconstruction volume of interest that as a projection position is changed assuming a very small increment in angular orientation the calculated optimized order in which to process a set of bricks does not change much if at all. Therefore it can be assumed that the optimum order in which to go through a set of bricks at projection position Pis also nearly optimum for projection P. As a result digital data processor can choose n number of projection positions that should have the same brick ordering and only calculate what the brick ordering should be for a single projection. While this does not impact the overall number of calculations that must be performed by GPU on each voxel it reduces the number of brick processing optimization calculations that must be done on each projection.

This also allows the calculation of voxels from a set of projection images to be calculated in parallel as illustrated in . The contribution of each projection image can then be summed and finally stored into digital data processor by use of a single write operation. For example if digital data processor determines that each slab in reconstruction volume of interest should be divided into an array of 32 32 bricks and if each brick contained a matrix of 16 16 8 voxels this would produce a slab that contained 8 512 512 voxel planes. Grouping each set of consecutive projections together reduces the number of brick processing optimization calculations by the factor for which they are grouped.

In this step digital data processor calculates the optimal size in which reconstruction volume of interest should be divided into bricks. This calculation is determined as digital data processor chooses the dimensions of each brick that is a multiple of the number of pixel shaders that will process the bricks without exceeding the cache limits of each pixel shaders . Method proceeds to step .

In this step digital data processor groups the number of projections together such that a certain number of projections will all receive the same brick processing order. Therefore digital data processor has to calculate only the optimal processing order for bricks over each projection set rather than on each projection. Method proceeds to step .

In this step at each projection position P digital data processor calculates u axis and v axis coordinates at which each brick in reconstruction volume of interest will be projected onto resampled detector plane . This information is then stored as a table in long term memory not shown of digital data processor where the number of tables corresponds to the number of projection positions. The actual projection calculation may be done only at the vertices of each brick. The coordinates of the individual voxels within a brick may be just a linear interpolation between the projected coordinates of the brick s corners. The acceptability of using a linear interpolation is a function of the number of voxels contained in a brick. If the geometric error is unacceptably large the size of a brick can be reduced. Method proceeds to step .

In this step digital data processor determines the order in which to process bricks for reconstruction. The optimal order is based on each brick s proximity to one another when projected on resampled detector plane . In the preferred embodiment of the invention the brick that casts the uppermost and leftmost projection onto resampled detector plane is chosen first. Note that while it is always a brick that occupies a corner of the current slab the specific corner varies depending on the orientation of reconstruction volume of interest at the current projection angle. With respect to this is brick . Digital data processor determines the optimal order in which to process bricks by ordering bricks based on top and leftmost position when projected on resampled detector plane . Method proceeds to step .

In this step digital data processor determines the order in which to process voxels of each brick for image reconstruction. A primary axis that is designed to occupy consecutive locations in memory of digital data processor is determined first. In the present invention this is z axis because voxels along z axis have the same weighting coefficients as determined in reference to Method and therefore require only a single read by digital data processor . Note that the choice of either x axis or y axis to be the next outer loop during processing has little impact on the performance of digital data processor . Method proceeds to step .

In this decision step it is determined whether there are additional bricks in reconstruction volume of interest to process. If yes method returns to step . If no method ends.

In this step digital data processor chooses a slab which is defined as a plane of bricks along the same x axis and y axis of reconstruction volume of interest to process. For example brick brick and brick are in the same slab. Digital data processor processes slabs from top to bottom order along z axis of reconstruction volume of interest . Method proceeds to step .

In this step digital data processor chooses the number of projections or the projection set for which the remaining calculations of method will be performed as determined in Step . Method proceeds to step .

In this step data from projection images of the determined projection set is loaded into GPU . The coordinates of the eight corners of the reconstruction slab are projected onto each detector . The smallest rectangular area that includes these points is then calculated by digital data processor . Because detector is a plane all voxels within the slab fall within this rectangle. Note that this step may be performed for one captured projection set while a CT scan procedure continues to capture additional projection sets thus enabling real time applications of the system. Method proceeds to step .

In this step digital data processor performs geometric normalization of the current slab of data. This is a two dimensional perspective warp calculation performed either by a general purpose PC such as digital data processor or by a graphics processing unit such as GPU . Method proceeds to step .

In this step digital data processor performs one dimensional pre correction for Feldkamp backprojection of the current slab of data. This conventional filter which is well known in the art helps correct for the mass distribution errors that are inherent in the use of weighted backprojection as a reconstruction technique. While other algorithms may be used to perform this pre correction the preferred embodiment utilizes Shepp Logan filters. Method proceeds to step .

In this step digital data processor chooses a brick in the current slab of reconstruction volume of interest to process based on the order as determined in Step of method . This process is further simplified by ordering the u axis and v axis projection coordinates of each brick in the u v table calculated in Step of Method based on the predetermined order for processing. Method proceeds to step .

In this step digital data processor chooses an x coordinate of voxels in the current brick to process based on the order in which to process voxels of a brick as determined by method . Method proceeds to step .

In this step digital data processor chooses a y coordinate of voxels in the current brick to process based on the order in which to process voxels of a brick as determined by method . Method proceeds to step .

In this step digital data processor determines the weighting coefficient for all voxels along the current x axis and y axis by using S offset of the voxels to find the pre calculated weighting coefficient stored in digital data processor as described in Method . Method proceeds to step .

In this step digital data processor chooses a z coordinate of voxels in the current brick to process based on the order in which to process voxels of a brick as determined by method . Method proceeds to step .

In this step digital data processor calculates the intensity value of each voxel along the current z coordinate for the selected x and y coordinates of the current brick. The intensity of each voxel in the reconstruction image is equal to the intensity summation of the same voxel at each projection position with a u physical coordinate and a v physical coordinate multiplied by a weighting coefficient. This is illustrated as I x y z P u x y v x y z w x y where u T f SID SOD S fand v z f SID SOD S f.

By calculating intensities across a set of projections the number of calculations between reading voxel data from projection images and reading writing voxel data to a reconstruction is reduced. For example if there are eight projections in a projection set a current voxel value defined as I x y z is read and written only once for every eight projection calculations. This is especially important in GPU implementations in which the read write bandwidth to the recreated image is much lower than the collective read bandwidth of the multiple projection images stored in memory of digital data processor . Method proceeds to step .

In this decision step it is determined whether there is another voxel along the same z axis of the current brick. If yes method returns to step . If no method proceeds to step .

In this decision step it is determined whether there is another set of voxels along another y axis of the current brick to process. If yes method returns to step . If no method proceeds to step .

In this decision step it is determined whether there is another set of voxels along another x axis of the current brick to process. If yes method returns to step . If no method proceeds to step .

In this decision step it is determined whether there is another brick in current slab of reconstruction volume of interest to process. If yes method returns to step . If no method proceeds to step .

In this decision step it is determined whether there is another projection set for the current set of bricks of the same slab. If yes method returns to step . If no method proceeds to step .

In this decision step it is determined whether there is another slab of reconstruction volume of interest to process. If yes method returns to step . If no method ends.

The foregoing and other objects are met by the methods and apparatus described above. It will be appreciated that the illustrated embodiment is merely on example of the invention and that other embodiments incorporating one or more of the architectures modes of operations methodologies and or other features described above fall within the scope of the invention. Thus by way of non limiting example it will be appreciated that although the illustrated embodiment is described in respect to certain medical imaging applications the invention has application beyond the particular applications described as well as beyond medical imaging itself.

