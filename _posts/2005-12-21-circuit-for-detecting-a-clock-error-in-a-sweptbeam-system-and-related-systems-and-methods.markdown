---

title: Circuit for detecting a clock error in a swept-beam system and related systems and methods
abstract: A circuit for detecting a phase error between a clock signal and a beam position includes a beam generator, sensor, and phase detector. The beam generator directs a beam toward a beam sweeper in response to a clock signal. The sensor, which is disposed at a mid line of a region that the beam sweeper scans, detects the beam from the beam sweeper, and the phase detector detects an error in the clock phase from the detected beam. Such a circuit can automatically detect the phase error in the pixel clock and correct this error, thus eliminating the need for a manual phase-error corrector.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07746515&OS=07746515&RS=07746515
owner: Microvision, Inc.
number: 07746515
owner_city: Redmond
owner_country: US
publication_date: 20051221
---
This application claims priority to U.S. Provisional Application Ser. No. 60 638 274 filed on Dec. 21 2004 which is incorporated by reference.

This application is related to issued U.S. Pat. No. 7 491 919 entitled CIRCUIT FOR DETECTING A CLOCK ERROR IN A SCANNED IMAGE SYSTEM AND RELATED CIRCUITS SYSTEMS AND METHODS which has a common filing date and assignee and which is incorporated by reference.

The invention may have been made with United States Government support. The United States Government may have certain rights in this invention.

Referring to in a scanned image system that sweeps a beam to generate or capture an image not shown in the image may exhibit noticeable distortion if the pixel clock not shown in is not synchronized to the position of the beam.

Assume for example that the scanned image system is a bi directional image generating system. A beam sweeper such as a microelectromechanical MEMS mirror rotates back and forth about an axis to sweep the beam through a scan angle 2 such that each left to right and right to left sweep of the beam generates a respective line of the image not shown in . In an image plane which may be occupied by a display screen or in the case of a virtual retinal display by a viewer s retina the mirror sweeps the beam through a scan distance D. Although in this example the generated image is described as spanning the entire scan distance D the image may span only a portion of the scan distance as discussed below in conjunction with . Furthermore although three instances of the swept beam are shown it is understood that the beam may be in only one position at any one time. According to alternative embodiments a plurality of beams may be swept across the image plane .

The pixel clock not shown in dictates the pixel that the beam generates at a particular time therefore if the pixel clock is synchronized with the position of the beam then the pixel clock causes the beam to generate a left most pixel of the image not shown in when the beam is in the left most position L a center pixel when the beam is in the center position C and a right most pixel when the beam is in the right most position R.

But if the pixel clock is not synchronized with i.e. is out of phase with the position of the beam then the generated image may be distorted to a degree that is proportional to the phase error between the pixel clock and the beam. As an extreme example of this phase error distortion assume that the phase of the pixel clock lags the position of the beam by D 2 during a left to right sweep of the beam consequently the pixel clock causes the beam to generate a left most pixel of the image when the beam is in the center position C and to generate a center pixel when the beam is in the right position R. And during the following right to left sweep of the beam the pixel clock causes the beam to generate the right most pixel of the previous line when the beam is in the center position C of the current line.

Referring to an example of the image distortion resulting from a phase error in a pixel clock not shown in of the scanned image system is discussed in more detail. In this example the MEMS mirror resonates back and forth from left to right thus causing the position of the beam to be sinusoidal relative to time as shown in .

Referring to assume that one desires to generate within a scan region of the image plane an image frame which includes a vertical line located at a horizontal position between D 5 and 4D 5 therefore the frame has a width W 3D 5 and is horizontally centered within the scan region. The scan region is defined in the horizontal dimension by the scan distance D and in the vertical dimension by a scan distance V. Borders and between the sides of the scan region and the image frame here indicated as being D 5 wide may be included for instance to reduce raster pinch distortion or provide one or more other advantages.

Because the pixel clock phase error equals zero during each left to right sweep of the beam the pixel clock may cause the beam to generate a respective horizontal line of the left to right image field for a duration Tbetween times tand t which respectively correspond to the beam positions D 5 and 4D 5. Some of the horizontal sweeps of the left to right image field include segments of the vertical line .

Likewise during each right to left sweep of the beam the pixel clock may cause the beam to generate a respective horizontal line of a right to left image field for the duration Tbetween times tand t which also respectively correspond to the beam positions 4D 5 and D 5. Some of the horizontal sweeps of the right to left image field include segments of the vertical line .

Referring to because both of the image fields and are centered within the scan region and have the same horizontal width W and vertical height H these fields are aligned in the both the horizontal and vertical dimensions consequently the vertical line segments and are aligned such that in the image frame the vertical line has straight edges.

Referring to and however a phase error between the pixel clock and the position of the beam may cause the vertical line to appear jagged or in the extreme case illustrated in appear as two separate vertical lines and . For example assume that the pixel clock lags the beam position by a time T. Therefore during each left to right sweep of the beam the pixel clock causes the beam to generate a respective horizontal line of a left to right image field from time t to time t . Likewise during each right to left sweep of the beam the pixel clock causes the beam to generate a respective horizontal line of a right to left image field from time t to time t . Consequently as shown in the image field solid line is shifted to the right relative to the center of the scan region and the image field dashed line is shifted to the left such that these fields are not horizontally aligned as are the image fields and of . This shifting of the image frames and in opposite directions causes the resulting image frame to be distorted in the horizontal dimension. And this distortion causes a misalignment of the vertical line segments and such that the vertical line now appears to a viewer not shown as the two vertical lines and or for a smaller phase error as a single vertical line with jagged edges not shown . Although not shown in distortion can occur in the vertical dimension if the pixel clock is not synchronized to the vertical position of the beam .

A circuit for detecting a phase error between a clock signal and a beam position includes a beam generator sensor and phase detector. The beam generator directs a beam toward a beam sweeper in response to a clock signal. The sensor which is disposed at a mid line of a region that the beam sweeper scans detects the beam from the beam sweeper and the phase detector detects an error in the clock phase from the detected beam.

Such a circuit can automatically detect the phase error in the pixel clock and correct this error thus eliminating the need for a manual phase error corrector.

The following discussion is presented to enable a person skilled in the art to make and use one or more embodiments of the invention. The general principles described herein may be applied to embodiments and applications other than those detailed below without departing from the spirit and scope of the invention. Therefore the present invention is not intended to be limited to the embodiments shown but is to be accorded the widest scope consistent with the principles and features disclosed or suggested herein.

Referring to a technique for correcting a nonzero pixel clock phase error is to provide the scanned image system with a manual control not shown that a viewer not shown manipulates until the image within the frame has a good quality. For example the viewer may manipulate the control to align the segments and into the line having straight edges.

Unfortunately this technique may be inconvenient for the viewer and the manual control may increase the size complexity and cost of the scanned image system .

Similarly referring to a technique for adjusting the width W and height H of the frame is to provide the scanned image system with one or more manual controls not shown that a viewer not shown manipulates until the frame has the desired width and height.

Unfortunately like the manual phase correction technique this manual height and width adjustment technique may be inconvenient for the viewer and the manual control s may increase the size complexity and cost of the scanned image system .

In addition to the circuit the subsystem includes a beam sweeper such as the MEMS mirror discussed above in conjunction with a fast scan drive circuit for causing the mirror to rotate back and forth in a fast scan dimension the fast scan dimension the horizontal dimension in this embodiment and a phase locked loop PLL circuit for generating signals RAW PCLK and H. The drive circuit generates a signal H which is a square wave having the same frequency as the signal not shown that the drive circuit generates for rotating the mirror and the PLL generates RAW PCLK and Hfrom Hin a conventional manner. In one example the mirror rotates back and forth at a frequency of approximately 15 KHz and scans a scan region that is 900 pixels wide in the horizontal dimension where the middle 800 pixels form the image this leaves 50 pixel wide horizontal borders between the sides of the image and the corresponding sides of the scan region Hand Heach have a frequency of approximately 15 KHz and RAW PCLK has a frequency of approximately 13.5 MHz and is in phase with H. But because of e.g. noise signal delays etc. Hmay be out of phase with the position of the mirror and thus out of phase with the position of a beam that the mirror sweeps. Consequently Hand RAW PCLK may also be out of phase with the position of the swept beam. According to another embodiment the beam sweeper may comprise a unidirectional beam sweeper such as a rotating polygon mirror for example. According to another embodiment the beam sweeper may scan bidirectionally but the beam source described below may be enabled to produce lines or pixels unidirectionally.

The circuit includes a beam source for generating a synchronization beam a beam source controller a beam sensor and a phase corrector which includes a phase detector and a phase shifter . The controller causes the beam source to generate the synchronization beam in response to a predetermined cycle of PCLK the predetermined cycle corresponding to a predetermined pixel position within the horizontal line that the synchronization beam is currently sweeping. If the subsystem is part of a scanned image generating system then the synchronization beam may comprise the beam or one of the beams that the subsystem uses to generate an image or may be a separate beam. If the subsystem is part of a scanned image capturing system then the synchronization beam may comprise the beam or one of the beams that the subsystem uses to illuminate an object the image of which the system is capturing or may be a separate beam. According to an illustrative embodiment the sensor includes a single sensing region e.g. the sensor comprises a single photo diode mounted to a mask the sensor being operable to detect the synchronization beam as the mirror sweeps the beam onto the sensor and to generate a corresponding detection signal DS. As discussed below in conjunction with the sensor may be positioned at the horizontal center of the scan region within an upper or lower border of the scan region i.e. the sensor is positioned outside of the image frame . The phase detector determines from the detection signal DS a phase error PE in PCLK relative to the position of the synchronization beam . The phase shifter generates PCLK from RAW PCLK and in response to the phase error PE from the phase detector adds a corresponding phase shift to PCLK to reduce the phase error PE toward or to zero. For example the phase shifter may be able to adjust the phase of PCLK in increments as fine as 1 10 of a pixel.

The mask includes a frame which defines an aperture through which the subsystem generates or captures an image frame not shown in . The frame is formed from a rigid or flexible material and may for example be clad with a copper foil or coating. The aperture has horizontal and vertical dimensions W and H corresponding to the dimensions of the image frame in the plane of the mask and therefore is ideally centered within a scan region having horizontal and vertical dimensions D and V. An example of the dimensions of the aperture is W H 250 microns m .

The mask also includes a connector for connecting the signal lead or leads not shown of the sensor to the phase detector .

According to some embodiments the sensor is mounted to the frame such that the sensor is horizontally centered about a midline between the two sides of the scan region and thus between the two sides of the aperture . Furthermore where the sensor is also used to detect and correct an error in the height V of the scan region as discussed below in conjunction with the sensor is located in a predetermined position in the vertical dimension for example such that a bottom edge of the sensor is aligned with a top edge of the scan region . Alternatively the sensor may instead be mounted to the bottom of the mask but horizontally and vertically aligned in a manner similar to that previously described.

The mask may also include a sensor cover which is mounted over the sensor to define one or two edges that may for example be straight i.e. knife s edges and . As discussed below in conjunction with a knife s edge aids the phase detector in determining what portion the beam is striking the sensor . Alternatively the cover may be omitted where a knife s edge is not needed or where the edge s of the sensor is are straight enough to provide a knife s edge. Moreover the edge may also be a knife s edge particularly where the sensor is used to adjust the height V of the scan region as discussed below in conjunction with .

Still referring to the sensor copper clad frame and the cover if present may be coated with a transparent or semi transparent substance such as polyimide that protects the sensor frame and cover and that may also be antireflective. Furthermore where the transparent substance is polyimide and the synchronization beam is a beam of red light then the polyimide acts as a filter that allows the beam to propagate to the sensor but that filters out blue and green light to reduce the amount of extraneous light that strikes the sensor. If allowed to strike the sensor such extraneous light may introduce an error into the determination of the PCLK phase error by the phase detector .

Referring to A and B a technique is described for detecting PCLK s two pixel phase lag error shown in and correcting this error so that the pixels in the lines and are aligned as shown in .

First the beam controller or another section of the circuit causes the vertical scan drive circuit not shown in A or B to cause the mirror to sweep the beam in the vertical dimension it being understood that the mirror scans the lines and only once per vertical sweep cycle.

Next for each left to right sweep of the line the beam controller activates the beam source such that in the line the beam generates a single respective pixel similarly for each right to left sweep of the line the beam controller activates the beam source such that in the line the beam generates a single respective pixel. The beam generates only a single pixel per each sweep of the lines and so that the sensor detects the intensity of only one pixel at a time as discussed below. The beam controller continues in this manner until the beam generates a predetermined number of the same pixels in each of the lines and . For example the beam controller causes the beam to generate sixteen pixels a subset of which are shown in one in each of the lines and over sixteen successive though not necessarily immediately successive sweeps. That is each left to right sweep contains a single respective pixel in the line and each right to left sweep contains a single respective pixel in the line . These sixteen pixels include and are centered around the center pixels and because these are the sixteen pixels in each line that are near the sensor when the expected maximum phase error is 8 pixels. The beam controller may cause the beam to generate these pixels in numerical order i.e. pixel in line during the first left to right sweep of line pixel in line during the first right to left sweep of line pixel in line during the second left to right sweep of line pixel in line during the second right to left sweep of line and so on. Or the beam controller may cause the beam to generate these pixels in any other order and may generate these pixels in other than sixteen consecutive sweeps of the line and of the line . The beam controller may include a counter not shown in to keep track of the pixel number in each line and . The signal Hfrom the PLL indicates the beginning of the line and thus resets the counter to 1. As the mirror sweeps the beam from left to right across the line the counter increments by one each cycle of PCLK to 900. Then as the mirror sweeps the beam from right to left across the line the counter decrements by one each cycle of PCLK back to 1.

During the generation of each of the pixels in the lines and per the preceding paragraph the sensor generates the detection signal DS which indicates the relative intensity of the generated pixel. For example referring to because the entire pixel in line strikes the sensor the sensor measures a maximum relative intensity for the pixel . In contrast because the pixel in line is three pixels away from the sensor the sensor measures a relatively low perhaps even zero intensity for the pixel .

Then the phase detector stores the relative intensities for each of the pixels that the beam generates and from these intensities determines the phase error between the pixel clock PCLK and the position of the beam.

More specifically the phase detector first calculates the respective intensity centroids Cand Cfor the lines and according to the following equations 

If C C or C C for example within 5 then the phase detector determines that the phase error PE between PCLK and the position of the beam is below a predetermined phase error threshold for example a threshold corresponding to C Cwithin 5 of

If C Csuch that the PE the magnitude of the predetermined phase error threshold PE positive then the phase detector determines that the phase of PCLK leads the position of the beam and thus that the phase shifter must retard the phase of PCLK to drive the phase error PE toward or to zero.

Next the phase shifter adjusts the phase of PCLK as indicated by the value of PE. If the magnitude of PE is less than the predetermined phase error threshold then the phase shifter maintains PCLK at its current phase. If PE is positive then the phase shifter retards the phase of PCLK by an amount that is proportional to the magnitude of PE. Conversely if PE is negative then the phase shifter advances the phase of PCLK by an amount that is proportional to the magnitude of PE. To stabilize the phase correction loop formed by the circuit the phase shifter may for each new value of PE received from the phase detector only partially correct the phase of PCLK. This is akin to reducing the gain of a negative feedback loop so that the loop does not oscillate.

If necessary the circuit repeats the above described sequence until the phase error PE is less than the predetermined phase error threshold.

In this example the pixels of the lines and are aligned as shown in the measured intensities of the pixels and in the line and of the pixels and in the line each equal 1 the measured intensities of the pixels and in the line and the pixels and in line equal 0.5 the measured intensities of the pixels and in line and the pixels and in line equal 0.25 and the measured intensities of all other pixels in the lines and equal 0.

Still referring to A and B although the above phase detection and correction technique is described where a pixel either fully strikes or fully misses the sensor the technique also works where one or more of the pixels partially strikes the sensor.

Furthermore this technique also works where the horizontal dimension or the vertical dimension of the sensor is smaller or greater than the width of two pixels.

In addition instead of generating each pixel only once the beam controller can generate multiple instances of each pixel and the phase detector can filter out noise by calculating the intensity of each pixel as the average intensity of the respective multiple pixel instances.

Moreover the predetermined phase error threshold may not be symmetrical about zero. That is the magnitude of the threshold for positive PE may be different than the magnitude of the threshold for negative PE.

Furthermore this technique works where the sensor is not horizontally centered about the mid line as long as the sensor is within an area covered by the pixels that the beam generates during the execution of this technique. For example referring to suppose that the sensor is shifted to the right such that the horizontal center of the sensor is between the pixels and of the lines and instead of between the pixels and as shown in . When the circuit operates according to the above described technique to correct a phase error in PCLK the circuit still properly adjusts the phase of PCLK so that the pixels of the lines and are vertically aligned on the left side of the sensor and the pixels are vertically aligned on the right side of the sensor . And if the sensor is near the edge of or outside of the area covered by the pixels that the beam initially generates one can typically detect this during testing for example because the circuit does not correct the phase error in PCLK and reprogram the beam controller to generate pixels that are in the area in which the sensor is disposed. Or one can program the beam controller to generate all of the pixels in each line and so that the phase detector can always detect the phase error in PCLK regardless of the horizontal position of the sensor .

But although this technique works where the sensor is not horizontally centered about the mid line where the mirror horizontally sweeps the beam in a sinusoidal fashion per one may prefer that the sensor be horizontally centered or approximately horizontally centered about the midline because the midline is where the velocity of the beam is the greatest and thus where a phase error in PCLK causes the greatest and thus often the most detectable spatial horizontal offset between the pixels of the lines and .

Referring to C and D another technique is described for detecting and correcting a pixel clock phase error. More specifically a technique is described for detecting PCLK s partial pixel phase lead shown in and correcting this error so that the pixels in the lines and are aligned as shown in .

To detect and correct the phase error in PCLK the beam controller or another section of the circuit first causes the vertical scan drive circuit not shown in A or B to cause the mirror to sweep the beam in the vertical dimension it being understood that the mirror scans the lines and only once per vertical sweep cycle.

Next during a left to right sweep of the line the beam controller activates the beam source such that in the line the beam generates the pixel similarly for a subsequent right to left sweep of the line the beam controller activates the beam source such that in the line the beam generates the pixel .

During the generation of each of the pixels in the lines and per the preceding paragraph the sensor generates the detection signal DS which indicates the relative intensity of the generated pixel. For example referring to because the portion of the pixel in the line that strikes the sensor is larger than the portion of the pixel in the line that strikes the sensor the sensor measures a greater intensity for the pixel in the line than it does for the pixel in the line .

Then the phase detector stores the relative intensities for the two pixels that the beam respectively generates in the lines and and from these intensities determines the phase error between PCLK and the position of the beam.

If the measured intensity of the pixel in the line equals or approximately equals e.g. within 5 the measured intensity of the pixel in the line then the phase detector determines that the phase error PE between PCLK and the position of the beam is below a predetermined phase error threshold and thus does not need to be corrected.

If the measured intensity of the pixel in the line is greater than the measured intensity of the pixel in the line by more than a predetermined threshold then the phase detector determines that the phase of PCLK leads the position of the beam PE positive and thus that the phase shifter must retard the phase of PCLK to drive the phase error PE toward or to zero.

In contrast if the measured intensity of the pixel in the line is less than the measured intensity of the pixel in the line by more than a predetermined threshold then the phase detector determines that the phase of PCLK lags the position of the beam as shown in PE negative and thus that the phase shifter must advance the phase of PCLK to drive the phase error PE toward or to zero.

Next the phase shifter adjusts the phase of PCLK as indicated by the value of PE in a manner similar to that discussed above in conjunction with . That is if the magnitude of PE is less than the predetermined phase error threshold then the phase shifter maintains PCLK at its current phase. If PE is positive and greater in magnitude than the predetermined threshold then the phase shifter retards the phase of PCLK by an amount that is proportional to the magnitude of PE. Conversely if PE is negative and greater in magnitude than the predetermined threshold then the phase shifter advances the phase of PCLK by an amount that is proportional to the magnitude of PE. To stabilize the phase correction loop formed by the circuit the phase shifter may for each new value of PE received from the phase detector only partially correct the phase of PCLK.

If necessary the circuit repeats the above described sequence until the magnitude of the phase error PE is less than the predetermined phase error threshold and the pixels in the lines and are aligned or approximately aligned as shown in .

For example instead of generating each pixel only once the beam controller can cause the beam to generate multiple instances each pixel and the phase detector can filter out noise by calculating the intensity of each pixel as the average intensity of the respective multiple pixel instances each pixel to filter out noise.

Moreover this technique works where the sensor is not near the mid line as long as the knife s edge is aligned with the centers of two of the same pixels in lines and when PCLK has zero phase error. For example the sensor may be shifted to the right such that the edge is aligned with the centers of the pixels not shown in instead of with the centers of the pixels . If the misalignment of the sensor with the pixels is inadvertent one can typically determine this during testing of the circuit for example the circuit does not correct the phase error in PCLK based on the generation of the pixels and reprogram the beam controller to generate the pixels e.g. the pixels in the lines and with which the edge is aligned when PCLK has zero phase error. For example where the edge is aligned with the pixels instead of with the pixels when PCLK has zero phase error one can add an offset of one pixel to the beam controller such that it generates the pixels in lines and instead of the pixels .

But although this technique works where the sensor is not near the mid line where the mirror horizontally sweeps the beam in a sinusoidal fashion per one may prefer that the sensor be near the midline because the midline is where the phase error is PCLK may be most detectable for the reason discussed above in conjunction with .

During a period where the beam controller is not generating a pixel with the synchronization beam a switch forces a voltage V Vacross the single photo diode that composes the sensor and across a parasitic or actual capacitor which is in parallel with the sensor.

In response to the beam controller activating the beam to generate a pixel the switch toggles to couple the sensor to a current source which generates a constant current Ic that is greater than the maximum current expected from the sensor. The beam controller may generate a signal not shown that causes the switch to toggle as described.

Also in response to the beam controller activating the beam a counter begins counting from a predetermined initial count value such as 0. The counter may receive PCLK or another clock signal as a counting clock.

In response to the beam the sensor sinks a current the signal DS having a magnitude that is proportional to the portion of the beam that strikes or that is otherwise detected by the sensor. The current sunk by the sensor and the current Ic combine to charge the capacitor . But because the current sunk by the sensor tends to discharge the capacitor the greater this sunk current the longer it takes the current Ic to charge the capacitor . Therefore it follows that the greater the portion of the beam that the sensor detects the longer it takes the current Ic to charge the capacitor and vice versa.

An amplifier amplifies the voltage across the capacitor and provides the amplified voltage to a comparator .

When the amplified voltage exceeds a predetermined threshold voltage V the output of the comparator toggles thus stopping the counter and causing the switch to toggle back to the state in which the switch drives a voltage V Vacross the sensor .

Consequently the count value represents the measured intensity of the pixel generated by the beam . That is the greater the count value the greater the measured pixel intensity and the lower the count value the lower the measured pixel intensity.

Still referring to other embodiments of the circuit may have different topologies and may also include more or fewer components.

Like the subsystem of the subsystem includes the MEMS mirror the horizontal scan drive circuit for causing the mirror to rotate back and forth in the horizontal dimension the phase locked loop PLL circuit for generating signals RAW PCLK and Hfrom the signal H and a vertical scan drive circuit not shown in for causing the mirror to rotate back and forth in the vertical dimension.

But unlike the subsystem the subsystem also includes a reflector for directing the synchronization beam to a sensor which is further discussed below. The reflector allows one to mount the sensor behind the mirror instead of on the mask or otherwise in front of the mirror although one may omit the reflector and mount the sensor to the mask or otherwise in front of the mirror.

Furthermore like the circuit of the circuit includes the beam source for generating the synchronization beam and includes the beam source controller .

But unlike the circuit the circuit includes the sensor a horizontal width adjuster a vertical height adjuster and a phase corrector which includes a phase detector and the phase shifter . Unlike the sensor which includes a single sensing region the sensor includes multiple sensing regions and generates multiple corresponding detection signals DS. Furthermore as discussed below in conjunction with the sensor is positioned away from the horizontal center of the scan region within an upper or lower border region. Like the phase detector the phase detector determines from the detection signals DS a phase error PE in PCLK relative to the position of the synchronization beam but as discussed below the phase detector makes this determination differently than the phase detector does as discussed above in conjunction with . And the adjusters and respectively detect and correct errors in the horizontal width D and the vertical height V of a scan region in response to the signals DS from the sensor . Of course for an image frame of given pixel dimensions detecting and correcting errors in D and V inherently detects and corrects errors in the width W and height H of the image frame within the scan region.

In the embodiment of the sensor includes four sensing regions S S S and S which are arranged as square quadrants. A respective photo diode may compose each of these regions which are contiguous along straight horizontal and vertical boundaries and . These boundaries are similar to the knife s edges and of . The sensor also has outer edges and which are also straight and similar to the knife s edges and . Alternatively a cover similar to the cover may be placed over the sensor to define the boundaries and and or the edges .

Referring to in an embodiment where the circuit uses the sensor only to adjust the vertical height V of the scan region the sensing regions S and S may be combined into a single top sensing region and the regions S and S may be combined into a single bottom sensing region such that the sensor has only top and bottom rectangular sensing regions contiguous along the horizontal boundary . That is the vertical boundary does not exist.

Conversely in an embodiment where the circuit does not use the sensor to adjust the vertical height V of the scan region the sensing regions S and S may be combined into a single left sensing region and the regions S and S may be combined into a single right sensing region such that the sensor has only left and right rectangular sensing regions contiguous along the vertical boundary . That is the horizontal boundary does not exist.

Still referring to the different embodiments of the sensor and the value of x are further discussed below in conjunction with . Moreover because the sensor has multiple sensing regions S each of the horizontal width adjuster vertical height adjuster and the phase detector may include a respective circuit such as the circuit for each sensing region S to convert the signal DS from that region S into a respective intensity value. For example the phase detector may include four circuits one for each of the sensing regions S S.

Referring to A and B a technique that the circuit may implement for detecting and correcting a pixel clock phase error is described. As a specific example the technique is described for detecting PCLK s partial pixel phase lead error shown in and correcting this error so that the pixels in the lines and are aligned as shown in . This technique is similar to the technique that the circuit may implement to detect and correct the PCLK phase error as discussed above in conjunction with .

First the beam controller or another section of the circuit causes the vertical scan drive to cause the mirror to sweep the beam in the vertical dimension.

Next during a left to right scan of the line the beam controller activates the beam source such that in the line the beam generates the pixel similarly for a subsequent right to left scan of the line the beam controller activates the beam source such that in the line the beam generates the pixel .

During the generation of each of the pixels in the lines and per the preceding paragraph the sensor generates one respective detection signal DS for each sensing region S S and these signals DS DS indicate the relative intensity of the portion of the generated pixel that strikes or is otherwise detected by the corresponding sensing region. For example referring to because the portion of the pixel in the line that strikes the sensing region S is larger than the portion of the pixel in the line that strikes the sensing region S the sensing region S measures a greater intensity for the pixel in the line than the sensing region S does.

Then for each of the sensing regions S S the phase detector stores the relative intensities for each of the pixels that the beam respectively generates in the lines and and from these intensities determines the phase error between PCLK and the position of the beam.

Generally where the pixel in the line is vertically aligned with the pixel in the line the phase error equals zero. With specific reference to the sensor where the portion of the pixel in the line on the left side of the boundary equals the portion of the pixel in the line on the left side of the boundary and the portion of the pixel in the line on the right side of the boundary equals the portion of the pixel in the line on the right side of the boundary the phase error is zero.

Therefore for each pixel the phase detector next computes a position dependent intensity value PDI according to the following equations PDI DS1 DS3 DS2 DS4 DS1 DS2 DS3 DS4 3 PDI DS1 DS3 DS2 DS4 DS1 DS2 DS3 DS4 4 where PDIis the position dependent intensity value for the pixel in the line DS DSare the respective intensity measurements from the regions S S of the sensor for the pixel in the line PDIis the position dependent intensity value for the pixel in the line and DS DSare the respective intensity measurements from the regions S S of the sensor for the pixel in the line .

If PDIequals or approximately equals PDI for example within a predetermined threshold of 5 then the phase detector determines that the phase error PE between PCLK and the position of the beam is below a predetermined phase error threshold and thus that PE does not need to be corrected.

In contrast if PDI PDIby more than the magnitude of a predetermined threshold then the phase detector determines that the phase of PCLK leads the position of the beam as shown in PE positive and thus that the phase shifter must retard the phase of PCLK to drive the phase error PE toward or to zero.

Next the phase shifter adjusts the phase of PCLK as indicated by the calculated value of PE in a manner similar to that discussed above in conjunction with . That is if the magnitude of PE is less than the predetermined phase error threshold then the phase shifter maintains PCLK at its current phase. If PE is positive and greater in magnitude than the predetermined threshold then the phase shifter retards the phase of PCLK by an amount that is proportional to the magnitude of PE. Conversely if PE is negative and greater in magnitude than the predetermined threshold then the phase shifter advances the phase of PCLK by an amount that is proportional to the magnitude of PE. To stabilize the phase correction loop formed by the circuit the phase shifter may for each new value of PE received from the phase detector only partially correct the phase of PCLK.

If necessary the circuit repeats the above described sequence until the phase error PE is less than the predetermined phase error threshold and the pixels in the lines and are aligned or approximately aligned as shown in .

For example instead of generating each pixel only once the beam controller can cause the beam to generate multiple instances of each pixel and the phase detector can filter out noise by calculating the intensity of each pixel as the average intensity of the respective multiple pixel instances.

Furthermore although discussed in conjunction with the pixels in the lines and this technique works with any other pixels with which the sensor is aligned and regardless of where the vertical boundary bisects the pixels when the phase error of PCLK is zero.

In addition because the horizontal boundary of the sensor is not used in the above described technique for determining the phase error in PCLK instead of including four sensing regions S S the sensor may include only two sensing regions left and right and thus omit the boundary as discussed above in conjunction with .

Referring to and next is described a technique that the circuit may use for both detecting and correcting the phase error of PCLK and detecting and correcting an error in the width D of the scan region .

One can see that although the plots and have the same period T and cross zero at the same times tand t these plots have an arbitrary amplitude A at different times tand t and tand t respectively although A is shown as a negative value relative to the zero crossing it may be a positive value. More specifically the plot which has corresponds to the larger width Dand which thus has the larger amplitude first crosses A at t and then crosses A again at t. Times tand tare symmetrical that is the time between tand t t t equals the time between tand T T t . In contrast the plot which corresponds to the smaller width Dand which thus has the smaller amplitude first crosses A at t which is before t and then crosses A again at t which is after t. Like the times tand t the times tand tare symmetrical that is the time between to and t t t equals the time between tand T T t .

Based on the analysis in the preceding paragraph one can generally state that a plot of the beam position over a scan region of any width D where D 2 A crosses A at a unique pair of symmetrical times tand t.

Consequently if the circuit knows the values of A t and tfor a given width D of the scan region and the sensor is located at the amplitude A or A then the circuit can detect and correct for an error in D as discussed below.

Referring to and the technique for using the circuit for both setting the phase error of PCLK to zero and setting of the width D of the scan region to zero is described in detail. This technique is similar but not identical to the technique for setting the phase error of PCLK to zero as described above in conjunction with .

First the circuit sets the phase error of PCLK to zero as discussed above in conjunction with . Therefore similar to the pixels in the pixels of the horizontal lines and are vertically aligned but it is unknown whether the boundary is aligned with the centers of the pixels . If at first the sensor cannot detect the pixels then the horizontal amplitude error of the width D may be so large that no portions of the pixels strike the sensor . To remedy this either a human operator not shown or the horizontal width adjuster may cause the horizontal drive circuit to vary D until the sensor detects the pixels .

Next during a left to right scan of the line the beam controller activates the beam source such that the beam generates the pixel in the line similarly for a subsequent right to left scan of the line the beam controller activates the beam source such that the beam generates the pixel in the line

Then during the generation of each of the pixels in the lines and per the preceding paragraph each sensing region S S of the sensor generates a respective detection signal DS DS as discussed above in conjunction with .

Next for each of the sensing regions S S the horizontal width adjuster stores the relative intensities for each of the pixels that the beam generates and from these intensities determines the horizontal amplitude error of the width D.

Generally where the pixel in the line is vertically aligned with the pixel in the line and both of these pixels are horizontally centered about the sensor boundary then the horizontal amplitude error of D is zero. With reference to the sensor where the portion of the pixel in line on the left side of the boundary equals the portion of the same pixel on the right side of the boundary and the portion of the pixel in line on the left side of the boundary equals the portion of the same pixel on the right side of the boundary the horizontal amplitude error of D is zero.

Therefore for the pixels in the lines and the horizontal width adjuster next computes respective position dependent intensity values PDI according to equations 3 and 4 above.

If PDIand PDIboth equal zero or approximately zero then the horizontal width adjuster determines that the horizontal amplitude error in the width D of the scan region is less than a predetermined error threshold and thus determines that D needs no adjustment.

If PDIand PDIare both positive and greater than a magnitude of a predetermined threshold the centers of the pixels are both shifted to the left of the boundary then the horizontal width adjuster determines that the width D of the scan region is wider than the predetermined desired width HAE is positive and thus that the horizontal drive circuit must reduce the driving force imparted to the mirror to drive the horizontal amplitude error toward or to zero.

In contrast if PDIand PDIare both negative and greater than a magnitude of a predetermined threshold the centers of the pixels are both shifted to the right of the boundary then the horizontal width adjuster determines that the width D of the scan region is narrower than the predetermined desired width HAE is negative and thus that the horizontal drive circuit must increase the driving force imparted to the mirror to drive the horizontal amplitude error toward or to zero.

Next the horizontal drive circuit adjusts the width D as indicated by the calculated value of HAE. That is if the magnitude of HAE is less than the magnitude of a predetermined amplitude error threshold then the drive circuit maintains D at its current width. If HAE is positive and greater than the magnitude of the predetermined threshold then the drive circuit reduces the width D by an amount that is proportional to the magnitude of HAE. Conversely if HAE is negative and greater than the magnitude of the predetermined threshold then the drive circuit increases the width D an amount that is proportional to the magnitude of HAE. To stabilize the scan width correction loop formed by the circuit the drive circuit may for each new value of HAE received from the horizontal width adjuster only partially correct the width D.

If necessary the circuit repeats the above described sequence until the both the phase error PE and the horizontal amplitude error HAE are less than their respective predetermined thresholds such that the pixels in the lines and are centered or approximately centered about the boundary as shown in .

For example instead of generating each pixel in the lines and only once the beam controller can generate multiple instances of each pixel and the horizontal width adjuster can filter out noise by calculating the intensities of the pixels in the lines and equal to the average intensities of the respective multiple pixel instances.

Furthermore although discussed in conjunction with the pixels in the lines and where A D 4 this technique works with any other nonzero value of A.

In addition because the horizontal boundary of the sensor is not used in the above described technique for determining the phase error in PCLK and the horizontal amplitude error in the width D instead of including four sensing regions S S the sensor may include only two sensing regions left and right and thus omit the boundary as discussed above in conjunction with .

Moreover instead of calculating the values of PDIand PDIper equations 3 and 4 the horizontal width adjuster may calculate only the numerators of these values. The reason for this is that because these values are not compared to one another the adjuster need not normalize them.

Referring to and next is described a technique that the circuit may use for detecting and correcting a vertical amplitude error VAE in the height H of the scan region .

First the circuit sets both the phase error of PCLK and the horizontal amplitude error in the width D to zero as discussed above in conjunction with B and .

Next during a left to right scan of the line the beam controller activates the beam source such that the beam generates the pixel in the line .

Then during the generation of the pixel in the line per the preceding paragraph each region S S of the sensor generates a respective detection signal DS DS as discussed above in conjunction with .

Next for each of the sensing regions S S the vertical height adjuster stores the relative intensities for the pixel that the beam generates and from these intensities determines the vertical amplitude error VAE in the height V.

Generally where the pixel is vertically centered about the horizontal boundary as shown in then VAE is zero and V has the desired predetermined value. With reference to the sensor where the portion of the pixel in the line on the top side of the boundary equals the portion of the same pixel on the bottom side of the boundary VAE is zero.

Therefore for the pixel in the line the vertical width adjuster next computes a vertical position dependent intensity value PDIV according to the following equation PDIV 12 34 5 

If PDIVequals zero or approximately zero then the vertical width adjuster determines that the vertical amplitude error in the height V of the scan region is less than a predetermined error threshold and thus determines that V needs no adjustment.

If PDIVis positive and greater than a magnitude of a predetermined error threshold the center of the pixel is above the boundary then the vertical height adjuster determines that the height V of the scan region is greater than a predetermined desired height and thus that the vertical drive circuit must reduce the driving force imparted to the mirror to drive the vertical amplitude error VAE toward or to zero.

In contrast if PDIVis negative and greater than a magnitude of a predetermined error threshold the center of the pixel is below the boundary then the vertical height adjuster determines that the height V of the scan region is smaller than a predetermined desired height and thus that the vertical drive circuit must increase the driving force imparted to the mirror to drive the vertical amplitude error VAE toward or to zero.

Next the vertical drive circuit adjusts the value of V as indicated by the calculated value of VAE. That is if the magnitude of VAE is less than the predetermined amplitude error threshold then the drive circuit maintains V at its current value. If VAE is positive and greater than the magnitude of a predetermined threshold then the drive circuit reduces the height V by an amount that is proportional to the magnitude of VAE. Conversely if VAE is negative and greater than the magnitude of a predetermined threshold then the drive circuit increases the height V an amount that is proportional to the magnitude of VAE. To stabilize the scan height correction loop formed by the circuit the drive circuit may for each new value of VAE received from the vertical height adjuster only partially correct the height V.

If necessary the circuit repeats the above described sequence until the magnitude of the vertical amplitude error VAE is less than a predetermined threshold such that the pixel in the line is centered or approximately centered about the horizontal sensor boundary as shown in .

For example instead of generating the pixel in the line only once the beam controller can generate multiple instances of the pixel and the vertical height adjuster can filter out noise by calculating the intensity of the pixel as the average intensity of the multiple pixel instances.

Furthermore although discussed in conjunction with the pixel in the line this technique works with any other pixel and line position. That is the line need not be the top most line of the scan region but can be any line between the top of the image frame and the top of the scan region. Furthermore the pixel can be any pixel within the line that strikes the sensor .

In addition because the vertical boundary of the sensor is not used in the above described technique for setting the height V instead of including four sensing regions S S the sensor may include only two sensing regions top and bottom and thus omit the boundary as discussed above in conjunction with . Of course this top bottom configuration may prohibit the use of the sensor for correcting the phase error of PCLK and the horizontal amplitude error in the scan width D.

Moreover instead of correcting the phase error of PCLK and the horizontal amplitude error in the width D of the scan region before correcting the vertical amplitude error in the height V of the scan region the circuit may correct the vertical amplitude error first where the circuit may adjust V such that the horizontal boundary intersects the center of the pixel or other pixel being used regardless of the position of the pixel relative to the vertical boundary .

Furthermore in a potentially less accurate alternative the vertical height adjuster may adjust V until at least one region S S of the sensor detects the pixel in the line . Because this alternative requires only one sensor regions this alternative may be implemented with a single sensing region sensor such as the sensor of .

In operation of the subsystem after the circuit has corrected the phase of PCLK and has corrected the width D and the height V of the scan region as needed once per vertical scan cycle of the mirror the beam controller causes the beam to generate a pixel e.g. the pixel in line that strikes the sensor . In response to sensing the pixel the sensor generates a pulse H e.g. Hmay be the same as one of the signals DS or may be a summation of these signals . Of course the phase of His shifted by the number of the pixel that strikes the sensor . But because this phase shift is constant one can program the phase shifter to take it into account.

In operation the beam generator directs the image beam onto the mirror which sweeps the beam through a pupil and across the retina by rotating back and forth as discussed above in conjunction with .

Light source may include multiple emitters such as for instance light emitting diodes LEDs lasers thermal sources arc sources fluorescent sources gas discharge sources or other types of illuminators. In some embodiments illuminator comprises a red laser diode having a wavelength of approximately 635 to 670 nanometers nm . In another embodiment illuminator comprises three lasers a red diode laser a green diode pumped solid state DPSS laser and a blue DPSS laser at approximately 635 nm 532 nm and 473 nm respectively. While laser diodes may be directly modulated DPSS lasers generally require external modulation such as an acousto optic modulator AOM for instance. In the case where an external modulator is used it is considered part of light source . Light source may include in the case of multiple emitters beam combining optics to combine some or all of the emitters into a single beam. Light source may also include beam shaping optics such as one or more collimating lenses and or apertures. Additionally while the wavelengths described are in the optically visible range other wavelengths may be within the scope of the invention.

Light beam while illustrated as a single beam may comprise a plurality of beams converging on a single scanner mirror or onto separate mirrors .

A 2D MEMS or other scanner scans one or more light beams at high speed in a pattern that covers an entire 2D FOV or a selected region of a 2D FOV within a frame period. A typical frame rate may be 60 Hz for example. Often it is advantageous to run one or both scan axes resonantly. In one embodiment one axis is run resonantly at about 19 KHz while the other axis is run non resonantly in a sawtooth pattern so as to create a progressive scan pattern. A progressively scanned bi directional approach with a single beam scanning horizontally at scan frequency of approximately 19 KHz and scanning vertically in sawtooth pattern at 60 Hz can approximate an SVGA resolution. In one such system the horizontal scan motion is driven electrostatically and the vertical scan motion is driven magnetically. Alternatively both the horizontal and vertical scan may be driven magnetically or capacitively. Electrostatic driving may include electrostatic plates comb drives or similar approaches. In various embodiments both axes may be driven sinusoidally or resonantly.

Several types of detectors may be appropriate depending upon the application or configuration. For example in one embodiment the detector may include a simple PIN photodiode connected to an amplifier and digitizer. In this configuration beam position information may be retrieved from the scanner or alternatively from optical mechanisms and image resolution is determined by the size and shape of scanning spot . In the case of multi color imaging the detector may comprise more sophisticated splitting and filtering to separate the scattered light into its component parts prior to detection. As alternatives to PIN photodiodes avalanche photodiodes APDs or photomultiplier tubes PMTs may be preferred for certain applications particularly low light applications.

In various approaches simple photodetectors such as PIN photodiodes APDs and PMTs may be arranged to stare at the entire FOV stare at a portion of the FOV collect light retrocollectively or collect light confocally depending upon the application. In some embodiments the photodetector collects light through filters to eliminate much of the ambient light.

The present device may be embodied as monochrome as full color and even as a hyper spectral. In some embodiments it may also be desirable to add color channels between the conventional RGB channels used for many color cameras. Herein the term grayscale and related discussion shall be understood to refer to each of these embodiments as well as other methods or applications within the scope of the invention. In the control apparatus and methods described below pixel gray levels may comprise a single value in the case of a monochrome system or may comprise an RGB triad or greater in the case of color or hyperspectral systems. Control may be applied individually to the output power of particular channels for instance red green and blue channels may be applied universally to all channels or may be applied to a subset of the channels.

In some embodiments the illuminator may emit a polarized beam of light or a separate polarizer not shown may be used to polarize the beam. In such cases the detector may include a polarizer cross polarized to the scanning beam . Such an arrangement may help to improve image quality by reducing the impact of specular reflections on the image.

From the foregoing it will be appreciated that although specific embodiments of the invention have been described herein for purposes of illustration various modifications may be made without deviating from the spirit and scope of the invention. For example referring to and the synchronization beam may be any type of electromagnetic beam such as a light beam or an electron beam. Where the beam is an electron beam then the mirror may be replaced with an electron beam sweeping circuit. Furthermore where an alternative is disclosed for a particular embodiment this alternative may also apply to other embodiments even if not specifically stated.

