---

title: Dual mode human interface device
abstract: A dual mode human interface device (HID) includes a wireless interface for wireless communication with a host computer; a wired interface for wired communication with the host computer; and a processor coupled with the wireless interface and the wired interface for transferring data between the HID and the host computer, wherein the processor initiates establishing wireless communication with the host computer, when the HID is connected to the host computer via the wired interface.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08401588&OS=08401588&RS=08401588
owner: Broadcom Corporation
number: 08401588
owner_city: Irvine
owner_country: US
publication_date: 20051027
---
This Patent Application claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 60 623 063 filed on Oct. 28 2004 and entitled DUAL MODE HUMAN INTERFACE DEVICE the entire content of which is hereby expressly incorporated by reference.

The present invention relates generally to wireless devices and more particularly to dual mode wired wireless human interface devices.

Wireless communication is rapidly growing. For example peripheral devices and human interface devices HIDs are increasingly utilizing wireless communication to communicate with a host computer. Bluetooth BT is a wireless protocol and for security it depends on establishing a shared secret called a link key between two BT devices systems. BT protocol uses the link key for authentication deriving an encryption key from the link key and using the encryption key to encrypt the information transmitted over the air. The BT link key is typically established via a BT pairing process defined in the BT specification. This process involves setting up a BT connection between two BT devices systems entering an identical PIN code on both sides and using the PIN code to derive a shared secret link key.

In addition through a process called bonding BT devices systems can remember the BT address and link keys of other BT devices systems with which they have been connected before and use this information to quickly recreate a secure connection.

However wireless HID devices being essential for the operation of a computer for the first time suffer from first boot and recovery problems. For example in a typical first boot problem a BT device does not initially know to which computer device address it should connect. Similarly in a recovery case if an existing BT device needs to be replaced the replacing BT device does not initially know to which computer device address it should connect. One conventional solution is to store corresponding bonding information in both the host computer and in the BT device at the time of manufacturing. However this solution lacks flexibility and does not address the device replacement recovery case.

BT devices also suffer from a complicated pairing scheme. Current BT pairing requires a user to search for BT devices locate the correct device from a list and enter a PIN code to complete the pairing.

Therefore there is a need for a device and method to avoid the first boot and recovery problems and provide a more robust connection to and a better compatibility with host computers.

In one embodiment the present invention is a dual mode interface for data communication between a HID and a host computer. The dual mode interface includes a wireless transceiver for wireless communication between the HID and the host computer a wired communication controller for wired communication between the HID and the host computer a HID peripheral interface for providing communication interface to the HID and a processor coupled with the wireless transceiver the wired communication controller and the HID peripheral interface for transferring data between the HID the wireless transceiver and the wired communication controller wherein the processor is capable of sensing whether the wired communication controller is connected to the host computer via a wired connection.

In one embodiment the present invention is a dual mode HID. The HID includes a wireless interface for wireless communication with a host computer a wired interface for wired communication with the host computer and a processor coupled with the wireless interface and the wired interface for transferring data between the HID and the host computer wherein the processor is capable of establishing pairing for wireless communication with the host computer when the HID is connected to the host computer via the wired interface.

In one embodiment the present invention is a method for data communication between a HID and a host computer. The method includes the steps of sensing a wired connection between the host and the HID transferring data between the host and the HID via the wired connection for securing subsequent wireless communication between the host and the HID via a wireless interface changing to wireless communication between the host and the HID via the wireless interface transferring data between the host and the HID via the wireless interface and changing back to wired communication between the host and the HID via the wired connection when the wired connection is reconnected.

In one embodiment the wireless communication interface is a Bluetooth interface and the wired communication interface is a USB interface.

In one embodiment the present invention is a dual mode interface for use with a dual mode HID device. In one embodiment the dual mode interface is a single chip integrated circuit IC that supports a USB interface and is used by a dual mode HID to interface to a host via a Bluetooth interface and or the USB connection. The dual mode HID uses the USB interface when it is plugged in and becomes a BT device when it is unplugged. The USB interface allows the operating system of the host to automatically configure the HID for BT operation by setting the link key in a secure and user transparent manner. The USB interface serves as a back up in case BT functionality is not available for any reason e.g. because the batteries have been fully discharged and can no longer supply sufficient power to the device or because radio severe radio interference is present resulting in poor performance over the BT link. The USB interface may also be used to recharge the HID when needed.

The PC host includes a host side wireless interface that supports a wireless networking standard such as the Bluetooth Standard Zigbee WiFi Ultrawideband UWB the 802.15 standard or another wireless standard and a wired interface that supports a wired standard such as USB RS 232 RS 422 IC PS2 IEEE 1394 also known as Firewire IEEE 1284 also known as the Centronics printer interface or the like. One skilled in the art will recognize that the invention described herein may also be applied to systems incorporating a proprietary wired or wireless communication protocols or both.

In one embodiment the wireless link is a Bluetooth protocol and the wired link is a universal serial bus USB interface. is a block diagram of a system for establishing a communication link to a dual mode USB BT device . A host computer includes a wireless communication interface for example a Bluetooth BT communication interface for executing wireless communication and a wired interface such as USB RS 232 RS 422 IC PS2 IEEE 1394 also known as Firewire IEEE 1284 also known as the Centronics printer interface and the like for transmitting and receiving data between computer and dual mode device . Computer also includes an operating system OS . In one embodiment wireless communication interface is a BT transceiver that plugs into computer and thus making computer Bluetooth capable. The BT transceiver may also be embedded in the computer.

Dual mode device also includes a wireless communication interface and a wired interface for receiving and transmitting data from to computer . Device also includes a CPU a memory an input block and an output block . Memory may include a ROM for storing firmware executed by the CPU a RAM for storing information and a non volatile memory for storing link key BT device addresses BDADDRs PINs and the like. Device also includes a battery that is preferably re chargeable. The battery may be charged via the wired connection. Wireless communication interface and wired interface are coupled to CPU and transmit data to OS for execution on computer . The dual mode device maybe a dual mode keyboard mouse printer other dual mode peripherals or any other dual mode digital device.

In one embodiment the wired interface is a USB interface. Digital devices are increasingly supporting USB ports. Typically a USB bus serves as an external interface serial bus between the USB enabled computer and the device .

In wireless operation CPU receives a communication channel allocation request signal transmitted from computer via the wireless communication interface and then judges if the wireless communication can be established in the current condition of CPU . If the wireless communication is established CPU transmits a message allowing wireless access.

In one embodiment computer and device use Bluetooth protocol to wirelessly communicate with each other after the pairing is accomplished. To establish a Bluetooth wireless communication link a first radio transceiver for example BT interface associated with the computer and a second radio transceiver for example BT interface associated with device are configured to automatically find and contact each other to establish a wireless communication link upon being brought into proximity with each other and each being activated by the user. Typically host systems utilizing the Bluetooth communication protocol transmit a general inquiry or in some cases a limited inquiry which is received and acknowledged by devices located within receiving range which are configured for general or limited discoverable mode as defined in the Bluetooth specification. Once a second Bluetooth configured device is identified a link is established and optionally authenticated.

Establishing a Bluetooth link authentication requires the initiating Bluetooth system to check to see if a link between the two communicating devices has already been previously established. If a link has been previously established the authentication is automatically accepted by the initiating Bluetooth device. Upon the first time that two devices communicate or if the authentication using an existing link key fails between two devices an initialization procedure is needed to create a common link key in a safe manner. This initialization procedure is called pairing. The method and system of the present invention utilizes a wired connection such as USB RS 232 RS 422 IC PS2 IEEE 1394 also known as Firewire IEEE 1284 also known as the Centronics printer interface or the like to accomplish a quick and efficient pairing of two dual mode devices. Once the pairing is accomplished the two dual mode devices are initialized and ready to wirelessly communicate with each other.

Typically an authentication procedure first checks to see if a link between the two devices has been already authenticated. If so the authentication is confirmed. If the link between the two devices is not currently authenticated but a common link key exists between the two devices from a previous link the authentication procedure may re authenticate the link. If the authentication fails or if there are no common link keys available between the two devices the authentication procedure initiates the pairing procedure to generate a new set of link keys between the two devices. Successful completion of the pairing procedure results in the establishment of a valid link key between the two devices.

Processor core is typically a microcontroller which executes firmware code either programmed into the device in either volatile or non volatile memory or else contained off chip in external memory such as RAM ROM or Flash. The firmware code contains instructions to functionally transfer data between the HID Peripheral Interfaces and either a Bluetooth transceiver or a USB host controller interface depending on the mode in which the device is currently operating. The dual mode HID is connected to the host PC via a USB cable.

In this embodiment the Bluetooth transceiver transmits and receives digital data wirelessly between the dual mode HID and a Bluetooth transceiver in the host PC according to the Bluetooth protocol specification. The USB host controller handles the device side portion of the USB protocol. It interfaces via a USB cable to a root hub interface in the host device typically a personal computer or possibly chained through one or more USB hubs as specified in the USB specification.

In one embodiment the processor core is capable of sensing whether the wired communication controller is connected to the host computer via the wired connection. If so the processor core initiates establishing a wireless communication with the host computer via the wireless transceiver . Moreover the processor core is capable of switching to wireless communication with the host computer via the wireless transceiver when the processor senses that the wired communication controller is no longer connected to the host computer via the wired connection. Additionally the processor core is capable of switching to wired communication with the host computer via the wired communication controller when the processor senses that the wireless communication is no longer established. Alternatively the processor core is capable of switching to wired communication with the host computer via the wired communication controller when the processor senses that the wired interface is reconnected.

In one embodiment the wireless interface unit operates according to the Bluetooth specification and in particular to the Human Interface Device HID profile for the Bluetooth specification. In one embodiment the wired interface unit operates according to the USB protocol.

Processing unit wireless interface unit wired interface unit and input output unit couple with one another via a system on chip SOC bus . Processing unit includes a processing interface that may be used to couple the processing unit to one or more devices. Input output unit includes an input output set of signal lines that couple the dual mode interface device to a user input device e.g. dual mode keyboard and or dual mode mouse.

The RF layer corresponds to the physical layer of the Open Systems Interconnection OSI framework. Similar to the RF layer the baseband layer corresponds to the physical layer that establishes a physical connection. The HCI layer is an interfacing protocol between a Bluetooth module and a host. The L2CAP layer corresponds to the data link layer of the OSI and is a protocol stack for interfacing a lower layer protocol stack with an upper layer application. The L2CAP layer has a similar role as the TCP layer of the Internet Protocol IP and is located above the HCI layer for enabling the upper layer protocol or application for exchanging data packets.

The RFCOMM layer is an emulator for serial communications and a protocol replacing serial communication protocols such as a USB RS 232 IC PS2 and the like. For instance USB is a wired protocol and security of USB operation is guaranteed by the physical wire which connects the device to the system.

The PPP layer is a protocol for serial communication between two computers. IP is an Internet communication protocol. TCP is a protocol used with IP for transmitting data in a message form on the Internet. UDP is a communication protocol providing limited services when messages are communicated using IP. UDP is an alternative to TCP and when used with IP is also referred to as UDP IP.

Similar to the TCP the UDP uses the IP to enable a computer to receive an actual data unit datagram from the another computer. A socket is a communication method between a client program and a server program on a network. The socket is sometimes referred to as an application programming interface API and is generated and utilized by a series of programming requests or function calls.

In Bluetooth terminology bonding is a dedicated procedure for performing the first authentication between BT devices where a common link key is created and stored for future use. An unknown device is a Bluetooth device for which no information BD address link key PIN or other is known. Prior to bonding the host computer the wireless keyboard and the wireless mouse are unknown to one another. In this state the devices are not yet bonded and are unknown to one another. A known device is a BT device for which at least the BD address BD ADDR is stored. During setup the host computer will learn the BD ADDR of the wireless keyboard and the wireless mouse. Both the host computer and the host side wireless interface may store the BD ADDR of each serviced wireless interface device i.e. wireless keyboard wireless mouse camera printer game controller etc. as well as additional information relating to the bonding of the devices.

An authenticated device is a BT device whose identity has been verified during the lifetime of the current link by way of the BT authentication procedure. For example a wireless keyboard is typically authenticated by the host computer after every connection. A trusted relationship is created when a remote device is marked as a trusted device. This includes storing a common link key for future authentication. During the setup procedure the wireless keyboard may be marked as a trusted device.

After the setup procedure has been completed the link key the BD ADDR and other configuration information are stored in a non volatile memory of the host side wireless interface. The wireless keyboard also saves host information and link key information into its non volatile memory. Additionally the host side wireless interface saves the configuration information of the wireless keyboard in its non volatile memory for subsequent use.

Dual mode devices for example dual mode HIDs can function without any special host support. Minimally to use the BT mode the host needs to be BT aware and have a BT transceiver which is under Bluetooth stack control at the operating system login prompt. The wired mode of operation is functional in the absence of a Bluetooth stack or transceiver facilitating use of such devices as high end USB HIDs for which the user has the option to later install a Bluetooth stack and use the HID unconstrained by wires. The host then eliminates the need for BT pairing prior to using the HID.

In operation when a wired HID is plugged in or detected by the system BT capability is determined. This can be done via a HID input report for example or via vendor specific USB requests. If the HID is recognized as a dual mode device the host creates a random link key suitable for cryptographic use and passes it to the device. The host also queries the HID for its BD ADDR and saves the BD ADDR internally along with the link key. The host also loads any necessary BT HID drivers at this time. Optionally the HID may generate a suitable link key and pass it to the host via a HID input report or a vendor specific USB request.

If boot mode operation over BT for example UHE described below is desired and the host has a UHE capable transceiver the HID s BD ADDR and link key should also be provided to the transceiver via USB during UHE operation.

Pairing a Bluetooth HID device with a Bluetooth stack over the HID s wired connection should preferably be restricted to times when the user is logged in because being logged in is considered a secure context. A user who has plugged in the dual mode HID can be reasonably assumed to be the user who was authenticated by username password entry at the login prompt.

While it is possible for a user to leave a machine unattended in a logged in state that act itself compromises the system s security. The user may also be prompted for a password before committing the BT pairing to guard against the possibility of the user leaving the machine unattended. If the Bluetooth stack is paired only with a Bluetooth HID over a wired connection when in a secure context a subsequently established and authenticated using the link key BT link is secured and can be safely used to enter sensitive information for example a password or credit card information.

Many operating systems can further be configured to automatically lock the user interface after a pre defined period of user inactivity. Once locked the system requires the user to re enter a valid username and password. This feature can further strengthen the security of BT links established automatically over the wired interface of a dual mode HID.

Once the OS loads and the user preferably has logged in to establish a secure context the OS or a driver queries the HID via the USB connection and determines that the device is a dual mode USB BT HID. The OS then retrieves the BD address of the HID via a USB Get Report operation generates a random number for use as the BT link key and stores it along with the BD address of the host or the BT transceiver of the host via a Set Report on the HID. The HID now knows to which BD address it should connect during BT operation. The random key may optionally be encrypted for better security.

The OS also saves the HID BD address along with the link key generated internally. These will be used for authentication during reconnection with the HID. The OS optionally provides the HID BD address and link key to the host BT transceiver. This allows UHE functionality on a UHE capable transceiver.

The HID and the transceiver complete authentication using the previously generated programmed link key. The HID proceeds with setting up the HID control and interrupt channels. The UHE capable transceiver then optionally places the HID in boot mode. The HID then starts issuing HID reports which are forwarded by the transceiver to host over the virtual HID ports.

Accordingly the dual mode HID of the present invention can be shipped from the manufacturer with any host transceiver because the HID is no longer dependant on the host for dealing with the first boot and recovery. Additionally the dual mode HID of the present invention does not require boot mode support.

It will be recognized by those skilled in the art that various modifications may be made to the illustrated and other embodiments of the invention described above without departing from the broad inventive scope thereof. It will be understood therefore that the invention is not limited to the particular embodiments or arrangements disclosed but is rather intended to cover any changes adaptations or modifications which are within the scope and spirit of the invention as defined by the appended claims.

