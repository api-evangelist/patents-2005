---

title: Method and apparatus for processing a modulated signal using an equalizer and a rake receiver
abstract: In a method for achieving higher S/N, one or more signals are received and processed to provide one or more streams of samples. In a first processing scheme, the sample stream(s) are equalized within an equalizer to generate symbol estimates, which may be subsequently processed (e.g., despread and decovered) to provide a first stream of recovered symbols. Each sample stream is filtered with a set of coefficients and may be scaled with a scaling factor. The scaled samples for all streams are then combined to generate the symbol estimates. The sample stream(s) may also be processed by a second processing scheme with one or more rake receivers to provide a second stream of recovered symbols. The signal quality for each processing scheme can be estimated and used to select either the first or second processing scheme.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07397844&OS=07397844&RS=07397844
owner: QUALCOMM Incorporated
number: 07397844
owner_city: San Diego
owner_country: US
publication_date: 20051103
---
The present Application for Patent is a Continuation and claims priority to patent application Ser. No. 09 624 319 entitled METHOD AND APPARATUS FOR PROCESSING A MODULATED SIGNAL USING AN EQUALIZER AND A RAKE RECEIVER filed Jul. 24 2000 now U.S. Pat. No. 7 082 174 and assigned to the assignee hereof and hereby expressly incorporated by reference herein.

The present invention relates to data communication. More particularly the present invention relates to a novel and improved method and apparatus for processing a received modulated signal using an equalizer and a rake receiver for improved performance.

A modern day communication system is required to support a variety of applications. One such communication system is a code division multiple access CDMA system that supports voice and data communication between users over a terrestrial link. The use of CDMA techniques in a multiple access communication system is disclosed in U.S. Pat. No. 4 901 307 entitled SPREAD SPECTRUM MULTIPLE ACCESS COMMUNICATION SYSTEM USING SATELLITE OR TERRESTRIAL REPEATERS and U.S. Pat. No. 5 103 459 entitled SYSTEM AND METHOD FOR GENERATING WAVEFORMS IN A CDMA CELLULAR TELEPHONE SYSTEM. Another specific CDMA system is disclosed in U.S. Pat. No. 6 574 211 entitled METHOD AND APPARATUS FOR HIGH RATE PACKET DATA TRANSMISSION issued Jun. 3 2003 hereinafter the HDR system . These patents are assigned to the assignee of the present invention and incorporated herein by reference.

A CDMA system is typically designed to conform to one or more standards. Such standards include the TIA EIA IS 95 Remote Station Base Station Compatibility Standard for Dual Mode Wideband Spread Spectrum Cellular System the IS 95 standard the standard offered by a consortium named 3Generation Partnership Project 3GPP and embodied in a set of documents including Document Nos. 3G TS 25.211 3G TS 25.212 3G TS 25.213 and 3G TS 25.214 the W CDMA standard and the TR 45.5 Physical Layer Standard for cdma2000Spread Spectrum Systems the CDMA 2000 standard . New CDMA standards are continually proposed and adopted for use. These CDMA standards are incorporated herein by reference.

A CDMA system typically employs a rake receiver to process a modulated signal that has been transmitted on the forward or reverse link. The rake receiver typically includes a searcher element and a number of finger processors. The searcher element searches for strong instances of the received signal or multipaths . The finger processors are assigned to process the strongest multipaths to generate demodulated symbols for those multipaths. The rake receiver then combines the demodulated symbols from all assigned finger processors to generate recovered symbols that are estimates of the transmitted data. The rake receiver efficiently combines energy received via multiple signal paths.

The rake receiver provides an acceptable level of performance for CDMA systems operated at low signal to noise ratio S N . For CDMA systems designed to transmit data at high data rates such as the HDR system higher S N is required. To achieve the higher S N the components that make up the noise term N need to be reduced. The noise term includes thermal noise No interference Io due to transmissions by other transmitting sources and transmissions for other users and inter symbol interference ISI that can come from multipath and distortion in the transmission channel. For CDMA systems designed to operate at low S N the ISI component is typically negligible compared to other noise components. However for CDMA systems designed to operate at higher S N the other noise components e.g. interference from other transmission sources are typically reduced and ISI becomes a non negligible noise component that may have a large impact on the overall S N.

As noted above the rake receiver provides acceptable performance when the S N of the received signal is low. The rake receiver can be used to combine energy from various multipaths but generally does not remove the effects of ISI e.g. from multipath and channel distortion . Thus the rake receiver may not be capable of achieving the higher S N required by CDMA systems operating at higher data rates.

As can be seen techniques that can be used to process a received modulated signal to achieve higher S N needed to support higher data rates are highly desirable.

The present invention provides techniques that can achieve the higher S N needed to support higher data rates. In accordance with the invention a number of signal processing paths can be provided to process one or more signals e.g. received via one or more antennas . One signal processing path includes an equalizer that attempts to reduce the ISI due to multipath and channel distortion. Another signal processing path can be implemented with one or more conventional rake receivers. Although the signal processing path that includes the equalizer typically provides better performance under certain operating conditions the signal processing path having a better signal quality estimate can be selected to process the received signal s .

An embodiment of the invention provides a method for processing one or more signals in a spread spectrum communication system. In accordance with the method one or more signals are received e.g. via one or more antennas and processed to provide one or more streams of samples which are then further processed by a first processing scheme to provide a first stream of recovered symbols. In the first processing scheme the stream s of samples are equalized and combined within an equalizer to generate symbol estimates which may subsequently be further processed e.g. despread and decovered to provide the first stream of recovered symbols. The stream s of samples may also be processed by a second processing scheme with one or more rake receivers to provide a second stream of recovered symbols. A signal quality associated with each processing scheme can be estimated and used to select either the first or second processing scheme.

In the first processing scheme the sample stream s may be equalized prior to being combined. In this case each stream of samples is filtered by a respective filter with a set of coefficients and may be scaled by a respective scaling factor. The scaled samples for all streams are then combined to generate the symbol estimates. Alternatively the sample stream s may be combined prior to being equalized. In this case each stream of samples can be scaled by a respective complex scaling factor. The scaled samples for all streams are then combined to generate summed samples that are further filtered with a set of coefficients to generate the symbol estimates.

Each filter within the equalizer can be implemented as a finite impulse response FIR filter an infinite impulse response IIR filter or some other filter structure. The filter coefficients and scaling factor s are typically adapted i.e. trained prior to being used and may further be adapted during use e.g. using a decision directed adaptation scheme .

Depending on the particular design of the equalizer various adaptation schemes can be used. In one adaptation scheme the filter coefficients are adapted separately and sequentially with respect to the scaling factor s . In this adaptation scheme the coefficient adaptation can be performed with the scaling factor s fixed and the scaling factor adaptation can be performed with the coefficients fixed. The coefficient adaptation and scaling factor adaptation can be performed iteratively a number of times e.g. over a particular sequence of expected symbols of known values . For the coefficient adaptation the coefficients of each filter can be adapted based on 1 the filtered samples from the filter and the expected symbols or 2 the symbol estimates and the expected symbols. Similarly the scaling factors can be adapted based on the symbol estimates and the expected symbols. Alternatively in another adaptation scheme the coefficients for all filters are adapted simultaneously based on the symbol estimates and the expected symbols.

For the above adaptation schemes the adaptation can be performed using for example time division multiplexed TDM pilot reference and in accordance with a least mean square LMS algorithm a recursive least square RLS algorithm a direct matrix inversion DMI algorithm or some other adaptation algorithm. Prior to the adaptation the coefficients of each filter can be initialized to a particular set of values e.g. 0 . . . 0 0 . . . 0 and the scaling factor s can also be initialized. A large multipath for each signal being received and processed can be identified and the magnitude and phase of the multipath can be used to initialize the coefficients and scaling factor associated with the signal. A large multipath for one of the signal s being received and processed can also be identified and a time offset corresponding to this multipath can be used for the coefficient and scaling factor adaptation e.g. the time offset can be used to properly generate the expected values .

The signal quality associated with the first processing scheme can be estimated based on a mean square error MSE between the symbol estimates and the expected symbols. The coefficient and scaling factor adaptation can be implemented to minimize this MSE. The MSE can be translated to a signal to noise ratio S N . The MSE or SIN can then be used to select the data rate for the received signal s .

Another embodiment of the invention provides a receiver unit operative to process one or more signals in a spread spectrum communication system. The receiver unit includes one or more pre processors and a first signal processing path that comprises an equalizer and a post processor. Each pre processor receives and processes a respective signal to provide a corresponding stream of samples. The equalizer receives combines and equalizes one or more streams of samples to generate symbol estimates. The post processor receives and may further process e.g. despread and decover the symbol estimates to provide a first stream of recovered symbols. The receiver unit may further include a second signal processing path and a controller. The second signal processing path can comprise one or more rake receivers used to process the sample stream s to generate a second stream of recovered symbols. The controller receives estimates of signal quality associated with the first and second signal processing paths and selects the first or second signal processing path based on the received signal quality estimates.

The post processor can include a PN despreader and a decover element. The PN despreader receives and despreads the symbol estimates with a PN sequence at a particular time offset to provide despread samples. The decover element decovers the despread samples with one or more channelization e.g. Walsh codes to provide the first stream of recovered symbols.

In one design the equalizer includes one or more filters one or more multipliers and a summer. Each filter receives and filters a respective stream of samples with a set of coefficients to provide corresponding filtered samples. Each multiplier receives and scales the filtered samples from a respective filter with a respective scaling factor to provide scaled samples. The summer receives and sums the scaled samples from all multipliers to provide the symbol estimates.

In another design the equalizer includes one or more multipliers a summer and a filter. Each multiplier receives and scales a respective stream of samples with a respective scaling factor to provide scaled samples. The summer receives and sums the scaled samples from all multipliers to provide summed samples. The filter receives and filters the summed samples with a set of coefficients to provide the symbol estimates.

In the above designs the equalizer further includes a coefficient adjustment element that adapts the coefficients of each filter and the scaling factor s for the multiplier s . Various adaptation schemes can be used as described above. Depending on the selected adaptation scheme the filter coefficients can be adapted based on either the filtered samples received from the filter or the symbol estimates. Also the adaptation can be performed using the pilot reference and in accordance with the LMS RLS DMI or some other algorithm.

The receiver unit can be used at a base station or a remote terminal in a spread spectrum e.g. CDMA communication system.

The invention further provides other methods and receiver units that implement various aspects and features of the invention as described below.

At a receiver unit the transmitted signal is received by one or more antennas and provided to a receiver RCVR . Within receiver each received signal is amplified filtered frequency downconverted quadrature demodulated and digitized to provide inphase I and quadrature Q samples. The samples may be digitally processed and then provided to a receive RX data processor that further processes and decodes the samples to recover the transmitted data. The processing and decoding at receive data processor are performed in a manner complementary to the processing and encoding performed at transmit data processor . The decoded data is then provided to a data sink .

The signal processing described above supports transmissions of traffic data messaging voice video and other types of communication in one direction. A bi directional communication system supports two way data transmission. The processing in can represent the forward link processing in a CDMA system in which case transmitter unit can represent a base station and receiver unit can represent a remote terminal. The signal processing for the reverse link is not shown in for simplicity.

As shown in receiver unit includes a number of antennas through that couple to a number of pre processors through used to process the signals received via the antennas. Each combination of antenna and pre processor forms part of a signal path used to process a particular received signal. The use of multiple antennas in receiver unit provides spatial diversity and may further suppress interference from other transmission sources both of which can improve performance. However receiver unit can also be designed with a single signal path and this is within the scope of the invention.

In the embodiment shown in data processor includes an upsampler a finite impulse response FIR filter and a downsampler all coupled in series. Upsampler receives and upsamples the ADC samples by a factor of P. The upsampling can be achieved by inserting P 1 zero valued samples between each pair of successive ADC samples. FIR filter then receives and filters the upsampled samples to remove images generated by the upsampling. FIR filter may further perform match filtering on the received samples. The filtered samples are provided to decimator and decimated by a factor of Q to generate the complex samples x n that are provided to receive data processor . The decimation can be achieved by simply discarding Q 1 samples from every Q filtered samples.

Data processor can also be implemented with a sample rate converter especially if P and Q are not integers or some other design and this is within the scope of the invention. Also data processor can be designed to provide additional and or different functions and this is also within the scope of the invention.

In the IS 95 CDMA system a receiver unit is designed to operate at a low signal to noise ratio S N where S denotes the desired signal and N denotes the total noise. The total noise includes the thermal noise No the interference Io due to transmissions by other transmitting sources and transmissions to other receiver units and inter symbol interference ISI . The ISI can be due to multipath or frequency distortion in the received signal due to the transmitter unit the transmission channel and the receiver unit. For the IS 95 CDMA system the low S N results from the concurrent transmissions of data for multiple users over the same system bandwidth. At the receiver unit the desired signal is recovered from a highly degraded received signal through the use of spread spectrum processing whereby energy from a longer time period is accumulated to generate a signal having improved S N.

The processing of a spread spectrum signal is conventionally performed using a rake receiver that searches for strong instances of the received signal or multipaths processes the strongest multipaths and combines the results from the processed multipaths to generate recovered symbols that are more accurate estimates of the transmitted data. The design and operation of a rake receiver are described in further detail below. The rake receiver efficiently combines energy from multiple signal paths and attempts to optimize the S N. However the rake receiver is limited in its ability to correct for channel induced distortions in the received signal because of the limited number of finger processors used to process the multipaths.

For CDMA systems designed to transmit at higher data rates such as the HDR system higher S N is required to support the higher data rates. To achieve a higher S N on the forward link of the HDR system data is transmitted to one user at any given moment. This eliminates the interference due to transmissions for other users. Moreover the interference from other transmitting base stations may be reduced by operating the HDR system with a reuse factor greater than one and by using a directional antenna at the transmitter unit or the receiver unit or both. To further improve S N ISI which is typically negligible in the IS 95 CDMA system may need to be reduced. The present invention provides techniques to reduce ISI due to multipath and channel distortion to achieve higher S N.

Within receive data processor the streams of samples from pre processors are provided to each of equalizer and rake receiver . Each stream of samples is generated from a respective received signal. Equalizer performs equalization on the received streams of samples and provides symbol estimates to post processor . Depending on the processing performed at transmitter unit post processor may further process the symbol estimates to provide recovered symbols. In particular if PN spreading and covering are performed at the transmitter unit post processor may be configured to perform despreading with a complex PN sequence and decovering with one or more channelization codes. Phase rotation which is achieved via pilot demodulation for a rake receiver is implicitly achieved by equalizer after the filter coefficients have been adopted.

Rake receiver may be configured to process one or more multipaths of each received signal to provide recovered symbols for that received signal. For each stream of samples rake receiver may be configured to perform PN despreading decovering and coherent demodulation for a number of multipaths. Rake receiver then combines demodulated symbols for all multipaths of a received signal to generate recovered symbols for that received signal. Rake receiver may further combine the recovered symbols for all received signals to provide the overall recovered symbols that are provided from the rake receiver.

The recovered symbols from post processor and rake receiver can be provided to a switch SW that selects the recovered symbols from either post processor or rake receiver to provide to a de interleaver . The selected recovered symbols are then reordered by de interleaver and subsequently decoded by a decoder . A controller couples to and manages the operation of equalizer post processor rake receiver and switch .

In accordance with the invention equalizer can be used to provide equalization of the received signals to reduce the amount of ISI in the received signals. Each received signal is distorted by the characteristics of the transmitter unit the transmission channel and the receiver unit. Equalizer can be operated to equalize the overall response for each received signal thus reducing the amount of ISI. The lower ISI improves S N and may support higher data rates.

A slicer can be provided within equalizer to receive and slice i.e. quantize the output symbol estimates n to generate sliced symbol estimates tilde over y n . The sliced symbol estimates can be used to adapt the variables within equalizer i.e. the coefficients within filters and the scaling factors for multipliers in a data directed adaptation scheme as described below. The design of slicer can be dependent on the particular quadrature modulation scheme being supported and more slicing levels can be provided for higher order modulation schemes e.g. 16 QAM 64 QAM and so on . Although not shown in for simplicity one or more slicers can also be provided to slice the symbol estimates n through n from filters through to generate sliced symbol estimates tilde over y n through tilde over y n respectively.

A coefficient adjustment element a receives the symbol estimates n through n the output symbol estimates n the sliced symbol estimates tilde over y n the actual expected symbols y n or a combination thereof. Coefficient adjustment element then adapts i.e. trains or adjusts the coefficients for filters through and the scaling factors for multipliers through based on the received symbol estimates and symbols. Coefficient adjustment element can be designed to implement the Least Mean Square LMS algorithm the Recursive Least Square RLS algorithm the direct matrix inversion DMI algorithm some other algorithm or a combination thereof. Coefficient adjustment element and the adaptation algorithms are described in further detail below.

Within filter the received samples x n are provided to a number of delay elements through coupled in series. Each delay element provides a particular amount of delay e.g. one clock cycle of the received sample rate clock 1 f . The received samples x n and the outputs of delay elements through are provided to multipliers through respectively. Each multiplier also receives a coefficient c scales each received sample with the coefficient and provides the scaled sample to a summer . Summer sums the scaled samples from multipliers through and provides the symbol estimates n . The symbol estimates n can be computed as 

Each filter in provides a frequency response C w that attempts to equalize the overall frequency response G w experienced by the signal being processed by that filter. The overall frequency response G w of the signal includes the frequency response of the transmitter unit the transmission channel and the receiver unit i.e. everything up to the filter . The coefficients of each filter are adapted or trained such that reduced ISI can be achieved.

As shown in a number of signals may be received via a number of antennas and processed by a corresponding number of pre processors . Each pre processor provides a stream of samples to a respective filter . Each filter can include a number of 2M 1 coefficients. Moreover the symbol estimates from K filters are scaled by K scaling factors and combined to generate the output symbol estimates n . Thus up to K 2M 1 K variables may be adjusted for equalizer . The K 2M 1 coefficients of the K filters and the K scaling factors can be adapted based on various adaptation schemes some of which are described below.

In a first adaptation scheme time domain adaptation is performed for the coefficients of filters followed by space domain adaptation for the scaling factors. The time domain adaptation adapts the coefficients of each filter to provide equalization of the received signal being processed by that filter. The space domain adaptation then adjusts the scaling factors associated with all assigned filters to provide equalization of equalizer

For the time domain adaptation filters through can be individually adapted based on their respective received samples and their equalized outputs. Prior to the first adaptation the scaling factors s n through s n can be initialized to a particular set of values e.g. all 1 K . The scaling factors are typically normalized such that their sum total is equal to one which can be expressed as 

Initially for each sample period n in which the coefficient adaptation is performed a set of received samples n x n M . . . x n M is filtered by filter with the set of coefficients n to generate a symbol estimate n which can be expressed as Eq 4 where n is the Hermitian transposed i.e. complex conjugated and transposed set of coefficients. Equation 4 is written in vector form but is equivalent to equation 1 described above. The symbol estimate n is then provided to coefficient adjustment element

Equalizer is typically adapted using known symbols prior to the first time the equalizer is used to process the received samples. For CDMA systems that transmit a pilot reference the equalizer can be adapted using this pilot reference. If the pilot reference is transmitted using time division multiplexing TDM such as in the HDR system the actual symbols y n at the output of equalizer are known during the pilot reference period and can be compared against the per antenna symbol estimates n or the output symbol estimates n . The error between the actual symbols and the symbol estimates can be computed and used to adapt the equalizer. The generation of the actual symbol y n for the HDR system is described in further detail below.

Alternatively if the pilot reference is transmitted using code division multiplexing CDM such as in the IS 95 system the symbol estimates n or n can be further processed to undo the CDM processing and generate recovered pilot symbols circumflex over p n or circumflex over p n respectively that can then be compared against the actual pilot symbols p n or p n respectively. Again the error between the actual pilot symbols and the recovered pilot symbols can be computed and used to adapt the equalizer. The adaptation of equalizer using a TDM pilot reference is described in detail below and the adaptation of equalizer using a CDM pilot reference is described in a subsequent section.

For a sample period n in which the actual symbol y n is known coefficient adjustment element can receive or generate the actual symbol y n for that sample period. An error e n between the symbol estimate n from filter and the actual symbol y n can then be computed for filter as . Eq 5 The error at any particular point in the processing path can be computed as the difference between the symbol estimate at that point and the expected symbol at that point.

Alternatively for a sample period n in which the actual symbol y n is not known an error e n between the symbol estimate n and the sliced symbol estimate tilde over y n can be computed for filter as tilde over y . Eq 6 The computed error e n using either equation 5 or 6 is then used to generate a new set of coefficients n 1 for the next sample period.

As noted above various adaptation algorithms can be used to generate the new coefficients some of which are described below.

For the LMS algorithm the new coefficients n 1 can be computed as 1 Eq 7 where is a unit less adaptation constant.

For the DMI algorithm the new coefficients n 1 can be computed with a training period of Nsymbols as follows 

Each of the LMS RLS and DMI algorithm directly or indirectly attempts to minimize the mean square error MSE which may be expressed as Eq 10 where Ex is the expected value of x. The LMS RLS DMI and other adaptation algorithms are described in further detail by Simon Haykin in a book entitled Adaptive Filter Theory 3edition Prentice Hall 1996 which is incorporated herein by reference.

Once filters through are individually adapted in the manner described above the space domain adaptation can be performed to adapt the scaling factors. The space domain adaptation can be achieved in a manner similar to that described above for the time domain adaptation. Specifically the coefficients of filters through are fixed and the scaling factors s n through s n are adjusted.

Initially for each sample period n in which the scaling factors are adapted each filter filters a set of received samples n with its set of coefficients to generate a symbol estimate n . The symbol estimates n through n from filters through are then provided to respective multipliers through and scaled with respective scaling factors s n through s n to generate the output symbol estimate n which can be expressed as 

The output symbol estimate n is then provided to coefficient adjustment element and used to generate an error e n which can be expressed as either or Eq 12 Eq 13 depending on whether the actual symbols are known equation 12 or not known equation 13 . The computed error e n is then used to generate new scaling factors s n 1 through s n 1 i.e. n 1 using the LMS RLS DMI or some other algorithm in similar manner as that described above for the adaptation of the filter coefficients.

The time domain and space domain adaptations can be iterated a number of times e.g. using the same or different pilot reference to achieve the desired performance. The iterative adaptation can be performed as follows 

Once the coefficients of filters through and the scaling factors are adapted the symbol estimates n from equalizer represent good estimates of the transmitted samples.

After the initial adaptation the equalizer can be periodically re adapted when the known symbols are again received e.g. during subsequent pilot reference periods . Alternatively or additionally equalizer can be adapted using a decision directed adaptation scheme e.g. during actual use when the actual symbols are typically not known . Decision directed adaptation can be performed based on the error between the sliced symbol estimates i.e. the expected signal level of the symbol estimates and the symbol estimates i.e. the actual level of the symbols as they are received .

The first adaptation scheme performs time domain and space domain adaptations separately and sequentially which reduces the complexity of the required computations. For example if each filter includes 2M 1 coefficients the time domain adaptation can be achieved by performing operations on vectors of length 2M 1 and possibly matrices of dimension 2M 1 by 2M 1. And if K signal processing paths are operated in parallel to process K received signals the space domain adaptation can be achieved by performing operations on vectors of length K and possibly matrices of dimension K by K.

In a second adaptation scheme the time domain and space domain adaptations are performed simultaneously for the coefficients and scaling factors within equalizer . In this embodiment all filters through are operated in parallel to filter their respective streams of samples x n through X n . The symbol estimates n through n from filters through can be computed as 

The symbol estimates n through n are then provided to multipliers through respectively scaled by the respective scaling factors s n through s n and combined to generate the output symbol estimate n which can be computed as shown in equation 11 .

An error e n between the symbol estimate n and the actual symbol y n or the sliced symbol estimate tilde over y n is computed as shown in equation 12 or 13 respectively. The error e n is then used to simultaneously adapt the K sets of filter coefficients n through n with the K scaling factors s n through s n fixed . The K set of filter coefficients can be concatenated into one vector of length K 2M 1 which is adjusted by the error e n . In this embodiment up to K 2M 1 variables are adapted simultaneously.

In the second adaptation scheme for a particular set of scaling factors the filter coefficients are adapted simultaneously by performing operations on vectors of length K 2M 1 and possibly matrices of dimension K 2M 1 by K 2M 1 . The required computations can be more complicated than those performed for the first adaptation scheme described above. However improved performance may be achieved since all coefficients can be jointly considered to equalize the received signals such that the output symbol estimates n are good estimates of the actual symbol y n . For example the coefficients of the filter used for antenna can depend on the signal s received via other antenna s .

The adaptation of the filter coefficients and the scaling factors can be achieved with the assistance of rake receiver . In a typical design rake receiver includes a searcher element and a number of finger processors. The searcher element processes the samples for a particular received signal at various time offsets possibly as directed by controller and searches for the strongest multipaths. For a CDMA system the searcher element typically performs a correlation of the received samples with a complex PN sequence that was used to spread the samples at the transmitter unit. The searcher element can be designed to perform the correlation at a specific time offset or at multiple time offsets. Each time offset corresponds to a specific delay of the PN sequence relative to an absolute zero delay PN sequence. The searcher element may also be designed to provide a complex correlation result for each time offset being examined or just correlation results that exceed a particular threshold. The searcher element or controller can be designed to maintain a list of correlation results and their corresponding time offsets for each received signal.

Based on the list of correlation results for all received signals controller can identify the strongest multipath e.g. the multipath having the largest magnitude or energy . The functions performed by the searcher element and finger processors are described in further detail below.

In an embodiment the initial values for the filter coefficients can be set based on the correlation results from rake receiver . For each received signal rake receiver can be operated to search for the strongest multipaths. The magnitude of the correlation results for the strongest multipaths for each received signal can be ranked. The index Ji corresponding to the strongest multipath for a particular received signal can be determined as 

Once the strongest multipath for all received signals is determined the time offset corresponding to this multipath can be identified. The coefficient c n for each filter can then be initialized to one of the following 1 a value related to a finger value which is indicative of the received signal quality of the strongest multipath e.g. c n where is a constant that may be dependent on the noise variance 2 a value of one 1.0 or some other value. The remaining coefficients can each be initialized to zero i.e. c n . . . c n c n . . . c n 0.0 . The time offset corresponding to the strongest multipath can be separated into a coarse portion and a fine portion. The coarse portion can be used as a coarse adjustment to properly generate the actual symbols y n used to adapt the coefficients and scaling factors as described below. The fine portion can be used as a fine adjustment to specify the time epic of the received samples x n . Specifically the fine portion can be used by digital processor to adjust the timing of the resampling clock which enables digital processor to generate received samples x n aligned in time to the time offset. The time offset for the generation of the actual symbols y n also takes into account the number of taps of each filter and the initial values of the coefficients.

The scaling factors can also be initialized with the assistance of rake receiver . For example each of the scaling factors can be initialized to a value that is related to the magnitude of the strongest multipath of the received signal being scaled with that scaling factor. Thus the scaling factors s n through s n can be set to values related to through respectively. Alternatively the scaling factors can each be set to a particular value e.g. 1 K prior to the adaptation. Other methods to initialize the coefficients and scaling factors can also be used and are within the scope of the invention.

As shown in the signal received on each antenna is processed by a respective pre processor to provide a stream of samples x n . Within equalizer the sample streams x n through X n from pre processors through are provided to multipliers through respectively which also receive the respective scaling factors sthrough s. Each multiplier scales the received samples x n with the scaling factor sand provides scaled samples to a summer . The scaling factors for multipliers are typically complex values that allow for a complex combination of the signals received via multiple antennas . Summer receives and sums the scaled samples from multipliers through to generate spatially combined samples x n which are then provided to a filter

Filter performs equalization on the samples x n based on a particular set of coefficients. The symbol estimates n from filter are provided as the output of equalizer and are also provided to a coefficient adjustment element . Filter can be implemented with filter shown in . Similar to that described above for equalizer a slicer can be provided within equalizer to receive and slice the symbol estimates n to generate sliced symbol estimates tilde over y n .

Coefficient adjustment element also receives the actual symbols y n the symbol estimates n and the sliced symbol estimates tilde over y n or a combination thereof. Coefficient adjustment element then adapts the coefficients of filter and the scaling factors sthrough sbased on the received symbol estimates and symbols. Coefficient adjustment element can also be designed to implement the LMS RLS DMI or some other algorithm or a combination thereof. Coefficient adjustment element can be implemented similar to coefficient adjustment element in .

The adaptation of the scaling factors and the coefficients within equalizer can be achieved using adaptation schemes similar to those described above for equalizer

In the first adaptation scheme time domain adaptation is performed first followed by space domain adaptation. To perform the time domain adaptation the scaling factors are initially set to a particular set of values and the filter coefficients are then adapted. The initial values for the scaling factors may be determined for example using direction of arrival DOA estimation which is known in radar theory and described by S. Haykin and A. Steinhardt in a book entitled Adaptive Radar Detection and Estimation John Wiley and Sons June 1992. Alternatively the scaling factors may each be initialized for example to 1 K. With the scaling factors fixed the filter coefficients can then be adapted using the LMS RLS DMI or some other algorithm similar to that described above.

Once the first iteration of the time domain adaptation is completed the coefficients can be fixed and the space domain adaptation can be performed e.g. over the same pilot reference or a different pilot reference . To perform the space domain adaptation the symbol estimates n are computed and used to adapt the scaling factors again using the LMS RLS DMI or some other algorithm similar to that described above. The time domain and space domain adaptations may be iterated a number of times to achieve the desired results. Similar to that described above for equalizer rake receiver can be used to initially set the coefficients for filter and the scaling factors. For example rake receiver can be operated to search for the strongest multipaths for each received signal being processed. The strongest multipath for all received signals can be identified based on equation 17 . The coefficients for filter can be initialized based on the magnitude of the strongest multipath. The time offset corresponding to this multipath can be used to properly generate the actual symbols y n used for the adaptation.

Also the strongest multipath for each received signal can be used to initially set the corresponding scaling factor. For example the initial value for the scaling factor scan be set based on the magnitude of the strongest multipath for the signal received via antenna the initial value for the scaling factor scan be set based on the magnitude of the strongest multipath for the signal received via antenna and so on. The initial values for the scaling factors can also be set based on finger values that are indicative of the received signal quality S N .

For some CDMA systems such as the HDR system a pilot reference is time division multiplexed TDM with other data and transmitted from a base station to the remote terminals. For these CDMA systems the filter coefficients and scaling factors can be adapted using the transmitted pilot reference. Thereafter the coefficients and scaling factors are fixed and used to process data that is transmitted in the time periods between the pilot references.

In accordance with the HDR CDMA system prior to transmission the traffic data is covered with Walsh codes corresponding to the channels to be used for the data transmission and the power control data for each remote terminal is covered with the Walsh code assigned to the remote terminal. The pilot reference covered traffic data and power control data are then spread with a complex PN spreading sequence generated by multiplying the short IPN and QPN spreading sequences assigned to the particular transmitting base station with the long PN sequence assigned to the recipient remote terminal. At the highest date rates the bit rate may match or exceed the chip rate of the PN spreading sequence and the Walsh codes and no direct sequence spreading of the data is achieved. The data frame format and the processing of the forward link transmission for the HDR system is described in further detail in the aforementioned U.S. Pat. No. 6 574 211.

For some CDMA systems such as the IS 95 CDMA system a pilot reference is code division multiplexed CDM with other data and transmitted from a base station to the remote terminals. For these CDMA systems the filter coefficients and scaling factors can be adapted using the transmitted CDM pilot reference. However since the pilot reference is code division multiplexed with other data additional processing is performed on the per antenna symbol estimates n or the output symbol estimates n to extract the transmitted pilot reference.

For the IS 95 CDMA system the pilot reference an all ones sequence is covered with a 64 chip all zeros Walsh sequence combined with other covered data and spread with the PN sequence. The transmitted CDM pilot reference can be recovered by processing the output symbol estimates n in a complementary manner. Referring to which is described in greater detail below within post processor the symbol estimates n are despread with the PN sequence decovered with the pilot Walsh sequence and accumulated over the 64 chip pilot symbol period to generate recovered pilot symbols circumflex over p n . The decovering removes the data on the other traffic channels which have been covered with Walsh sequences that are orthogonal to the pilot Walsh sequence.

The error e n between the recovered pilot symbols circumflex over p n and the actual expected pilot symbol p n can then be computed as . Eq 18 The error e n can then be used to adapt the filter coefficients and scaling factors using any combination of adaptation scheme and adaptation algorithm e.g. LMS RLS or DMI described above. For equalizer in the adaptation can also be performed using the per antenna symbol estimates n from each filter . The symbol estimates n can be processed by post processor in the manner described above to generate recovered pilot symbols circumflex over p n . The error e n between the recovered pilot symbols circumflex over p n and the expected pilot symbol p n can then be computed as . Eq 19 Generally an error between the recovered symbols e.g. n or circumflex over p n and the expected symbol e.g. y n or p n can be computed at any particular point in the receiver unit. Proper processing is performed such that equivalent or like kind symbols are being compared.

For CDMA systems that transmit a CDM pilot reference an error e n may be computed for each pilot symbol period e.g. every 64 chips for the IS 95 CDMA system . If the CDM pilot reference is transmitted continuously such as for the IS 95 CDMA system the adaptation can also be performed in a continuous manner albeit at a lower pilot symbol rate. For CDMA systems that transmit a TDM pilot reference an error may be computed for each chip period. However the adaptation using the TDM pilot reference is typically only performed during the pilot reference period.

As noted above information from the rake receiver can be used to 1 initialize the filter coefficients prior to the first adaptation 2 properly generate the expected symbols y n or p n and 3 specify the time epic of the received samples x n as described above. For equalizer in the center coefficient c n of each filter can be initialized to the finger value e.g. c n of the strongest multipath of the signal being processed by that filter. The time offset of the strongest multipath can be used to generate the expected symbols y n or the expected pilot symbols p n and to generate received samples x n that are aligned in time to the time offset. The expected symbols y n and p n are also generated by taking into account the delay associated with the processing elements up to the point where the error is computed. For example for a particular time offset the expected pilot symbols p n would be generated with a delay relative to expected symbols y n to account for the delay of post processor .

The filter coefficients and scaling factors can also be adapted using the received data. The received samples can be processed decoded and CRC checked to determine whether a data packet was received without error. A correctly received data packet can then be re encoded and re processed in a manner similar to that performed at the transmitter unit. The re generated symbols can then be compared against the recovered symbols e.g. n and the error between these can be used to adapt the filter coefficients and scaling factors. The recovered symbols are appropriately buffered to account for the decoding re encoding and re processing delays.

As shown in the received Iand Qsamples from a particular pre processor are provided to a number of finger processors through . Within each assigned finger processor the received Iand Qsamples are provided to a PN despreader which also receives a complex PN sequence PNI and PNQ. The complex PN sequence is generated in accordance with the particular design of the CDMA system being implemented and for the HDR system is generated by multiplying the short IPN and QPN sequences with the long PN sequence by multipliers and . The short IPN and QPN sequences are used to spread the data at the transmitting base station and the long PN sequence is assigned to the recipient receiver unit and used to scramble the data. The PNI and PNQ sequences are generated with a time offset corresponding to the particular multipath being processed by that finger processor.

PN despreader performs a complex multiply of the complex Iand Qsamples with the complex PN sequence and provides complex despread Iand Qsamples to decover elements and . Decover element decovers the despread samples with one or more channelization codes e.g. Walsh codes that were used to cover the data and generates complex decovered samples. The decovered samples are then provided to a symbol accumulator that accumulates the samples over the length of the channelization codes to generate decovered symbols. The decovered symbols are then provided to a pilot demodulator .

For the HDR system a pilot reference is transmitted during a portion of the forward link transmission. Thus decover element decovers the despread samples with the particular channelization code e.g. a Walsh code 0 for the HDR system that was used to cover the pilot reference at the base station. The decovered pilot samples are then provided to an accumulator and accumulated over a particular time interval to generate pilot symbols. The accumulation time interval can be the duration of the pilot channelization code an entire pilot reference period or some other time interval. The pilot symbols are then provided to a pilot filter and used to generate pilot estimates that are provided to pilot demodulator . The pilot estimates are estimated or predicted pilot symbols for the time period when data is present.

Pilot demodulator performs coherent demodulation of the decovered symbols from symbol accumulator with the pilot estimates from pilot filter and provides demodulated symbols to a symbol combiner . Coherent demodulation can be achieved by performing a dot product and a cross product of the decovered symbols with the pilot estimates. The dot and cross products effectively perform a phase demodulation of the data and further scale the resultant output by the relative strength of the recovered pilot. The scaling with the pilots effectively weighs the contributions from different multipaths in accordance with the quality of the multipaths for efficient combining. The dot and cross products thus perform the dual role of phase projection and signal weighting that are characteristics of a coherent rake receiver.

Symbol combiner receives and coherently combines the demodulated symbols from all assigned finger processors to provide recovered symbols for a particular received signal being processed by the rake receiver. The recovered symbols for all received signals may then be combined as described below to generate overall recovered symbols that are then provided to the subsequent processing element.

Searcher element can be designed to include a PN despreader a PN generator and a signal quality measurement element. The PN generator generates the complex PN sequence at various time offsets possibly as directed by controller which are used in the search for the strongest multipaths. For each time offset to be searched the PN despreader receives and despreads the Iand Qsamples with the complex PN sequence at the particular time offset to provide despread samples. The signal quality of the despread samples is then estimated. This can be achieved by computing the energy of each despread sample i.e. I Q and accumulating the energy over a particular time period e.g. the pilot reference period . Searcher element performs the search at numerous time offsets and the multipaths having the highest signal quality measurements are selected. The available finger processors are then assigned to process these multipaths.

The design and operation of a rake receiver for a CDMA system is described in further detail in U.S. Pat. No. 5 764 687 entitled MOBILE DEMODULATOR ARCHITECTURE FOR A SPREAD SPECTRUM MULTIPLE ACCESS COMMUNICATION SYSTEM and U.S. Pat. No. 5 490 165 entitled DEMODULATION ELEMENT ASSIGNMENT IN A SYSTEM CAPABLE OF RECEIVING MULTIPLE SIGNALS both assigned to the assignee of the present invention and incorporated herein by reference.

In the embodiment shown in a number of forward link signals are received by antennas through and processed by pre processors through respectively to generate sample streams x n through x n . Thus a number of rake receivers can be provided to process the K sample streams. A combiner may then be used to combine the recovered symbols from all received signals being processed. Alternatively one or more rake receivers can be time division multiplexed to process the K sample streams. In this TDM rake receiver architecture the samples from the K streams can be temporarily stored to a buffer and later retrieved and processed by the rake receiver.

For each received signal rake receiver can be operated to process up to L multipaths where L represents the number of available finger processors . Each of the L multipaths corresponds to a particular time offset that is identified with the assistance of searcher element . Controller or searcher element can be designed to maintain a list of the magnitude of the strongest multipath and its corresponding time offset for each of the K received signals being processed. These magnitudes and time offsets can be used to initialize the coefficients and scaling factors of equalizer as described above. In one implementation the magnitude of each multipath of interest can be computed as the square root of the accumulated energy value divided by the number of samples N used in the accumulation.

Within post processor the symbol estimates are provided to a PN despreader which also receives a complex PN sequence having the same time offset as that used to adapt the filter coefficients. PN despreader despreads the symbol estimates with the complex PN sequence and provides the despread samples to a decover element . Decover element then decovers the samples with one or more channelization codes used to cover the data at the base station. The decovered samples for each channel are then accumulated over the length of the channelization codes by a symbol accumulator to generate recovered symbols that are then provided to the subsequent processing element.

Equalizer post processor and rake receiver can be time division multiplexed to process samples of all received signals using a single set of processing elements. Also some of the elements within post processor are similar with those within rake receiver . Thus post processor and rake receiver can be designed and operated such that at least some of the common functions can be performed by a shared set of processing elements.

During the adaptation period for filters shown in the actual symbol y n can be generated based on the time offset of the strongest multipath for all received signals. For the HDR system the pilot reference is an all ones sequence and the channelization code used to cover the pilot reference is Walsh code 0 i.e. the all zeros sequence . The pilot reference is then despread with the complex PN sequence. Thus the transmitted pilot reference is equal to the complex PN sequence for the time duration in which the pilot reference is transmitted.

At the receiver unit the actual symbol y n during the pilot reference period can be generated as the complex PN sequence at the time offset corresponding the strongest multipath of all received signals i.e. y n PNI n jPNQ n .

Referring back to receive data processor includes two signal processing paths that can be operated to process the received signals. The first signal processing path includes equalizer and post processor and the second signal processing path includes rake receiver . In an embodiment the two signal processing paths can be operated in parallel e.g. during the adaptation period and a signal quality estimate can be computed for each of the signal processing paths. The signal processing path that provides the better signal quality can then be selected to process the received signals.

For a conventional rake receiver the received signal quality can be estimated by computing the signal to noise S N ratio. For CDMA systems that transmit TDM pilot reference the S N can be computed during the pilot reference period when the received signal is known. A signal quality estimate can be generated for each assigned finger processor. The estimates for all assigned finger processors can then be weighted and combined to generate an overall S N which can be computed as 

For the signal processing path that includes equalizer the signal quality can be estimated using various criteria including a mean square error MSE . Again for CDMA systems that transmit TDM pilot reference the MSE can be estimated during the pilot reference period and can be computed as 

The S Nfor the signal processing path with equalizer can be compared with the S Nfor the signal processing path with rake receiver . The signal processing path that provides the better S N can then be selected to process the received signals.

Alternatively the MSE can be computed for the signal processing path with rake receiver using equation 23 and compared against the MSE computed for the signal processing path with equalizer . The signal processing path with the better MSE can then be selected.

For the HDR system the S N is estimated at a remote terminal and used to determine a maximum data rate that can be received by the remote terminal for the operating conditions. The maximum data rate is then transmitted back to the base station for which the S N is estimated. Thereafter that base station transmits to the remote terminal at a data rate up to identified maximum data rate.

With the present invention the data rate for a data transmission can be estimated using various methods. In one method the S N can be estimated for the rake receiver or for the equalizer based on the computed MSE as shown in equation 24 . The best S N from all signal processing paths can then be used to determine a maximum data rate that can be supported. Alternatively the MSE can be used to directly determine the maximum data rate. The best S N MSE or maximum data rate can be sent to the base station.

Under certain operating conditions the signal processing path with the equalizer can provide better performance than the one with the rake receiver. For example the signal processing path with the equalizer typically performs better when the S N is high and for channels with ISI. The rake receiver can be used to process multipaths which also cause ISI. In fact the rake receiver can be viewed as a filter with L taps where L corresponds to the number of finger processors with each tap corresponding to a time delay that can be adjusted. However the rake receiver is not as effective at reducing ISI due to frequency distortion in the received signals.

The equalizer can more effectively reduce ISI due to frequency distortion. This is achieved by providing a response that is approximately the inverse of the frequency distortion while attempting to minimize the overall noise which includes the ISI. The equalizer thus inverts the channel and also attempts to smooth out the effect of multipath. In fact each filter when the coefficients are initialized to 0 . . . 0 1 0 . . . 0 is equivalent to one finger processor. Subsequently as the zero valued coefficients are adapted the filter frequency response is altered to equalize the channel distortion. Thus the equalizer can be used to effectively deal with both multipath induced ISI and channel induced ISI.

For simplicity many of the aspects and embodiments of the invention have been described for a spread spectrum communication system. However many of the principles of the invention described herein can be applied to non spread spectrum communication systems and communication systems capable of selectively performing direct sequence spreading such as the HDR system.

Filters in can be designed to be of any length i.e. any number of taps and coefficients . More taps allow filter to better correct for frequency distortion in the received signal and to process multipaths having larger time offsets. However more taps equate to increased complexity more complicated computations to equalize the taps and possibly longer convergence time. The number of taps is thus a design choice and is selected based on a number of factors including for example costs performance complexity and so on. For example it may be desirable to provide equalization over a particular time window e.g. 20 sec in which case the number of taps may be dependent on the sample rate f. Any number of taps can be employed and are within the scope of the invention.

The processing units described herein e.g. filters equalizer post processor rake receiver and so on can be implemented in various manners such as for example within one or more application specific integrated circuits ASICs digital signal processors DSPs microcontrollers microprocessors or other electronic circuits designed to perform the functions described herein. Also the processing units can be implemented with a general purpose or specially designed processor operated to execute instruction codes that implement the functions described herein. Thus the processing units described herein can be implemented using hardware software or a combination thereof.

The foregoing description of the preferred embodiments is provided to enable any person skilled in the art to make or use the present invention. Various modifications to these embodiments will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other embodiments without the use of the inventive faculty. Thus the present invention is not intended to be limited to the embodiments shown herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein.

