---

title: Telecommunications device for use between analog telephones and a packet network
abstract: A communication device is coupled to a packet network and includes two ports coupled to two analog telephones. The communication device receives a message from the packet network indicating a called number and processes the called number to select one of the ports and to transfer a ring signal through the selected port to ring the analog telephone. The communication device transfers a message to the packet network indicating that a called party is being alerted, detects an off-hook condition for the analog telephone and stops the transfer of the ring signal, transfers a message to the packet network indicating packet routing information for the communication session, exchanges analog voice signals with the analog telephone through the selected port, exchanges voice packets with the packet network using the packet routing information, and interworks between the analog voice signals and the voice packets.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07443840&OS=07443840&RS=07443840
owner: Sprint Communications Company L.P.
number: 07443840
owner_city: Overland Park
owner_country: US
publication_date: 20050217
---
This patent application is a continuation of patent application Ser. No. 09 803 842 filed Mar. 12 2001 entitled Telecommunications Provider Agent which is a continuation of U.S. Pat. No. 6 229 803 filed Aug. 5 1998 entitled Telecommunications Provider Agent and which is hereby incorporated by reference into this patent application.

The invention is related to the field of telecommunications and in particular to a communication device that is utilized between analog telephones and a packet network.

Advanced communications networks are being developed to support a vast array of communications services. These networks are controlled by complex hardware and software platforms referred to as session managers. Users requiring communications sessions from these advanced networks must interface with the session managers to request and receive communications services. Session managers operate using various messages such as invite messages reply messages confirm messages join messages and terminate messages.

A class 5 telephone switch communicates with an analog telephone using the analog telephony signals in the well known analog telephony format. The class 5 telephone switch provides power to the telephone. The class 5 telephone switch detects off hook current caused by the telephone and provides the telephone with dial tone. The caller generates Dual Tone Multi Frequency DTMF signals. The class 5 telephone switch detects the DTMF signals and initiates the call in the network. When the far end telephone is ringing the class 5 telephone switch plays a ringback tone to the caller. If the far end telephone is busy the class 5 telephone switch plays a busy tone to the caller. On incoming calls the class 5 telephone switch provides ring current to the telephone.

Telephony cards are being developed to manage multiple telephones in the home. The telephony cards are typically plugged into communications hubs or computers in the residence and telephones are connected to the telephony card. The telephony cards connect these telephones in the home to a network element in the advanced communications network. This connection between the telephony card and the network element is much different than the traditional analog line to the local switch. This connection is typically an Asynchronous Transfer Mode ATM connection to an ATM device. ATM signals do not traditionally support analog telephony signals such as off hook dial tone and busy signals. The telephony cards detect off hook conditions on hook conditions and digits. In addition the telephony cards provide the telephones with dial tone ring current ringback and busy signals.

At present there is not an acceptable software interface method or product for use between the telephony card and the session manager in the network. There is a need for software that can provide an interface between the telephony card and the session manager.

Some examples of the invention include a communication device that is coupled to a packet network and that includes at least two ports respectively coupled to at least two analog telephones. The communication device receives a first message from the packet network indicating a called number and responsively processes the called number to select one of the ports coupled to one of the analog telephones. The communication device transfers a ring signal through the selected port to ring the one analog telephone. The communication device transfers a second message to the packet network indicating that a called party associated with the called number is being alerted responsive to transferring the ring signal. The communication device detects an off hook condition for the one analog telephone and responsively stops the transfer of the ring signal. The communication device transfers a third message to the packet network indicating packet routing information for the communication session. The communication device exchanges analog voice signals with the one analog telephone through the selected port and exchanges voice packets with the packet network using the packet routing information. The communication device interworks between the analog voice signals and the voice packets.

The network is comprised of network elements that provide digital communications services to the telephony card . Some examples of network elements are ATM switches and multiplexers Digital Subscriber Line DSL equipment Internet Protocol IP routers and servers and enhanced services platforms. The session manager controls the set up and delivery of communications services in the network . The session manager receives user service requests and invokes the desired services through network elements .

Version 0.8 of the Retailer Reference Point Specification issued by the Telecommunication Information Network Architecture Consortium TINA C specifies the session manager and the connection and messaging between the session manager and the provider agent . The interface between the session manager and the provider agent is compiled into CORBA IDL. The interface transport is via Transaction Control Protocol Internet Protocol TCP IP using Logic Link Control Sub Network Access Protocol LLC SNAP encapsulation and ATM Adaptation Layer 5 AAL5 to provide Permanent Virtual Connection PVC connectivity.

The telephony card includes channels for the phones and an interface to the network . In some embodiments of the invention the channels to the phones are conventional telephone ports and the interface to the network is an ADSL ATM port. The telephony card includes circuitry to interwork analog telephony signals from the phones with the digital signals to the network . One example of such a digital signal is an ADSL ATM signal. The telephony card includes circuitry that generates dial tones ring back tones busy tones fast busy tones and ring current for the phones . The telephony card includes circuitry that detects Dual Tone Multi Frequency DTMF digit events off hook events and on hook events and that provides messages indicating these events. The telephony card also includes software control systems that control the circuitry and interface with the API . One example of the telephony card is the telephony card product provided by InnoMedia Logic IML of Quebec Canada.

The phones represent any communications devices supported by the telephony card . Some examples are conventional analog telephones wireless phones computers modems and fax machines. Additional phones could be connected to channels A and B or additional phones could be connected to additional channels on the telephony card . Only two channels with one phone each is shown for the sake of clarity.

Those skilled in the art are familiar with the telephony card and the network . A description of these elements is found in co pending U.S. patent application Ser. No. 08 826 641 entitled Telecommunications System filed on Apr. 7 1997 assigned to the same entity as this patent application and that is hereby incorporated by reference into this patent application. A description of these elements is found in co pending U.S. patent application entitled Asynchronous Transfer Mode System for Providing Telephony Service 09 129248 filed on the same date as this patent application assigned to the same entity as this patent application and that is hereby incorporated by reference into this patent application.

The API is a software interface that exchanges event messages and instructions between the telephony card and the provider agent . The provider agent accepts event messages from the telephony card through the API and provides instructions back to the telephony card . For example the provider agent might receive information through the API that the phone has gone off hook. In response the provider agent might provide a control instruction through the API to the telephony card to provide dial tone to the phone . In some embodiments of the invention the API is specified in CORBA IDL.

The provider agent responds to event messages for the phones with instructions for the telephony card to interact with the user. User interaction includes dial tone digit collection ring ringback and busy signals. The provider agent also exchanges messaging with the session manager . Messages include invite messages reply messages join messages confirm messages and terminate messages.

Both the provider agent and the API are comprised of software that is stored on a software storage medium. Examples of a software storage medium include magnetic disks optical disks or integrated circuits. The provider agent and the API could also be stored on a server and down loaded to a user over the Internet or another operational connection. Both the provider agent and the API are executed by a microprocessor system. The microprocessor system could be comprised of a single microprocessor or a configuration of related microprocessors. The microprocessor system could be housed in many devices with a few examples being a residential communications hub a computer or the telephony card . In some embodiments of the invention the provider agent is comprised of objects written in C code.

The controller object communicates with the session manager and the port objects . Communications with the session manager are comprised of the following messages 

The controller object encapsulates call related information by generating call record objects that are identified by session ID and channel ID. The controller object stores data indicating the idle or busy status of each channel. The controller object includes an internal data structure for any desired call handling policies. Call handling policies include rules for call waiting voice mail call blocking and the internal routing of incoming calls to particular phones such as idle phones. These policies can be varied based on the caller s number the time of day or other factors.

The port objects are state machines. depicts one example of a state machine for the port object in block diagram form. The initial state is Idle. An off hook event for channel A moves the port object to the dial tone state and an instruction to provide dial tone is provided to the telephony card . A digit event for channel A moves the port object to the collect digits state and an instruction to stop dial tone is provided to the telephony card . The port object creates a digit collection object. Digits that are collected by the telephony card are provided to the digit collection object for analysis. The digit collection object determines the type of number dialed such as emergency numbers seven digit numbers ten digit numbers and international numbers. The digit collection object instructs the port object when digit collection is complete. A digits complete event for channel A moves the port object to the call proceeding state and the port object instructs the controller object to send Start Service and Invite messages to the session manager . An alerting indication from the controller object moves the port object to the ringback state where a ringback instruction is provided to the telephony card. The alerting event is based on a reply message from the session manager . A join event from the controller object moves the port object to the active state where the session is conducted. The join event is based on a join message from the session manager . An on hook event for channel A moves the port object back to the idle state and results in a termination message being sent by the controller object to the session manager .

A few deviations from the above described state machine should be appreciated. If the reply message had a busy indication a busy state would be entered instead of the ringback state and a busy tone instruction would be provided to the telephony card . If the reply message had a reject indication a fast busy state would be entered instead of the ringback state and a fast busy tone instruction would be provided to the telephony card . In both of the above cases an on hook event moves the port object back to the idle state.

When receiving a call the state machine is much simpler. In the idle state an invite indication from the controller object moves the port object to the ring state where the telephony card is instructed to ring channel A. The invite indication is based on an invite message from the session manager . An off hook event for channel A moves the port object to that active state until an on hook event moves the port object back to the idle state.

Referring back to the event objects track the events for each respective channel and indicate the events to the respective port objects . The event object can process events using a different thread than the port object and the event object can process events using a different thread than the port object . Multi threaded processing in this manner has advantages. Multi threading simplifies system design and is more efficient than a single threaded system. Multi threading allows multiple threads to be processed in various states at the same time without the entire system waiting for a single input.

The API utilizes a messaging format comprised of an instruction followed by variables in parentheses. The primary instructions are 

In the above messages the channel ID identifies the relevant channel of the telephony card . The tone types are dial tone ringback busy and fast busy. The event types are off hook on hook and digit. The value is the value of the digit. The VPI VCI identifies the Virtual Path and Virtual Channel used by the telephony card for the session.

The thread manager object provides fault tolerance for software failures and certain hardware failures. The thread manager object continuously receives heartbeat messages from the objects . If a heartbeat message is not received as expected the thread manager object identifies and attempts to restart the affected thread. If the heartbeat is still absent the thread manager object instructs the telephony card to use conventional fail over analog telephone service for the channel with the malfunctioning thread.

The user inputs a called number using the telephone . The telephony card detects the digits and forwards the values to the event object . For a called number of 1 800 555 2222 the messages event A digit 1 and event A digit 8 would be used for the first two dialed digits and the message event A digit 2 would be used for the last dialed digit. The event object provides a digit indication to the port object . After the first digit the port object moves from the dial tone state to the digits state and sends stop tone A dial to the telephony card . In response the telephony card stops the dial tone on channel A. The port object also processes the digit values with the digit collection object.

The digit collection object determines that the formatting of the called number is correct and that digit collection is complete. The digit collection object indicates to the port object that digit collection is complete and provides the called number. In response to the digits complete message the port object moves from the digits state to the call proceeding state and indicates a request for telephony service with the dialed number to the controller object .

The controller object generates and transmits a Start Service message requesting telephone service to the session manager . The session manager responds with reference information such as the session ID the party ID and a secret ID. On the controller object generates and transmits an invite message with the dialed number to the session manager . The session manager typically sets up the session and returns a reply message to the controller object indicating that the called party is being alerted. Alternatively the called party might be busy or might reject the session.

If an alerting indication is received in the reply message the controller object indicates the alerting condition to the port object and the port object moves to the ringback state. The port object sends start tone A ringback to the telephony card . In response the telephony card puts a ringback tone on channel A to emulate a ringing phone at the far end.

When the party at the far end accepts the invitation the session manager sends a Join message to the controller object . In response the controller object generates and transmits an add stream message to the session manager with the terminal ID the party ID and the VPI VCI. The session manager sends a Confirm message to the controller object and the controller object sends a confirm indication to the port object . In response to the confirm indication the port object sends open voice channel A VPI VCI to the telephony card . In response to the open voice channel message the telephony card stops the ringback tone and interworks the analog telephony signal on channel A with the ATM signal on the VPI VCI. At this point the session is in progress and the telephone call can proceed.

The session ends when the user places the phone on hook. The telephony card sends event A on hook to the event object which indicates the on hook to the port object . The port object indicates the termination status to the controller object and sends close voice channel A VPI VCI to the telephony card . The telephony card ceases to interwork channel A with the VPI VCI. The controller object generates and transmits a Terminate message to the session manager .

When the user takes the phone off hook to answer the call the telephony card sends event A off hook to the event object which indicates the off hook to the port object . The port object sends stop ring A to the telephony card which stops the ringing. The port object informs the controller object that the user has joined the session and the controller object sends a join message to the session manager .

The session manager sends reference information to the controller object indicating the session ID party ID and secret ID. The session manager also sends a Join Stream message to the controller object . In response the controller object generates and transmits reference information to the session manager with the terminal ID the party ID and the VPI VCI. The session manager sends a Confirm message to the controller object and the controller object sends a confirm indication to the port object . In response to the confirm indication the port object sends open voice channel A VPI VCI to the telephony card. At this point the session manager has the information to set up the connection. Subsequently the session is in progress and the telephone call can proceed.

The session ends when a termination message is received by the controller object from the session manager . The controller object indicates the termination status to the port object which sends close voice channel A VPI VCI to the telephony card . The telephony card ceases to interwork channel A with the VPI VCI.

It should be appreciated that various combinations of call origination and termination can occur in the context of the invention. For example the phone can originate a call or receive a call. Likewise the phone can terminate a call or the called party can terminate a call. It should also be appreciated that the port object and the event object operate in a similar fashion to the port object and the event object respectively. Using these objects the provider agent can handle multiple sessions at the same time. A provider agent can have numerous such objects but only two groups are shown for purposes of clarity.

Race conditions exist when improper events occur given the current state of the port objects . This typically occurs when calls are incoming and outgoing at the same moment. One example is where an invite message is received by the controller object and the controller object determines that the status of channel A is idle but in reality the port object is already in the dial tone state due to an off hook event. The port object will receive an invite indication from the controller object when it expects to receive digit indications from the event object . In this case the port object must instruct the controller object to reply busy or reject and to set channel A status to busy.

In another example the controller object may receive an invite message from the session manger but before the phone rings the phone goes off hook. The port object will receive an invite indication from the controller object and an off hook event from the telephony card . In this case the port object instructs the telephony card to open the voice channel and VPI VCI for the incoming call as if the phone was answered for that call.

The telephones and are conventional communications devices that use the analog telephony format. The connections and are any medium operational to carry analog telephony signals and the connections and are typically twisted pairs of copper wires. The connection is also capable of carrying signals using the ATM DSL format. The ATM DSL format is a DSL signal that transports ATM cells as the high bandwidth data.

The residential hub is located at a residence. A residence is a conventional dwelling where people reside such as a house duplex apartment or condominium. The residential hub provides an analog telephony interface to the telephones and . The residential hub provides an ATM DSL interface to the DSL mux . The residential hub executes provider agent software that directs system operation.

The DSL mux is a device that interworks the ATM ADSL format with an ATM broadband format. The ATM broadband format is a broadband signal that transports ATM cells. Synchronous Optical Network SONET is a popular broadband format and the ATM SONET format is well known. Preferably the DSL mux includes redundant OC 3 network interfaces and handles up to residences on the access side. The DSL mux should be able to differentiate data from voice. In some embodiments the DSL mux could be adapted to provide Switched Virtual Circuits SVCs to the ATM switches . The DSL mux could be adapted from the DSL product provided by Westell.

The ATM switch is able to establish SVCs and Permanent Virtual Circuits PVCs . The ATM switch is conventional such as the Vector switch supplied by Nortel. The connection carries the ATM broadband format. In some embodiments the connection carries the ATM SONET format. For example the connection could be comprised at least in part of a Broadband Metropolitan Area Network BMAN that uses a 4 fiber bi directional line switched self healing OC 3 SONET ring.

There are various ATM connectivity options between the ATM switch and the residential hub . ATM connections could be provisioned as PVCs from the residential hub directly to the ATM switch . PVCs tend to waste bandwidth in the SONET rings comprising the connection . ATM connections could be provisioned from the residential hub to the DSL mux and the DSL mux and the ATM switch could establish SVCs to communicate. The entire connection between the residential hub could be established with SVCs as needed. Combinations of PVCs and SVCs could also be used. For example low bandwidth control channels could be provisioned directly from the residential hub to the ATM switch but higher bandwidth user channels could be established on an SVC basis.

The residential hub includes an ATM DSL interface an ATM backplane a telephony card and other cards . The telephones and are connected to the telephony card by connections and . The ATM DSL interface is connected to the DSL mux by connection . An uninterruptable power supply UPS may be included if desired in order to provide power during an outage to the residence.

The ATM DSL interface provides smoothing and shaping for the ATM signals. The ADSL ATM interface converts control and communications ATM cells into the ATM DSL format for transport to the DSL mux . The ATM DSL interface also receives control and communications ATM cells from the DSL mux and provides these to the appropriate components of residential hub using the ATM backplane . The ATM backplane allows for ATM communications within the residential hub .

The telephony card supports analog telephony communications with the telephones and . The telephony card is controlled by a provider agent that is resident in the residential hub . The telephony card provides power and dial tone to the telephones. The telephony card detects on hook off hook and DTMF tones. The telephony card provides ringback and busy tones to the telephones and . The telephony card interworks analog telephony signals with ATM signals. In some embodiments the telephony card provides echo cancellation or other digital signal processing functions. The telephony card could be adapted from the telephony card product supplied by Innomedia Logic of Quebec Canada.

The other cards represent a number of different cards that can be plugged into the residential hub. Empty slots for additional cards are also shown on the ATM backplane. Some examples of other cards include a Java card ATM card MPEG card utility card or LAN card. The cards provide communications services to the end users as discussed below.

The Java card includes a processor and memory and is operational to receive Java applets from the service node. Java applets can support a wide variety of tasks. In particular Java applets can be used to provide the intelligence to support class 5 features such as call waiting and call forwarding. The Java card also exerts control over the cards and DSL ATM interface . This could include ATM virtual connection assignments for communications to the mux or a service node. The Java card may also communicate with the service node to request numerous other communications services. The ATM card provides an ATM interface to devices within the residence. If the ATM card exchanges ATM signaling with resident devices over VPI 0 and VPI 5 then the ATM card may use virtual path associated signaling to exchange control information with the service node. The MPEG card provides an MPEG interface to devices within the residence. MPEG is a video formatting standard. Typically the MPEG card will receive MPEG formatted video in ATM cells through the ATM DSL interface and provide video signals to devices in the residence. The utility card is coupled to utility metering devices in the home. The utility card is programmed to collect the metering information and forward it to the utility companies through ATM DSL interface . The LAN card supports a LAN that is internal to the residence. For example the LAN card could support ethernet connections to multiple computers. The computers could access the Internet through the LAN card and ATM DSL interface .

The invention is not restricted to basic telephone service. A subscription configuration service could also be deployed. The provider agent would analyze the called number to determine if telephone service or the subscription configuration service is requested. The provider agent would then direct the telephony card to couple the call to the requested service. Other services could be implemented in a similar fashion.

Those skilled in the art can appreciate variations of the above described embodiments that fall within the scope of the invention. As a result the invention is not limited to the specific embodiments discussed above but only by the following claims and their equivalents.

