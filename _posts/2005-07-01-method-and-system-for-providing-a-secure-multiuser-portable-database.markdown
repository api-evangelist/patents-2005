---

title: Method and system for providing a secure multi-user portable database
abstract: A system and method for providing, managing, and accessing a multi-user secure portable database using secure memory cards is provided. The database has a secure portion for storing security keys and a non-secure portion for encrypted data files. Access to the encrypted data files is controlled by assigning access rights through an access control matrix to each encrypted data file according to a hierarchical structure of users. A user requesting access is identified in the hierarchy, associated with a key for allowing the requested access, and the requested access allowed to a file in accordance with the rights allocated through the access control matrix. A patient can selectively grant access to encrypted medical records on his card to a physician. Authentication of the owner/patient is preferably required. Other records required by emergency medical personnel are readable from the same card without requiring permission from the patient.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07661146&OS=07661146&RS=07661146
owner: PrivaMed, Inc.
number: 07661146
owner_city: Carle Place
owner_country: US
publication_date: 20050701
---
The present invention relates generally to a system and method for providing a secure portable database and more particularly to a system and method for providing the secure storage of and hierarchical multi user access to privatized data on a portable database.

Conventionally portable storage of data has been commercially available for electronically strong text such as addresses and phone numbers or for simple storage and access of a common type of digital media such as music. These databases commonly provided on flash memory cards or Universal Serial Bus USB tokens have nominal or no built in security since the intended use is for non sensitive data storage and access for a single user. In other words these products do not provide for the portable storage of secure privatized data and a means for multiple parties to access such protected data in a controlled way. There is a need for a portable multi user secure database and a system and method for storage and retrieval of select data by an authorized user which is not provided for in the prior art.

In particular there is a need in the current fragmented health care system in the United States and in other countries for a generic database and network for the exchange of patient health information among different health care providers. The U.S. health care system is made up of many entities spread over a large geographic area with minimal or no communications or coordination among them for exchange of patient health data. Information is generally owned and kept by the health care provider generating the data and will only be copied to another if expressly asked for. As a result physicians do not have easy routine access to the patient s general medical records except for what they themselves produce. In addition patients going from one health care provider to another usually do not have the relevant records and test results with them. This system results in a number of major problems including delays in diagnosis and treatment inefficient use of time and resources unnecessary repetition of tests and errors in medical practices that could lead to thousands of deaths each year.

Finally the physician s lack of immediate access to patient information also encourages fraud and abuse of our current health care system. The consequences of such abuse are increased insurance premiums and therefore increased cost to the consumer. There is clearly a need therefore for a more accessible portable and efficient system for exchanging patient health information among different health care providers.

There is also a need for a system and method of managing and accessing medical data that maintains a patient s privacy. In fact as a result of the Health Insurance Portability and Accountability Act HIPAA enacted by Congress in 1996 U.S. health care providers are now mandated to maintain patient data in a private and secure manner. In accordance with HIPAA patient health care information can only be divulged by a physician to other health care providers upon the consent of the patient.

Though some attempts have been made to implement an accessible electronic medical information system none of them provide the accessibility security and portability needed to address the current problems in our health care system. U.S. Pat. No. 5 899 998 to McGauley et al. for example discloses a method and system for maintaining and updating computerized medical records. The system includes a set of databases that propagate data from one database to the other over a network. Encryption techniques are used to maintain the security of the data only when it is being transmitted to other computers.

Similarly U.S. Pat. No. 6 463 417 to Schoenberg discloses a method and system to allow access to patient data over a communications network. All patient medical records are stored on a number of computers. Access to these computers is only available via a communications network. Should the network fail the access to the data will be lost. In addition access to such a host based database requires access to another provider s system or another insurance company s database which may not be easily accessible due to business reasons.

U.S. Pat. No. 6 523 116 to Berman discloses a personal card that contains a public key to access a centralized database. The public key identifies the patient whose medical record is needed and allows access to the data. The card only provides the user access to the database. No medical data records are available on the card. The user needs either direct access or an access point that is connected to the computer that hosts the centralized database generally through a network.

U.S. Pat. No. 5 832 488 to Eberhardt discloses storage of a patient s medical history on a smart card. The medical history on the card can be updated and also stored on a computer database. The card is associated with an ID number rather than a name and only health care providers have a list to associate the ID number with a name. The data is not otherwise protected or secure and there is no mechanism for a patient to selectively authorize a physician access to particular data records saved on the card. In summary none of these systems provide a database that is portable and easily accessible to both health care providers and patients within an environment that adequately protects the patient s privacy.

These and other prior art systems and methods for providing a medical database which include server based storage low tech compact disc CD formats or low memory smart cards have at least the following limitations. The server based solutions do not allow off line access to the data the low memory smart cards have very limited storage capability and are generally used only as identification tokens and CDs are neither easy to use nor flexible enough to handle the necessary security requirements. Other limitations of the prior art include the inability to provide integrated data across multiple providers the inability for the patient and the doctor to have easy access to their own medical data and medical history and the lack of a standard format where the data can be easily stored in a secure form and mined .

There is a need therefore which is lacking in the prior art for a system and method for providing a storage system and method for providing the secure storage of and hierarchical multi user access to privatized data on a portable database.

The present invention which addresses the needs of the prior art relates to a system and method for providing the secure storage of and hierarchical multi user access to privatized data on a portable database. The invention may be applied to numerous applications including for example providing an efficient cost effective health care system and patient medical record database or providing a multi user secure system for the sale or rental of music and or videos downloaded onto a flash smart card owned by the purchaser.

The present invention provides a method of providing managing and accessing a multi user portable secure database. A database is provided with a secure portion and a non secure portion. The method includes storing security components for encrypting and decrypting data files in the secure portion and storing encrypted data files in the non secure portion. The method further includes controlling access to the encrypted data files by assigning an access control matrix to each encrypted data file according to a hierarchical structure. The access control matrix defines access rights of each user to each encrypted data file by assigning a level of access to each type of access. A user requesting access is associated with one of the security components for allowing the requested access and the requested access to one or more of the encrypted data files is allowed in accordance with the access control matrix.

A multi user system is also provided for storing updating and accessing secure data records using a portable database which includes a secure portion and a non secure portion. The system includes a data structuring module and an access control module. The data structuring module is configured to embed a hierarchical structure for each user into each secure data record in the portable database. The hierarchical structure identifies each user and allows for assigning access rights to each secure data record. The access control module is configured to embed a security element into each secure data record and to cooperate with a security management module for managing a plurality of security elements associated with a plurality of users and with the data structuring module. The access control module is also configured to assign the access rights for each user to each secure data record and to allow a user access to a secure data record in accordance with the assigned access rights. The non secure portion of the portable database includes the secure data records and the secure portion includes at least one of the plurality of security elements.

As a result the present invention provides a method for providing managing and accessing a multi user portable secure database system and a system for storing updating and accessing secure encrypted records on a portable database. The system and method provide multi user access on a hierarchical basis and a portable database that carries with it all necessary information and security components to enable secure access to authorized users.

The system and method is particularly useful for managing health care data between multiple users including various health care providers pharmacists medical insurance companies and the patient to whom the health care data pertains and optionally to those outside the medical community for specific purposes. A medical smart card held by doctors EMT workers and others also includes patient controlled access requiring patient authorization for release of any medical information to the selected third party.

The preferred embodiments of the method and system for providing the secure storage of and hierarchical multi user access to privatized data on a portable database as well as other objects features and advantages of this invention will be apparent from the following detailed description which is to be read in conjunction with the accompanying drawings.

The present invention provides a system and method for providing a secure database format and access technology oriented towards portability small footprint security and a distributed nature in a public environment in which multiple users can have varying levels of access to the secure data. The database which may be provided on a generic database platform is highly flexible and easy to use and allows for users to be added on demand.

The term data record is used interchangeably with the term data file data and file herein to mean data in any format which can be stored as a file on a computer including text binary and graphics.

The data stored in the portable database of the present invention may include multiple formats including any combination of textual digital images digital audio and digital video. In addition the system and method for providing the secure portable database of the present invention may be utilized across many market segments.

Moreover the present invention provides a system and method for embedding the security management and access rights to different levels of data in the database itself which allows for portability of the secure database. Security management includes providing data encryption and digital signatures to ensure data integrity and to verify an owner of each data record. Therefore all data records on the portable database are encrypted and signed. The secure database may be maintained on a personalized data card which may be carried by a user of the database such as a high storage secure memory card for example an X Mobile card XMC which is available from Renesas Technology America Inc. 450 Holger Way San Jose Calif. 95134. Further no on line access to any hosts is required for control of the security. Optionally however synchronization with a host database or a patient s personal computer for example is provided as a means to backup data from the patient s card.

As one particular example there is an immediate need for providing a secure portable medical database system which is compliant with the recent Health Insurance Portability and Accountability Act HIPAA . The portable database can be stored in a secure common format and distributed among patients and health care providers. Each patient preferably carries his own medical history on a personalized secure memory card. The entire database including the medical histories of all patients in a health plan for example as well as information about all health care providers in the plan may additionally be stored on a secure server.

Referring to the system and method of the present invention for providing a secure portable database for a particular secure application e.g. for storing updating transporting and accessing data records can generally be differentiated into three main functional components Data Structuring Access Control and Security Management. These components are provided in block diagram format. Specifically the system includes a data structuring module for creating data records from any application data whereby each data record is embedded with a hierarchical structure of users and an access control module which provides a security layer to the application data by embedding security components and encrypting the data records after structuring by the data structuring module . The access control module also provides user interface in cooperation with a security management module to provide a secure portable database in a multi user environment according to the method of the present invention. Optionally the system includes the management module which preferably further includes a key management module and a user identification or authentication module .

The secure application itself requires some type of physical storage for storing the secure portable database . However the implementation of the system and method according to the present invention function independently from the storage device and are not limited to any one particular type. In addition any encryption methods known to those skilled in the art may be applied including both symmetric key encryption such as Advanced Encryption Standard AES and asymmetric key encryption. Examples of preferred physical storage spaces for use with the system and method of the present invention include a flash memory in which the data can be stored as binary files or a text based Extensible Markup Language XML database.

The database itself is preferably partitioned into a secure portion and a non secure portion . Data records processed by the data structuring module are embedded with security components added by the access control module . The resulting encrypted data records are preferably stored in the non secure portion . Also stored in the non secure portion are encrypted security components and encrypted digital signatures. The non secure portion may physically be provided by flash memory e.g. in a flash smart card or a smart card which has an embedded disk for example a Universal Serial Bus USB device including flash memory plus processor to handle encryption.

The secure portion contains the security components which include encryption decryption keys certificates and so on as described in more detail below. The secure portion is preferably physically provided by a processor with the security components being made accessible via the access control mode. Smart card technology offers a secure platform for storing and maintaining encryption keys and access control data.

In one embodiment the digital certificates of all users of the system are stored on each secure data card distributed to the users. Each card also stores the owner s private key stored in a secure portion of the card.

In another embodiment the public keys may be maintained externally to the portable database e.g. on a host computer or PDA. These keys would then be accessible for example through a card reader operatively connected to the host computer or through the PDA.

The management module may include any suitable key management and user identification method known in the prior art. The access control module and data structuring module are then configured to cooperate with the management module to provide a secure multi user portable database. Each of these three modules and its implementation according to the methods of the present invention is described in more detail below.

Referring still to a method of the present invention includes providing and managing a portable secure database which includes providing the database with the secure portion and the non secure portion . The method further includes storing security components for encrypting and decrypting data files in the secure portion and storing encrypted data files in the non secure portion . The method may further include storing encrypted security components in the non secure portion . Security components may include keys and certificates associated with each user. As is well known to those skilled in the art the certificate contains a public key associated with the owner of the certificate. In addition the certificate is preferably digitally signed for example by a Certificate Authority or a Card Administrator CA . Therefore a CA public key may be used to validate the public key of the owner of a data record from his certificate and identify the groups associated with the owner according to methods well known to those skilled in the art.

Access to the encrypted data files is controlled through the access control module by assigning a level of access available to each encrypted data file record according to a hierarchical structure of users see for representation of hierarchical structure . Preferably the user identification module identifies the user requesting access. The access control module then associates the user with one of the keys stored in the secure portion which is needed for decrypting the requested encrypted data files. If the level of access associated with the requested file for the user requesting access is allowed the appropriate key is applied to decrypt the requested encrypted data files and to ensure the integrity of the data for example by verifying that originally stored data has not been modified.

The identity of each user including an ID is embedded in a certificate which is initially obtained for each user of the system from for example the card administrator of the database application. The user s membership in one or more groups is also identified using cascading certificates issued from the secure portion of the database see . The certificates attest to the user s identity and membership in a group e.g. Emergency Medical team EMT worker or hospital administrator and affect each user s access rights.

The certificates are stored in the non secure portion of the database . The identity as defined by the certificates is used for all interaction with the portable database including but not limited to the authentication of a user logging in. Upon authentication the user s certificate as well as cascading certificates attesting to the user s membership in different groups are accessed.

The user identification module operates to authenticate and verify a user requesting access by any means known to those skilled in the art including any one of several clearly designed security mechanisms e.g. challenge and response via digital signature verification. Upon verification the user requesting access is identified with the corresponding certificates. The key requirement is that a well established interface be used to store the private key on a protected user device such as a smart card or an XMC which is a product having a flash memory Security Disk SD Multimedia Card MMC with an embedded smart card chip. Examples of known security token interfaces include Cryptographic Application Program Interface CAPI and Public Key Cryptographic Standard 11 PKCS11 .

The private key associated with the certificate identifying the owner of for example the flash smart card is maintained in the secure portion of the database and is accessed from the secure portion upon authentication of the user. The private key which is stored in the secure portion is never released but is used to execute standard cryptographic operations such as digital signature generation and decryption of keys in accordance with methods well known to those skilled in the art.

The data structuring module in cooperation with the management module operates to create and maintain a hierarchical tree structure used to represent all data and users in the database which is embedded in the directory structure of the database. Through use of the hierarchical tree structure the data is added to the database into a particular folder owned by the user in a seamless automated and secure manner. All data in the owner s folder occupies a branch of the hierarchical tree and the owner has control over all data in his her branch with some possible exceptions. All data is preferably encrypted and the files can only be viewed and accessed by the parties specified through the access control module. In addition all data is preferably digitally signed using the private key of the entity or individual creating the record file. The digital signature contains details of the creator i.e. the owner of the data which can be viewed concurrently with the data itself. Data can also be marked as write once so that the data cannot be changed. In one embodiment the signed data records cannot be altered later even by the creator.

In addition a mechanism for determining any data in the database that has been tampered with is also provided. For example a signed audit log or hash as known to those skilled in the art is preferably created for all records as they are inserted into the database. An on going hash of this log may then be rehashed and signed with the card administrator s key to insure that the records have not been tampered with.

The access control module in cooperation with the data structuring module provides and maintains an access control structure for assigning and monitoring individual access rights to each data record. For example the access control module provides the ability to specify who can read the data an individual or group where the group is defined by the entity issuing the certificates and allows a mechanism for a user who has the proper access rights to read the data and to grant those access rights to the data to someone else. In addition the format for assigning security and access rights is provided independently of the database platform such that the physical database itself does not have to have security built in. The structuring module allows the capability for a record to be exported from the database to be imported into another database or to be used as a standalone record. Exported records have the same format as records in the database. A method of exporting a data record from the portable database therefore may include exporting either a read only copy a read write copy where the original is locked and cannot be changed if is re imported or a read write copy where the original is not locked.

In a system for maintaining a database reliable trusted timestamps are difficult to maintain because the timestamp must be retrieved from a secure server which generally requires the user to be online. According to the method and system of the present invention for providing a portable secure database an additional digitally signed record may be attached to each encrypted data record by the access control module to allow access rights to be granted to a record for a limited time only.

These features are obtained in part by providing a particular simple record format for all data which is tailored for a micro portable database. As described above the portable database may be physically stored on devices such as flash memory smart cards with the secure portion provided by a processor running the access control module and the non secure portion provided by flash memory.

As described in more detail below the system provides a method for all operations on the data records to be done automatically each time in a clearly specified simple format. The system and method of the present invention is further described by way of example in terms of a preferred application of the portable database to the management of patient medical data. However the scope of the present invention is not intended to be limited to medical data having application to any use requiring a multi user secure portable database. Such other applications may include but are not limited to digital media such as music and or videos retail loyalty cards maintenance records for aircraft and automobiles and secure access and payment cards for example for school campus environments.

Referring to the data structuring module provides a hierarchical tree structure of ownership to represent all data. The hierarchical structure is shown for one item or data record in the tree. Each record contains a name and a value and represents either a folder or a tree end node i.e. contains data . The data can be in any format which is able to be stored as a file on a computer including text binary and graphics. An indicator well known to those skilled in the art such as Multipurpose Internet Mail Extensions MIME preferably indicates the data type. File extensions can be used as well to name the file and to give identity to the file type.

The first level last row in the hierarchical structure of each record indicates an individual or entity. That entity controls all data within its tree in other words the data records owned by a particular entity can be created read updated or in some cases deleted by the owner of the data. The individual may be for example a particular insurance company identified by a particular User Identification User ID .

Each individual user as identified in the first level is one of the users of the database system. A user as the term is referred to herein refers generally to any card holder data record owner or third party user of the database of the present invention.

Each user of data is also a member of a group in a second level of the tree as identified in each user s certificate which allows the various owners of data records to be categorized more generally e.g. as an insurance company a doctor an emergency medical team EMT worker a pharmacist or a patient. Each user is additionally often associated with a second group more particularly identified for example a particular doctors group a specific insurance company and so on. Every owner as well as third party users who do not own any data records in the database is also a member of the world of users at the top of the hierarchical tree. Third party users may include for example those with a one time or limited time access for example summer camps and educational institutions requiring physicals and attorneys representing a patient in a personal injury case. The identity of each user including the ID is embedded in the certificate and the individual user s membership in one or more groups is embedded using cascading certificates issued from the secure portion of the database see for attaching to each owner s data records when generated.

In other words the hierarchical structure is assigned to each data record automatically as it is created via the data structuring module represented in according to the identity and group membership in the user s associated certificates which are retrieved upon authentication. By default the creator of the data record is the owner . An owner has permission to control all data within its branch of the hierarchical tree.

Referring still to the system also includes an access control structure whereby each item in the tree contains an access control entry which has the same format throughout the database. The access control entry contains a write once flag which if set indicates that the record has been written only once and has not been deleted or modified. Therefore if the flag is set the data record is valid. The access control entry further includes a level of access. The level of access in the access control entry preferably includes one of the following values Restricted R Allowed A Grant G and Supergrant S .

Referring to the access control structure includes an access matrix through which one of the values listed above is assigned to each type of access available uppermost row and to each level in the hierarchical structure of the data record . The types of access preferably include Create Read Update and Delete. These types of access as their labels suggest represent the capability to create read update or delete a particular file.

A value of Restricted in a particular row and column of the matrix therefore indicates that the type of access indicated in the column is not allowed to the hierarchical level of users e.g. individual group world represented by the row in which the value of Restricted is found. Similarly Allowed indicates that the corresponding type of access is allowed to the particular level of users in the hierarchy. The Grant level of access includes the Allowed level of access as well as the permission to grant the Allowed level of access to others. Finally the value Supergrant permits the level of users to which Supergrant is assigned for a particular type of access e.g. Read Create Update or Write permission to grant either the Allowed or Grant level of access for the particular access type to others.

In the example shown in world rights are restricted to read only access. The level of access rights in a level supercedes the rights of any row beneath it in the same column. For example because the World has read access as shown in the Read column so do the Group s and the Individual . Therefore the access rights for the Group s and the Individual are granted automatically as shown by use of parentheses and are not available for modification.

The Group row indicates the rights for a member of a group to access the data. One or more groups can be put in the Group User ID field . In other words one or more Group records can be created for an item in order to grant different groups different rights.

The individual row similarly indicates the access rights of a particular individual or entity identified by the User ID to the record . The individual is the primary holder of a certificate. In the example of the record holder of the item has access to create read update and delete the file and is the owner of the data .

In a preferred embodiment the access matrix is automatically generated for each record as it is created according to the particular user creating the record as well as the type of record being created. The non secure portion of the database is preferably partitioned so that different types of records are automatically created in different sub directories under each user s directory. For example the access control matrix shown in is automatically generated for general informational records created in one sub directory of a patient s main directory in the database. The system automatically assigns the appropriate access rights according to the hierarchical structure of the database. For example unless otherwise specified a record created in a particular folder assumes the same access rights as the folder it is created in. Likewise a folder assumes the same access rights as its parent folder unless otherwise specified. More private records with for example particular information regarding doctor s visits are maintained in a different sub directory with more restrictive access to those other than the patient.

The access control structure of the system of the present invention may further include a counter associated with each record. The counter is preferably decremented by another entity but it may also be decremented directly by a component of the access control module which is embedded in the secure portion only when another specific card is present in the system e.g. a pharmacist s card. For example when a doctor issues a prescription the counter indicates the number of times it has been filled. All members of the group pharmacy have access to this counter. In a specific example for a prescription providing for no re fills the counter would initially be set to one 1 . Upon filling the prescription all group members of pharmacy would decrement the counter on the records in the database pertaining to prescriptions for this patient to zero 0 .

The system and database formed in accordance with the present invention also preferably include additional record storage security features. Records are stored according to a common format. All records except for those that can be read by the World are encrypted. In addition the encrypted records may include a local timestamp as described above. The time stamped record together with the unique card ID assigned by the administrator ensures that the record is unique and has not been copied from another card.

Preferably each encrypted data record includes the time stamp and a digital signature. The digital signature also includes the unique card ID from which the data originated. Data accessible to the World which is not encrypted also includes a digital signature.

The method and system of the present invention for providing managing and accessing a secure portable database is provided herein by way of example for a particular embodiment of a secure portable database for patient health data. Preferably a data card such as a flash smart card is used as a platform for the portable database. The card is preferably initialized by a card administrator. Initialization includes personalizing each card and forcing certain access control rules to always be applied to particular record s for all entities or users. Referring to the item shown in a blank entry in the access control matrix generated by the administrator indicates that the card holder has privilege to assign any access value to the corresponding hierarchical level and type of access.

An individualized card is preferably issued for each user of the database. With reference to as well as to each card is first initialized by assigning a unique card ID number. Preferably a card administrator CA creates a folder e.g. SYSTEM on the card for the entity CA where the CA is a member of the group administrator ADM . The CA then assigns an ID number to the card holder which will be used to identify both the card and the card holder or owner and creates a file in the SYSTEM folder that contains the card ID number. An access control matrix is automatically assigned as shown in to the card ID file granting READ access to all users in the hierarchy to World but full access only to the CA. A certificate and private key protected by a PIN and or biometric data such as a fingerprint scan will also be issued to the card holder as part of this process. These are used to identify the owner and to encrypt and sign all data records.

Multiple portable data cards are generated in this manner and distributed for example to an insurance company for issue to individual patients who will own the card. Referring to and still also to the insurance company e.g. ABC creates its folder on the card issued according to and preferably creates file s in the folder containing records such as patient identification data including name address and preferably the patient s insurance ID number and group number. Alternatively however the same files can be created by the CA and stored under the SYSTEM folder as shown in . Upon creation the access matrix is automatically assigned as before preferably to give read rights to the WORLD and full access rights only to ABC company. It may also be preferable to assign a Supergrant access level to an insurance company e.g. ABC for files created in its folder. The access rights and information on the card could then be updated and passed on easily to a different insurance carrier should the patient change plans.

Other data may also be included in this or other files which will be readable by the WORLD including any combination of date of birth social security number a photograph religious preferences driver s license etc. This data may also include a card owner s wishes to be an organ donor and special medical conditions such as allergies.

Referring to and still to the portable database is updated in this example every time the patient sees a physician for medical treatment. First the physician creates his own folder and files within the folder. The physician e.g. Dr. J creates a physician information file which the world can read containing his contact information. The file is again automatically assigned access rights automatically with the group INS representing the patient s insurance company having only read and update access rights to the doctor s informational files.

The portable database is then further updated with one or more files containing the results of the doctor s visit. The files may include text files as well as image files for example X ray data and or audio and video files e.g. volume renderings of three dimensional computer assisted tomography CAT scans or magnetic resonance imaging MRI scans. According to the method of the present invention a copy of the patient records may be created in the patient s sub folder within the doctor s folder with an access control structure automatically generated with full access rights granted only to the doctor Dr. J at a level of access of Allowed to create read delete and update the file and optionally with READ only access granted to the insurance company. In another preferred embodiment once the file is created and exited the doctor only has READ access to the file i.e. a write once flag is enabled which locks the file and helps prevent tampering. The doctor however may review all of his previous records of this patient at any time.

A copy of the patient PAT records may also be created in the patient PAT s folder with an access control matrix assigning Supergrant privileges to the patient to grant READ access to others e.g. to another doctor and or to his insurance company. Alternatively because each individual doctor is also a member of the group DOCTOR the patient may grant read access to the group DOCTOR to allow any physician total access to all of his medical records.

Therefore upon transporting the portable database to a different physician the patient can grant access to the second physician to read the results of the previous visit to a different doctor. The means by which such authorization is provided includes exporting data using the public key of the intended recipient.

A file may also be created in the patient s directory which includes any data which may be useful for the patient to have publicly available to certain users with access to the database without comprising privacy rights such as blood type allergies to medication and other materials special health conditions e.g. epilepsy diabetes heart conditions the existence of metal objects and pace makers and other special medical conditions. Such information might include important patient history information that an emergency medical team EMT worker could quickly access in the event of an emergency. Preferably a patient s general physician would create such file in an EMT directory for example which would have full access rights to the general physician and read access to the world. In addition new emergency records could be written to a patient s card during transport to the hospital including vital signs blood pressure and other medical data collected during emergency treatment. Such data could then be accessed quickly by physicians at the hospital.

The portable database on each patient s card is thus updated transported from one health care provider to another and accessed upon permission of the patient. The database may also be updated by a pharmacy when the patient has a prescription filled. The prescription may be added to the card by the doctor granting read access rights to the entire group pharmacy. In this case a particular pharmacist within the group merely searches the card for a keyword for example prescriptions to locate and read the prescription entered by a doctor under his prescriptions folder . Optionally the prescription may be hand delivered by paper prescription. In either case the database should be updated by adding or updating the prescription information including decrementing a counter on the card if the prescription to keep track of refills.

An example of the contents of the secure portable database on the card after the patient fills his prescription at the pharmacy are provided in . A security layer has been added to the records as described above so that the patient can carry his own medical report and can view his own medical records and history securely for example on a home personal computer or on a personal digital assistant PDA or other reader adapted to read the card e.g. a smart card with flash memory without risk of altering or damaging the records. For additional security a central database may be provided so that the patient as well as health care providers can back up all records into the appropriate folders on a physical storage device which is preferably accessible to the Internet. The central database will maintain the same level of security to the files as the portable database since the security components are embedded in the files themselves. The backups could be done every time the card is written to or according to a pre arranged timed interval.

Because the patient has Supergrant access to his or her patient records the patient can authorize and consent to particular records of his choosing to be read by another select individual e.g. another doctor. He may also choose to send any of the encrypted medical records to an individual securely via the Internet or e mail.

As already described the creator of a record is automatically an owner of the record and is signed by the owner. However one may also assign ownership rights to another. For example a patient may provide rights to some of their data for research. In addition in some cases for a user other than the owner to gain a particular access level the presence and authentication of the owner is required. The symbol O after a level of user listed in indicates such a case. For example READ and CREATE in medical history under the patient s directory indicate that the patient must be present and authenticated in order for the indicated second user an EMT worker and doctor and a doctor to have READ and CREATE access respectively.

Access to the portable database and authentication is physically provided using any device that includes a processor on which the methods of the present invention may be processed and which may be operatively connected to the portable database as needed. For example any computer e.g. desk top portable or other or a suitable PDA may be used. The processing device preferably runs a standard set of features preferably through a graphical user interface GUI to allow easy access to the card and automatic implementation of the security. In addition at least the management module preferably runs on the computer by accessing the security components stored in the secure portion of the database see .

The interface between the processing device and the portable secure database may be any interface that works with a variety of media e.g. flash card hard disk or the internet. Preferably the interface is provided by an Application Programming Interface API or Extensible Markup Language XML . In addition the secure portion of the portable database is preferably embedded with a certificate that ensures the application using the interface is connected to a legitimate database with the expected secure access. Additional secure interfacing and synchronization with other media e.g. a central database or another card for backing up the portable database is likewise ensured via use of the embedded certificate.

Referring to as well as the user identification module of the management module provides authentication of a user of the portable database preferably using two factors of identification. In the particular embodiment shown user interface to the database is provided by a computer which is operatively connected to at least one portable database reader . The authentication is provided for example as shown in by the presence of a verified user s patient e.g. card in the smart card reader along with entry of a personal identification number PIN known only to the owner of the card . Optionally entry of a biometric identifier such as a fingerprint rather than a PIN or password may be used.

Referring again to preferably data records created by another e.g. a doctor can be written to a user s such as a patient s card only after authentication of the doctor s card against the patient s. This authentication process preferably requires the patient to be present and interactively enter his her password PIN etc. as a means of giving permission to the doctor to read from and or write to the patient s card. In addition the doctor also preferably goes through a two factor identification so that both doctor and patient are logged on to the application accessing the portable database. However a computer in the doctor s office may optionally have one authentication factor in the way of either a physical or software key in the computer and the second a PIN e.g. entered into the computer. Also the doctor s files may be stored on the computer rather than or in addition to on a card.

Referring to a method for validating or authenticating a user requesting access is provided for the example of a doctor logging in to the system. The password or PIN entered during authentication see is obtained and used to access a private key associated with the doctor which is stored in the secure portion of the database. The application sends a challenge to the doctor s card which uses the private key to sign the data . The user s public key pulled from the certificate is used by the application to validate the doctor s response to the challenge and thus validate the doctor s identity within the database hierarchy.

This method may also include validating an expiration date against a remote Certificate Authority or local revocation list. This may be done by comparing the data inside the certificate with a trusted time stamp on line server.

Referring to B and C the system and method of the present invention provide for automatically encrypting each data record upon creation in cooperation with the key management module of the management module see also . In for example after authentication and identification validation as described above a doctor may write data records from an office visit for example to the patient s card . Optionally the data records may also be exported with the same embedded security components to a local and or remote backup storage space and parts of the data records containing information regarding the patient s visit e.g. accounting information may be exported to a different database .

A method of writing to another s smart flash card includes automatically encrypting the data as provided in using the key management module as shown in . In this example a doctor is writing to a patient s card . Referring to both and once permission is granted by the patient according to the authentication and validation processes described above the data is obtained for writing to the card. A public key is obtained from the secure portion of the portable database on the patient s smart card . The data records being copied may for example be encrypted with a symmetric key e.g. Advanced Encryption Standard AES . That AES key is then encrypted with the public key of anybody who has access other than WORLD as determined by the access control matrix assigned to the data record.

Preferably the doctor s digital signature is also provided to verify its origin. Data is signed with the doctor s private key accessed from the secure portion of the doctor s card. The encrypted data is then written to the non secure portion of the patient s card along with the attached digital signature .

Referring to a method of reading encrypted data records from the portable secure database on the card includes using the key management module . The method includes obtaining the encrypted data from the non secure potion of the database and accessing a private key from the secure portion of the portable database to decrypt the symmetric key used to encrypt the data records. The method also preferably includes accessing the digital signature attached to the encrypted data records obtaining the certificate which includes the public key of the entity who signed the data and validating the signature. The results of the signature check along with the unencrypted data records are preferably sent to a display screen associated with a computer or PDA running the application.

Any method of encryption and decryption known in the art may be used with the methods of the present invention. One embodiment of a method for encrypting patient medical data records for example for secure storage to the portable non secure memory is described by where the interface application runs on a Doctor s personal computer PC . The method includes the application randomly generating an Advance Encryption Standard AES key. The patient data record is then encrypted with the key along with the group ID s access information obtained from the access control matrix. The encrypted data is then saved and stored in open non secure memory . In addition the application also encrypts the AES with the patient public key obtained from the secure portion of the smart card and stores the encrypted AES in open memory .

The encrypted data record may then be accessed decrypted and sent to the entity with the access rights to at least read the data. After the two factor authentication validates the user e.g. patient requesting access at least one of the factors is used to begin the decryption process. For example a password or PIN entered during authentication see is sent to a secure memory engine e.g. smart card for verification. In response to the verification the encrypted AES key is obtained from the open flash memory and the patient s private key which is stored in the secure portion is sent to the smart card. The AES key is then decrypted using the private key. The decrypted or open AES key is then applied automatically to decrypt the patient data. Access to the decrypted data is then made available according to the access rights assigned through the access control matrix for the user requesting access. Other examples of encryption decryption techniques are provided below. It is understood however that these examples are not intended to limit the scope of the invention and any cryptographic method appropriate for use with the secure portable database may be used.

Referring to a method of encryption is provided similar to that shown in except that the randomly generated AES key is stored in the secure memory smart card . The AES key is only made available when the patient or the owner of the card provides a password or biometric input or other identifier.

Preferably the application runs on the host PC and randomly generates an AES Advance Encryption Standard key. The application then encrypts patient data and all group ID access information with the AES key. The encrypted data is then saved in the open memory and the AES key is stored in the secure memory smart card.

Referring still to a method of decrypting the data records is also similar to the example shown in with the difference that the AES key can be obtained from the secure memory smart card by the patient providing the password biometrics or other ID. Specifically the patient provides the ID to allow the decryption process. The password is sent to the smart card secure memory engine and the smart card verifies the password or biometrics input. The AES key is then sent to the application after authenticating the password . The open AES key is used to decrypt the patient data obtained from the open memory. The decrypted data is then available to be read by those whose Group ID is allowed .

In another example shown in the patient data and group ID s obtained from the cascading or group certificates are encrypted using the randomly generated AES key while the Group IDs associated with this data are encrypted together with the AES key with an application specific Public key which is provided e.g. by the Card Administrator CA . Again it is assumed the application runs on a doctor s host PC. The application randomly generates an AES Advance Encryption Standard key and then encrypts patient data with the AES key . The encrypted data is then saved in the open memory . All group IDs allowed to read this data are appended to the AES key and form the AES Record . The AES Record is encrypted using the CA s Public key and the AES Record is stored in open memory .

An example of decryption of the group ID s and data is shown in an entity is validated to make sure it has a valid ID. The system then checks to see whether that entity has access rights to the data. The system consists of the application running on the doctor s PC the patient smart card and the Doctor s card smart card.

First the doctor is validated see . The patient smart card receives the encrypted AES Record . The patient smart card decrypts AES Record using an Application Specific or Card Administrator s CA Private key to retrieve the AES key and the Group IDs. The patient smart card receives the Doctor s certificate and Doctor s Public key and the patient smart card extracts the Doctor s Group ID . The Doctor s Group ID is then compared with the Group IDs that the patient smart card has extracted from the AES Record . If the Group IDs match the AES key is encrypted with Doctor s public key . The encrypted AES key is passed to the Doctor s smart card which decrypts the AES using Doctor s Private key . The AES is then used by the application to decrypt the permitted data received from the open memory.

Though the examples above have been provided for the example of a secure portable database for storing managing and accessing patient medical history in a secure multi user environment it is understood to those skilled in the art that the system and method of the present invention may be extended to many other uses such as for sale or rental of music or videos downloaded onto a flash smart card.

Therefore as a result of the present invention a multi user secure portable database and a system and method for providing and managing said database are provided.

Although the preferred embodiments of the present invention have been described with reference to the accompanying drawings it is to be understood that the invention is not limited to those precise embodiments and that other changes and modifications may be made by one skilled in the art without departing from the scope and spirit of the invention.

