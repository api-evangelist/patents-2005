---

title: Application monitor apparatus
abstract: An application monitor apparatus is provided that enables feedback to be sent to a transmitting terminal without relay processing of application data in the application layer. A packet transmission decision unit outputs to an application monitor unit and a packet transmitting unit only packets for which transmission is authorized by both the application monitor unit and the packet transmitting unit. When monitoring processing of the application monitor unit is slower than the rate of receiving packets at a packet receiving unit, the packet transmission decision unit sends feedback to the packet receiving unit to delay the transmission of packets.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08289860&OS=08289860&RS=08289860
owner: NEC Corporation
number: 08289860
owner_city: Tokyo
owner_country: JP
publication_date: 20051116
---
The present invention relates to an application monitor apparatus and more particularly to an application monitor apparatus that is required for monitoring processing in which a data loss does not arise in real time.

The importance of functions that monitor data communicated between a transmitting terminal and a receiving terminal has been increasing in recent years accompanying the explosive spread in the use of the Internet. In particular monitoring processing requires not only layer 3 IP Internet Protocol layer 4 TCP Transmission Control Protocol and UDP User Datagram Protocol but also complex monitoring processing that refers to the contents of an application layer.

Further when utilizing monitoring processing for accounting or the like it is necessary for an application monitor apparatus to execute complete monitoring processing in real time without losing the data that is the object of monitoring.

In general methods of monitoring application data communicated between a transmitting terminal and a receiving terminal can be broadly classified into two kinds. The first kind is a method that monitors the communicated packets without influencing the communication between the transmitting terminal and the receiving terminal for example see Japanese Patent Laid Open No. 11 243389 .

A configuration example of an application monitor apparatus that utilizes this first method is shown in . In an application monitor apparatus comprises a packet receiving means and an application monitor means .

Packets that are transmitted from transmitting terminals . . . N are input into receiving terminals . . . N via a plurality of intermediary devices . A data replication means is present at some point along the path of communication between the transmitting terminal and the receiving terminal and all of the replicated packets are input into the application monitor apparatus .

As the intermediary devices routers LAN Local Area Network switches repeaters and the like are used. Although in the transmitting terminals and the receiving terminals are connected to one of the intermediary devices respectively this merely represents one example of a connection between the transmitting terminals receiving terminals and intermediary devices on the Internet. Configurations can also be considered in which a plurality of the intermediary devices are provided and in which no intermediary devices are provided and the connection configuration thereof is arbitrary. Further although the transmitting terminal and receiving terminal are described separately in to facilitate explanation in general an actual terminal has the functions of both the transmitting terminal and the receiving terminal .

All of the packets that are input to the application monitor apparatus are subjected to termination processing up to layer 4 transport layer in the packet receiving means to assemble the application data after which the required monitoring processing is carried out in the application monitor means . With respect to the termination processing up to layer 4 it is not necessary to execute all the layer 4 termination processing in the receiving terminals .

For example when layer 4 is TCP although it is necessary to perform processing that reassembles the data in order to guarantee the data sequence there is no necessity to transmit data to the transmitting terminal such as when processing an ACK acknowledgement transmission to the transmitting terminal . Further when layer 4 is UDP special processing is not required and data may be simply passed to the application monitor means .

According to the first method when the processing speed at the application monitor means is lower than the rate of inputting packets to the packet receiving means a data loss is generated inside the application monitor apparatus and complete monitoring processing cannot be executed.

The second method is one in which an application monitor apparatus relays application data between a transmitting terminal and a receiving terminal and performs monitoring processing at the time of the relay processing. In order to relay the application data it is necessary for the monitor apparatus to execute termination processing up to layer 4.

A configuration example of an application monitor apparatus that utilizes this second method is shown in . In an application monitor apparatus comprises a packet receiving means an application monitor means and a packet transmitting means .

Packets that are transmitted from the transmitting terminals . . . N always pass through the application monitor apparatus via the intermediary device to be transferred to the receiving terminals . . . N via the intermediary device . The packets that are input into the application monitor apparatus undergo termination processing up to layer 4 in the packet receiving means and are then input into the application monitor means .

When layer 4 is TCP the termination processing up to layer 4 in the packet receiving means includes ACK transmission processing with respect to the transmitting terminal . Accordingly with the application monitor apparatus of the second method it is possible to execute rate control for the input traffic. More specifically when the processing speed at the application monitor means is slower than the rate of inputting packets to the packet receiving means by transmitting feedback from the application monitor means to the packet receiving means the transmitting terminal dynamically controls the rate of transmitting packets with the TCP rate control.

Therefore according to the second method monitoring can be executed in which packet loss does not occur. In this connection although according to the second method communication between the transmitting terminals and receiving terminals is split into two parts by the application monitor apparatus the application monitor apparatus may comprise one of two kinds of apparatus. The first kind is an apparatus such as a proxy server in which case the transmitting terminals and receiving terminals know of the existence of the application monitor apparatus . The second kind is a stealth type of apparatus in which case the transmitting terminals and receiving terminals do not know of the existence of the application monitor apparatus .

More specifically the term know of the existence of the application monitor apparatus refers to the transmitting terminals transmitting the packets to the application monitor apparatus with the assumption that layer 4 termination will be conducted once at the application monitor apparatus .

After the application monitoring processing part performs the required monitoring processing it carries out a request to transmit data to a TCP transmission processing part . After subjecting the transmitting data to termination processing of the TCP layer at the TCP transmission processing part and then performing termination processing up to the IP layer at the IP transmission processing part the packets are transmitted to the network.

As the TCP termination processing performed at the TCP receiver processing part and the TCP transmission processing part it is necessary to execute all TCP processing such as guaranteeing the packet sequence send processing of ACK packets rate control at the transmitting side and receiving side and control for retransmission of packets. Further the TCP receiver processing part the TCP transmission processing part and the application monitoring processing part are generally connected by an API Application Programming Interface called a socket and it is known that TCP processing also entails heavy processing in the respect that each of these parts always requires a copy of the data being transmitted or received.

Examples of the application monitor apparatus that utilizes the second method include a firewall device application gateway that refers to the application layer and a proxy server.

In the above described conventional application monitor apparatus utilizing the first method a problem exists in that feedback can not be sent from the application monitor apparatus to the transmitting terminal. More specifically when the processing performance of the application monitor means is lower than the performance of processing communication between the transmitting and receiving terminals in the application monitor apparatus utilizing the first method complete monitoring processing can not be carried out because the monitoring processing does not keep up with the rate of communication between the transmitting terminal and receiving terminal and a packet loss occurs.

Further according to the conventional application monitor apparatus utilizing the second method since it is necessary for the application monitor means to perform monitoring processing of data at the application layer and also to relay data received from a packet receiving means to a packet transmitting means there is a problem in that the processing load required to execute monitoring processing is extremely heavy in the application monitor apparatus that utilizes the second method.

In this case it is necessary to execute all the TCP termination processing including guaranteeing the packet sequence send processing of ACK packets rate control at the transmitting side and receiving side and control for retransmission of packets. A heavy processing load thus exists particularly in the TCP receiver processing part and TCP transmission processing part.

Further the socket API for connecting the TCP receiver processing part the TCP transmission processing part and the application monitoring processing part is also a factor that produces a heavy processing load in the respect that a copy of data being sent and received is always required at each respective part when data passes from the TCP receiver processing part to the application monitoring processing part and then from the application monitoring processing part to the TCP transmission processing part.

Since it is necessary to always continue execution of relay processing for the corresponding connection even after the application monitor means decides that monitoring processing is unnecessary there is a problem that the processing load for executing the monitoring processing is extremely heavy in the application monitor apparatus that utilizes the second method.

Thus an object of the present invention is to solve the above described problems by providing an application monitor apparatus that can send feedback to a transmitting terminal without conducting relay processing of application data for an application layer.

An application monitor apparatus according to the present invention comprises packet receiving means that receives packets from a network packet transmitting means that transmits packets to the network and application monitor means that performs monitoring processing for packets that are received by the packet receiving means wherein the application monitor apparatus has packet transmission decision means that includes means that transmits packets that are input from the packet receiving means to both the application monitor means and the packet transmitting means and decision means that decides whether or not to transmit packets input from the packet receiving means to both the application monitor means and the packet transmitting means on the basis of information from the application monitor means and the packet transmitting means respectively.

According to the application monitor apparatus of the present invention since the packet transmission decision means carries out the transfer of packets to the application monitor apparatus and the packet transmitting means only at a time when both the application monitor means and the packet transmitting means are capable of receiving the packets it is guaranteed that all packets that arrive at a receiving terminal from the packet transmitting means also arrive at the application monitor means.

When processing at the application monitor means is slow direct feedback is sent to ensure that packets are not transmitted from the packet transmission decision means to the application monitor means and the packet transmitting means and thus it is also guaranteed that a packet loss will not occur.

Furthermore since it is not necessary for the application monitor means to relay data from the packet receiving means to the packet transmitting means the application monitor means need perform only monitoring processing and thus high speed monitoring processing can be realized. In particular according to application monitor means to be described later the only processing that is required in the TCP Transmission Control Protocol layer is assembly processing for packets in order to guarantee the packet sequence for the TCP connection. Since no other TCP termination processing such as transmission processing of ACK acknowledgement packets rate control at the transmitting side and receiving side or control for retransmission of packets is required the processing is performed at a high speed.

Further it has been pointed out that the load of copy processing of data transmitted through the socket API Application Programming Interface is heavy for the application monitor apparatus utilizing the second method when transmitting data from the application monitoring processing part to the TCP transmission processing part. However according to the application monitor apparatus of the present invention since it is not necessary to transmit data from the application monitor means it is possible to reduce the load caused by the buffer copy processing.

Also for cases in which the monitoring processing has become unnecessary since it is not necessary for the application monitor means to process the packets of the corresponding connection and only the connections that require the monitoring processing need be processed it is possible to realize extremely high speed monitoring processing.

Next an embodiment of the present invention is described referring to the drawings. is a block diagram showing the configuration of an application monitor apparatus according to an embodiment of the present invention. In an application monitor apparatus according to the embodiment of the present invention comprises packet receiving means packet transmission decision means packet transmitting means and application monitor means .

At the packet receiving means after termination processing of the necessary layer is performed for packets received from a network in packets received from transmitting terminals . . . N through an intermediary device packets are output to the packet transmission decision means .

The packet transmission decision means transmits to both the application monitor means and the packet transmitting means the packets that are input from the packet receiving means only when it decides that it is possible to transmit the packets to both the application monitor means and the packet transmitting means in accordance with information that is input from both the application monitor means and the packet transmitting means .

Further in a case where the packet transmission decision means cannot send to the application monitor means and the packet transmitting means the packets that are input from the packet receiving means the packet transmission decision means causes the packet transmitting rate to be lowered by transmitting feedback to the transmitting terminal .

Methods for transmitting feedback to the transmitting terminal will be described later and these methods include a method that notifies the transmitting terminal that the packet transmission rate is too high by simply discarding packets and a method that utilizes the rate control of the TCP Transmission Control Protocol layer.

After the packet transmitting means carries out the termination processing of the layer that is required for packet transmission such as header creation it transmits the packets to the network in packets are transmitted from the packet transmitting means to the receiving terminals . . . N through an intermediary device . The application monitor means performs the required monitoring processing on the packets that are input from the packet transmission decision means .

Hereunder the operation of the application monitor apparatus according to the embodiment of the present invention is described referring to .

Packets that are input from the network to the application monitor apparatus are input into the packet transmission decision means via the packet receiving means inside the application monitor apparatus . The packet transmission decision means sends to the application monitor means and the packet transmitting means only packets that it decides can be sent to both the packet transmitting means and the application monitor means .

Since the transmission of packets is always authorized by the application monitor means and the packet transmitting means when the packet processing speed of the packet transmitting means and the application monitor means is sufficiently fast compared to the rate of inputting packets to the packet receiving means from the transmitting terminal packets are transmitted to the receiving terminal without almost any delay.

In particular when the packet transmitting means can guarantee that it can transmit 100 of the packets input from the packet transmission decision means to the network without any loss there is no necessity for the packet transmitting means to notify the packet transmission decision means of information concerning whether or not the transmission of packets is possible and thus the packet transmission decision means can decide whether or not to transmit packets on the basis of only information from the application monitor means .

When monitoring processing at the application monitor means is slower than the rate of inputting packet data from the packet receiving means and the processing of all packets can not be executed the application monitor means notifies the packet transmission decision means that it can not receive packets. Because the packet transmission decision means transmits packets to the packet transmitting means and the application monitor means at a speed at which the application monitor means can process all the packets it is possible for the application monitor means to realize the monitoring processing without packet loss.

Next a specific example of a transmission decision method of the packet transmission decision means of will be described. is a block diagram showing a first configuration example of the packet transmission decision means of and is a view showing one example of a transmission authorization table shown in . In packet transmission decision means comprises an application monitor means transmission authorization condition receiving part a packet transmitting means transmission authorization condition receiving part a transmission authorization table and a transmission decision part .

The transmission authorization table manages application monitor means transmission authorization information and packet transmitting means transmission authorization information for each connection Connection ID as shown in . For packets for which a transmission request is received the transmission decision part refers to the entry for the corresponding connection ID in the transmission authorization table to check the application monitor means transmission authorization information and the packet transmitting means transmission authorization information.

The transmission decision part only transmits packets to both the application monitor means and the packet transmitting means when transmission of packets is authorized to both the application monitor means and the packet transmitting means and when the transmission of packets is not authorized to either one of the application monitor means and the packet transmitting means the transmission decision part discards the packets.

When the application monitor means transmission authorization condition receiving part receives from the application monitor means the transmission authorization information for the application monitor means it updates the application monitor means transmission authorization information in the transmission authorization table . Similarly when the packet transmitting means transmission authorization condition receiving part receives from the packet transmitting means the transmission authorization information for the packet transmitting means it updates the packet transmitting means transmission authorization information in the transmission authorization table .

Data that is input from the packet receiving means is temporarily stored in connection units in the packet buffer . The transmission authorization table manages the buffer storage amount the application monitor means transmission authorization amount and the packet transmitting means transmission authorization amount for each connection Connection ID as shown in . When the packet buffer receives packets from the packet receiving means it updates the buffer storage amount relating to the corresponding connection ID of the transmission authorization table to a value that is increased by the amount of the received packets.

The application monitor means transmission authorization condition receiving part receives from the application monitor means information regarding the number of bytes that can be transmitted to the application monitor means and updates the application monitor means transmission authorization amount of the transmission authorization table . Similarly the packet transmitting means transmission authorization condition receiving part receives from the packet transmitting means information regarding the number of bytes that can be transmitted to the packet transmitting means and updates the packet transmitting means transmission authorization amount of the transmission authorization table .

When the information of the transmission authorization table is updated the transmission decision part reads the entry relating to the updated connection ID and determines the lower value among the application monitor means transmission authorization amount and the packet transmitting means transmission authorization amount that is the amount that can be transmitted to both the application monitor means and the packet transmitting means .

When the amount that can be transmitted to both of these is not 0 and the value of the buffer storage amount is also not 0 the transmission decision part reads packets corresponding to the smallest value among the amount that can be transmitted to both of these and the buffer storage amount from the packet buffer and transmits the packets to both the application monitor means and the packet transmitting means .

Thereafter the transmission decision part subtracts the amount of the transmitted packets from the buffer storage amount the application monitor means transmission authorization amount and the packet transmitting means transmission authorization amount to update the transmission authorization table . In this connection although the above transmission authorization table utilizes the buffer storage amount the application monitor means transmission authorization amount and the packet transmitting means transmission authorization amount for example the same control can be carried out by utilizing a relative value such as the byte sequence number of received data.

According to this third configuration example the transmission decision part transmits packets separately to the application monitor means and the packet transmitting means . The transmission authorization table controls the transmission of data utilizing data byte sequence numbers and not the values for buffer storage amount and transmissible amount.

For each connection Connection ID the transmission authorization table comprises a buffer storage sequence an application monitor means transmission completion sequence a packet transmitting means transmission completion sequence an application monitor means transmission authorization sequence a packet transmitting means transmission authorization sequence and a buffer storage amount see and . In this connection although a buffer storage amount field is not essential as it can be calculated from the other fields it is included in one field of the entries of this table in order to facilitate explanation of the third configuration example.

The terms application monitor means transmission authorization sequence and packet transmitting means transmission authorization sequence refer to the maximum sequence numbers that the application monitor means and the packet transmitting means are authorized to transmit respectively. The application monitor means transmission authorization sequence is updated from the application monitor means through the application monitor means transmission authorization condition receiving part . The packet transmitting means transmission authorization sequence is updated from the packet transmitting means through the packet transmitting means transmission authorization condition receiving part .

The terms application monitor means transmission completion sequence and packet transmitting means transmission completion sequence refer to the ends of sequence numbers of data that has been transmitted to the application monitor means and the packet transmitting means respectively. The buffer storage sequence is the end of a sequence number of data stored in the packet buffer .

When the transmission authorization table is updated the transmission decision part reads out the corresponding connection ID entry. When the value of the application monitor means transmission authorization sequence and the value of the buffer storage sequence are both larger than the application monitor means transmission completion sequence packets are transmitted to the application monitor means until the value thereof reaches the value that is the smaller of the value for the application monitor means transmission authorization sequence and the value for the buffer storage sequence. After transmitting packets to the application monitor means the transmission decision part reads the value of the application monitor means transmission completion sequence to update it to the value of the transmission completed sequence number.

Similarly when the value of the packet transmitting means transmission authorization sequence and the value of the buffer storage sequence are both larger than the packet transmitting means transmission completion sequence packets are transmitted to the packet transmitting means until the value thereof reaches the value that is the smaller of the value for the packet transmitting means transmission authorization sequence and the value for the buffer storage sequence. After transmitting packets to the packet transmitting means the transmission decision part reads the value of the packet transmitting means transmission completion sequence to update it to the value of the transmission completed sequence number.

According to the third configuration example although it is possible for the transmission decision part to transmit packets independently to the application monitor means and the packet transmitting means the feature of this configuration is that it can be guaranteed that ultimately the same data is transmitted to both the application monitor means and the packet transmitting means .

The IP receiver processing part corresponds to the above described packet receiving means and the IP transmission processing part corresponds to the above described packet transmitting means . Further the application monitor means that is provided with the L4 assembly processing part and the application monitoring processing part corresponds to the application monitor means .

The IP receiver processing part performs IP termination processing for data received from a network not shown and outputs packets to the packet transmission decision means . The IP transmission processing part transmits packets that are received from the packet transmission decision means to the network.

For packets received from the packet transmission decision means the L4 assembly processing part performs assembly of data according to necessity and then outputs the data to the application monitoring processing part . When layer 4 is UDP User Datagram Protocol since assembly of data is not necessary the L4 assembly processing part outputs the packets as they are to the application monitoring processing part .

When layer 4 is TCP Transmission Control Protocol since there is a possibility that the packet sequence is changed the received data is stored in a packet buffer not shown in the L4 assembly processing part and after rearranging the packets according to their sequence the L4 assembly processing part outputs the data that was rearranged into the proper sequence to the application monitoring processing part . However when the processing of the application monitoring processing part is not conducted in time data for which assembly was completed also remains stored in the packet buffer and output of the packets is performed after transmission authorization is received from the application monitoring processing part .

When the rate of inputting packets into the L4 assembly processing part from the packet transmission decision means is higher than the rate of inputting packets into the application monitoring processing part from the L4 assembly processing part packets are stored in the packet buffer of the L4 assembly processing part . When in accordance with the storage amount of the packet buffer the L4 assembly processing part determines that it should not receive packets it notifies the packet transmission decision means that it cannot store packets.

The application monitoring processing part receives data that is arranged according to sequence from the L4 assembly processing part and then executes the required monitoring processing. When the processing by the application monitoring processing part of packets that are input from the L4 assembly processing part is not conducted in time the application monitoring processing part notifies the L4 assembly processing part that the monitoring processing is not being conducted in time.

Similarly to the packet transmission decision means shown in if packets that are input from the IP receiver processing part are those for which transmission is authorized by both the L4 assembly processing part and the IP transmission processing part the packet transmission decision means outputs the packets to both the L4 assembly processing part and the IP transmission processing part . In all other cases the packet transmission decision means discards the packets received from the IP receiver processing part .

According to the first example of the present invention when processing of the application monitor means is not conducted in time packets that are input into the packet transmission decision means are discarded. When layer 4 is TCP it is necessary for the transmitting terminal to resend the packets that are discarded. As a result the rate of inputting packets to the application monitor means is lowered and it is possible to realize monitoring processing without any packet loss.

The second example of the present invention has the same configuration as the above described application monitor apparatus according to the first example of the present invention shown in except that the contents of the packet transmission decision means of the application monitor apparatus according to the first example of the present invention are changed in the second example.

Similarly to the packet transmission decision means shown in the packet transmission decision means according to the second example of the present invention has a packet buffer that stores received packets. When the packet transmission decision means cannot transmit packets received from the IP receiver processing part instead of discarding the packets it stores the packets in the packet buffer and then transmits the packets when transmission of the packets is enabled.

However when packets are received from the IP receiver processing part the packets may be discarded depending on the buffer usage amount of the packet buffer. Methods of discarding packets include a method which simply discards packets when the packet buffer becomes full and a method that discards packets at random utilizing AQM Active Queue Management such as RED Random Early Discard see RFC Request For Comments 2309 .

According to the second example of the present invention since the packet transmission decision means comprises the packet buffer the probability of packets being discarded in succession by the packet transmission decision means is lowered and thus an effect is achieved that the probability of packets being discarded due to a temporary burst is reduced.

The third example of the present invention has the same configuration as the above described application monitor apparatus according to the first example of the present invention shown in except that it is possible to distinguish each connection ID when making a decision as to whether or not transmission of packets is possible.

More specifically the application monitoring processing part notifies the L4 assembly processing part as to whether or not reception of packets is possible for each connection and the L4 assembly processing part and the IP transmission processing part notify the packet transmission decision means as to whether or not reception of packets is possible for each connection.

The packet transmission decision means has a function that determines whether or not transmission authorization for each connection is issued from both the L4 assembly processing part and the IP transmission processing part . Thus when packets are received from the IP receiver processing part the packet transmission decision means decides whether or not transmission of packets for the corresponding connection is possible. When transmission is possible packets are output to both the L4 assembly processing part and the IP transmission processing part and when the packet transmission decision means decides that transmission is not possible the packets are discarded.

According to the third example of the present invention by determining whether or not transmission of packets is possible for each connection when a monitoring processing load is heavy for only a small number of connections the transmission rate is lowered by discarding packets of only the connections with a heavy load and the monitoring processing can be implemented without packet loss for the other connections.

The packet transmission decision means according to the third example of the present invention has a configuration and operation that are the same as the packet transmission decision means shown in and a detailed description thereof has thus been omitted here.

The fourth example of the present invention has the same configuration as the above described application monitor apparatus according to the third example of the present invention more specifically the application monitor apparatus according to the first example of the present invention shown in except that the packet transmission decision means of the application monitor apparatus according to the third example of the present invention is modified to have a packet buffer storing packets for each connection.

According to the fourth example of the present invention when the packet transmission decision means cannot transmit packets received from the IP receiver processing part instead of discarding the packets it stores the packets in a packet buffer and transmits the packets at a time when packet transmission is enabled. At that time the packet buffer is managed by use of connection units and a decision as to whether or not packets can be transmitted is also made individually for each connection and thus packets for which transmission is enabled can be given priority for transmission.

Further when the packet transmission decision means receives packets from the IP receiver processing part it discards packets in accordance with the buffer usage amount of each connection of the packet buffer. Examples of methods for discarding packets include a tail drop method in which packets are simply discarded when the buffer usage amount exceeds a threshold value and a method which discards packets at random utilizing AQM.

Although queue management is executed using connection units in the fourth example of the present invention the queue units used to carry out packet discarding decisions are not necessarily limited to connection units. For example methods also exist which determine packet discarding for queues of packets that are grouped by class units defined by DiffServ see RFC 2474 and RFC 2475 IP address units application units distinguished by layer 4 port numbers and the like.

The packet transmission decision means according to the fourth example of the present invention has a configuration and operation that are the same as the packet transmission decision means shown in and thus a detailed description thereof has been omitted here.

The IP receiver processing part and the TCP receiver processing part correspond to the above described packet receiving means and the IP transmission processing part and the TCP transmission processing part correspond to the above described packet transmitting means . Further the application monitor means that is provided with the application monitoring processing part corresponds to the above described application monitor means .

Packets that are input from a network not shown undergo IP termination processing in the IP receiver processing part and are then input to the TCP receiver processing part . The TCP receiver processing part performs TCP termination processing for the packets. The TCP transmission processing part performs TCP termination processing for the packets input from the packet transmission decision means and transmits the packets to the IP transmission processing part . The IP transmission processing part transmits the packets that are input from the TCP transmission processing part to the network.

The TCP termination processing at the TCP receiver processing part includes transmission processing for ACK acknowledgement packets. When the transmission of ACK packets is necessary the TCP receiver processing part requests the TCP transmission processing part to transmit ACK packets directly.

The application monitor means performs monitoring processing for packets that are input from the packet transmission decision means . When the monitoring processing of the application monitor means is not conducted in time the application monitor means notifies the packet transmission decision means that it cannot receive packets of the corresponding connection.

However a notification from the application monitor means to the packet transmission decision means need not necessarily use connection units. When the application monitoring processing part cannot perform monitoring processing independently for each connection it notifies the packet transmission decision means that it cannot receive packets on any of the connections.

The packet transmission decision means reads out from the TCP receiver processing part the packets of connection that are authorized by both the application monitoring processing part and the TCP transmission processing part and outputs the packets to both the application monitoring processing part and the TCP transmission processing part .

At the TCP receiver processing part only data that can be sent to both the application monitoring processing part and the TCP transmission processing part is read out. When the processing performance of the application monitoring processing part cannot keep up with the rate of inputting packets to the TCP receiver processing part the packet queue of the corresponding connection builds up at the TCP receiver processing part and as a result rate control of the TCP layer is executed and thus the rate drops autonomously for connection for which processing is delayed.

According to the fifth example of the present invention feedback from the application monitoring processing part is notified to the TCP receiver processing part and as a result of packets being accumulated at the TCP receiver processing part rate control at the TCP layer is carried out. Thus effective monitoring processing that does not generate packet loss can be executed.

Next a method for notifying packet transmission authorization information between a packet transmission decision means a packet transmitting means and an application monitor means will be described. According to the first to fifth examples of the present invention as described above the application monitor means and the packet transmitting means issue a notification to the packet transmission decision means to indicate whether or not the transmission of packets is possible. The packet transmission decision means transmits packets to the packet transmitting means and the application monitor means only when it is possible to transmit packets to both the application monitor means and the packet transmitting means.

However any methods may be utilized for the notification method and transmission method as long as it is guaranteed that the same packets are transmitted to both the application monitor means and the packet transmitting means from the packet transmission decision means. One example thereof is described as the sixth example of the present invention. The following description uses the configuration of the application monitor apparatus according to the embodiment of the present invention shown in .

After the packet transmission decision means stores packets received from the packet receiving means in a packet buffer not shown it notifies the application monitor means and the packet transmitting means of the data amount that can be transmitted. The application monitor means and the packet transmitting means respectively and independently read out and process the data that can be transmitted.

When both the application monitor means and the packet transmitting means have completed reading out the data the packet transmission decision means determines that packet transmission is completed and deletes the corresponding packets from the packet buffer.

According to the sixth example of the present invention since the application monitor means and the packet transmitting means independently read out packets an effect is obtained whereby it is possible to eliminate the dependency relationship between the application monitor means and the packet transmitting means .

Further according to the sixth example of the present invention it is possible to flexibly adjust the packet readout amount in accordance with the load states of the application monitor means and the packet transmitting means .

The packet transmission decision means according to the sixth example of the present invention has the same operation and configuration as the packet transmission decision means shown in and thus a description thereof is omitted here.

The seventh example of the present invention is one in which the following change is added to the above described second example fourth example and fifth example of the present invention.

The application monitor means has a function that determines whether or not monitoring processing is necessary for each connection. For the connection that the application monitor means determined that monitoring processing is necessary monitoring processing is executed as described above in the aforementioned second example fourth example and fifth example of the present invention. When the monitoring processing can not be conducted in time a notification that packets cannot be received at the connection is sent to the packet transmitting means IP transmission processing part and TCP transmission processing part .

For the connection for which the application monitor means determine as the result of monitoring processing that the monitoring processing is unnecessary the application monitor means notify the packet transmission decision means that reception of packets is always possible. The application monitor means then discard the packets received from the packet transmission decision means without performing processing.

According to the seventh example of the present invention since the application monitor means has a function that discards the received packets of the connection for which the monitoring processing is unnecessary the execution of unnecessary monitoring processing can be eliminated to enable overall high speed monitoring processing.

The eight example of the present invention is one in which the following change is added to the above described seventh example of the present invention.

For the connection for which the application monitor means determined as the result of monitoring processing that the monitoring processing is unnecessary the application monitor means notify the packet transmission decision means that the monitoring processing is unnecessary.

For the connection for which the application monitor means determined that the monitoring processing is unnecessary the packet transmission decision means thereafter does not output packets to the application monitoring processing part and transmits packets only to the packet transmitting means IP transmission processing part TCP transmission processing part in accordance with only a determination as to whether it is possible to transmit packets to the packet transmitting means.

According to the eighth example of the present invention for the connection for which the monitoring processing is unnecessary there is no longer a necessity to transmit packets to the application monitor means and the application monitor means need only perform processing for the connection for which the monitoring is required. As a result it is possible to execute high speed monitoring processing.

In the application monitor apparatus according to the ninth example of the present invention comprises packet receiving means packet transmission decision means packet transmitting means and a plurality of application monitor means to N.

The packet transmission decision means transmits packets to all the application monitor means to N and the packet transmitting means only when all the application monitor means to N and the packet transmitting means have authorized the transmission of packets.

An advantage of providing a plurality of application monitor means is that processing is speeded up by simplifying the functions required for the monitoring processing of one application monitor means. By simplifying the monitoring processing it is also possible to employ hardware for the application monitor means to N to speed up processing.

For example taking the case of an e mail monitor apparatus an example can be considered in which one application monitor means is customized to only extract user information from an e mail and another application monitor means determines whether or not a particular keyword is included in the e mail.

